{
  "version": 3,
  "sources": ["../../../src/sal/infrastructure/entity_utilities.js", "../../../src/sal/entities/People.js", "../../../src/sal/primitives/validation_error.js", "../../../src/sal/primitives/entity.js", "../../../src/sal/fields/BaseField.js", "../../../src/sal/components/fields/BaseFieldModule.js", "../../../src/sal/components/fields/BlobModule.js", "../../../src/sal/components/fields/CheckboxModule.js", "../../../src/sal/components/fields/DateModule.js", "../../../src/sal/components/fields/LookupModule.js", "../../../src/sal/components/fields/PeopleModule.js", "../../../src/sal/components/fields/SearchSelectModule.js", "../../../src/sal/components/fields/SelectModule.js", "../../../src/sal/components/fields/TextAreaModule.js", "../../../src/sal/components/fields/TextModule.js", "../../../src/sal/components/fields/index.js", "../../../src/sal/fields/BlobField.js", "../../../src/sal/fields/CheckboxField.js", "../../../src/sal/fields/DateField.js", "../../../src/sal/fields/LookupField.js", "../../../src/sal/infrastructure/sal.js", "../../../src/sal/fields/PeopleField.js", "../../../src/sal/fields/SelectField.js", "../../../src/sal/fields/TextAreaField.js", "../../../src/sal/fields/TextField.js", "../../../src/sal/fields/index.js", "../../../src/sal/primitives/constrained_entity.js", "../../../src/sal/primitives/index.js", "../../../src/sal/entities/Page.js", "../../../src/sal/entities/index.js", "../../../src/env.js", "../../../src/sal/infrastructure/knockout_extensions.js", "../../../src/sal/infrastructure/register_components.js", "../../../src/sal/infrastructure/authorization.js", "../../../src/sal/infrastructure/index.js", "../../../src/infrastructure/store.js", "../../../src/entities/audit_coversheet.js", "../../../src/entities/audit_email.js", "../../../src/entities/audit_organization.js", "../../../src/entities/audit_request.js", "../../../src/entities/audit_bulk_request.js", "../../../src/value_objects/comment.js", "../../../src/value_objects/active_viewer.js", "../../../src/components/active_viewers/active_viewers_module.js", "../../../src/components/comment_chain/CommentChainTemplate.js", "../../../src/components/comment_chain/comment_chain_module.js", "../../../src/entities/audit_request_internal.js", "../../../src/services/people_manager.js", "../../../src/entities/audit_response.js", "../../../src/entities/audit_bulk_response.js", "../../../src/entities/audit_response_doc.js", "../../../src/entities/audit_response_doc_ro.js", "../../../src/entities/audit_ro_email_log.js", "../../../src/entities/config.js", "../../../src/entities/index.js", "../../../src/sal/orm.js", "../../../src/sal/index.js", "../../../src/infrastructure/application_db_context.js", "../../../src/pages/ia_db/IA_DB_Template.js", "../../../src/common/utilities.js", "../../../lib/webcomponents/searchselect/SearchSelectTemplate.js", "../../../lib/webcomponents/searchselect/searchselect.js", "../../../lib/webcomponents/data-table/data-table.js", "../../../src/pages/ia_db/ia_db.js", "../../../src/common/router.js", "../../../src/components/tabs/tabs_module.js", "../../../src/sal/components/modal/modalDialog.js", "../../../src/sal/components/modal/ModalDialogTemplate.js", "../../../src/sal/components/forms/baseForm.js", "../../../src/sal/components/forms/default/defaultForm.js", "../../../src/sal/enums/display_modes.js", "../../../src/sal/infrastructure/form_manager.js", "../../../src/components/forms/request/new_form/new_request_form.js", "../../../src/services/approvals_service.js", "../../../src/services/audit_email_service.js", "../../../src/services/permission_manager.js", "../../../src/value_objects/task.js", "../../../src/services/tasks.js", "../../../src/services/audit_request_service.js", "../../../src/services/coversheet_manager.js", "../../../src/services/audit_response_service.js", "../../../src/services/index.js", "../../../src/components/forms/request/new_form/NewRequestFormTemplate.js", "../../../src/components/request_detail_view/request_detail_view.js", "../../../src/components/forms/response_doc/confirm_approve/confirm_approve_response_doc_form.js", "../../../src/components/forms/response_doc/confirm_approve/ConfirmApproveResponseDocFormTemplate.js", "../../../src/components/forms/response_doc/confirm_reject/confirm_reject_response_doc_form.js", "../../../src/components/forms/response_doc/confirm_reject/ConfirmRejectResponseDocFormTemplate.js", "../../../src/components/forms/request/confirm_delete/confirm_delete_request_form.js", "../../../src/components/forms/request/confirm_delete/ConfirmDeleteRequestFormTemplate.js", "../../../src/components/request_detail_view/RequestDetailViewTemplate.js", "../../../src/components/request_detail_view/RequestDetailCoversheetsTabTemplate.js", "../../../src/components/request_detail_view/RequestDetailResponsesTabTemplate.js", "../../../src/components/request_detail_view/RequestDetailResponseDocsTabTemplate.js", "../../../src/components/forms/request/edit_form/EditRequestFormTemplate.js", "../../../src/components/forms/request/edit_form/edit_request_form.js", "../../../src/components/forms/cover_sheet/edit_form/edit_cover_sheet_form.js", "../../../src/components/forms/cover_sheet/edit_form/EditCoverSheetFormTemplate.js", "../../../src/components/forms/response/new_form/new_response_form.js", "../../../src/components/forms/response/new_form/NewResponseFormTemplate.js", "../../../src/components/forms/response/edit_form/edit_response_form.js", "../../../src/components/forms/response/edit_form/EditResponseFormTemplate.js", "../../../src/components/forms/response_doc/edit_form/edit_response_doc_form.js", "../../../src/components/forms/response_doc/edit_form/EditResponseDocFormTemplate.js", "../../../src/components/bulk_add_request/bulk_add_request.js", "../../../src/components/bulk_add_request/BulkAddRequestTemplate.js"],
  "sourcesContent": ["export const sortByTitle = (a, b) => {\r\n  if (a.Title > b.Title) {\r\n    return 1;\r\n  }\r\n  if (a.Title < b.Title) {\r\n    return -1;\r\n  }\r\n  return 0;\r\n};\r\n\r\nexport const sortByField = (field) => (a, b) => {\r\n  if (a[field] > b[field]) {\r\n    return 1;\r\n  }\r\n  if (a[field] < b[field]) {\r\n    return -1;\r\n  }\r\n  return 0;\r\n};\r\n\r\nexport const createNewRequestTitle = () => {\r\n  const ts = new Date();\r\n  return ts.format(\"yyMMdd\") + \"-\" + (ts.getTime() % 100000);\r\n};\r\n", "export class People {\r\n  constructor({\r\n    ID,\r\n    Title,\r\n    LoginName = null,\r\n    IsGroup = null,\r\n    IsEnsured = false,\r\n  }) {\r\n    this.ID = ID;\r\n    this.Title = Title;\r\n    this.LookupValue = Title;\r\n    this.LoginName = LoginName != \"\" ? LoginName : null;\r\n    this.IsGroup = IsGroup;\r\n    // Has the user data been fetched? Used for binding handlers.\r\n    this.IsEnsured = IsEnsured;\r\n  }\r\n\r\n  ID = null;\r\n  Title = null;\r\n  LoginName = null;\r\n  LookupValue = null;\r\n\r\n  getKey = () => this.LoginName ?? this.Title;\r\n\r\n  static Create = function (props) {\r\n    if (!props || (!props.ID && !(props.Title || props.LookupValue)))\r\n      return null;\r\n    return new People({\r\n      ...props,\r\n      Title: props.Title ?? props.LookupValue,\r\n    });\r\n  };\r\n}\r\n", "export class ValidationError {\r\n  constructor(source, type, description) {\r\n    this.source = source;\r\n    this.type = type;\r\n    this.description = description;\r\n  }\r\n}\r\n", "export class Entity {\r\n  constructor(params) {\r\n    if (params?.ID) this.ID = params.ID;\r\n    if (params?.Title) this.Title = params.Title;\r\n  }\r\n\r\n  ObservableID = ko.observable();\r\n  ObservableTitle = ko.observable();\r\n\r\n  get id() {\r\n    return this.ObservableID();\r\n  }\r\n\r\n  set id(val) {\r\n    this.ObservableID(val);\r\n  }\r\n\r\n  get Title() {\r\n    return this.ObservableTitle();\r\n  }\r\n\r\n  set Title(val) {\r\n    this.ObservableTitle(val);\r\n  }\r\n}\r\n", "import { ValidationError } from \"../primitives/validation_error.js\";\r\n\r\nexport class BaseField {\r\n  constructor({\r\n    displayName,\r\n    systemName,\r\n    instructions = null,\r\n    isRequired = false,\r\n    width,\r\n    classList = [],\r\n    Visible = ko.pureComputed(() => true),\r\n  }) {\r\n    this.displayName = displayName;\r\n    this.systemName = systemName;\r\n    this.instructions = instructions;\r\n    this.isRequired = isRequired;\r\n    this.Visible = Visible;\r\n    this.width = width ? \"col-md-\" + width : \"col-md-6\";\r\n    this.classList = classList;\r\n\r\n    this.addFieldRequirement(isRequiredValidationRequirement(this));\r\n  }\r\n\r\n  Value = ko.observable();\r\n\r\n  get = () => this.Value();\r\n  set = (val) => this.Value(val);\r\n  clear = () => {\r\n    if (ko.isObservableArray(this.Value)) this.Value([]);\r\n    else this.Value(null);\r\n  };\r\n\r\n  toString = ko.pureComputed(() => this.Value());\r\n\r\n  toJSON = () => this.Value();\r\n  fromJSON = (val) => this.Value(val);\r\n\r\n  validate = (showErrors = true) => {\r\n    this.ShowErrors(showErrors);\r\n    return this.Errors();\r\n  };\r\n\r\n  _fieldValidationRequirements = ko.observableArray();\r\n\r\n  Errors = ko.pureComputed(() => {\r\n    if (!this.Visible()) return [];\r\n    const errors = this._fieldValidationRequirements()\r\n      .filter((req) => req.requirement())\r\n      .map((req) => req.error);\r\n\r\n    return errors;\r\n  });\r\n\r\n  addFieldRequirement = (requirement) =>\r\n    this._fieldValidationRequirements.push(requirement);\r\n\r\n  IsValid = ko.pureComputed(() => !this.Errors().length);\r\n\r\n  ShowErrors = ko.observable(false);\r\n\r\n  ValidationClass = ko.pureComputed(() => {\r\n    if (!this.ShowErrors()) return;\r\n    return this.Errors().length ? \"is-invalid\" : \"is-valid\";\r\n  });\r\n}\r\n\r\nfunction isRequiredValidationRequirement(field) {\r\n  return {\r\n    requirement: ko.pureComputed(() => {\r\n      // Return true if field fails validation\r\n      const isRequired = ko.unwrap(field.isRequired);\r\n      if (!isRequired) return false;\r\n\r\n      const value = ko.unwrap(field.Value);\r\n      if (value?.constructor == Array) return !value.length;\r\n      return value === null || value === undefined;\r\n    }),\r\n    error: new ValidationError(\r\n      \"text-field\",\r\n      \"required-field\",\r\n      `${ko.utils.unwrapObservable(field.displayName)} is required!`\r\n    ),\r\n  };\r\n}\r\n", "// Hint: use the es6-string-html VS Code module to make template literals easier to read\r\nexport const html = String.raw;\r\n\r\nexport function registerFieldComponents(constructor) {\r\n  ko.components.register(constructor.edit, {\r\n    template: constructor.editTemplate,\r\n    viewModel: constructor,\r\n  });\r\n\r\n  ko.components.register(constructor.view, {\r\n    template: constructor.viewTemplate,\r\n    viewModel: constructor,\r\n  });\r\n}\r\n\r\nexport class BaseFieldModule {\r\n  constructor(params) {\r\n    Object.assign(this, params);\r\n  }\r\n\r\n  _id;\r\n  getUniqueId = () => {\r\n    if (!this._id) {\r\n      this._id = \"field-\" + Math.floor(Math.random() * 10000);\r\n    }\r\n    return this._id;\r\n  };\r\n\r\n  Errors = ko.pureComputed(() => {\r\n    if (!this.ShowErrors()) return [];\r\n    if (!this.isRequired) return [];\r\n    return this.Value()\r\n      ? []\r\n      : [\r\n          new ValidationError(\r\n            \"text-field\",\r\n            \"required-field\",\r\n            this.displayName + ` is required!`\r\n          ),\r\n        ];\r\n  });\r\n\r\n  ShowErrors = ko.observable(false);\r\n\r\n  ValidationClass = ko.pureComputed(() => {\r\n    if (!this.ShowErrors()) return;\r\n    return this.Errors().length ? \"is-invalid\" : \"is-valid\";\r\n  });\r\n\r\n  static viewTemplate = html`\r\n    <div class=\"fw-semibold\" data-bind=\"text: displayName\"></div>\r\n    <div data-bind=\"text: toString()\"></div>\r\n  `;\r\n\r\n  static editTemplate = html`<div>Uh oh!</div>`;\r\n}\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <h5>\r\n    <span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n  </h5>\r\n  <!-- ko ifnot: entityType -->\r\n  <div class=\"alert alert-danger\">Missing entity type</div>\r\n  <!-- /ko -->\r\n  <!-- ko if: entityType -->\r\n  <!-- ko ifnot: multiple -->\r\n  <div\r\n    data-bind=\"component: {name: Value()?.components.edit, params: {Entity: Value()}}\"\r\n  ></div>\r\n  <!-- /ko -->\r\n  <!-- ko if: multiple -->\r\n  <table class=\"table\">\r\n    <thead>\r\n      <tr data-bind=\"\">\r\n        <!-- ko foreach: Cols -->\r\n        <th data-bind=\"text: displayName\"></th>\r\n        <!-- /ko -->\r\n        <th>Actions</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody data-bind=\"\">\r\n      <!-- ko foreach: {data: Value, as: 'row'} -->\r\n      <tr data-bind=\"\">\r\n        <!-- ko foreach: {data: row.FormFields, as: 'col'} -->\r\n        <td data-bind=\"text: col.toString\"></td>\r\n        <!-- /ko -->\r\n        <td>\r\n          <i\r\n            title=\"remove item\"\r\n            class=\"fa-solid fa-trash pointer\"\r\n            data-bind=\"click: $parent.remove.bind(row)\"\r\n          ></i>\r\n        </td>\r\n      </tr>\r\n      <!-- /ko -->\r\n      <tr>\r\n        <!-- ko foreach: NewItem()?.FormFields -->\r\n        <td>\r\n          <div\r\n            data-bind=\"component: {name: components.edit, params: $data}\"\r\n          ></div>\r\n        </td>\r\n        <!-- /ko -->\r\n        <td class=\"align-bottom\">\r\n          <button\r\n            title=\"add and new\"\r\n            type=\"button\"\r\n            data-bind=\"click: submit\"\r\n            class=\"btn btn-success\"\r\n          >\r\n            Add +\r\n          </button>\r\n        </td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nconst viewTemplate = html`\r\n  <h5>\r\n    <span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n  </h5>\r\n  <!-- ko ifnot: entityType -->\r\n  <div class=\"alert alert-danger\">Missing entity type</div>\r\n  <!-- /ko -->\r\n  <!-- ko if: entityType -->\r\n  <!-- ko ifnot: multiple -->\r\n  <!-- ko if: Value -->\r\n  <div\r\n    data-bind=\"component: {name: Value().components.view, params: {Entity: Value()}}\"\r\n  ></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n  <!-- ko if: multiple -->\r\n  <table class=\"table\">\r\n    <thead>\r\n      <tr data-bind=\"\">\r\n        <!-- ko foreach: Cols -->\r\n        <th data-bind=\"text: displayName\"></th>\r\n        <!-- /ko -->\r\n      </tr>\r\n    </thead>\r\n    <tbody data-bind=\"\">\r\n      <!-- ko foreach: {data: Value, as: 'row'} -->\r\n      <tr data-bind=\"\">\r\n        <!-- ko foreach: {data: row.FormFields, as: 'col'} -->\r\n        <td data-bind=\"text: col.toString()\"></td>\r\n        <!-- /ko -->\r\n      </tr>\r\n      <!-- /ko -->\r\n    </tbody>\r\n  </table>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class BlobModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static viewTemplate = viewTemplate;\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"blob-view\";\r\n  static edit = \"blob-edit\";\r\n  static new = \"blob-edit\";\r\n}\r\n\r\nregisterFieldComponents(BlobModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <div class=\"form-check form-switch\">\r\n    <label class=\"form-check-label\"\r\n      ><span class=\"fw-semibold\" data-bind=\"text: displayName\"></span>\r\n      <input\r\n        class=\"form-check-input\"\r\n        type=\"checkbox\"\r\n        role=\"switch\"\r\n        data-bind=\"checked: Value\"\r\n      />\r\n      <!-- ko if: instructions -->\r\n      <div\r\n        class=\"fw-lighter fst-italic text-secondary\"\r\n        data-bind=\"html: instructions\"\r\n      ></div>\r\n      <!-- /ko -->\r\n    </label>\r\n  </div>\r\n`;\r\n\r\nconst viewTemplate = html`\r\n  <div class=\"form-check form-switch\">\r\n    <label class=\"form-check-label\"\r\n      ><span class=\"fw-semibold\" data-bind=\"text: displayName\"></span>\r\n      <input\r\n        class=\"form-check-input\"\r\n        type=\"checkbox\"\r\n        role=\"switch\"\r\n        data-bind=\"checked: Value\"\r\n        disabled\r\n      />\r\n    </label>\r\n  </div>\r\n`;\r\n\r\nexport class CheckboxModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static viewTemplate = viewTemplate;\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"checkbox-view\";\r\n  static edit = \"checkbox-edit\";\r\n  static new = \"checkbox-edit\";\r\n}\r\n\r\nregisterFieldComponents(CheckboxModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <input\r\n      class=\"form-control\"\r\n      data-bind=\"value: inputBinding, class: ValidationClass, attr: {'type': type}\"\r\n    />\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class DateModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"date-view\";\r\n  static edit = \"date-edit\";\r\n  static new = \"date-edit\";\r\n}\r\n\r\nregisterFieldComponents(DateModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <!-- ko if: isSearch -->\r\n    <div data-bind=\"text: toString()\"></div>\r\n    <input class=\"form-control\" data-bind=\"\" />\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: isSearch -->\r\n    <!-- ko if: Options().length -->\r\n    <!-- ko if: multiple -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      multiple=\"true\"\r\n      data-bind=\"options: Options, \r\n  selectedOptions: Value,\r\n  optionsText: optionsText,\r\n  class: ValidationClass\"\r\n    ></select>\r\n    <div class=\"fw-light flex justify-between\">\r\n      <p class=\"fst-italic\">Hold ctrl to select multiple</p>\r\n      <button type=\"button\" class=\"btn btn-link h-1\" data-bind=\"click: clear\">\r\n        CLEAR\r\n      </button>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: multiple -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      data-bind=\"options: Options, \r\n    optionsCaption: 'Select...', \r\n    value: Value,\r\n    optionsText: optionsText,\r\n    class: ValidationClass\"\r\n    ></select>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class LookupModule extends BaseFieldModule {\r\n  constructor(field) {\r\n    super(field);\r\n    this.onSearchInput = field.onSearchInput;\r\n    this.multiple = field.multiple ?? false;\r\n  }\r\n\r\n  // selectedOptions = ko.pureComputed({\r\n  //   read: () => {\r\n  //     if (this.multiple) return this.Value();\r\n  //     return ko.unwrap(this.Value) ? [ko.unwrap(this.Value)] : [];\r\n  //   },\r\n  //   write: (val) => {\r\n  //     if (this.multiple) {\r\n  //       this.Value(val);\r\n  //       return;\r\n  //     }\r\n\r\n  //     if (val.length) {\r\n  //       this.Value(val[0]);\r\n  //       return;\r\n  //     }\r\n  //     this.Value(null);\r\n  //   },\r\n  // });\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"lookup-view\";\r\n  static edit = \"lookup-edit\";\r\n  static new = \"lookup-edit\";\r\n}\r\n\r\nregisterFieldComponents(LookupModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold w-100\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <!-- ko ifnot: spGroupId -->\r\n    <div\r\n      data-bind=\"attr: {id: getUniqueId()}, \r\n      people: Value, \r\n      pickerOptions: pickerOptions,\r\n      class: ValidationClass\"\r\n    ></div>\r\n    <!-- /ko -->\r\n    <!-- ko if: ShowUserSelect -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      data-bind=\"options: userOpts, \r\n        optionsCaption: 'Select...', \r\n        optionsText: 'Title',\r\n        value: ValueFunc,\r\n        class: ValidationClass\"\r\n    ></select>\r\n    <!-- /ko -->\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nconst viewTemplate = html`\r\n  <div class=\"fw-semibold\" data-bind=\"text: displayName\"></div>\r\n  <!-- ko if: toString -->\r\n  <!-- ko ifnot: multiple -->\r\n  <div\r\n    data-bind=\"text: toString, \r\n      attr: {title: Value()?.LoginName}\"\r\n  ></div>\r\n  <!-- /ko -->\r\n  <!-- ko if: multiple -->\r\n  <ul data-bind=\"foreach: Value\">\r\n    <li data-bind=\"attr: {title: LoginName}, text: Title\"></li>\r\n  </ul>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n  <!-- ko ifnot: toString -->\r\n  <div class=\"fst-italic\">Not provided.</div>\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class PeopleModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  ValueFunc = ko.pureComputed({\r\n    read: () => {\r\n      if (!this.Value()) return;\r\n      const userOpts = ko.unwrap(this.userOpts);\r\n      return userOpts.find((opt) => opt.ID == this.Value().ID);\r\n    },\r\n    write: (opt) => {\r\n      const userOpts = ko.unwrap(this.userOpts);\r\n      if (!userOpts) return;\r\n      this.Value(opt);\r\n    },\r\n  });\r\n\r\n  ShowUserSelect = ko.pureComputed(() => {\r\n    // We don't care to unwrap this, since we want to know if it's set or an observable.\r\n    const groupName = this.spGroupName;\r\n    if (!groupName) return false;\r\n    const options = ko.unwrap(this.userOpts);\r\n    return options.length;\r\n  });\r\n\r\n  static viewTemplate = viewTemplate;\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"people-view\";\r\n  static edit = \"people-edit\";\r\n  static new = \"people-edit\";\r\n}\r\n\r\nregisterFieldComponents(PeopleModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n  </label>\r\n  <search-select\r\n    class=\"form-select\"\r\n    data-bind=\"searchSelect: { \r\n      options: Options, \r\n      selectedOptions: Value,\r\n      optionsText: optionsText,\r\n      onSearchInput: onSearchInput\r\n    }\"\r\n  >\r\n  </search-select>\r\n  <div class=\"fw-light flex justify-between\">\r\n    <p class=\"fst-italic\"></p>\r\n    <button type=\"button\" class=\"btn btn-link h-1\" data-bind=\"click: clear\">\r\n      CLEAR\r\n    </button>\r\n  </div>\r\n  <!-- ko if: instructions -->\r\n  <div\r\n    class=\"fw-lighter fst-italic text-secondary\"\r\n    data-bind=\"html: instructions\"\r\n  ></div>\r\n  <!-- /ko -->\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class SearchSelectModule extends BaseFieldModule {\r\n  constructor(field) {\r\n    super(field);\r\n    this.Options = field.Options;\r\n    this.Value = field.Value;\r\n    this.optionsText =\r\n      field.optionsText ??\r\n      ((val) => {\r\n        return val;\r\n      });\r\n    this.multiple = field.multiple;\r\n    this.OptionsCaption = field.OptionsCaption ?? \"Select...\";\r\n    this.onSearchInput = field.onSearchInput;\r\n  }\r\n\r\n  GetSelectedOptions = ko.pureComputed(() => {\r\n    if (this.multiple) return this.Value();\r\n\r\n    return this.Value() ? [this.Value()] : [];\r\n  });\r\n\r\n  InputGroupFocused = ko.observable();\r\n  setFocus = () => this.InputGroupFocused(true);\r\n\r\n  FilterText = ko.observable();\r\n  FilteredOptions = ko.pureComputed(() =>\r\n    this.Options().filter((option) => {\r\n      if (this.GetSelectedOptions().indexOf(option) >= 0) return false;\r\n      if (this.FilterText())\r\n        return this.optionsText(option)\r\n          .toLowerCase()\r\n          .includes(this.FilterText().toLowerCase());\r\n      return true;\r\n    })\r\n  );\r\n\r\n  addSelection = (option, e) => {\r\n    console.log(\"selected\", option);\r\n    if (e.target.nextElementSibling) {\r\n      //e.stopPropagation();\r\n      e.target.nextElementSibling.focus();\r\n    }\r\n    if (this.multiple) {\r\n      this.Value.push(option);\r\n    } else {\r\n      this.Value(option);\r\n    }\r\n  };\r\n\r\n  removeSelection = (option) =>\r\n    this.multiple ? this.Value.remove(option) : this.Value(null);\r\n\r\n  setInputGroupFocus = () => {\r\n    this.InputGroupFocused(true);\r\n    clearTimeout(this.focusOutTimeout);\r\n  };\r\n\r\n  removeInputGroupFocus = (data, e) => {\r\n    this.focusOutTimeout = window.setTimeout(() => {\r\n      this.InputGroupFocused(false);\r\n    }, 0);\r\n  };\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"search-select-view\";\r\n  static edit = \"search-select-edit\";\r\n  static new = \"search-select-new\";\r\n}\r\n\r\nregisterFieldComponents(SearchSelectModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <!-- ko if: multiple -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      multiple=\"true\"\r\n      data-bind=\"options: Options, \r\n        optionsCaption: 'Select...', \r\n        optionsText: optionsText,\r\n        selectedOptions: Value,\r\n        class: ValidationClass\"\r\n    ></select>\r\n    <div class=\"fst-italic fw-light\">Hold ctrl to select multiple.</div>\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: multiple -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      data-bind=\"options: Options, \r\n        optionsCaption: 'Select...', \r\n        optionsText: optionsText,\r\n        value: Value,\r\n        class: ValidationClass\"\r\n    ></select>\r\n    <!-- /ko -->\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class SelectModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"select-view\";\r\n  static edit = \"select-edit\";\r\n  static new = \"select-edit\";\r\n}\r\n\r\nregisterFieldComponents(SelectModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <div class=\"component field\">\r\n    <!-- ko if: isRichText -->\r\n    <label class=\"fw-semibold\"\r\n      ><span data-bind=\"text: displayName\"></span\r\n      ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span\r\n      >:</label\r\n    >\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n    <div\r\n      class=\"richtext-field\"\r\n      data-bind=\"childrenComplete: childrenHaveLoaded\"\r\n    >\r\n      <!-- Create the editor container -->\r\n      <div\r\n        class=\"form-control\"\r\n        data-bind=\"attr: {'id': getUniqueId()}, class: ValidationClass\"\r\n        style=\"height: 150px\"\r\n      >\r\n        <div data-bind=\"html: Value\"></div>\r\n      </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: isRichText -->\r\n    <label class=\"fw-semibold\"\r\n      ><span data-bind=\"text: displayName\"></span\r\n      ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n      <!-- ko if: instructions -->\r\n      <div\r\n        class=\"fw-lighter fst-italic text-secondary\"\r\n        data-bind=\"html: instructions\"\r\n      ></div>\r\n      <!-- /ko -->\r\n      <textarea\r\n        name=\"\"\r\n        id=\"\"\r\n        cols=\"30\"\r\n        rows=\"10\"\r\n        class=\"form-control\"\r\n        data-bind=\"textInput: Value, class: ValidationClass, attr: attr\"\r\n      ></textarea>\r\n    </label>\r\n    <!-- /ko -->\r\n    <!-- ko if: ShowErrors -->\r\n    <!-- ko foreach: Errors -->\r\n    <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n  </div>\r\n`;\r\n\r\nconst viewTemplate = html`\r\n  <div class=\"fw-semibold\" data-bind=\"text: displayName\"></div>\r\n  <!-- ko if: Value -->\r\n  <!-- ko if: isRichText -->\r\n  <div data-bind=\"html: Value\"></div>\r\n  <!-- /ko -->\r\n  <!-- ko ifnot: isRichText -->\r\n  <div data-bind=\"text: Value\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n  <!-- ko ifnot: Value -->\r\n  <div class=\"fst-italic\">Not provided.</div>\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class TextAreaModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  childrenHaveLoaded = (nodes) => {\r\n    this.initializeEditor();\r\n  };\r\n\r\n  getToolbarId = () => \"toolbar-\" + this.getUniqueId();\r\n\r\n  initializeEditor() {\r\n    const toolbarOptions = [\r\n      [\"bold\", \"italic\", \"underline\", \"strike\"], // toggled buttons\r\n      [\"link\"],\r\n      [\"blockquote\", \"code-block\"],\r\n\r\n      [{ header: 1 }, { header: 2 }], // custom button values\r\n      [{ list: \"ordered\" }, { list: \"bullet\" }],\r\n      [{ script: \"sub\" }, { script: \"super\" }], // superscript/subscript\r\n      [{ indent: \"-1\" }, { indent: \"+1\" }], // outdent/indent\r\n      [{ direction: \"rtl\" }], // text direction\r\n\r\n      [{ size: [\"small\", false, \"large\", \"huge\"] }], // custom dropdown\r\n      [{ header: [1, 2, 3, 4, 5, 6, false] }],\r\n\r\n      [{ color: [] }, { background: [] }], // dropdown with defaults from theme\r\n      [{ font: [] }],\r\n      [{ align: [] }],\r\n\r\n      [\"clean\"], // remove formatting button\r\n    ];\r\n\r\n    // debugger;\r\n    var editor = new Quill(\"#\" + this.getUniqueId(), {\r\n      modules: { toolbar: toolbarOptions },\r\n      theme: \"snow\",\r\n    });\r\n\r\n    const Value = this.Value;\r\n\r\n    Value.subscribe((val) => {\r\n      if (val == \"\") {\r\n        editor.setText(\"\");\r\n      }\r\n    });\r\n\r\n    editor.on(\"text-change\", function (delta, oldDelta, source) {\r\n      Value(editor.root.textContent ? editor.root.innerHTML : \"\");\r\n    });\r\n  }\r\n\r\n  static viewTemplate = viewTemplate;\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"text-area-view\";\r\n  static edit = \"text-area-edit\";\r\n  static new = \"text-area-edit\";\r\n}\r\n\r\nregisterFieldComponents(TextAreaModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <input\r\n      class=\"form-control\"\r\n      data-bind=\"textInput: Value, class: ValidationClass, attr: attr\"\r\n    />\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class TextModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"text-view\";\r\n  static edit = \"text-edit\";\r\n  static new = \"text-edit\";\r\n}\r\n\r\nregisterFieldComponents(TextModule);\r\n", "export * from \"./BaseFieldModule.js\";\r\nexport * from \"./BlobModule.js\";\r\nexport * from \"./CheckboxModule.js\";\r\nexport * from \"./DateModule.js\";\r\nexport * from \"./LookupModule.js\";\r\nexport * from \"./PeopleModule.js\";\r\nexport * from \"./SearchSelectModule.js\";\r\nexport * from \"./SelectModule.js\";\r\nexport * from \"./TextAreaModule.js\";\r\nexport * from \"./TextModule.js\";\r\n", "import { BaseField } from \"./index.js\";\r\nimport { BlobModule } from \"../components/fields/index.js\";\r\n\r\nexport class BlobField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    this.entityType = params.entityType;\r\n    this.multiple = params.multiple;\r\n\r\n    if (this.multiple) {\r\n      this.Value = ko.observableArray();\r\n    }\r\n\r\n    if (ko.isObservable(this.entityType)) {\r\n      this.entityType.subscribe(this.updateEntityTypeHandler);\r\n      // this.Value.subscribe(this.updateEntityTypeHandler);\r\n    }\r\n    this.updateEntityTypeHandler(ko.unwrap(this.entityType));\r\n  }\r\n\r\n  toString = ko.pureComputed(() => `${this.Value()?.length ?? \"0\"} items`);\r\n\r\n  toJSON = ko.pureComputed(() => {\r\n    if (!this.multiple) return this.Value()?.toJSON();\r\n    return this.Value().map((value) => value.toJSON());\r\n  });\r\n\r\n  fromJSON = (input) => {\r\n    if (!input) return;\r\n    if (!this.multiple) {\r\n      this.Value()?.fromJSON(input);\r\n      return;\r\n    }\r\n    this.Value.removeAll();\r\n    input.map((obj) => {\r\n      const newEntity = new this.entityConstructor();\r\n      newEntity.fromJSON(obj);\r\n      this.Value.push(newEntity);\r\n    });\r\n  };\r\n\r\n  // TypedValues = ko.observableArray();\r\n  // TypedValue = ko.observable();\r\n\r\n  // Value = ko.pureComputed(() =>\r\n  //   this.multiple ? this.TypedValues() : this.TypedValue()\r\n  // );\r\n\r\n  get = () => {\r\n    return JSON.stringify(this.toJSON());\r\n  };\r\n\r\n  blob;\r\n  set = (val) => {\r\n    if (window.DEBUG) console.log(val);\r\n    this.blob = val;\r\n    if (val?.constructor == BlobField) {\r\n      // this.fromJSON(val.toJSON());\r\n      return;\r\n    }\r\n    this.fromJSON(JSON.parse(val));\r\n  };\r\n\r\n  get entityConstructor() {\r\n    return ko.utils.unwrapObservable(this.entityType);\r\n  }\r\n\r\n  // use purecomputed for memoization, fields shouldn't change\r\n  Cols = ko.pureComputed(() => {\r\n    const entityType = ko.unwrap(this.entityType);\r\n    if (!entityType) return [];\r\n\r\n    const newEntity = new this.entityConstructor();\r\n\r\n    return newEntity.FormFields();\r\n  });\r\n\r\n  // ColKeys = ko.pureComputed(() =>\r\n  //   new this.entityConstructor()?.FormFieldKeys()\r\n  // );\r\n\r\n  // Support multiple items\r\n  NewItem = ko.observable();\r\n\r\n  submit = () => {\r\n    const errors = this.NewItem()?.validate();\r\n    if (errors.length) return;\r\n\r\n    this.Value.push(this.NewItem());\r\n\r\n    this.NewItem(new this.entityConstructor());\r\n  };\r\n\r\n  add = (item) => this.Value.push(item);\r\n  remove = (item) => this.Value.remove(item);\r\n\r\n  updateEntityTypeHandler = (newType) => {\r\n    if (!newType) return;\r\n\r\n    if (!this.multiple) {\r\n      this.Value(new this.entityConstructor());\r\n    } else {\r\n      this.NewItem(new this.entityConstructor());\r\n    }\r\n    if (this.blob) this.fromJSON(JSON.parse(this.blob));\r\n\r\n    // this.applyValueToTypedValues();\r\n  };\r\n\r\n  applyValueToTypedValues = () => {\r\n    // if (!this.Value() || !this.TypedValue()) return;\r\n    // if (!this.multiple) {\r\n    //   mapObjectToEntity(this.Value(), this.TypedValue());\r\n    //   return;\r\n    // }\r\n    // const typedItems = this.Value()?.map((item) => {\r\n    //   const newEntity = new this.entityConstructor();\r\n    //   mapObjectToEntity(item, newEntity);\r\n    //   return newEntity;\r\n    // });\r\n    // this.TypedValues(typedItems);\r\n  };\r\n\r\n  // Errors = ko.pureComputed(() => {\r\n  //   if (!this.Visible()) return [];\r\n  //   // const isRequired = ko.unwrap(this.isRequired);\r\n  //   const isRequired =\r\n  //     typeof this.isRequired == \"function\"\r\n  //       ? this.isRequired()\r\n  //       : this.isRequired;\r\n  //   if (!isRequired) return [];\r\n  //   const currentValue = this.multiple ? this.TypedValues() : this.TypedValue();\r\n  //   return currentValue\r\n  //     ? []\r\n  //     : [\r\n  //         new ValidationError(\r\n  //           \"text-field\",\r\n  //           \"required-field\",\r\n  //           (typeof this.displayName == \"function\"\r\n  //             ? this.displayName()\r\n  //             : this.displayName) + ` is required!`\r\n  //         ),\r\n  //       ];\r\n  // });\r\n\r\n  components = BlobModule;\r\n}\r\n", "import { BaseField } from \"./index.js\";\r\nimport { CheckboxModule } from \"../components/fields/index.js\";\r\n\r\nexport class CheckboxField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  components = CheckboxModule;\r\n}\r\n", "import { DateModule } from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nexport const dateFieldTypes = {\r\n  date: \"date\",\r\n  datetime: \"datetime-local\",\r\n};\r\n\r\n/**\r\n * This field needs to convert between locale and UTC Dates stored on the server;\r\n */\r\n\r\nexport class DateField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    this.type = params.type ?? dateFieldTypes.date;\r\n  }\r\n\r\n  toString = ko.pureComputed(() => {\r\n    // if this is datetime vs date we expect different things\r\n    switch (this.type) {\r\n      case dateFieldTypes.date:\r\n        return this.toLocaleDateString();\r\n      case dateFieldTypes.datetime:\r\n        return this.toLocaleString();\r\n      default:\r\n        return \"\";\r\n    }\r\n  });\r\n\r\n  toSortableDateString = () => this.Value()?.format(\"yyyy-MM-dd\");\r\n  toLocaleDateString = () => this.Value()?.toLocaleDateString();\r\n  toLocaleString = () => this.Value()?.toLocaleString();\r\n\r\n  toInputDateString = () => {\r\n    const d = this.Value();\r\n    return [\r\n      d.getUTCFullYear().toString().padStart(4, \"0\"),\r\n      (d.getUTCMonth() + 1).toString().padStart(2, \"0\"),\r\n      d.getUTCDate().toString().padStart(2, \"0\"),\r\n    ].join(\"-\");\r\n  };\r\n  toInputDateTimeString = () => this.Value().format(\"yyyy-MM-ddThh:mm\");\r\n\r\n  get = ko.pureComputed(() => {\r\n    if (!this.Value() || isNaN(this.Value().valueOf())) {\r\n      return null;\r\n    }\r\n\r\n    return this.Value().toISOString();\r\n  });\r\n\r\n  set = (newDate) => {\r\n    if (!newDate) return null;\r\n    if (newDate.constructor.getName() != \"Date\") {\r\n      // console.warn(\"Attempting to set date\", newDate);\r\n      newDate = new Date(newDate);\r\n    }\r\n    if (newDate.getTimezoneOffset()) {\r\n    }\r\n    this.Value(newDate);\r\n  };\r\n\r\n  inputBinding = ko.pureComputed({\r\n    read: () => {\r\n      if (!this.Value()) return null;\r\n      switch (this.type) {\r\n        case dateFieldTypes.date:\r\n          return this.toInputDateString();\r\n        case dateFieldTypes.datetime:\r\n          return this.toInputDateTimeString();\r\n        default:\r\n          return null;\r\n      }\r\n    },\r\n    write: (val) => {\r\n      if (!val) return;\r\n      //writes in format\r\n      this.Value(new Date(val));\r\n    },\r\n  });\r\n\r\n  components = DateModule;\r\n}\r\n", "import {\r\n  LookupModule,\r\n  SearchSelectModule,\r\n  SelectModule,\r\n} from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nexport class LookupField extends BaseField {\r\n  constructor({\r\n    displayName,\r\n    type: entityType,\r\n    isRequired = false,\r\n    Visible,\r\n    entitySet,\r\n    options = ko.observableArray(),\r\n    optionsFilter = null,\r\n    optionsText = null,\r\n    multiple = false,\r\n    lookupCol = null,\r\n    instructions,\r\n  }) {\r\n    super({ Visible, displayName, isRequired, instructions });\r\n    // Support passing in options\r\n    // if options are not passed, assume this is a search input\r\n    if (!options) {\r\n      this.isSearch = true;\r\n    } else {\r\n      this.isSearch = false;\r\n      this.allOpts = options;\r\n    }\r\n    this.isSearch = !options;\r\n    this.multiple = multiple;\r\n    this.Value = multiple ? ko.observableArray() : ko.observable();\r\n\r\n    this.entityType = entityType;\r\n    this.entitySet = entitySet;\r\n    this.lookupCol = lookupCol ?? \"Title\";\r\n    this.optionsText = optionsText ?? ((item) => item[this.lookupCol]);\r\n    if (optionsFilter) this.optionsFilter = optionsFilter;\r\n\r\n    this.components = multiple ? SearchSelectModule : LookupModule;\r\n  }\r\n\r\n  isSearch = false;\r\n\r\n  allOpts;\r\n  optionsFilter = (val) => val;\r\n\r\n  Options = ko.pureComputed(() => {\r\n    const optsFilter = ko.unwrap(this.optionsFilter);\r\n    const allOpts = ko.unwrap(this.allOpts);\r\n    return allOpts.filter(optsFilter);\r\n  });\r\n\r\n  IsLoading = ko.observable(false);\r\n  HasLoaded = ko.observable(false);\r\n\r\n  // TODO: Started this, should really go in the entity base class if we're doing active record\r\n  // create = async () => {\r\n  //   const newItems = this.multiple ? this.Value() : [this.Value()]\r\n  //   newItems.map(item => this.entitySet.AddEntity(newItems))\r\n  // }\r\n\r\n  refresh = async () => {\r\n    if (!!!this.Value()) {\r\n      return;\r\n    }\r\n    this.IsLoading(true);\r\n    if (!this.multiple) {\r\n      await this.entitySet.LoadEntity(this.Value());\r\n      this.IsLoading(false);\r\n      this.HasLoaded(true);\r\n      return;\r\n    }\r\n\r\n    await Promise.all(\r\n      this.Value().map(\r\n        async (entity) => await this.entitySet.LoadEntity(entity)\r\n      )\r\n    );\r\n    this.IsLoading(false);\r\n    this.HasLoaded(true);\r\n  };\r\n\r\n  ensure = async () => {\r\n    if (this.HasLoaded()) return;\r\n    if (this.IsLoading()) {\r\n      return new Promise((resolve, reject) => {\r\n        const isLoadingSubscription = this.IsLoading.subscribe((isLoading) => {\r\n          if (!isLoading) {\r\n            isLoadingSubscription.dispose();\r\n            resolve();\r\n          }\r\n        });\r\n      });\r\n    }\r\n    await this.refresh();\r\n  };\r\n\r\n  toString = ko.pureComputed(() => {\r\n    if (!!!this.Value()) {\r\n      return \"\";\r\n    }\r\n    if (this.multiple) {\r\n      return this.Value()\r\n        .map((val) => getEntityPropertyAsString(val, this.lookupCol))\r\n        .join(\", \");\r\n    }\r\n    return getEntityPropertyAsString(this.Value(), this.lookupCol);\r\n  });\r\n\r\n  get = () => {\r\n    if (!this.Value()) return;\r\n    if (this.multiple) {\r\n      return this.Value().map((entity) => {\r\n        return {\r\n          ID: entity.ID,\r\n          LookupValue: entity.LookupValue,\r\n          Title: entity.Title,\r\n        };\r\n      });\r\n    }\r\n    const entity = this.Value();\r\n    return {\r\n      ID: entity.ID,\r\n      LookupValue: entity.LookupValue,\r\n      Title: entity.Title,\r\n    };\r\n  };\r\n\r\n  set = (val) => {\r\n    if (!val) {\r\n      this.Value(val);\r\n      return;\r\n    }\r\n    if (this.multiple) {\r\n      const valArr = Array.isArray(val) ? val : val.results ?? val.split(\"#;\");\r\n\r\n      this.Value(valArr.map((value) => this.findOrCreateNewEntity(value)));\r\n      return;\r\n    }\r\n\r\n    this.Value(this.findOrCreateNewEntity(val));\r\n    if (val && !this.toString()) {\r\n      // this.ensure();\r\n    }\r\n  };\r\n\r\n  findOrCreateNewEntity = (val) => {\r\n    if (this.entityType.FindInStore) {\r\n      const foundEntity = this.entityType.FindInStore(val);\r\n      if (foundEntity) return foundEntity;\r\n      console.warn(\r\n        `Could not find entity in store: ${this.entityType.name}`,\r\n        val\r\n      );\r\n    }\r\n\r\n    const optionEntity = this.allOpts().find((entity) => entity.ID == val.ID);\r\n    if (optionEntity) return optionEntity;\r\n\r\n    if (this.entityType.Create) {\r\n      return this.entityType.Create(val);\r\n    }\r\n\r\n    const newEntity = new this.entityType();\r\n    newEntity.ID = val.ID;\r\n    // Kick off the load process in the background\r\n    this.entitySet.LoadEntity(newEntity);\r\n\r\n    return newEntity;\r\n  };\r\n}\r\n\r\n// Should fully constrain all entities, this is ridiculous\r\nfunction getEntityPropertyAsString(entity, column) {\r\n  if (entity.FieldMap && entity.FieldMap[column]) {\r\n    const field = entity.FieldMap[column];\r\n    if (typeof field == \"function\") {\r\n      return field();\r\n    }\r\n\r\n    if (field.toString && typeof field.toString == \"function\") {\r\n      return field.toString();\r\n    }\r\n\r\n    if (field.get && typeof field.get == \"function\") {\r\n      return field.get();\r\n    }\r\n\r\n    if (field.obs) {\r\n      return field.obs();\r\n    }\r\n\r\n    return field;\r\n  }\r\n  return entity[column] ?? \"\";\r\n}\r\n", "/*\r\n    SharePoint Acces Layer - sal.js\r\n\r\n    Abstract any functions that rely on reading or setting SP items to here.\r\n\r\n    Create a new \"Connection\" object type that will store information for \r\n    interfacing with a specific list.\r\n\r\n    Author: Peter Backlund \r\n    Contact: backlundpf <@> state.gov\r\n    Created: 2019-02-12\r\n*/\r\n\r\n/*\r\n  TODO:\r\n  - migrate to rest api\r\n  - remove new from \"new SP.ClientContext.get_current()\"\r\n  - standardize currctx\r\n  - remove unused functions\r\n  - Combine functions \r\n*/\r\n\r\nwindow.console = window.console || { log: function () {} };\r\n\r\nwindow.sal = window.sal ?? {};\r\nvar sal = window.sal;\r\n\r\nconst serverRelativeUrl =\r\n  _spPageContextInfo.webServerRelativeUrl == \"/\"\r\n    ? \"\"\r\n    : _spPageContextInfo.webServerRelativeUrl;\r\n\r\nsal.globalConfig = sal.globalConfig || {\r\n  siteGroups: [],\r\n  siteUrl: serverRelativeUrl,\r\n  listServices: serverRelativeUrl + \"/_vti_bin/ListData.svc/\",\r\n  defaultGroups: {},\r\n};\r\nsal.site = sal.site || {};\r\n\r\nwindow.DEBUG = true;\r\n\r\nexport function executeQuery(currCtx) {\r\n  return new Promise((resolve, reject) =>\r\n    currCtx.executeQueryAsync(resolve, (sender, args) => {\r\n      reject({ sender, args });\r\n    })\r\n  );\r\n}\r\n\r\nfunction principalToPeople(oPrincipal, isGroup = null) {\r\n  return {\r\n    ID: oPrincipal.get_id(),\r\n    Title: oPrincipal.get_title(),\r\n    LoginName: oPrincipal.get_loginName(),\r\n    IsEnsured: true,\r\n    IsGroup:\r\n      isGroup != null\r\n        ? isGroup\r\n        : oPrincipal.constructor.getName() == \"SP.Group\",\r\n    oPrincipal,\r\n  };\r\n}\r\n\r\n// Used in authorization\r\nexport function getDefaultGroups() {\r\n  const defaultGroups = sal.globalConfig.defaultGroups;\r\n  const result = {};\r\n  Object.keys(defaultGroups).forEach((key) => {\r\n    result[key] = principalToPeople(defaultGroups[key], true);\r\n  });\r\n  return result;\r\n}\r\n\r\nconst siteGroups = {};\r\n\r\nexport async function getGroupUsers(groupName) {\r\n  if (siteGroups[groupName]?.Users?.constructor == Array) {\r\n    return siteGroups[groupName].Users;\r\n  }\r\n  const url = `/web/sitegroups/GetByName('${groupName}')?$expand=Users`;\r\n\r\n  const groupResult = await fetchSharePointData(url);\r\n\r\n  const group = groupResult.d;\r\n  group.Users = group.Users?.results;\r\n\r\n  siteGroups[groupName] = group;\r\n  return group.Users;\r\n}\r\n\r\n// Used in router\r\nexport const webRoot =\r\n  _spPageContextInfo.webAbsoluteUrl == \"/\"\r\n    ? \"\"\r\n    : _spPageContextInfo.webAbsoluteUrl;\r\n\r\nexport async function InitSal() {\r\n  if (sal.utilities) return;\r\n  console.log(\"Init Sal\");\r\n  var currCtx = SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n  //sal.site = sal.siteConnection;\r\n\r\n  // Get default groups\r\n  sal.globalConfig.defaultGroups = {\r\n    owners: web.get_associatedOwnerGroup(),\r\n    members: web.get_associatedMemberGroup(),\r\n    visitors: web.get_associatedVisitorGroup(),\r\n  };\r\n  currCtx.load(sal.globalConfig.defaultGroups.owners);\r\n  currCtx.load(sal.globalConfig.defaultGroups.members);\r\n  currCtx.load(sal.globalConfig.defaultGroups.visitors);\r\n\r\n  // Get Current User information\r\n  var user = web.get_currentUser(); //must load this to access info.\r\n  currCtx.load(user);\r\n\r\n  // Get the site groups\r\n  var siteGroupCollection = web.get_siteGroups();\r\n  currCtx.load(siteGroupCollection);\r\n\r\n  // Get the roles upfront so we can validate they're present on the site.\r\n  sal.globalConfig.roles = [];\r\n  var oRoleDefinitions = currCtx.get_web().get_roleDefinitions();\r\n  currCtx.load(oRoleDefinitions);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    currCtx.executeQueryAsync(\r\n      function () {\r\n        sal.globalConfig.currentUser = user;\r\n\r\n        var listItemEnumerator = siteGroupCollection.getEnumerator();\r\n        while (listItemEnumerator.moveNext()) {\r\n          var oListItem = listItemEnumerator.get_current();\r\n          sal.globalConfig.siteGroups.push(principalToPeople(oListItem));\r\n        }\r\n\r\n        // Role Definitions\r\n        var oEnumerator = oRoleDefinitions.getEnumerator();\r\n        while (oEnumerator.moveNext()) {\r\n          var oRoleDefinition = oEnumerator.get_current();\r\n          sal.globalConfig.roles.push(oRoleDefinition.get_name());\r\n        }\r\n\r\n        sal.config = new sal.NewAppConfig();\r\n        sal.utilities = new sal.NewUtilities();\r\n        resolve();\r\n      },\r\n      function (sender, args) {\r\n        alert(\"Error initializing SAL\");\r\n        reject();\r\n      }\r\n    );\r\n  });\r\n  // console.log()\r\n}\r\n\r\nsal.NewAppConfig = function () {\r\n  // TODO: We should take in configuration from our current application, roles/groups etc.\r\n  var siteRoles = {};\r\n  siteRoles.roles = {\r\n    FullControl: \"Full Control\",\r\n    Design: \"Design\",\r\n    Edit: \"Edit\",\r\n    Contribute: \"Contribute\",\r\n    RestrictedContribute: \"Restricted Contribute\",\r\n    InitialCreate: \"Initial Create\",\r\n    Read: \"Read\",\r\n    RestrictedRead: \"Restricted Read\",\r\n    LimitedAccess: \"Limited Access\",\r\n  };\r\n  siteRoles.fulfillsRole = function (inputRole, targetRole) {\r\n    // the site roles are already in authoritative order\r\n    const roles = Object.values(siteRoles.roles);\r\n    if (!roles.includes(inputRole) || !roles.includes(targetRole)) return false;\r\n\r\n    return roles.indexOf(inputRole) <= roles.indexOf(targetRole);\r\n  };\r\n\r\n  siteRoles.validate = function () {\r\n    Object.keys(siteRoles.roles).forEach(function (role) {\r\n      var roleName = siteRoles.roles[role];\r\n      if (!sal.globalConfig.roles.includes(roleName)) {\r\n        console.error(roleName + \" is not in the global roles list\");\r\n      } else {\r\n        console.log(roleName);\r\n      }\r\n    });\r\n  };\r\n\r\n  var siteGroups = {\r\n    groups: {\r\n      Owners: \"workorder Owners\",\r\n      Members: \"workorder Members\",\r\n      Visitors: \"workorder Visitors\",\r\n      RestrictedReaders: \"Restricted Readers\",\r\n    },\r\n  };\r\n\r\n  var publicMembers = {\r\n    siteRoles,\r\n    siteGroups,\r\n  };\r\n\r\n  return publicMembers;\r\n};\r\n\r\n// Used in Authorization\r\nexport async function getUserPropsAsync(userId = _spPageContextInfo.userId) {\r\n  // We need to make two api calls, one to user info list, and one to web\r\n  // const userInfoUrl = `/Web/lists/getbytitle('User%20Information%20List')/Items(${userId})`;\r\n  const userPropsUrl = `/sp.userprofiles.peoplemanager/getmyproperties`;\r\n  // const userGroupUrl = `/Web/GetUserById(${userId})/Groups`;\r\n\r\n  // Get more user info:\r\n  const userInfoUrl = `/Web/GetUserById(${userId})/?$expand=Groups`;\r\n\r\n  const userInfo = (await fetchSharePointData(userInfoUrl)).d;\r\n\r\n  // TODO: See if we can just select the properties we need\r\n  // const userPropsUrl = `/sp.userprofiles.peoplemanager/getpropertiesfor(@v)?@v='${encodeURIComponent(\r\n  //   userInfo.LoginName\r\n  // )}'`;\r\n\r\n  const userProps = (await fetchSharePointData(userPropsUrl))?.d\r\n    .UserProfileProperties.results;\r\n\r\n  function findPropValue(props, key) {\r\n    return props.find((prop) => prop.Key == key)?.Value;\r\n  }\r\n\r\n  return {\r\n    ID: userId,\r\n    Title: userInfo.Title,\r\n    LoginName: userInfo.LoginName,\r\n    WorkPhone: findPropValue(userProps, \"WorkPhone\"),\r\n    EMail: findPropValue(userProps, \"WorkEmail\"), // TODO: Do we still need this spelling?\r\n    IsEnsured: true,\r\n    IsGroup: false,\r\n    Groups: userInfo.Groups?.results?.map((group) => {\r\n      return {\r\n        ...group,\r\n        ID: group.Id,\r\n        IsGroup: true,\r\n        IsEnsured: true,\r\n      };\r\n    }),\r\n  };\r\n}\r\n\r\n// TODO: DEPRECATED remove after verification\r\nasync function getUserPropsAsyncDeprecated() {\r\n  // TODO: We aren't getting the phone number, need to query userprofile service\r\n  return new Promise((resolve, reject) => {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var oUser = web.get_currentUser();\r\n    var oGroups = oUser.get_groups();\r\n\r\n    function onQueryGroupsSucceeded() {\r\n      const user = {\r\n        ID: oUser.get_id(),\r\n        Title: oUser.get_title(),\r\n        LoginName: oUser.get_loginName(),\r\n        IsEnsured: true,\r\n        IsGroup: false,\r\n        Groups: [],\r\n      };\r\n\r\n      var groupsEnumerator = oGroups.getEnumerator();\r\n      while (groupsEnumerator.moveNext()) {\r\n        var oGroup = groupsEnumerator.get_current();\r\n        user.Groups.push(principalToPeople(oGroup));\r\n      }\r\n      resolve(user);\r\n    }\r\n\r\n    function onQueryGroupsFailed(sender, args) {\r\n      console.error(\r\n        \" Everyone - Query Everyone group failed. \" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n      reject(args);\r\n    }\r\n    currCtx.load(oUser);\r\n    currCtx.load(oGroups);\r\n    const data = { oUser, oGroups, resolve, reject };\r\n\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onQueryGroupsSucceeded),\r\n      Function.createDelegate(data, onQueryGroupsFailed)\r\n    );\r\n  });\r\n}\r\n\r\nsal.NewUtilities = function () {\r\n  // TODO: Split this up into UserManager, GroupManager, etc\r\n  function createSiteGroup(groupName, permissions, callback) {\r\n    /* groupName: the name of the new SP Group\r\n     *  permissions: an array of permissions to assign to the group\r\n     * groupOwner: the name of the owner group\r\n     */\r\n    callback = callback === undefined ? null : callback;\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var groupCreationInfo = new SP.GroupCreationInformation();\r\n    groupCreationInfo.set_title(groupName);\r\n    this.oGroup = oWebsite.get_siteGroups().add(groupCreationInfo);\r\n    oGroup.set_owner(oWebsite.get_associatedOwnerGroup());\r\n\r\n    oGroup.update();\r\n    var collRoleDefinitionBinding =\r\n      SP.RoleDefinitionBindingCollection.newObject(clientContext);\r\n\r\n    this.oRoleDefinitions = [];\r\n\r\n    permissions.forEach(function (perm) {\r\n      var oRoleDefinition = oWebsite.get_roleDefinitions().getByName(perm);\r\n      this.oRoleDefinitions.push(oRoleDefinition);\r\n      collRoleDefinitionBinding.add(oRoleDefinition);\r\n    });\r\n\r\n    var collRollAssignment = oWebsite.get_roleAssignments();\r\n    collRollAssignment.add(oGroup, collRoleDefinitionBinding);\r\n\r\n    function onCreateGroupSucceeded() {\r\n      var roleInfo =\r\n        oGroup.get_title() +\r\n        \" created and assigned to \" +\r\n        oRoleDefinitions.forEach(function (rd) {\r\n          rd + \", \";\r\n        });\r\n      if (callback) {\r\n        callback(oGroup.get_id());\r\n      }\r\n      console.log(roleInfo);\r\n    }\r\n\r\n    function onCreateGroupFailed(sender, args) {\r\n      alert(\r\n        groupnName +\r\n          \" - Create group failed. \" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    clientContext.load(oGroup, \"Title\");\r\n\r\n    var data = {\r\n      groupName: groupName,\r\n      oGroup: oGroup,\r\n      oRoleDefinition: oRoleDefinition,\r\n      callback: callback,\r\n    };\r\n\r\n    clientContext.executeQueryAsync(\r\n      Function.createDelegate(data, onCreateGroupSucceeded),\r\n      Function.createDelegate(data, onCreateGroupFailed)\r\n    );\r\n  }\r\n\r\n  function getUserGroups(user, callback) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var everyone = web.ensureUser(user);\r\n    var oGroups = everyone.get_groups();\r\n\r\n    function onQueryGroupsSucceeded() {\r\n      var groups = new Array();\r\n      var groupsInfo = new String();\r\n      var groupsEnumerator = oGroups.getEnumerator();\r\n      while (groupsEnumerator.moveNext()) {\r\n        var oGroup = groupsEnumerator.get_current();\r\n        var group = principalToPeople(oGroup);\r\n\r\n        groupsInfo +=\r\n          \"\\n\" +\r\n          \"Group ID: \" +\r\n          oGroup.get_id() +\r\n          \", \" +\r\n          \"Title : \" +\r\n          oGroup.get_title();\r\n        groups.push(group);\r\n      }\r\n      console.log(groupsInfo.toString());\r\n      callback(groups);\r\n    }\r\n\r\n    function onQueryGroupsFailed(sender, args) {\r\n      console.error(\r\n        \" Everyone - Query Everyone group failed. \" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n    currCtx.load(everyone);\r\n    currCtx.load(oGroups);\r\n    data = { everyone: everyone, oGroups: oGroups, callback: callback };\r\n\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onQueryGroupsSucceeded),\r\n      Function.createDelegate(data, onQueryGroupsFailed)\r\n    );\r\n  }\r\n\r\n  function getUsersWithGroup(oGroup, callback) {\r\n    var context = new SP.ClientContext.get_current();\r\n\r\n    var oUsers = oGroup.get_users();\r\n\r\n    function onGetUserSuccess() {\r\n      var userObjs = [];\r\n      var userEnumerator = oUsers.getEnumerator();\r\n      while (userEnumerator.moveNext()) {\r\n        var oUser = userEnumerator.get_current();\r\n        var userObj = principalToPeople(oUser);\r\n        userObjs.push(userObj);\r\n      }\r\n      callback(userObjs);\r\n    }\r\n\r\n    function onGetUserFailed(sender, args) {}\r\n\r\n    var data = { oUsers: oUsers, callback: callback };\r\n    context.load(oUsers);\r\n    context.executeQueryAsync(\r\n      Function.createDelegate(data, onGetUserSuccess),\r\n      Function.createDelegate(data, onGetUserFailed)\r\n    );\r\n  }\r\n\r\n  function copyFiles(sourceLib, destLib, callback, onError) {\r\n    var context = new SP.ClientContext.get_current();\r\n    var web = context.get_web();\r\n    var folderSrc = web.getFolderByServerRelativeUrl(sourceLib);\r\n    context.load(folderSrc, \"Files\");\r\n    context.executeQueryAsync(\r\n      function () {\r\n        console.log(\"Got the source folder right here!\");\r\n        var files = folderSrc.get_files();\r\n        var e = files.getEnumerator();\r\n        var dest = [];\r\n        while (e.moveNext()) {\r\n          var file = e.get_current();\r\n          var destLibUrl = destLib + \"/\" + file.get_name();\r\n          dest.push(destLibUrl); //delete this when we're happy we got the file paths right\r\n          file.copyTo(destLibUrl, true);\r\n        }\r\n        console.log(dest); //delete this when we're happy we got the file paths right\r\n        context.executeQueryAsync(\r\n          function () {\r\n            console.log(\"Files moved successfully!\");\r\n            callback();\r\n          },\r\n          function (sender, args) {\r\n            console.log(\"error: \") + args.get_message();\r\n            onError;\r\n          }\r\n        );\r\n      },\r\n      function (sender, args) {\r\n        console.log(\"Sorry, something messed up: \" + args.get_message());\r\n      }\r\n    );\r\n  }\r\n\r\n  function copyFilesAsync(sourceFolder, destFolder) {\r\n    return new Promise((resolve, reject) => {\r\n      copyFiles(sourceFolder, destFolder, resolve, reject);\r\n    });\r\n  }\r\n\r\n  var publicMembers = {\r\n    copyFiles: copyFiles,\r\n    copyFilesAsync,\r\n    createSiteGroup: createSiteGroup,\r\n    getUserGroups: getUserGroups,\r\n    getUsersWithGroup: getUsersWithGroup,\r\n  };\r\n\r\n  return publicMembers;\r\n};\r\n\r\nexport async function copyFileAsync(sourceFilePath, destFilePath) {\r\n  const uri = `/web/getfilebyserverrelativeurl('${sourceFilePath}')/copyto('${destFilePath}')`;\r\n\r\n  const result = await fetchSharePointData(uri, \"POST\");\r\n\r\n  return result;\r\n}\r\n\r\n// Used in Authorization\r\nasync function getCurrentUserPropertiesAsync() {\r\n  var headers = {\r\n    \"Content-Type\": \"application/json;odata=verbose\",\r\n    \"X-RequestDigest\": document.getElementById(\"__REQUESTDIGEST\").value,\r\n  };\r\n  try {\r\n    var response = await fetch(\r\n      _spPageContextInfo.webAbsoluteUrl +\r\n        \"/_api/SP.UserProfiles.PeopleManager/GetMyProperties\",\r\n      {\r\n        method: \"GET\",\r\n        headers,\r\n      }\r\n    );\r\n    if (!response.ok) {\r\n      throw new Error(response.status);\r\n    }\r\n\r\n    const data = await response.json();\r\n    sal.globalConfig.currentUserProfile = data.d;\r\n    const requestorPhone = data.d.UserProfileProperties.results.find(function (\r\n      prop\r\n    ) {\r\n      return prop.Key == \"WorkPhone\";\r\n    }).Value;\r\n  } catch (error) {\r\n    console.error(\"Unable to fetch User Properties:\", error);\r\n  }\r\n}\r\n\r\n// Used in Knockout people custom binding\r\nexport async function ensureUserByKeyAsync(userName) {\r\n  return new Promise((resolve, reject) => {\r\n    var group = sal.globalConfig.siteGroups.find(function (group) {\r\n      return group.LoginName == userName;\r\n    });\r\n\r\n    if (group) {\r\n      resolve(group);\r\n      return;\r\n    }\r\n\r\n    var context = new SP.ClientContext.get_current();\r\n    var oUser = context.get_web().ensureUser(userName);\r\n\r\n    function onEnsureUserSucceeded(sender, args) {\r\n      const user = principalToPeople(oUser);\r\n      resolve(user);\r\n    }\r\n\r\n    function onEnsureUserFailed(sender, args) {\r\n      console.error(\r\n        \"Failed to ensure user :\" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n      reject(args);\r\n    }\r\n    const data = { oUser, resolve, reject };\r\n\r\n    context.load(oUser);\r\n    context.executeQueryAsync(\r\n      Function.createDelegate(data, onEnsureUserSucceeded),\r\n      Function.createDelegate(data, onEnsureUserFailed)\r\n    );\r\n  });\r\n}\r\n\r\nfunction getSPSiteGroupByName(groupName) {\r\n  var userGroup = null;\r\n  if (this.globalConfig.siteGroups != null) {\r\n    userGroup = this.globalConfig.siteGroups.find(function (group) {\r\n      return group.Title == groupName;\r\n    });\r\n  }\r\n  return userGroup;\r\n}\r\n\r\nexport class ItemPermissions {\r\n  constructor({ hasUniqueRoleAssignments, roles }) {\r\n    this.hasUniqueRoleAssignments = hasUniqueRoleAssignments;\r\n    this.roles = roles;\r\n  }\r\n\r\n  hasUniqueRoleAssignments;\r\n  roles = [];\r\n\r\n  addPrincipalRole(principal, roleName) {\r\n    const newRoleDef = new RoleDef({ name: roleName });\r\n    const principalRole = this.getPrincipalRole(principal);\r\n\r\n    if (principalRole) {\r\n      principalRole.addRoleDef(newRoleDef);\r\n      return;\r\n    }\r\n\r\n    const newRole = new Role({ principal });\r\n    newRole.addRoleDef(newRoleDef);\r\n    this.roles.push(newRole);\r\n  }\r\n\r\n  getPrincipalRole(principal) {\r\n    return this.roles.find((role) => role.principal.ID == principal.ID);\r\n  }\r\n\r\n  principalHasPermissionKind(principal, permission) {\r\n    const role = this.getPrincipalRole(principal);\r\n    return role?.roleDefs.find((roleDef) =>\r\n      roleDef.basePermissions?.has(permission)\r\n    )\r\n      ? true\r\n      : false;\r\n  }\r\n\r\n  getValuePairs() {\r\n    // For backwards compatibility\r\n    return this.roles.flatMap((role) =>\r\n      role.roleDefs.map((roleDef) => [role.principal.Title, roleDef.name])\r\n    );\r\n  }\r\n\r\n  static fromRestResult(result) {\r\n    const roles = result.RoleAssignments.results.map(\r\n      Role.fromRestRoleAssignment\r\n    );\r\n\r\n    return new ItemPermissions({\r\n      hasUniqueRoleAssignments: result.HasUniqueRoleAssignments,\r\n      roles,\r\n    });\r\n  }\r\n}\r\n\r\nexport class Role {\r\n  constructor({ principal, roleDefs = [] }) {\r\n    this.principal = principal;\r\n    this.roleDefs = roleDefs;\r\n  }\r\n\r\n  principal; // People Entity\r\n  roleDefs = [];\r\n\r\n  addRoleDef(roleDef) {\r\n    this.roleDefs.push(roleDef);\r\n  }\r\n\r\n  static fromRestRoleAssignment(role) {\r\n    return new Role({\r\n      principal: { ...role.Member, ID: role.Member.Id },\r\n      roleDefs: role.RoleDefinitionBindings.results.map(\r\n        RoleDef.fromRestRoleDef\r\n      ),\r\n    });\r\n  }\r\n  static fromJsomRole(role) {\r\n    const newRole = new Role({\r\n      principal: principalToPeople(role.get_member()),\r\n    });\r\n\r\n    var roleDefs = role.get_roleDefinitionBindings();\r\n    if (roleDefs != null) {\r\n      var roleDefsEnumerator = roleDefs.getEnumerator();\r\n      while (roleDefsEnumerator.moveNext()) {\r\n        var roleDef = roleDefsEnumerator.get_current();\r\n        newRole.roleDefs.push(RoleDef.fromJsomRoleDef(roleDef));\r\n      }\r\n    }\r\n    return newRole;\r\n  }\r\n}\r\n\r\nexport class RoleDef {\r\n  constructor({ name, basePermissions = null }) {\r\n    this.name = name;\r\n    this.basePermissions = basePermissions;\r\n  }\r\n  name;\r\n  basePermissions;\r\n\r\n  static fromRestRoleDef(roleDef) {\r\n    const newRoleDef = new RoleDef({\r\n      name: roleDef.Name,\r\n      basePermissions: roleDef.BasePermissions,\r\n    });\r\n    Object.assign(newRoleDef, roleDef);\r\n    return newRoleDef;\r\n  }\r\n\r\n  static fromJsomRoleDef(roleDef) {\r\n    const newRoleDef = new RoleDef({ name: roleDef.get_name() });\r\n    newRoleDef.basePermissions = roleDef.get_basePermissions();\r\n\r\n    return newRoleDef;\r\n  }\r\n}\r\n\r\nexport function SPList(listDef) {\r\n  /*\r\n      Expecting a list definition object in the following format:\r\n        var assignmentListDef = {\r\n        name: \"Assignment\",\r\n        title: \"Assignment\"\r\n      };\r\n    */\r\n\r\n  /*****************************************************************\r\n                                Globals       \r\n    ******************************************************************/\r\n\r\n  var self = this;\r\n\r\n  self.config = {\r\n    def: listDef,\r\n  };\r\n\r\n  /*****************************************************************\r\n                                Common Private Methods       \r\n    ******************************************************************/\r\n  async function init() {\r\n    if (!self.config.fieldSchema) {\r\n      const listEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')?$expand=Fields`;\r\n      const list = await fetchSharePointData(listEndpoint);\r\n      // const apiEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')/Fields`;\r\n      //const fields = await fetchData(apiEndpoint);\r\n      self.config.guid = list.d.Id;\r\n      self.config.fieldSchema = list.d.Fields.results;\r\n    }\r\n  }\r\n\r\n  init();\r\n\r\n  /*****************************************************************\r\n                                Common Public Methods       \r\n    ******************************************************************/\r\n\r\n  async function setListPermissionsAsync(itemPermissions, reset) {\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    // await executeQuery(currCtx).catch((sender, args) => {\r\n    //   console.warn(\"Unable to get list: \", sender);\r\n    //   return;\r\n    // });\r\n\r\n    return setResourcePermissionsAsync(oList, itemPermissions, reset);\r\n  }\r\n\r\n  function setListPermissions(valuePairs, callback, reset) {\r\n    reset = reset === undefined ? false : reset;\r\n\r\n    var users = new Array();\r\n    var resolvedGroups = new Array();\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    valuePairs.forEach(function (vp) {\r\n      var resolvedGroup = getSPSiteGroupByName(vp[0]);\r\n      if (resolvedGroup) {\r\n        resolvedGroups.push([resolvedGroup, vp[1]]);\r\n      } else {\r\n        users.push([currCtx.get_web().ensureUser(vp[0]), vp[1]]);\r\n      }\r\n    });\r\n\r\n    function onFindItemSucceeded() {\r\n      console.log(\"Successfully found item\");\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      if (reset) {\r\n        oList.resetRoleInheritance();\r\n        oList.breakRoleInheritance(false, false);\r\n        oList\r\n          .get_roleAssignments()\r\n          .getByPrincipal(sal.globalConfig.currentUser)\r\n          .deleteObject();\r\n      } else {\r\n        oList.breakRoleInheritance(false, false);\r\n      }\r\n\r\n      this.resolvedGroups.forEach(function (groupPairs) {\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(groupPairs[1])\r\n        );\r\n        oList.get_roleAssignments().add(groupPairs[0], roleDefBindingColl);\r\n      });\r\n\r\n      this.users.forEach(function (userPairs) {\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(userPairs[1])\r\n        );\r\n        oList.get_roleAssignments().add(userPairs[0], roleDefBindingColl);\r\n      });\r\n\r\n      var data = { oList: oList, callback: callback };\r\n\r\n      function onSetListPermissionsSuccess() {\r\n        console.log(\"Successfully set permissions\");\r\n        callback(oList);\r\n      }\r\n\r\n      function onSetListPermissionsFailure(sender, args) {\r\n        console.error(\r\n          \"Failed to update permissions on List: \" +\r\n            this.oList.get_title() +\r\n            args.get_message() +\r\n            \"\\n\",\r\n          args.get_stackTrace()\r\n        );\r\n      }\r\n\r\n      currCtx.load(oList);\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onSetListPermissionsSuccess),\r\n        Function.createDelegate(data, onSetListPermissionsFailure)\r\n      );\r\n    }\r\n\r\n    function onFindItemFailed(sender, args) {\r\n      console.error(\r\n        \"Failed to find List: \" + this.oList.get_title + args.get_message(),\r\n        args.get_stackTrace()\r\n      );\r\n    }\r\n    var data = {\r\n      oList: oList,\r\n      users: users,\r\n      resolvedGroups: resolvedGroups,\r\n      callback: callback,\r\n    };\r\n    //let data = { title: oListItem.get_item(\"Title\"), oListItem: oListItem };\r\n\r\n    currCtx.load(oList);\r\n    users.map(function (user) {\r\n      currCtx.load(user[0]);\r\n    });\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onFindItemSucceeded),\r\n      Function.createDelegate(data, onFindItemFailed)\r\n    );\r\n  }\r\n\r\n  /*****************************************************************\r\n                                createListItem      \r\n    ******************************************************************/\r\n  function mapObjectToListItem(val) {\r\n    if (!val) {\r\n      return val;\r\n    }\r\n    if (!Array.isArray(val)) {\r\n      return mapItemToListItem(val);\r\n    }\r\n    return val\r\n      .map((item) => {\r\n        return mapItemToListItem(item);\r\n      })\r\n      .join(\";#\");\r\n  }\r\n\r\n  function mapItemToListItem(item) {\r\n    if (item.ID) {\r\n      //var lookupValue = new SP.FieldLookupValue();\r\n      //lookupValue.set_lookupId(item.id);\r\n      //return lookupValue;\r\n      return `${item.ID};#${item.LookupValue ?? \"\"}`;\r\n    }\r\n    if (item.LookupValue) {\r\n      //var lookupValue = new SP.FieldLookupValue();\r\n      //lookupValue.set_lookupId(item.id);\r\n      //return lookupValue;\r\n      return item.LookupValue;\r\n    }\r\n    if (item.constructor.getName() == \"Date\") {\r\n      return item.toISOString();\r\n    }\r\n    return item;\r\n  }\r\n\r\n  function createListItemAsync(entity, folderPath = null) {\r\n    return new Promise((resolve, reject) => {\r\n      //self.updateConfig();\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const itemCreateInfo = new SP.ListItemCreationInformation();\r\n\r\n      if (folderPath) {\r\n        var folderUrl =\r\n          sal.globalConfig.siteUrl +\r\n          \"/Lists/\" +\r\n          self.config.def.name +\r\n          \"/\" +\r\n          folderPath;\r\n        itemCreateInfo.set_folderUrl(folderUrl);\r\n      }\r\n\r\n      const oListItem = oList.addItem(itemCreateInfo);\r\n      const restrictedFields = [\r\n        \"ID\",\r\n        \"Author\",\r\n        \"Created\",\r\n        \"Editor\",\r\n        \"Modified\",\r\n      ];\r\n      Object.keys(entity)\r\n        .filter((key) => !restrictedFields.includes(key))\r\n        .forEach((key) => {\r\n          oListItem.set_item(key, mapObjectToListItem(entity[key]));\r\n        });\r\n\r\n      oListItem.update();\r\n\r\n      function onCreateListItemSucceeded() {\r\n        resolve(oListItem.get_id());\r\n      }\r\n\r\n      function onCreateListItemFailed(sender, args) {\r\n        console.error(\"Create Item Failed - List: \" + self.config.def.name);\r\n        console.error(\"ValuePairs\", entity);\r\n        console.error(sender, args);\r\n        reject(sender);\r\n      }\r\n\r\n      const data = { entity, oListItem, resolve, reject };\r\n\r\n      currCtx.load(oListItem);\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onCreateListItemSucceeded),\r\n        Function.createDelegate(data, onCreateListItemFailed)\r\n      );\r\n    });\r\n  }\r\n\r\n  /*****************************************************************\r\n                                getListItems      \r\n    ******************************************************************/\r\n  function mapListItemToObject(val) {\r\n    if (!val) {\r\n      return val;\r\n    }\r\n    let out = {};\r\n    switch (val.constructor.getName()) {\r\n      case \"SP.FieldUserValue\":\r\n        out.LoginName = val.get_email();\r\n      case \"SP.FieldLookupValue\":\r\n        out.ID = val.get_lookupId();\r\n        out.LookupValue = val.get_lookupValue();\r\n        out.Title = val.get_lookupValue();\r\n        break;\r\n      default:\r\n        out = val;\r\n    }\r\n    return out;\r\n  }\r\n\r\n  function getListItems(caml, fields, callback) {\r\n    /*\r\n        Obtain all list items that match the querystring passed by caml.\r\n        */\r\n    var camlQuery = new SP.CamlQuery.createAllItemsQuery();\r\n\r\n    camlQuery.set_viewXml(caml);\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n    var oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    var collListItem = oList.getItems(camlQuery);\r\n\r\n    function onGetListItemsSucceeded() {\r\n      var self = this;\r\n      var listItemEnumerator = self.collListItem.getEnumerator();\r\n\r\n      const foundObjects = [];\r\n\r\n      while (listItemEnumerator.moveNext()) {\r\n        var oListItem = listItemEnumerator.get_current();\r\n        var listObj = {};\r\n        fields.forEach((field) => {\r\n          var colVal = oListItem.get_item(field);\r\n          //console.log(`SAL: Setting ${field} to`, colVal);\r\n          listObj[field] = Array.isArray(colVal)\r\n            ? colVal.map((val) => mapListItemToObject(val))\r\n            : mapListItemToObject(colVal);\r\n        });\r\n        //listObj.fileUrl = oListItem.get_item(\"FileRef\");\r\n        // listObj.oListItem = oListItem;\r\n        foundObjects.push(listObj);\r\n      }\r\n      //this.setState({ focusedItems })\r\n      //console.log(\"calling callback get list\");\r\n      callback(foundObjects);\r\n    }\r\n\r\n    function onGetListItemsFailed(sender, args) {\r\n      console.log(\"unsuccessful read\", sender);\r\n\r\n      alert(\r\n        \"Request on list \" +\r\n          self.config.def.name +\r\n          \" failed, producing the following error: \\n \" +\r\n          args.get_message() +\r\n          \"\\nStackTrack: \\n \" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n    var data = {\r\n      collListItem: collListItem,\r\n      callback: callback,\r\n      fields,\r\n      camlQuery,\r\n    };\r\n\r\n    currCtx.load(collListItem, `Include(${fields.join(\", \")})`);\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onGetListItemsSucceeded),\r\n      Function.createDelegate(data, onGetListItemsFailed)\r\n    );\r\n  }\r\n\r\n  function getListItemsAsync({ fields = null, caml = null }) {\r\n    if (!caml) {\r\n      var caml =\r\n        '<View Scope=\"RecursiveAll\"><Query><Where><Eq>' +\r\n        '<FieldRef Name=\"FSObjType\"/><Value Type=\"int\">0</Value>' +\r\n        \"</Eq></Where></Query></View>\";\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      getListItems(caml, fields, resolve);\r\n    });\r\n  }\r\n\r\n  function findByIdAsync(id, fields) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        findById(id, fields, resolve);\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    });\r\n  }\r\n\r\n  async function getById(id, fields) {\r\n    const [queryFields, expandFields] = await getQueryFields(fields);\r\n\r\n    const apiEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')/items(${id})?$Select=${queryFields}&$expand=${expandFields}`;\r\n\r\n    const result = await fetchSharePointData(apiEndpoint);\r\n    return result.d;\r\n  }\r\n\r\n  async function getListFields() {\r\n    if (!self.config.fieldSchema) {\r\n      const apiEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')/Fields`;\r\n      const fields = await fetchSharePointData(apiEndpoint);\r\n      self.config.fieldSchema = fields.d.results;\r\n    }\r\n    return self.config.fieldSchema;\r\n  }\r\n\r\n  async function getQueryFields(fields) {\r\n    const queryFields = [];\r\n    const expandFields = [];\r\n\r\n    const listFields = await getListFields();\r\n    fields.map((f) => {\r\n      // TODO: Figure out why FileRef is pretending to be a lookup\r\n      if (f == \"FileRef\") {\r\n        queryFields.push(f);\r\n        return;\r\n      }\r\n\r\n      if (f.includes(\"/\")) {\r\n        queryFields.push(f);\r\n        expandFields.push(f.split(\"/\")[0]);\r\n        return;\r\n      }\r\n      const fieldSchema = listFields.find((lf) => lf.StaticName == f);\r\n      if (!fieldSchema) {\r\n        alert(`Field '${f}' not found on list ${self.config.def.name}`);\r\n        return;\r\n      }\r\n\r\n      const idString = f + \"/ID\";\r\n      let titleString = f + \"/Title\";\r\n      switch (fieldSchema.TypeAsString) {\r\n        case \"LookupMulti\":\r\n        case \"Lookup\":\r\n          titleString = f + \"/\" + fieldSchema.LookupField;\r\n        case \"User\":\r\n          queryFields.push(idString);\r\n          queryFields.push(titleString);\r\n          expandFields.push(f);\r\n          // expandFields.push(titleString);\r\n          break;\r\n        case \"Choice\":\r\n        default:\r\n          queryFields.push(f);\r\n      }\r\n    });\r\n    return [queryFields, expandFields];\r\n  }\r\n\r\n  // { column, value, type = \"LookupValue\" }\r\n  async function findByColumnValueAsync(\r\n    columnFilters,\r\n    { orderByColumn = null, sortAsc },\r\n    { count = null, includePermissions = false, includeFolders = false },\r\n    fields\r\n  ) {\r\n    const [queryFields, expandFields] = await getQueryFields(fields);\r\n    if (includePermissions) {\r\n      queryFields.push(\"RoleAssignments\");\r\n      queryFields.push(\"HasUniqueRoleAssignments\");\r\n      expandFields.push(\"RoleAssignments\");\r\n    }\r\n    const orderBy = orderByColumn\r\n      ? `$orderby=${orderByColumn} ${sortAsc ? \"asc\" : \"desc\"}`\r\n      : \"\";\r\n    // TODO: fieldfilter should use 'lookupcolumnId' e.g. ServiceTypeId eq 1\r\n    const colFilterArr = [];\r\n    columnFilters.forEach((colFilter) =>\r\n      colFilterArr.push(\r\n        `${colFilter.column} ${colFilter.op ?? \"eq\"} '${colFilter.value}'`\r\n      )\r\n    );\r\n    if (!includeFolders) colFilterArr.push(`FSObjType eq '0'`);\r\n\r\n    const filter = \"$filter=(\" + colFilterArr.join(`) and (`) + \")\";\r\n\r\n    //const fsObjTypeFilter = `FSObjType eq '0'`;\r\n    // const fieldFilter = `${column} eq '${value}'`;\r\n    // const filter2 = !includeFolders\r\n    //   ? `$filter=(${fieldFilter}) and (${fsObjTypeFilter})`\r\n    //   : `$filter=${fieldFilter}`;\r\n\r\n    const include = \"$select=\" + queryFields;\r\n    const expand = `$expand=` + expandFields;\r\n    const page = count ? `$top=${count}` : \"\";\r\n\r\n    const apiEndpoint =\r\n      `/web/lists/GetByTitle('${self.config.def.title}')/items?` +\r\n      `${include}&${expand}&${orderBy}&${filter}&${page}`;\r\n\r\n    const result = await fetchSharePointData(apiEndpoint);\r\n    const cursor = {\r\n      results: result?.d?.results,\r\n      _next: result?.d?.__next,\r\n    };\r\n\r\n    // if (window.DEBUG) console.log(cursor);\r\n    return cursor;\r\n  }\r\n\r\n  async function loadNextPage(cursor) {\r\n    const result = await fetchSharePointData(cursor._next);\r\n    return {\r\n      results: result?.d?.results,\r\n      _next: result?.d?.__next,\r\n    };\r\n  }\r\n\r\n  function findById(id, fields, callback) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n    var oList = web.get_lists().getByTitle(self.config.def.title);\r\n    var oListItem = oList.getItemById(id);\r\n\r\n    function onGetListItemSucceeded() {\r\n      const listObj = {};\r\n      fields.forEach((field) => {\r\n        var colVal = oListItem.get_item(field);\r\n        //console.log(`SAL: Setting ${field} to`, colVal);\r\n        listObj[field] = Array.isArray(colVal)\r\n          ? colVal.map((val) => mapListItemToObject(val))\r\n          : mapListItemToObject(colVal);\r\n      });\r\n      callback(listObj);\r\n    }\r\n\r\n    function onGetListItemFailed(sender, args) {\r\n      console.error(\"SAL: findById - List: \" + self.config.def.name);\r\n      console.error(\"Fields\", this);\r\n      console.error(sender, args);\r\n    }\r\n\r\n    var data = {\r\n      oListItem,\r\n      callback,\r\n      fields,\r\n    };\r\n    currCtx.load(oListItem);\r\n    // currCtx.load(oListItem, `Include(${fields.join(\", \")})`);\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onGetListItemSucceeded),\r\n      Function.createDelegate(data, onGetListItemFailed)\r\n    );\r\n  }\r\n\r\n  /*****************************************************************\r\n                            updateListItem      \r\n    ******************************************************************/\r\n\r\n  function updateListItemAsync(entity) {\r\n    if (!entity?.ID) {\r\n      return false;\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const oListItem = oList.getItemById(entity.ID);\r\n\r\n      const restrictedFields = [\r\n        \"ID\",\r\n        \"Author\",\r\n        \"Created\",\r\n        \"Editor\",\r\n        \"Modified\",\r\n      ];\r\n\r\n      Object.keys(entity)\r\n        .filter((key) => !restrictedFields.includes(key))\r\n        .forEach((key) => {\r\n          oListItem.set_item(key, mapObjectToListItem(entity[key]));\r\n        });\r\n\r\n      oListItem.update();\r\n\r\n      function onUpdateListItemsSucceeded() {\r\n        //alert('Item updated!');\r\n        console.log(\"Successfully updated \" + this.oListItem.get_item(\"Title\"));\r\n        resolve();\r\n      }\r\n\r\n      function onUpdateListItemFailed(sender, args) {\r\n        console.error(\"Update Failed - List: \" + self.config.def.name);\r\n        console.error(\"Item Id\", this.oListItem.get_id() ?? \"N/A\");\r\n        console.error(entity);\r\n        console.error(sender, args);\r\n        reject(args);\r\n      }\r\n\r\n      const data = { oListItem, entity, resolve, reject };\r\n\r\n      currCtx.load(oListItem);\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onUpdateListItemsSucceeded),\r\n        Function.createDelegate(data, onUpdateListItemFailed)\r\n      );\r\n    });\r\n  }\r\n\r\n  /*****************************************************************\r\n                            deleteListItem      \r\n    ******************************************************************/\r\n  function deleteListItem(id, callback) {\r\n    //[[\"ColName\", \"Value\"], [\"Col2\", \"Value2\"]]\r\n    //self.callbackDeleteListItem = callback;\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n    var oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    var data = { callback: callback };\r\n    const oListItem = oList.getItemById(id);\r\n    oListItem.deleteObject();\r\n\r\n    function onDeleteListItemsSucceeded(sender, args) {\r\n      //alert('Item updated!');\r\n      callback();\r\n    }\r\n\r\n    function onDeleteListItemsFailed(sender, args) {\r\n      console.error(\r\n        \"sal.SPList.deleteListItem: Request on list \" +\r\n          self.config.def.name +\r\n          \" failed, producing the following error: \\n \" +\r\n          args.get_message() +\r\n          \"\\nStackTrack: \\n \" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onDeleteListItemsSucceeded),\r\n      Function.createDelegate(data, onDeleteListItemsFailed)\r\n    );\r\n  }\r\n\r\n  async function deleteListItemAsync(id) {\r\n    const apiEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')/items(${id})`;\r\n    return await fetchSharePointData(apiEndpoint, \"DELETE\", {\r\n      \"If-Match\": \"*\",\r\n    });\r\n    // return new Promise((resolve, reject) => deleteListItem(id, resolve));\r\n  }\r\n\r\n  /*****************************************************************\r\n                            Permissions  \r\n    ******************************************************************/\r\n  /**\r\n   * Documentation - setItemPermissions\r\n   * @param {number} id Item identifier, obtain using getListItems above\r\n   * @param {ItemPermissions} itemPermissions an instance of ItemPermissions\r\n   */\r\n  async function setItemPermissionsAsync(id, itemPermissions, reset) {\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n\r\n    const oListItem = await getoListItemByIdAsync(id);\r\n\r\n    return setResourcePermissionsAsync(oListItem, itemPermissions, reset);\r\n  }\r\n\r\n  async function setResourcePermissionsAsync(\r\n    oListItem,\r\n    itemPermissions,\r\n    reset\r\n  ) {\r\n    if (reset) {\r\n      oListItem.resetRoleInheritance();\r\n      oListItem.breakRoleInheritance(false, false);\r\n    }\r\n\r\n    // const result = await new Promise((resolve, reject) => {\r\n    //   currCtx.executeQueryAsync(\r\n    //     () => {\r\n    //       resolve();\r\n    //     },\r\n    //     (sender, args) => {\r\n    //       console.error(\r\n    //         \"Failed to break permissions on item: \" +\r\n    //           this.oListItem.get_lookupValue() +\r\n    //           args.get_message(),\r\n    //         args\r\n    //       );\r\n    //       reject();\r\n    //     }\r\n    //   );\r\n    // });\r\n\r\n    for (const role of itemPermissions.roles) {\r\n      const ensuredPrincipalResult = await ensureUserByKeyAsync(\r\n        role.principal.Title\r\n      );\r\n      if (!ensuredPrincipalResult) return;\r\n\r\n      const currCtx2 = new SP.ClientContext.get_current();\r\n      const web = currCtx2.get_web();\r\n\r\n      const oPrincipal = ensuredPrincipalResult.oPrincipal;\r\n\r\n      currCtx2.load(oPrincipal);\r\n\r\n      role.roleDefs.map((roleDef) => {\r\n        const roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(roleDef.name)\r\n        );\r\n        oListItem.get_roleAssignments().add(oPrincipal, roleDefBindingColl);\r\n      });\r\n\r\n      const data = {};\r\n      await executeQuery(currCtx2).catch(({ sender, args }) => {\r\n        console.error(\r\n          `Failed to set role permissions on item id ${id} for principal ${role.principal.Title} ` +\r\n            args.get_message(),\r\n          args\r\n        );\r\n      });\r\n    }\r\n\r\n    if (reset) {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .getByPrincipal(sal.globalConfig.currentUser)\r\n        .deleteObject();\r\n\r\n      await executeQuery(currCtx).catch(({ sender, args }) => {\r\n        console.error(\r\n          `Failed to remove role permissions on item id ${id} for Current User ` +\r\n            args.get_message(),\r\n          args\r\n        );\r\n      });\r\n    }\r\n  }\r\n\r\n  function getoListItemByIdAsync(id) {\r\n    return new Promise((resolve, reject) => {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const oListItem = oList.getItemById(id);\r\n      currCtx.executeQueryAsync(\r\n        () => {\r\n          resolve(oListItem);\r\n        },\r\n        (sender, args) => {\r\n          console.error(\r\n            \"Failed to find item: \" + id + args.get_message(),\r\n            args\r\n          );\r\n          reject();\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Documentation - getItemPermissionsAsync\r\n   * @param {number} id Item identifier, obtain using getListItems above\r\n   * @param {Function} callback The callback function to execute after\r\n   *  obtaining permissions\r\n   */\r\n  function getItemPermissionsAsync(id) {\r\n    return new Promise((resolve, reject) => {\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      var oList = web.get_lists().getByTitle(self.config.def.title);\r\n      var camlQuery = new SP.CamlQuery();\r\n      camlQuery.set_viewXml(\r\n        '<View><Query><Where><Eq><FieldRef Name=\"ID\"/><Value Type=\"Text\">' +\r\n          id +\r\n          \"</Value></Eq></Where></Query></View>\"\r\n      );\r\n\r\n      var oListItems = oList.getItems(camlQuery);\r\n\r\n      currCtx.load(\r\n        oListItems,\r\n        \"Include(ID, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n      );\r\n\r\n      function onQuerySuccess() {\r\n        var listItemEnumerator = oListItems.getEnumerator();\r\n\r\n        while (listItemEnumerator.moveNext()) {\r\n          var oListItem = listItemEnumerator.get_current();\r\n          var itemPermissions = new ItemPermissions({\r\n            hasUniqueRoleAssignments: oListItem.get_hasUniqueRoleAssignments(),\r\n            roles: [],\r\n          });\r\n\r\n          var roleEnumerator = oListItem.get_roleAssignments().getEnumerator();\r\n          // enumerate the roles\r\n          while (roleEnumerator.moveNext()) {\r\n            var roleColl = roleEnumerator.get_current();\r\n            const role = Role.fromJsomRole(roleColl);\r\n            // var principal = roleColl.get_member();\r\n\r\n            // const roleDef = {\r\n            //   principal: principalToPeople(principal),\r\n            //   permissions: [],\r\n            // };\r\n\r\n            // const roleDefBindingCollEnumerator = roleColl\r\n            //   .get_roleDefinitionBindings()\r\n            //   .getEnumerator();\r\n            // while (roleDefBindingCollEnumerator.moveNext()) {\r\n            //   const role = roleDefBindingCollEnumerator.get_current();\r\n            //   roleDef.permissions.push(role.get_name());\r\n            // }\r\n            itemPermissions.roles.push(role);\r\n          }\r\n          resolve(itemPermissions);\r\n          break;\r\n        }\r\n      }\r\n\r\n      function onQueryFailed(sender, args) {\r\n        reject(args.get_message());\r\n      }\r\n\r\n      const data = {\r\n        oListItems,\r\n        resolve,\r\n        reject,\r\n      };\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onQuerySuccess),\r\n        Function.createDelegate(data, onQueryFailed)\r\n      );\r\n    });\r\n  }\r\n\r\n  async function getListPermissions() {\r\n    const url =\r\n      `/web/lists/getByTitle('${self.config.def.name}')` +\r\n      `?$select=HasUniqueRoleAssignments,RoleAssignments` +\r\n      `&$expand=RoleAssignments/Member,RoleAssignments/RoleDefinitionBindings`;\r\n\r\n    const headers = {\r\n      \"Cache-Control\": \"no-cache\",\r\n    };\r\n    const result = await fetchSharePointData(url, \"GET\", headers);\r\n\r\n    if (!result) return;\r\n\r\n    return ItemPermissions.fromRestResult(result.d);\r\n  }\r\n\r\n  /*****************************************************************\r\n                            Folders          \r\n    ******************************************************************/\r\n\r\n  function getServerRelativeFolderPath(relFolderPath) {\r\n    let builtPath = sal.globalConfig.siteUrl;\r\n\r\n    builtPath += self.config.def.isLib\r\n      ? \"/\" + self.config.def.name\r\n      : \"/Lists/\" + self.config.def.name;\r\n\r\n    if (relFolderPath) {\r\n      builtPath += \"/\" + relFolderPath;\r\n    }\r\n\r\n    return builtPath;\r\n  }\r\n\r\n  function upsertFolderPathAsync(folderPath) {\r\n    if (self.config.def.isLib) {\r\n      return new Promise((resolve, reject) =>\r\n        upsertLibFolderByPath(folderPath, resolve)\r\n      );\r\n    }\r\n    return new Promise((resolve, reject) =>\r\n      upsertListFolderByPath(folderPath, resolve)\r\n    );\r\n  }\r\n\r\n  async function setFolderReadonlyAsync(folderPath) {\r\n    try {\r\n      const currentPerms = await getFolderPermissionsAsync(folderPath);\r\n\r\n      const targetPerms = currentPerms.map((user) => {\r\n        return [user.LoginName, sal.config.siteRoles.roles.RestrictedRead];\r\n      });\r\n      await setFolderPermissionsAsync(folderPath, targetPerms, true);\r\n    } catch (e) {\r\n      console.warn(e);\r\n    }\r\n    return;\r\n  }\r\n\r\n  async function ensureFolderPermissionsAsync(relFolderPath, targetPerms) {\r\n    const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n\r\n    const apiEndpoint =\r\n      sal.globalConfig.siteUrl +\r\n      `/_api/web/GetFolderByServerRelativeUrl('${serverRelFolderPath}')/` +\r\n      \"ListItemAllFields/RoleAssignments?$expand=Member,Member/Users,RoleDefinitionBindings\";\r\n\r\n    const response = await fetch(apiEndpoint, {\r\n      method: \"GET\",\r\n      headers: {\r\n        Accept: \"application/json; odata=verbose\",\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      if (response.status == 404) {\r\n        return;\r\n      }\r\n      console.error(response);\r\n    }\r\n    const result = await response.json();\r\n    const permissionResults = result?.d?.results;\r\n    if (!permissionResults) {\r\n      console.warn(\"No results found\", result);\r\n      return;\r\n    }\r\n\r\n    const missingPerms = targetPerms.filter((targetPermPair) => {\r\n      const targetLoginName = targetPermPair[0];\r\n      const targetPerm = targetPermPair[1];\r\n      // find an existing matching permissiont\r\n      const permExists = permissionResults.find((curPerm) => {\r\n        // If the target user isn't the member\r\n        if (curPerm.Member.LoginName != targetLoginName) {\r\n          // Or the member is a group that the target user isn't in\r\n          if (\r\n            !curPerm.Member.Users?.results.find(\r\n              (curUser) => curUser.LoginName == targetLoginName\r\n            )\r\n          ) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        // The target principal has permissions assigned, let see if they include the target permission\r\n        if (\r\n          curPerm.RoleDefinitionBindings.results?.find((curBinding) =>\r\n            sal.config.siteRoles.fulfillsRole(curBinding.Name, targetPerm)\r\n          )\r\n        ) {\r\n          return true;\r\n        }\r\n\r\n        // Finally, the target principal is assigned, but don't have the appropriate permissions\r\n        return false;\r\n      });\r\n\r\n      return !permExists;\r\n    });\r\n\r\n    console.log(\"Adding missing permissions\", missingPerms);\r\n    if (missingPerms.length)\r\n      await setFolderPermissionsAsync(relFolderPath, missingPerms, false);\r\n\r\n    return;\r\n  }\r\n  /*****************************************************************\r\n                            List Folders          \r\n    ******************************************************************/\r\n  function getFolderContentsAsync(relFolderPath, fields) {\r\n    return new Promise((resolve, reject) => {\r\n      // TODO: everything is the same as getListItems except for the caml query\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n\r\n      const camlQuery = SP.CamlQuery.createAllItemsQuery();\r\n      camlQuery.set_folderServerRelativeUrl(serverRelFolderPath);\r\n      const allItems = oList.getItems(camlQuery);\r\n\r\n      currCtx.load(allItems, `Include(${fields.join(\", \")})`);\r\n\r\n      currCtx.executeQueryAsync(\r\n        function () {\r\n          const foundObjects = [];\r\n          var listItemEnumerator = allItems.getEnumerator();\r\n          while (listItemEnumerator.moveNext()) {\r\n            var oListItem = listItemEnumerator.get_current();\r\n            var listObj = {};\r\n            fields.forEach((field) => {\r\n              var colVal = oListItem.get_item(field);\r\n              //console.log(`SAL: Setting ${field} to`, colVal);\r\n              listObj[field] = Array.isArray(colVal)\r\n                ? colVal.map((val) => mapListItemToObject(val))\r\n                : mapListItemToObject(colVal);\r\n            });\r\n            //listObj.fileUrl = oListItem.get_item(\"FileRef\");\r\n            listObj.oListItem = oListItem;\r\n            foundObjects.push(listObj);\r\n          }\r\n          resolve(foundObjects);\r\n        },\r\n        function (sender, args) {\r\n          console.warn(\"Unable load list folder contents:\");\r\n          console.error(sender);\r\n          console.error(args);\r\n          reject(args);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  async function getFolderPermissionsAsync(relFolderPath) {\r\n    return new Promise(async (resolve, reject) => {\r\n      const oListItem = await getFolderItemByPath(relFolderPath);\r\n      if (!oListItem) {\r\n        reject(\"Folder item does not exist\");\r\n        return;\r\n      }\r\n      const roles = oListItem.get_roleAssignments();\r\n\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      currCtx.load(oListItem);\r\n      currCtx.load(roles);\r\n      currCtx.executeQueryAsync(\r\n        function () {\r\n          const currCtx = new SP.ClientContext.get_current();\r\n          console.log(oListItem);\r\n          const principals = [];\r\n          const bindings = [];\r\n          const roleEnumerator = roles.getEnumerator();\r\n          // enumerate the roles\r\n          while (roleEnumerator.moveNext()) {\r\n            const role = roleEnumerator.get_current();\r\n            const principal = role.get_member();\r\n            const bindings = role.get_roleDefinitionBindings();\r\n            // get the principal\r\n            currCtx.load(bindings);\r\n            currCtx.load(principal);\r\n            principals.push({ principal: principal, bindings: bindings });\r\n          }\r\n          currCtx.executeQueryAsync(\r\n            // success\r\n            function (sender, args) {\r\n              // alert the title\r\n              //alert(principal.get_title());\r\n\r\n              const logins = principals.map(function ({ principal, bindings }) {\r\n                const principalRoles = [];\r\n                const bindingEnumerator = bindings.getEnumerator();\r\n                while (bindingEnumerator.moveNext()) {\r\n                  const binding = bindingEnumerator.get_current();\r\n                  principalRoles.push(binding.get_name());\r\n                }\r\n                return {\r\n                  ID: principal.get_id(),\r\n                  Title: principal.get_title(),\r\n                  LoginName: principal.get_loginName(),\r\n                  Roles: principalRoles,\r\n                };\r\n              });\r\n              resolve(logins);\r\n            },\r\n            // failure\r\n            function (sender, args) {\r\n              console.warn(\"Unable load folder principals permissions:\");\r\n              console.error(sender);\r\n              console.error(args);\r\n              reject(args);\r\n            }\r\n          );\r\n        },\r\n        function (sender, args) {\r\n          console.warn(\"Unable load folder permissions:\");\r\n          console.error(sender);\r\n          console.error(args);\r\n          reject(args);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  async function getFolderItemByPath(relFolderPath) {\r\n    return new Promise((resolve, reject) => {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const camlQuery = SP.CamlQuery.createAllItemsQuery();\r\n\r\n      const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n\r\n      var camlq =\r\n        '<View Scope=\"RecursiveAll\"><Query><Where><And><Eq>' +\r\n        '<FieldRef Name=\"FSObjType\"/><Value Type=\"int\">1</Value>' +\r\n        \"</Eq><Eq>\" +\r\n        '<FieldRef Name=\"FileRef\"/><Value Type=\"Text\">' +\r\n        serverRelFolderPath +\r\n        \"</Value>\" +\r\n        \"</Eq></And></Where></Query><RowLimit>1</RowLimit></View>\";\r\n\r\n      camlQuery.set_viewXml(camlq);\r\n\r\n      const allFolders = oList.getItems(camlQuery);\r\n\r\n      async function onFindItemSucceeded() {\r\n        const foundObjects = [];\r\n        var listItemEnumerator = allFolders.getEnumerator();\r\n        while (listItemEnumerator.moveNext()) {\r\n          // Should be only one item\r\n          const oListItem = listItemEnumerator.get_current();\r\n          foundObjects.push(oListItem);\r\n        }\r\n\r\n        if (!foundObjects) {\r\n          console.warn(\"folder not found\");\r\n          resolve(foundObjects);\r\n        }\r\n\r\n        if (foundObjects.length > 1) {\r\n          console.warn(\"Multiple folders found!\");\r\n          resolve(foundObjects);\r\n        }\r\n        const oListItem = foundObjects[0];\r\n        resolve(oListItem);\r\n      }\r\n\r\n      function onFindItemFailed(sender, args) {\r\n        console.warn(\"Unable load list folder contents:\");\r\n        console.error(sender);\r\n        console.error(args);\r\n        reject(args);\r\n      }\r\n      const data = {\r\n        allFolders,\r\n        resolve,\r\n        reject,\r\n      };\r\n      currCtx.load(allFolders);\r\n\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onFindItemSucceeded),\r\n        Function.createDelegate(data, onFindItemFailed)\r\n      );\r\n    });\r\n  }\r\n\r\n  /*****************************************************************\r\n                            Document Libraries Folders\r\n    ******************************************************************/\r\n\r\n  /*****************************************************************\r\n                        Folder Creation          \r\n    ******************************************************************/\r\n\r\n  function upsertListFolderByPath(folderPath, callback) {\r\n    var folderArr = folderPath.split(\"/\");\r\n    var idx = 0;\r\n\r\n    var upsertListFolderInner = function (parentPath, folderArr, idx, success) {\r\n      var folderName = folderArr[idx];\r\n      idx++;\r\n      var curPath = folderArr.slice(0, idx).join(\"/\");\r\n      ensureListFolder(\r\n        curPath,\r\n        function (iFolder) {\r\n          if (idx >= folderArr.length) {\r\n            //We've reached the innermost folder and found it exists\r\n            success(iFolder.get_id());\r\n          } else {\r\n            upsertListFolderInner(curPath, folderArr, idx, success);\r\n          }\r\n        },\r\n        function () {\r\n          self.createListFolder(\r\n            folderName,\r\n            function (folderId) {\r\n              if (idx >= folderArr.length) {\r\n                //We've reached the innermost folder and found it exists\r\n                success(folderId);\r\n              } else {\r\n                upsertListFolderInner(curPath, folderArr, idx, success);\r\n              }\r\n            },\r\n            parentPath\r\n          );\r\n        }\r\n      );\r\n    };\r\n    upsertListFolderInner(\"\", folderArr, idx, callback);\r\n  }\r\n\r\n  /**\r\n   * CreateListFolder\r\n   * Creates a folder at the specified path\r\n   * @param {String} folderName\r\n   * @param {Function} callback\r\n   * @param {String} path\r\n   */\r\n  self.createListFolder = function (folderName, callback, path) {\r\n    path = path === undefined ? \"\" : path;\r\n\r\n    // Used for lists, duh\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    const oList = web.get_lists().getByTitle(self.config.def.title);\r\n    let folderUrl = \"\";\r\n    const itemCreateInfo = new SP.ListItemCreationInformation();\r\n    itemCreateInfo.set_underlyingObjectType(SP.FileSystemObjectType.folder);\r\n    itemCreateInfo.set_leafName(folderName);\r\n    if (path) {\r\n      folderUrl =\r\n        sal.globalConfig.siteUrl +\r\n        \"/Lists/\" +\r\n        self.config.def.name +\r\n        \"/\" +\r\n        path;\r\n      itemCreateInfo.set_folderUrl(folderUrl);\r\n    }\r\n\r\n    const newItem = oList.addItem(itemCreateInfo);\r\n    newItem.set_item(\"Title\", folderName);\r\n\r\n    newItem.update();\r\n\r\n    function onCreateFolderSucceeded(sender, args) {\r\n      callback(this.newItem.get_id());\r\n    }\r\n\r\n    function onCreateFolderFailed(sender, args) {\r\n      alert(\r\n        \"Request on list \" +\r\n          self.config.def.name +\r\n          \" failed, producing the following error: \\n\" +\r\n          args.get_message() +\r\n          \"\\nStackTrack: \\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    const data = {\r\n      folderName: folderName,\r\n      callback: callback,\r\n      newItem: newItem,\r\n    };\r\n\r\n    currCtx.load(newItem);\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onCreateFolderSucceeded),\r\n      Function.createDelegate(data, onCreateFolderFailed)\r\n    );\r\n  };\r\n\r\n  function ensureListFolder(path, onExists, onNonExists) {\r\n    var folderUrl =\r\n      sal.globalConfig.siteUrl + \"/Lists/\" + self.config.def.name + \"/\" + path;\r\n\r\n    var ctx = SP.ClientContext.get_current();\r\n\r\n    // Could also call getFileByServerRelativeUrl() here. Doesn't matter.\r\n    // The way this works is identical for files and folders.\r\n    var folder = ctx.get_web().getFolderByServerRelativeUrl(folderUrl);\r\n    folder.get_listItemAllFields();\r\n    var data = {\r\n      folder: folder,\r\n      path: path,\r\n      onExists: onExists,\r\n      onNonExists: onNonExists,\r\n    };\r\n    ctx.load(folder, \"Exists\", \"Name\");\r\n\r\n    function onQueryFolderSucceeded() {\r\n      if (folder.get_exists()) {\r\n        // Folder exists and isn't hidden from us. Print its name.\r\n        console.log(\r\n          \"Folder \" + folder.get_name() + \" exists in \" + self.config.def.name\r\n        );\r\n        var currCtx = new SP.ClientContext.get_current();\r\n\r\n        var folderItem = folder.get_listItemAllFields();\r\n        function onQueryFolderItemSuccess() {\r\n          onExists(folderItem);\r\n        }\r\n        function onQueryFolderItemFailure(sender, args) {\r\n          console.error(\"Failed to find folder at \" + path, args);\r\n        }\r\n        data = { folderItem: folderItem, path: path, onExists: onExists };\r\n        currCtx.load(folderItem);\r\n        currCtx.executeQueryAsync(\r\n          Function.createDelegate(data, onQueryFolderItemSuccess),\r\n          Function.createDelegate(data, onQueryFolderItemFailure)\r\n        );\r\n      } else {\r\n        console.warn(\"Folder exists but is hidden (security-trimmed) for us.\");\r\n      }\r\n    }\r\n\r\n    function onQueryFolderFailed(sender, args) {\r\n      if (args.get_errorTypeName() === \"System.IO.FileNotFoundException\") {\r\n        // Folder doesn't exist at all.\r\n        console.log(\r\n          \"SAL.SPList.ensureListFolder: \\\r\n          Folder \" +\r\n            path +\r\n            \" does not exist in \" +\r\n            self.config.def.name\r\n        );\r\n        onNonExists();\r\n      } else {\r\n        // An unexpected error occurred.\r\n        console.error(\"Error: \" + args.get_message());\r\n      }\r\n    }\r\n    ctx.executeQueryAsync(\r\n      Function.createDelegate(data, onQueryFolderSucceeded),\r\n      Function.createDelegate(data, onQueryFolderFailed)\r\n    );\r\n  }\r\n\r\n  function upsertLibFolderByPath(folderUrl, success) {\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    // TODO: Check if the folder exists before adding it\r\n\r\n    var createFolderInternal = function (parentFolder, folderUrl, success) {\r\n      var ctx = parentFolder.get_context();\r\n      var folderNames = folderUrl.split(\"/\");\r\n      var folderName = folderNames[0];\r\n      var curFolder = parentFolder.get_folders().add(folderName);\r\n      ctx.load(curFolder);\r\n      ctx.executeQueryAsync(\r\n        function () {\r\n          if (folderNames.length > 1) {\r\n            var subFolderUrl = folderNames\r\n              .slice(1, folderNames.length)\r\n              .join(\"/\");\r\n            createFolderInternal(curFolder, subFolderUrl, success);\r\n          } else {\r\n            success(curFolder);\r\n          }\r\n        },\r\n        function (sender, args) {\r\n          console.error(\"error creating new folder\");\r\n          console.error(sender);\r\n          console.error(error);\r\n        }\r\n      );\r\n    };\r\n    createFolderInternal(oList.get_rootFolder(), folderUrl, success);\r\n  }\r\n\r\n  function setFolderPermissionsAsync(folderPath, valuePairs, reset) {\r\n    return new Promise((resolve, reject) => {\r\n      setFolderPermissions(folderPath, valuePairs, resolve, reset);\r\n    });\r\n  }\r\n\r\n  function setFolderPermissions(relFolderPath, valuePairs, callback, reset) {\r\n    reset = reset === undefined ? false : reset;\r\n    // TODO: Validate that the users exist\r\n    var users = [];\r\n    var resolvedGroups = [];\r\n\r\n    const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    const folder = web.getFolderByServerRelativeUrl(serverRelFolderPath);\r\n\r\n    valuePairs.forEach(function (vp) {\r\n      var resolvedGroup = getSPSiteGroupByName(vp[0]);\r\n      if (resolvedGroup?.oGroup) {\r\n        resolvedGroups.push([resolvedGroup.oGroup, vp[1]]);\r\n      } else {\r\n        //This doesn't appear to be a group, let's see if we can find a user\r\n        users.push([currCtx.get_web().ensureUser(vp[0]), vp[1]]);\r\n      }\r\n    });\r\n\r\n    function onFindFolderSuccess() {\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      var folderItem = this.folder.get_listItemAllFields();\r\n      if (reset) {\r\n        folderItem.resetRoleInheritance();\r\n        folderItem.breakRoleInheritance(false, false);\r\n        folderItem\r\n          .get_roleAssignments()\r\n          .getByPrincipal(sal.globalConfig.currentUser)\r\n          .deleteObject();\r\n      } else {\r\n        folderItem.breakRoleInheritance(false, false);\r\n      }\r\n\r\n      this.resolvedGroups.forEach(function (groupPairs) {\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(groupPairs[1])\r\n        );\r\n        folderItem.get_roleAssignments().add(groupPairs[0], roleDefBindingColl);\r\n      });\r\n\r\n      this.users.forEach(function (userPairs) {\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(userPairs[1])\r\n        );\r\n        folderItem.get_roleAssignments().add(userPairs[0], roleDefBindingColl);\r\n      });\r\n\r\n      var data = { folderItem: folderItem, callback: callback };\r\n\r\n      function onSetFolderPermissionsSuccess() {\r\n        console.log(\"Successfully set permissions\");\r\n        this.callback(folderItem);\r\n      }\r\n\r\n      function onSetFolderPermissionsFailure(sender, args) {\r\n        console.error(\r\n          \"Failed to update permissions on item: \" +\r\n            this.folderItem.get_lookupValue() +\r\n            args.get_message() +\r\n            \"\\n\" +\r\n            args.get_stackTrace(),\r\n          false\r\n        );\r\n      }\r\n\r\n      currCtx.load(folderItem);\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onSetFolderPermissionsSuccess),\r\n        Function.createDelegate(data, onSetFolderPermissionsFailure)\r\n      );\r\n    }\r\n\r\n    function onFindFolderFailure(sender, args) {\r\n      console.error(\r\n        \"Something went wrong setting perms on library folder\",\r\n        args\r\n      );\r\n    }\r\n\r\n    var data = {\r\n      folder: folder,\r\n      users: users,\r\n      callback: callback,\r\n      resolvedGroups: resolvedGroups,\r\n      valuePairs: valuePairs,\r\n      reset: reset,\r\n    };\r\n\r\n    users.map(function (user) {\r\n      currCtx.load(user[0]);\r\n    });\r\n    currCtx.load(folder);\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onFindFolderSuccess),\r\n      Function.createDelegate(data, onFindFolderFailure)\r\n    );\r\n  }\r\n\r\n  /*****************************************************************\r\n                                  \r\n  ******************************************************************/\r\n\r\n  function showModal(formName, title, args, callback) {\r\n    var id = \"\";\r\n    if (args.id) {\r\n      id = args.id;\r\n    }\r\n    const options = SP.UI.$create_DialogOptions();\r\n\r\n    var listPath = self.config.def.isLib\r\n      ? \"/\" + self.config.def.name + \"/\"\r\n      : \"/Lists/\" + self.config.def.name + \"/\";\r\n\r\n    var rootFolder = \"\";\r\n\r\n    if (args.rootFolder) {\r\n      rootFolder = sal.globalConfig.siteUrl + listPath + args.rootFolder;\r\n    }\r\n\r\n    // WARNING: this looks similar to listPath but is different\r\n    var formsPath = self.config.def.isLib\r\n      ? \"/\" + self.config.def.name + \"/forms/\"\r\n      : \"/Lists/\" + self.config.def.name + \"/\";\r\n\r\n    Object.assign(options, {\r\n      title: title,\r\n      dialogReturnValueCallback: callback,\r\n      args: JSON.stringify(args),\r\n      height: 800,\r\n      url:\r\n        sal.globalConfig.siteUrl +\r\n        formsPath +\r\n        formName +\r\n        \"?ID=\" +\r\n        id +\r\n        \"&Source=\" +\r\n        location.pathname +\r\n        \"&RootFolder=\" +\r\n        rootFolder,\r\n    });\r\n    SP.UI.ModalDialog.showModalDialog(options);\r\n\r\n    // SP.SOD.execute(\r\n    //   \"sp.ui.dialog.js\",\r\n    //   \"SP.UI.ModalDialog.showModalDialog\",\r\n    //   options\r\n    // );\r\n  }\r\n\r\n  function showCheckinModal(fileRef, callback) {\r\n    var options = SP.UI.$create_DialogOptions();\r\n    options.title = \"Check in Document\";\r\n    options.height = \"600\";\r\n    options.dialogReturnValueCallback = callback;\r\n\r\n    options.url =\r\n      sal.globalConfig.siteUrl +\r\n      \"/_layouts/checkin.aspx?List={\" +\r\n      self.config.guid +\r\n      \"}&FileName=\" +\r\n      fileRef;\r\n\r\n    SP.UI.ModalDialog.showModalDialog(options);\r\n  }\r\n\r\n  function checkinWithComment(fileRef, comment) {\r\n    const url = `/web/GetFileByServerRelativeUrl('${fileRef}')/CheckIn(comment='${comment}',checkintype=0)`;\r\n    return fetchSharePointData(url, \"POST\");\r\n  }\r\n\r\n  function showVersionHistoryModal(itemId) {\r\n    return new Promise((resolve) => {\r\n      var options = SP.UI.$create_DialogOptions();\r\n      options.title = \"Version History\";\r\n      options.height = \"600\";\r\n      options.dialogReturnValueCallback = resolve;\r\n\r\n      options.url = getVersionHistoryUrl(itemId);\r\n\r\n      SP.UI.ModalDialog.showModalDialog(options);\r\n    });\r\n  }\r\n\r\n  function getVersionHistoryUrl(itemId) {\r\n    return (\r\n      sal.globalConfig.siteUrl +\r\n      \"/_layouts/15/versions.aspx?List={\" +\r\n      self.config.guid +\r\n      \"}&ID=\" +\r\n      itemId\r\n    );\r\n  }\r\n\r\n  function uploadNewDocumentAsync(folderPath, title, args) {\r\n    return new Promise((resolve, reject) => {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      currCtx.load(oList);\r\n      currCtx.executeQueryAsync(\r\n        function () {\r\n          //folder = folder != '/' ? folder : '';\r\n\r\n          var siteString =\r\n            sal.globalConfig.siteUrl == \"/\" ? \"\" : sal.globalConfig.siteUrl;\r\n\r\n          const options = SP.UI.$create_DialogOptions();\r\n          Object.assign(options, {\r\n            title: title,\r\n            dialogReturnValueCallback: resolve,\r\n            args: JSON.stringify(args),\r\n            url:\r\n              siteString +\r\n              \"/_layouts/Upload.aspx?List=\" +\r\n              oList.get_id().toString() +\r\n              \"&RootFolder=\" +\r\n              siteString +\r\n              \"/\" +\r\n              self.config.def.name +\r\n              \"/\" +\r\n              encodeURI(folderPath) +\r\n              \"&Source=\" +\r\n              location.pathname +\r\n              \"&args=\" +\r\n              encodeURI(JSON.stringify(args)),\r\n          });\r\n          //console.log(\"Options url: \" + options.url);\r\n          SP.UI.ModalDialog.showModalDialog(options);\r\n          // SP.SOD.execute(\r\n          //   \"sp.ui.dialog.js\",\r\n          //   \"SP.UI.ModalDialog.showModalDialog\",\r\n          //   options\r\n          // );\r\n        },\r\n        function (sender, args) {\r\n          console.error(\"Error showing file modal: \");\r\n          console.error(sender);\r\n          console.error(args);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  const UPLOADCHUNKSIZE = 10485760; // PnPJs\r\n  // const UPLOADCHUNKSIZE = 262144000; // SPO\r\n\r\n  const uploadchunkActionTypes = {\r\n    start: \"startupload\",\r\n    continue: \"continueupload\",\r\n    finish: \"finishupload\",\r\n  };\r\n\r\n  async function uploadFileRestChunking(\r\n    file,\r\n    relFolderPath,\r\n    fileName,\r\n    progress\r\n  ) {\r\n    /* https://sharepoint.stackexchange.com/questions/287334/upload-files-250mb-via-sharepoint-rest-api\r\nhttps://learn.microsoft.com/en-us/previous-versions/office/developer/sharepoint-rest-reference/dn450841(v=office.15)\r\n    */\r\n    const blob = file;\r\n    const chunkSize = UPLOADCHUNKSIZE;\r\n    const fileSize = file.size;\r\n\r\n    const totalBlocks =\r\n      parseInt((fileSize / chunkSize).toString(), 10) +\r\n      (fileSize % chunkSize === 0 ? 1 : 0);\r\n\r\n    const fileRef = relFolderPath + \"/\" + fileName;\r\n\r\n    const jobGuid = getGUID();\r\n    // const jobGuid = crypto.randomUUID\r\n    //   ? crypto.randomUUID()\r\n    //   : \"74493426-fb10-4e47-bc82-120954b81a60\";\r\n\r\n    let currentPointer;\r\n    progress({ currentBlock: 0, totalBlocks });\r\n    currentPointer = await startUpload(\r\n      jobGuid,\r\n      file.slice(0, chunkSize),\r\n      fileRef,\r\n      relFolderPath\r\n    );\r\n\r\n    for (i = 2; i < totalBlocks; i++) {\r\n      progress({ currentBlock: i, totalBlocks });\r\n      currentPointer = await continueUpload(\r\n        jobGuid,\r\n        file.slice(currentPointer, currentPointer + chunkSize),\r\n        currentPointer,\r\n        fileRef\r\n      );\r\n    }\r\n\r\n    progress({ currentBlock: totalBlocks - 1, totalBlocks });\r\n    const result = await finishUpload(\r\n      jobGuid,\r\n      file.slice(currentPointer),\r\n      currentPointer,\r\n      fileRef\r\n    );\r\n\r\n    progress({ currentBlock: totalBlocks, totalBlocks });\r\n\r\n    return result;\r\n  }\r\n\r\n  async function startUpload(uploadId, chunk, fileRef, relFolderPath) {\r\n    const url =\r\n      `/web/getFolderByServerRelativeUrl(@folder)/files/getByUrlOrAddStub(@file)/StartUpload(guid'${uploadId}')?` +\r\n      `&@folder='${relFolderPath}'&@file='${fileRef}'`;\r\n\r\n    const headers = {\r\n      \"Content-Type\": \"application/octet-stream\",\r\n    };\r\n    const opts = {\r\n      body: chunk,\r\n    };\r\n\r\n    const result = await fetchSharePointData(url, \"POST\", headers, opts);\r\n    if (!result) {\r\n      console.error(\"Error starting upload!\");\r\n      return;\r\n    }\r\n\r\n    return parseFloat(result.d.StartUpload);\r\n  }\r\n\r\n  async function continueUpload(uploadId, chunk, fileOffset, fileRef) {\r\n    const url =\r\n      `/web/getFileByServerRelativeUrl(@file)/ContinueUpload(uploadId=guid'${uploadId}',fileOffset=${fileOffset})?` +\r\n      `&@file='${fileRef}'`;\r\n\r\n    const headers = {\r\n      \"Content-Type\": \"application/octet-stream\",\r\n    };\r\n    const opts = {\r\n      body: chunk,\r\n    };\r\n\r\n    const result = await fetchSharePointData(url, \"POST\", headers, opts);\r\n\r\n    if (!result) {\r\n      console.error(\"Error starting upload!\");\r\n      return;\r\n    }\r\n\r\n    return parseFloat(result.d.ContinueUpload);\r\n  }\r\n\r\n  async function finishUpload(uploadId, chunk, fileOffset, fileRef) {\r\n    const url =\r\n      `/web/getFileByServerRelativeUrl(@file)/FinishUpload(uploadId=guid'${uploadId}',fileOffset=${fileOffset})?` +\r\n      `&@file='${fileRef}'`;\r\n\r\n    const headers = {\r\n      \"Content-Type\": \"application/octet-stream\",\r\n    };\r\n    const opts = {\r\n      body: chunk,\r\n    };\r\n\r\n    const result = await fetchSharePointData(url, \"POST\", headers, opts);\r\n\r\n    if (!result) {\r\n      console.error(\"Error starting upload!\");\r\n      return;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async function uploadFileRest(file, relFolderPath, fileName) {\r\n    return await fetch(\r\n      _spPageContextInfo.webServerRelativeUrl +\r\n        `/_api/web/GetFolderByServerRelativeUrl('${relFolderPath}')/Files/add(url='${fileName}',overwrite=true)`,\r\n      {\r\n        method: \"POST\",\r\n        credentials: \"same-origin\",\r\n        body: file,\r\n        headers: {\r\n          Accept: \"application/json; odata=verbose\",\r\n          \"Content-Type\": \"application/json;odata=nometadata\",\r\n          \"X-RequestDigest\": document.getElementById(\"__REQUESTDIGEST\").value,\r\n        },\r\n      }\r\n    ).then((response) => {\r\n      if (!response.ok) {\r\n        console.error(\"Error Uploading File\", response);\r\n        return;\r\n      }\r\n\r\n      return response.json();\r\n    });\r\n  }\r\n\r\n  async function uploadFileToFolderAndUpdateMetadata(\r\n    file,\r\n    fileName,\r\n    relFolderPath,\r\n    payload,\r\n    progress = null\r\n  ) {\r\n    if (!progress) {\r\n      progress = () => {};\r\n    }\r\n\r\n    const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n    let result = null;\r\n    if (file.size > UPLOADCHUNKSIZE) {\r\n      const job = () =>\r\n        uploadFileRestChunking(file, serverRelFolderPath, fileName, progress);\r\n      result = await uploadQueue.addJob(job);\r\n    } else {\r\n      progress({ currentBlock: 0, totalBlocks: 1 });\r\n      result = await uploadFileRest(file, serverRelFolderPath, fileName);\r\n      progress({ currentBlock: 1, totalBlocks: 1 });\r\n    }\r\n\r\n    await updateUploadedFileMetadata(result.d, payload);\r\n\r\n    // check in\r\n    await checkinWithComment(serverRelFolderPath + \"/\" + fileName, \"\");\r\n\r\n    let itemUri = result.d.ListItemAllFields.__deferred.uri + \"?$select=ID\";\r\n\r\n    const listItem = await fetchSharePointData(itemUri);\r\n    return listItem.d.ID;\r\n  }\r\n\r\n  async function updateUploadedFileMetadata(fileResult, payload) {\r\n    var result = await fetch(fileResult.ListItemAllFields.__deferred.uri, {\r\n      method: \"POST\",\r\n      credentials: \"same-origin\",\r\n      body: JSON.stringify(payload),\r\n      headers: {\r\n        Accept: \"application/json; odata=nometadata\",\r\n        \"Content-Type\": \"application/json;odata=nometadata\",\r\n        \"X-RequestDigest\": document.getElementById(\"__REQUESTDIGEST\").value,\r\n        \"X-HTTP-Method\": \"MERGE\",\r\n        \"If-Match\": \"*\",\r\n      },\r\n    }).then((response) => {\r\n      if (!response.ok) {\r\n        console.error(\"Error Updating File\", response);\r\n        return;\r\n      }\r\n\r\n      return response;\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  function copyFiles(sourceFolderPath, destFolderPath, callback, onError) {\r\n    const sourcePath = getServerRelativeFolderPath(sourceFolderPath);\r\n    const destPath = getServerRelativeFolderPath(destFolderPath);\r\n    var context = new SP.ClientContext.get_current();\r\n    var web = context.get_web();\r\n    var folderSrc = web.getFolderByServerRelativeUrl(sourcePath);\r\n    context.load(folderSrc, \"Files\");\r\n    context.executeQueryAsync(\r\n      function () {\r\n        var files = folderSrc.get_files();\r\n        var e = files.getEnumerator();\r\n        var dest = [];\r\n        while (e.moveNext()) {\r\n          var file = e.get_current();\r\n          var destLibUrl = destPath + \"/\" + file.get_name();\r\n          dest.push(destLibUrl); //delete this when we're happy we got the file paths right\r\n          file.copyTo(destLibUrl, true);\r\n        }\r\n        console.log(dest); //delete this when we're happy we got the file paths right\r\n        context.executeQueryAsync(\r\n          function () {\r\n            console.log(\"Files moved successfully!\");\r\n            callback();\r\n          },\r\n          function (sender, args) {\r\n            console.log(\"error: \") + args.get_message();\r\n            onError;\r\n          }\r\n        );\r\n      },\r\n      function (sender, args) {\r\n        console.error(\"Unable to copy files: \", args.get_message());\r\n        console.error(sender);\r\n        console.error(args);\r\n        reject(args);\r\n      }\r\n    );\r\n  }\r\n\r\n  function copyFilesAsync(sourceFolder, destFolder) {\r\n    // TODO: this should stay as a static utility instead of list specific\r\n    return new Promise((resolve, reject) => {\r\n      copyFiles(sourceFolder, destFolder, resolve, reject);\r\n    });\r\n  }\r\n\r\n  // Ensure List/Library exists on the site\r\n  async function ensureList() {\r\n    // Query List Title\r\n    const listInfo = await fetchSharePointData(\r\n      `/web/lists/GetByTitle('${self.config.def.title}')`\r\n    );\r\n  }\r\n\r\n  const publicMembers = {\r\n    findByIdAsync,\r\n    getById,\r\n    findByColumnValueAsync,\r\n    loadNextPage,\r\n    getListItemsAsync,\r\n    createListItemAsync,\r\n    updateListItemAsync,\r\n    deleteListItemAsync,\r\n    setItemPermissionsAsync,\r\n    getItemPermissionsAsync,\r\n    getListPermissions,\r\n    setListPermissionsAsync,\r\n    getFolderContentsAsync,\r\n    upsertFolderPathAsync,\r\n    getServerRelativeFolderPath,\r\n    setFolderReadonlyAsync,\r\n    setFolderPermissionsAsync,\r\n    ensureFolderPermissionsAsync,\r\n    uploadFileToFolderAndUpdateMetadata,\r\n    uploadNewDocumentAsync,\r\n    copyFilesAsync,\r\n    showModal,\r\n    showCheckinModal,\r\n    showVersionHistoryModal,\r\n    getVersionHistoryUrl,\r\n  };\r\n\r\n  return publicMembers;\r\n}\r\n\r\nasync function fetchSharePointData(\r\n  uri,\r\n  method = \"GET\",\r\n  headers = {},\r\n  opts = {}\r\n) {\r\n  const siteEndpoint = uri.startsWith(\"http\")\r\n    ? uri\r\n    : sal.globalConfig.siteUrl + \"/_api\" + uri;\r\n  const response = await fetch(siteEndpoint, {\r\n    method,\r\n    headers: {\r\n      Accept: \"application/json; odata=verbose\",\r\n      \"X-RequestDigest\": document.getElementById(\"__REQUESTDIGEST\").value,\r\n      ...headers,\r\n    },\r\n    ...opts,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    if (response.status == 404) {\r\n      return;\r\n    }\r\n    console.error(response);\r\n  }\r\n  try {\r\n    const result = await response.json();\r\n    return result;\r\n  } catch (e) {\r\n    return;\r\n  }\r\n}\r\n\r\nwindow.fetchSharePointData = fetchSharePointData;\r\n\r\n/**\r\n * Gets a random GUID value\r\n *\r\n * http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\r\n */\r\n/* eslint-disable no-bitwise */\r\nfunction getGUID() {\r\n  if (crypto.randomUUID) return crypto.randomUUID();\r\n\r\n  let d = Date.now();\r\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\r\n    const r = (d + Math.random() * 16) % 16 | 0;\r\n    d = Math.floor(d / 16);\r\n    return (c === \"x\" ? r : (r & 0x3) | 0x8).toString(16);\r\n  });\r\n}\r\n\r\nclass UploadQueue {\r\n  constructor() {}\r\n\r\n  jobs = [];\r\n  _queue = [];\r\n\r\n  enqueue(job) {\r\n    this._queue.push(job);\r\n  }\r\n\r\n  async dequeue() {\r\n    this._queue.shift();\r\n  }\r\n\r\n  async doWork() {\r\n    const job = await this.dequeue();\r\n  }\r\n\r\n  addJob(job) {\r\n    return new Promise((resolve) => {\r\n      this.enqueue(job);\r\n    });\r\n  }\r\n}\r\n\r\nclass JobProcessor {\r\n  constructor(maxConcurrency) {\r\n    this.maxConcurrency = maxConcurrency;\r\n    this.runningJobs = 0;\r\n    this.queue = [];\r\n  }\r\n\r\n  addJob(asyncFunction) {\r\n    return new Promise((resolve, reject) => {\r\n      const job = async () => {\r\n        try {\r\n          const result = await asyncFunction();\r\n          resolve(result);\r\n        } catch (error) {\r\n          reject(error);\r\n        } finally {\r\n          this.runningJobs--;\r\n          this.processQueue();\r\n        }\r\n      };\r\n\r\n      this.queue.push(job);\r\n      this.processQueue();\r\n    });\r\n  }\r\n\r\n  processQueue() {\r\n    while (this.runningJobs < this.maxConcurrency && this.queue.length > 0) {\r\n      const job = this.queue.shift();\r\n      this.runningJobs++;\r\n      job();\r\n    }\r\n  }\r\n}\r\n\r\nconst uploadQueue = new JobProcessor(5);\r\n", "import { sortByTitle } from \"../infrastructure/index.js\";\r\nimport { PeopleModule } from \"../components/fields/PeopleModule.js\";\r\nimport { People } from \"../entities/People.js\";\r\nimport { getUsersByGroupName } from \"../infrastructure/index.js\";\r\nimport { ensureUserByKeyAsync } from \"../infrastructure/sal.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nconst components = {\r\n  view: \"people-view\",\r\n  edit: \"people-edit\",\r\n  new: \"people-edit\",\r\n};\r\n\r\nexport class PeopleField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    // this.pickerOptions = params.pickerOptions ?? {};\r\n    this.spGroupName = params.spGroupName ?? null;\r\n    this.multiple = params.multiple ?? false;\r\n    // this.pickerOptions = params.pickerOptions ?? {};\r\n\r\n    this.Value = this.multiple ? ko.observableArray() : ko.observable();\r\n\r\n    if (ko.isObservable(this.spGroupName)) {\r\n      this.spGroupName.subscribe(this.spGroupNameChangedHandler);\r\n    }\r\n    if (ko.unwrap(this.spGroupName)) {\r\n      this.spGroupNameChangedHandler(ko.unwrap(this.spGroupName));\r\n    }\r\n  }\r\n\r\n  spGroupId = ko.observable();\r\n  userOpts = ko.observableArray();\r\n  expandUsers = ko.observable(false);\r\n\r\n  spGroupNameChangedHandler = async (groupName) => {\r\n    if (!groupName) {\r\n      this.userOpts.removeAll();\r\n      this.spGroupId(null);\r\n    }\r\n\r\n    const group = await ensureUserByKeyAsync(groupName);\r\n    this.spGroupId(group.ID);\r\n    const users = await getUsersByGroupName(groupName);\r\n    this.userOpts(users.sort(sortByTitle));\r\n  };\r\n\r\n  pickerOptions = ko.pureComputed(() => {\r\n    const groupId = ko.unwrap(this.spGroupId);\r\n\r\n    const opts = {\r\n      AllowMultipleValues: this.multiple,\r\n    };\r\n\r\n    if (groupId) opts.SharePointGroupID = groupId;\r\n\r\n    return opts;\r\n  });\r\n\r\n  toString = ko.pureComputed(() => {\r\n    if (!this.multiple) return this.Value()?.Title;\r\n\r\n    return this.Value()?.map((user) => user.Title);\r\n  });\r\n\r\n  set = (val) => {\r\n    if (!this.multiple) {\r\n      this.Value(People.Create(val));\r\n      return;\r\n    }\r\n\r\n    if (!val) {\r\n      this.Value.removeAll();\r\n      return;\r\n    }\r\n\r\n    const vals = val.results ?? val;\r\n\r\n    if (!vals.length) {\r\n      this.Value.removeAll();\r\n      return;\r\n    }\r\n    this.Value(vals.map((u) => People.Create(u)));\r\n  };\r\n\r\n  components = PeopleModule;\r\n}\r\n", "import {\r\n  SearchSelectModule,\r\n  SelectModule,\r\n} from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nexport class SelectField extends BaseField {\r\n  constructor({\r\n    displayName,\r\n    isRequired = false,\r\n    Visible,\r\n    options,\r\n    multiple = false,\r\n    optionsText,\r\n    instructions,\r\n  }) {\r\n    super({ Visible, displayName, isRequired, instructions });\r\n    this.Options(options);\r\n    this.multiple = multiple;\r\n    this.Value = multiple ? ko.observableArray() : ko.observable();\r\n    this.optionsText = optionsText;\r\n\r\n    this.components = this.multiple ? SearchSelectModule : SelectModule;\r\n  }\r\n\r\n  toString = ko.pureComputed(() =>\r\n    this.multiple ? this.Value().join(\", \") : this.Value()\r\n  );\r\n\r\n  get = () => this.Value();\r\n\r\n  set = (val) => {\r\n    if (val && this.multiple) {\r\n      if (Array.isArray(val)) {\r\n        this.Value(val);\r\n      } else {\r\n        this.Value(val.results ?? val.split(\";#\"));\r\n      }\r\n      return;\r\n    }\r\n    this.Value(val);\r\n  };\r\n\r\n  Options = ko.observableArray();\r\n}\r\n", "import { TextAreaModule } from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nexport class TextAreaField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    this.isRichText = params.isRichText;\r\n    this.attr = params.attr ?? {};\r\n  }\r\n\r\n  components = TextAreaModule;\r\n}\r\n", "import { TextModule } from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\n// import ValidationError from \"../primitives/ValidationError.js\";\r\n\r\nexport class TextField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    this.attr = params.attr ?? {};\r\n    this.options = params.options ?? null;\r\n  }\r\n\r\n  components = TextModule;\r\n}\r\n", "export * from \"./BaseField.js\";\r\nexport * from \"./BlobField.js\";\r\nexport * from \"./CheckboxField.js\";\r\nexport * from \"./DateField.js\";\r\nexport * from \"./LookupField.js\";\r\nexport * from \"./PeopleField.js\";\r\nexport * from \"./SelectField.js\";\r\nexport * from \"./TextAreaField.js\";\r\nexport * from \"./TextField.js\";\r\n\r\n// export default {BaseField, BlobField}\r\n", "import { Entity } from \"./index.js\";\r\nimport { BaseField } from \"../fields/index.js\";\r\n\r\n/**\r\n * Constrained Entity's are validated based on their declared fields.\r\n * We are expecting user input, so need to validate each input field.\r\n */\r\n\r\nexport class ConstrainedEntity extends Entity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  toJSON = () => {\r\n    const out = {};\r\n    Object.keys(this.FieldMap).map(\r\n      (key) => (out[key] = this.FieldMap[key]?.get())\r\n    );\r\n    return out;\r\n  };\r\n\r\n  fromJSON(inputObj) {\r\n    if (window.DEBUG)\r\n      console.log(\"Setting constrained entity from JSON\", inputObj);\r\n    Object.keys(inputObj).map((key) => this.FieldMap[key]?.set(inputObj[key]));\r\n  }\r\n\r\n  get FieldMap() {\r\n    const fieldMap = {};\r\n    Object.entries(this)\r\n      .filter(([key, val]) => val instanceof BaseField)\r\n      .map(([key, val]) => {\r\n        key = val.systemName ?? key;\r\n        fieldMap[key] = val;\r\n      });\r\n    return fieldMap;\r\n  }\r\n\r\n  FormFields = () => Object.values(this.FieldMap);\r\n\r\n  // Validate the entire entity\r\n  validate = (showErrors = true) => {\r\n    Object.values(this.FieldMap).map(\r\n      (field) => field?.validate && field.validate(showErrors)\r\n    );\r\n    return this.Errors();\r\n  };\r\n\r\n  Errors = ko.pureComputed(() => {\r\n    return Object.values(this.FieldMap)\r\n      .filter((field) => field?.Errors && field.Errors())\r\n      .flatMap((field) => field.Errors());\r\n  });\r\n\r\n  IsValid = ko.pureComputed(() => !this.Errors().length);\r\n\r\n  /**\r\n   * Expose methods to generate default new, edit, and view forms\r\n   * for a constrained entity. Uses the constrained\r\n   * entity components.\r\n   *\r\n   * This could be broken into a separate service, but since it's\r\n   * tightly coupled leave it here?\r\n   */\r\n  // static components = {\r\n  //   new: (entity, view = null) =>\r\n  //     new ConstrainedEntityComponent({\r\n  //       entityView: new ConstrainedEntityView({ entity, view }),\r\n  //       displayMode: \"edit\",\r\n  //     }),\r\n  //   edit: (entity, view = null) =>\r\n  //     new ConstrainedEntityComponent({\r\n  //       entityView: new ConstrainedEntityView({ entity, view }),\r\n  //       displayMode: \"edit\",\r\n  //     }),\r\n  //   view: (entity, view = null) =>\r\n  //     new ConstrainedEntityComponent({\r\n  //       entityView: new ConstrainedEntityView({ entity, view }),\r\n  //       displayMode: \"view\",\r\n  //     }),\r\n  // };\r\n}\r\n", "export * from \"./validation_error.js\";\r\nexport * from \"./entity.js\";\r\nexport * from \"./constrained_entity.js\";\r\n", "import { Entity } from \"../primitives/index.js\";\r\n\r\nexport class Page extends Entity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static Views = {\r\n    All: [\"ID\", \"Title\", \"Created\", \"Author\", \"Modified\", \"Editor\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"Pages\",\r\n    title: \"Pages\",\r\n  };\r\n}\r\n", "export * from \"./People.js\";\r\nexport * from \"./Page.js\";\r\n", "export const assetsPath = \"/sites/CGFS/Style Library/apps/audit/src\";\r\n", "import { People } from \"../entities/index.js\";\r\nimport { ensureUserByKeyAsync } from \"./index.js\";\r\nimport { assetsPath } from \"../../env.js\";\r\n\r\nko.subscribable.fn.subscribeChanged = function (callback) {\r\n  var oldValue;\r\n  this.subscribe(\r\n    function (_oldValue) {\r\n      oldValue = _oldValue;\r\n    },\r\n    this,\r\n    \"beforeChange\"\r\n  );\r\n\r\n  this.subscribe(function (newValue) {\r\n    callback(newValue, oldValue);\r\n  });\r\n};\r\n\r\nko.observableArray.fn.subscribeAdded = function (callback) {\r\n  this.subscribe(\r\n    function (arrayChanges) {\r\n      const addedValues = arrayChanges\r\n        .filter((value) => value.status == \"added\")\r\n        .map((value) => value.value);\r\n      callback(addedValues);\r\n    },\r\n    this,\r\n    \"arrayChange\"\r\n  );\r\n};\r\n\r\nko.bindingHandlers.searchSelect = {\r\n  init: function (element, valueAccessor, allBindingsAccessor) {\r\n    const { options, selectedOptions, optionsText, onSearchInput } =\r\n      valueAccessor();\r\n\r\n    function populateOpts() {\r\n      const optionItems = ko.unwrap(options);\r\n\r\n      const optionElements = optionItems.map((option) => {\r\n        const optionElement = document.createElement(\"option\");\r\n        ko.selectExtensions.writeValue(optionElement, ko.unwrap(option));\r\n        // optionElement.value = option;\r\n        optionElement.innerText = optionsText(option);\r\n\r\n        if (\r\n          ko\r\n            .unwrap(selectedOptions)\r\n            ?.find((selectedOption) => selectedOption.ID == option.ID)\r\n        ) {\r\n          optionElement.setAttribute(\"selected\", \"\");\r\n        }\r\n        return optionElement;\r\n      });\r\n\r\n      element.append(...optionElements);\r\n    }\r\n\r\n    populateOpts();\r\n\r\n    if (ko.isObservable(options)) {\r\n      options.subscribe(() => populateOpts(), this);\r\n    }\r\n\r\n    ko.utils.registerEventHandler(element, \"change\", (e) => {\r\n      selectedOptions(\r\n        element.selectedOptions.map((opt) => ko.selectExtensions.readValue(opt))\r\n      );\r\n    });\r\n\r\n    if (onSearchInput) {\r\n      ko.utils.registerEventHandler(element, \"input\", (e) => {\r\n        onSearchInput(e.originalEvent.target.searchInputElement.value);\r\n      });\r\n    }\r\n  },\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {\r\n    const { selectedOptions } = valueAccessor();\r\n    const selectedUnwrapped = ko.unwrap(selectedOptions);\r\n\r\n    for (var i = 0; i < element.options.length; i++) {\r\n      const o = element.options[i];\r\n      o.toggleAttribute(\r\n        \"selected\",\r\n        selectedUnwrapped.includes(ko.selectExtensions.readValue(o))\r\n      );\r\n    }\r\n\r\n    // element.selectedOptions = ko.unwrap(selectedOptions);\r\n  },\r\n};\r\n\r\nko.bindingHandlers.people = {\r\n  init: function (element, valueAccessor, allBindingsAccessor) {\r\n    var schema = {};\r\n    schema[\"PrincipalAccountType\"] = \"User\";\r\n    schema[\"SearchPrincipalSource\"] = 15;\r\n    schema[\"ShowUserPresence\"] = true;\r\n    schema[\"ResolvePrincipalSource\"] = 15;\r\n    schema[\"AllowEmailAddresses\"] = true;\r\n    schema[\"AllowMultipleValues\"] = false;\r\n    schema[\"MaximumEntitySuggestions\"] = 50;\r\n    //schema[\"Width\"] = \"280px\";\r\n    schema[\"OnUserResolvedClientScript\"] = async function (elemId, userKeys) {\r\n      //  get reference of People Picker Control\r\n      var pickerControl = SPClientPeoplePicker.SPClientPeoplePickerDict[elemId];\r\n      var observable = valueAccessor();\r\n      var userJSObject = pickerControl.GetControlValueAsJSObject()[0];\r\n      if (!userJSObject) {\r\n        observable(null);\r\n        return;\r\n      }\r\n\r\n      if (userJSObject.IsResolved) {\r\n        if (userJSObject.Key == observable()?.LoginName) return;\r\n        var user = await ensureUserByKeyAsync(userJSObject.Key);\r\n        var person = new People(user);\r\n        observable(person);\r\n      }\r\n    };\r\n\r\n    // TODO: Minor - accept schema settings as options\r\n    //var mergedOptions = Object.assign(schema, obs.schemaOpts);\r\n\r\n    //  Initialize the Control, MS enforces to pass the Element ID hence we need to provide\r\n    //  ID to our element, no other options\r\n    SPClientPeoplePicker_InitStandaloneControlWrapper(element.id, null, schema);\r\n    // const helpDiv = document.createElement(\"div\");\r\n    // helpDiv.innerHTML = \"Search surname first e.g. Smith, John\";\r\n    // helpDiv.classList.add(\"fst-italic\", \"fw-lighter\");\r\n    // element.appendChild(helpDiv);\r\n  },\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {\r\n    var pickerControl =\r\n      SPClientPeoplePicker.SPClientPeoplePickerDict[element.id + \"_TopSpan\"];\r\n    var userValue = ko.utils.unwrapObservable(valueAccessor());\r\n\r\n    if (!userValue) {\r\n      // Clear the form\r\n      pickerControl?.DeleteProcessedUser();\r\n      return;\r\n    }\r\n\r\n    if (\r\n      userValue &&\r\n      !pickerControl\r\n        .GetAllUserInfo()\r\n        .find((pickerUser) => pickerUser.DisplayText == userValue.LookupValue)\r\n    ) {\r\n      pickerControl.AddUserKeys(\r\n        userValue.LoginName ?? userValue.LookupValue ?? userValue.Title\r\n      );\r\n    }\r\n  },\r\n};\r\n\r\nko.bindingHandlers.dateField = {\r\n  init: function (element, valueAccessor, allBindingsAccessor) {},\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {},\r\n};\r\n\r\nko.bindingHandlers.downloadLink = {\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {\r\n    var path = valueAccessor();\r\n    var replaced = path.replace(/:([A-Za-z_]+)/g, function (_, token) {\r\n      return ko.unwrap(viewModel[token]);\r\n    });\r\n    element.href = replaced;\r\n  },\r\n};\r\n\r\nko.bindingHandlers.files = {\r\n  init: function (element, valueAccessor) {\r\n    function addFiles(fileList) {\r\n      var value = valueAccessor();\r\n      if (!fileList.length) {\r\n        value.removeAll();\r\n        return;\r\n      }\r\n\r\n      const existingFiles = ko.unwrap(value);\r\n      const newFileList = [];\r\n      for (let file of fileList) {\r\n        if (!existingFiles.find((exFile) => exFile.name == file.name))\r\n          newFileList.push(file);\r\n      }\r\n      ko.utils.arrayPushAll(value, newFileList);\r\n      return;\r\n    }\r\n\r\n    ko.utils.registerEventHandler(element, \"change\", function () {\r\n      addFiles(element.files);\r\n    });\r\n\r\n    const label = element.closest(\"label\");\r\n    if (!label) return;\r\n\r\n    ko.utils.registerEventHandler(label, \"dragover\", function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    });\r\n\r\n    ko.utils.registerEventHandler(label, \"dragenter\", function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      label.classList.add(\"dragging\");\r\n    });\r\n\r\n    ko.utils.registerEventHandler(label, \"dragleave\", function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      label.classList.remove(\"dragging\");\r\n    });\r\n\r\n    ko.utils.registerEventHandler(label, \"drop\", function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      let dt = event.originalEvent.dataTransfer;\r\n      let files = dt.files;\r\n      addFiles(files);\r\n    });\r\n  },\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {\r\n    const value = valueAccessor();\r\n    if (!value().length && element.files.length) {\r\n      // clear all files\r\n      element.value = null;\r\n      return;\r\n    }\r\n\r\n    return;\r\n  },\r\n};\r\n\r\nko.bindingHandlers.toggleClick = {\r\n  init: function (element, valueAccessor, allBindings) {\r\n    var value = valueAccessor();\r\n\r\n    ko.utils.registerEventHandler(element, \"click\", function () {\r\n      var classToToggle = allBindings.get(\"toggleClass\");\r\n      var classContainer = allBindings.get(\"classContainer\");\r\n      var containerType = allBindings.get(\"containerType\");\r\n\r\n      if (containerType && containerType == \"sibling\") {\r\n        $(element)\r\n          .nextUntil(classContainer)\r\n          .each(function () {\r\n            $(this).toggleClass(classToToggle);\r\n          });\r\n      } else if (containerType && containerType == \"doc\") {\r\n        var curIcon = $(element).attr(\"src\");\r\n        if (curIcon == \"/_layouts/images/minus.gif\")\r\n          $(element).attr(\"src\", \"/_layouts/images/plus.gif\");\r\n        else $(element).attr(\"src\", \"/_layouts/images/minus.gif\");\r\n\r\n        if ($(element).parent() && $(element).parent().parent()) {\r\n          $(element)\r\n            .parent()\r\n            .parent()\r\n            .nextUntil(classContainer)\r\n            .each(function () {\r\n              $(this).toggleClass(classToToggle);\r\n            });\r\n        }\r\n      } else if (containerType && containerType == \"any\") {\r\n        if ($(\".\" + classToToggle).is(\":visible\"))\r\n          $(\".\" + classToToggle).hide();\r\n        else $(\".\" + classToToggle).show();\r\n      } else $(element).find(classContainer).toggleClass(classToToggle);\r\n    });\r\n  },\r\n};\r\n\r\nko.bindingHandlers.toggles = {\r\n  init: function (element, valueAccessor) {\r\n    var value = valueAccessor();\r\n\r\n    ko.utils.registerEventHandler(element, \"click\", function () {\r\n      value(!value());\r\n    });\r\n  },\r\n};\r\n\r\nconst fromPathTemplateLoader = {\r\n  loadTemplate: function (name, templateConfig, callback) {\r\n    if (templateConfig.fromPath) {\r\n      // TODO: Minor - fix error catching and fallback flow\r\n      fetch(assetsPath + templateConfig.fromPath)\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(\r\n              `Error Fetching HTML Template - ${response.statusText}`\r\n            );\r\n          }\r\n          return response.text();\r\n        })\r\n        .catch((error) => {\r\n          if (!templateConfig.fallback) return;\r\n          console.warn(\r\n            \"Primary template not found, attempting fallback\",\r\n            templateConfig\r\n          );\r\n          fetch(assetsPath + templateConfig.fallback)\r\n            .then((response) => {\r\n              if (!response.ok) {\r\n                throw new Error(\r\n                  `Error Fetching fallback HTML Template - ${response.statusText}`\r\n                );\r\n              }\r\n              return response.text();\r\n            })\r\n            .then((text) =>\r\n              ko.components.defaultLoader.loadTemplate(name, text, callback)\r\n            );\r\n        })\r\n        .then((text) =>\r\n          text\r\n            ? ko.components.defaultLoader.loadTemplate(name, text, callback)\r\n            : null\r\n        );\r\n    } else {\r\n      callback(null);\r\n    }\r\n  },\r\n};\r\n\r\nko.components.loaders.unshift(fromPathTemplateLoader);\r\n\r\nconst fromPathViewModelLoader = {\r\n  loadViewModel: function (name, viewModelConfig, callback) {\r\n    if (viewModelConfig.viaLoader) {\r\n      // console.log(\"loading module\", name);\r\n      const module = import(assetsPath + viewModelConfig.viaLoader).then(\r\n        (module) => {\r\n          // console.log(\"imported module\", name);\r\n          const viewModelConstructor = module.default;\r\n          // We need a createViewModel function, not a plain constructor.\r\n          // We can use the default loader to convert to the\r\n          // required format.\r\n          ko.components.defaultLoader.loadViewModel(\r\n            name,\r\n            viewModelConstructor,\r\n            callback\r\n          );\r\n        }\r\n      );\r\n    } else {\r\n      // Unrecognized config format. Let another loader handle it.\r\n      callback(null);\r\n    }\r\n  },\r\n};\r\n\r\nko.components.loaders.unshift(fromPathViewModelLoader);\r\n", "export const html = String.raw;\r\n\r\nexport function registerComponent({\r\n  name,\r\n  folder,\r\n  module = null,\r\n  moduleFilename = null,\r\n  template: templateFilename,\r\n}) {\r\n  if (ko.components.isRegistered(name)) {\r\n    return;\r\n  }\r\n  if (moduleFilename || module) {\r\n    ko.components.register(name, {\r\n      template: {\r\n        fromPath: `/components/${folder}/${templateFilename}.html`,\r\n      },\r\n      viewModel: module ?? {\r\n        viaLoader: `/components/${folder}/${moduleFilename}.js`,\r\n      },\r\n    });\r\n  } else {\r\n    ko.components.register(name, {\r\n      template: {\r\n        fromPath: `/components/${folder}/${templateFilename}.html`,\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport function directRegisterComponent(name, { template, viewModel = null }) {\r\n  ko.components.register(name, {\r\n    template,\r\n    viewModel,\r\n  });\r\n}\r\n\r\nexport function registerFieldComponent({\r\n  name,\r\n  components,\r\n  viewModel = null,\r\n  folder = null,\r\n}) {\r\n  // register both our view and edit\r\n  folder = folder ?? name;\r\n\r\n  Object.keys(components).map((view) => {\r\n    const componentName = components[view];\r\n    if (ko.components.isRegistered(componentName)) {\r\n      return;\r\n    }\r\n\r\n    // See if we already have this element in the dom\r\n    const elementName = `field-` + componentName;\r\n    const fieldViewElement = document.getElementById(elementName);\r\n\r\n    if (!viewModel) {\r\n      debugger;\r\n    }\r\n    ko.components.register(componentName, {\r\n      template: fieldViewElement\r\n        ? {\r\n            element: fieldViewElement,\r\n          }\r\n        : {\r\n            fromPath: `/sal/components/fields/${folder}/${name}${view}.html`,\r\n          },\r\n      viewModel: viewModel ?? {\r\n        viaLoader: `/sal/components/fields/${folder}/${name}Module.js`,\r\n      },\r\n    });\r\n  });\r\n}\r\n", "import { getGroupUsers } from \"./sal.js\";\r\n\r\nexport async function getUsersByGroupName(groupName) {\r\n  const users = await getGroupUsers(groupName);\r\n\r\n  if (!users) return [];\r\n\r\n  return users.map((userProps) => new People(userProps));\r\n}\r\n", "export * from \"./entity_utilities.js\";\r\nexport * from \"./knockout_extensions.js\";\r\nexport * from \"./register_components.js\";\r\nexport * from \"./sal.js\";\r\nexport * from \"./authorization.js\";\r\n", "import { ORGROLES, ORGTYPES } from \"../entities/index.js\";\r\nexport const configurationsStore = {};\r\n\r\nexport const auditOrganizationStore = ko.observableArray();\r\n\r\nexport const allActionOfficesFilter = (org) =>\r\n  ORGROLES.ACTIONOFFICE == org.Role;\r\n\r\nexport const allRequestingOfficesFilter = (org) =>\r\n  ORGROLES.REQUESTINGOFFICE == org.Role;\r\n", "import { AuditRequest, AuditOrganization } from \"./index.js\";\r\nimport { auditOrganizationStore } from \"../infrastructure/store.js\";\r\n\r\nimport { ConstrainedEntity } from \"../sal/primitives/constrained_entity.js\";\r\nimport { LookupField, TextField } from \"../sal/fields/index.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport class AuditCoversheet extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  Title = new TextField({\r\n    displayName: \"Title\",\r\n    required: true,\r\n  });\r\n\r\n  FileName = new TextField({\r\n    displayName: \"Name\",\r\n    systemName: \"FileLeafRef\",\r\n    required: true,\r\n  });\r\n\r\n  FileRef = new TextField({\r\n    displayName: \"File Link\",\r\n    systemName: \"FileRef\",\r\n  });\r\n\r\n  ReqNum = new LookupField({\r\n    displayName: \"Request Number\",\r\n    type: AuditRequest,\r\n    lookupCol: \"Title\",\r\n    required: true,\r\n    entitySet: appContext.AuditRequests,\r\n  });\r\n\r\n  ActionOffice = new LookupField({\r\n    displayName: \"Action Offices\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: ko.pureComputed(() => {\r\n      // Only allow action offices from this coversheets associated request\r\n      const request = ko.unwrap(this.ReqNum.Value);\r\n      if (!request) return (val) => val;\r\n\r\n      const requestActionOffices = ko.unwrap(request.ActionOffice.Value);\r\n\r\n      return (opt) => requestActionOffices.includes(opt);\r\n    }),\r\n    lookupCol: \"Title\",\r\n    multiple: true,\r\n    entitySet: appContext.AuditOrganizations,\r\n  });\r\n\r\n  static Views = {\r\n    All: [\"ID\", \"Title\", \"FileLeafRef\", \"FileRef\", \"ReqNum\", \"ActionOffice\"],\r\n    AOCanUpdate: [\"Title\", \"FileLeafRef\", \"ActionOffice\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    title: \"AuditCoversheets\",\r\n    name: \"AuditCoversheets\",\r\n    isLib: true,\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/constrained_entity.js\";\r\n\r\nexport class AuditEmail extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static Views = {\r\n    All: [\"ID\", \"Title\", \"To\", \"Body\", \"NotificationType\", \"ReqNum\", \"ResID\"],\r\n  };\r\n  static ListDef = {\r\n    name: \"AuditEmails\",\r\n    title: \"AuditEmails\",\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/constrained_entity.js\";\r\n\r\nexport const ORGTYPES = {\r\n  BUREAU: \"Bureau\",\r\n  EXTERNAL: \"External\",\r\n  INTERNAL: \"Internal\",\r\n  POST: \"Post\",\r\n};\r\n\r\nexport const ORGROLES = {\r\n  ACTIONOFFICE: \"Action Office\",\r\n  REQUESTINGOFFICE: \"Requesting Office\",\r\n  QUALITYASSURANCE: \"Quality Assurance\",\r\n  SPECIALPERMISSIONS: \"Special Permissions\",\r\n  RESTRICTEDREADERS: \"Restricted Readers\",\r\n};\r\n\r\nexport class AuditOrganization extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"Country\",\r\n      \"Organization_x0020_Description\",\r\n      \"EmailGroup\",\r\n      \"Org_Type\",\r\n      \"Post_x0020_Code\",\r\n      \"UserGroup\",\r\n      \"Role\",\r\n    ],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditOrganizations\",\r\n    title: \"AuditOrganizations\",\r\n  };\r\n}\r\n", "import { AuditOrganization, ORGTYPES } from \"./audit_organization.js\";\r\nimport {\r\n  LookupField,\r\n  PeopleField,\r\n  TextField,\r\n  TextAreaField,\r\n  DateField,\r\n  dateFieldTypes,\r\n  SelectField,\r\n  CheckboxField,\r\n} from \"../sal/fields/index.js\";\r\nimport { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\n\r\nimport { ValidationError } from \"../sal/primitives/validation_error.js\";\r\nimport {\r\n  allActionOfficesFilter,\r\n  allRequestingOfficesFilter,\r\n  auditOrganizationStore,\r\n} from \"../infrastructure/store.js\";\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport const AUDITREQUESTSTATES = {\r\n  OPEN: \"Open\",\r\n  CANCELLED: \"Canceled\",\r\n  CLOSED: \"Closed\",\r\n  REOPENED: \"ReOpened\",\r\n};\r\n\r\nexport const AUDITREQUESTTYPES = {\r\n  TASKER: \"Tasker\",\r\n  REQUEST: \"Request\",\r\n  NOTIFICATION: \"Notification\",\r\n};\r\n\r\nexport class AuditRequest extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n\r\n    this.InternalDueDate.addFieldRequirement({\r\n      requirement: ko.pureComputed(() => {\r\n        return this.InternalDueDate.Value() > this.ReqDueDate.Value();\r\n      }),\r\n      error: new ValidationError(\r\n        \"text-field\",\r\n        \"required-field\",\r\n        \"The Internal Due Date must be before the Request Due Date!\"\r\n      ),\r\n    });\r\n  }\r\n\r\n  ReqType = new SelectField({\r\n    displayName: \"Request Type\",\r\n    options: Object.values(AUDITREQUESTTYPES),\r\n    isRequired: true,\r\n    instructions: ko.pureComputed(() => {\r\n      switch (this.ReqType.Value()) {\r\n        case AUDITREQUESTTYPES.TASKER:\r\n          return \"A request that doesn't require QA Approval.\";\r\n        case AUDITREQUESTTYPES.REQUEST:\r\n          return \"A request requiring QA Approval\";\r\n        case AUDITREQUESTTYPES.NOTIFICATION:\r\n          return \"A request that is closed after the email is sent\";\r\n        default:\r\n      }\r\n    }),\r\n  });\r\n\r\n  ReqNum = new TextField({\r\n    displayName: \"Request Number\",\r\n    systemName: \"Title\",\r\n    isRequired: true,\r\n  });\r\n\r\n  ReqSubject = new TextField({\r\n    displayName: \"Request Subject\",\r\n    isRequired: true,\r\n  });\r\n\r\n  RequestingOffice = new LookupField({\r\n    displayName: \"Requesting Office\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: allRequestingOfficesFilter,\r\n    lookupCol: \"Title\",\r\n    entitySet: appContext.AuditOrganizations,\r\n    isRequired: true,\r\n  });\r\n\r\n  FiscalYear = new TextField({\r\n    displayName: \"Fiscal Year\",\r\n    isRequired: true,\r\n  });\r\n\r\n  InternalDueDate = new DateField({\r\n    displayName: \"Internal Due Date\",\r\n    type: dateFieldTypes.date,\r\n    isRequired: true,\r\n  });\r\n\r\n  ReqDueDate = new DateField({\r\n    displayName: \"Request Due Date\",\r\n    type: dateFieldTypes.date,\r\n    isRequired: true,\r\n  });\r\n\r\n  ReqStatus = new SelectField({\r\n    displayName: \"Request Status\",\r\n    options: Object.values(AUDITREQUESTSTATES),\r\n    isRequired: true,\r\n  });\r\n\r\n  IsSample = new CheckboxField({\r\n    displayName: \"Is Sample?\",\r\n  });\r\n\r\n  ReceiptDate = new DateField({\r\n    displayName: \"Receipt Date\",\r\n    type: dateFieldTypes.date,\r\n    isRequired: false,\r\n  });\r\n\r\n  RelatedAudit = new TextField({\r\n    displayName: \"Related Audit\",\r\n    isRequired: false,\r\n    instructions:\r\n      \"The Audit Request number of the similar audit performed in the previous FY\",\r\n  });\r\n\r\n  ActionItems = new TextAreaField({\r\n    displayName: \"Action Items\",\r\n    instructions: \"Items that have been requested by the Auditor\",\r\n    isRichText: true,\r\n    isMinimalEditor: true,\r\n    classList: [\"min-w-full\"],\r\n  });\r\n\r\n  Comments = new TextAreaField({\r\n    displayName: \"Comments\",\r\n    isRichText: true,\r\n    isMinimalEditor: true,\r\n    classList: [\"min-w-full\"],\r\n  });\r\n\r\n  Reminders = new SelectField({\r\n    displayName: \"Reminders\",\r\n    options: [\r\n      \"3 Days Before Due\",\r\n      \"1 Day Before Due\",\r\n      \"1 Day Past Due\",\r\n      \"3 Days Past Due\",\r\n      \"7 Days Past Due\",\r\n    ],\r\n    multiple: true,\r\n  });\r\n\r\n  EmailSent = new CheckboxField({\r\n    displayName: \"Email has been sent\",\r\n  });\r\n\r\n  Sensitivity = new SelectField({\r\n    displayName: \"Sensitivity\",\r\n    options: [\"None\", \"Official\", \"SBU\", \"PII_SBU\"],\r\n  });\r\n\r\n  ActionOffice = new LookupField({\r\n    displayName: \"Action Offices\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: allActionOfficesFilter,\r\n    lookupCol: \"Title\",\r\n    multiple: true,\r\n    entitySet: appContext.AuditOrganizations,\r\n  });\r\n\r\n  EmailActionOffice = new LookupField({\r\n    displayName: \"Email Action Offices\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: allActionOfficesFilter,\r\n    lookupCol: \"Title\",\r\n    multiple: true,\r\n    entitySet: appContext.AuditOrganizations,\r\n  });\r\n\r\n  ClosedDate = new DateField({\r\n    displayName: \"Closed Date\",\r\n    isRequired: false,\r\n  });\r\n\r\n  ClosedBy = new PeopleField({\r\n    displayName: \"Closed By\",\r\n    isRequired: false,\r\n  });\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"ReqType\",\r\n      \"ReqSubject\",\r\n      \"FiscalYear\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"EmailSent\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n      \"EmailActionOffice\",\r\n      \"RequestingOffice\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n    ],\r\n    New: [\r\n      \"Title\",\r\n      \"ReqType\",\r\n      \"ReqSubject\",\r\n      \"RequestingOffice\",\r\n      \"FiscalYear\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n    ],\r\n    IACanUpdate: [\r\n      \"ReqType\",\r\n      \"ReqSubject\",\r\n      \"FiscalYear\",\r\n      \"RequestingOffice\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n      \"EmailActionOffice\",\r\n      \"ClosedBy\",\r\n      \"ClosedDate\",\r\n    ],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditRequests\",\r\n    title: \"AuditRequests\",\r\n  };\r\n}\r\n", "import { AuditRequest } from \"./audit_request.js\";\r\n// import { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport class AuditBulkRequest extends AuditRequest {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  toRequest() {\r\n    const newReq = new AuditRequest(this);\r\n\r\n    newReq.fromJSON(this.toJSON());\r\n    return newReq;\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"ReqSubject\",\r\n      \"FiscalYear\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"EmailSent\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n      \"EmailActionOffice\",\r\n      \"EmailActionOffice\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n    ],\r\n    New: [\r\n      \"Title\",\r\n      \"ReqSubject\",\r\n      \"FiscalYear\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n    ],\r\n  };\r\n  static ListDef = {\r\n    name: \"AuditBulkRequests\",\r\n    title: \"AuditBulkRequests\",\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\nimport { TextField, DateField, dateFieldTypes } from \"../sal/fields/index.js\";\r\n\r\nexport class Comment extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  id = new TextField({\r\n    displayName: \"ID\",\r\n  });\r\n  text = new TextField({\r\n    displayName: \"Comment\",\r\n  });\r\n  author = new TextField({\r\n    displayName: \"author\",\r\n  });\r\n  timestamp = new TextField({\r\n    displayName: \"timestamp\",\r\n  });\r\n\r\n  FieldMap = {\r\n    id: this.id,\r\n    text: this.text,\r\n    author: this.author,\r\n    timestamp: this.timestamp,\r\n  };\r\n\r\n  static Create({ id, text, author, timestamp }) {\r\n    const newComment = new Comment();\r\n    newComment.id.Value(id);\r\n    newComment.text.Value(text);\r\n    newComment.author.Value(author);\r\n    newComment.timestamp.Value(timestamp);\r\n\r\n    return newComment;\r\n  }\r\n  static Views = {\r\n    All: [\"id\", \"text\", \"author\", \"timestamp\"],\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\nimport { TextField, DateField, dateFieldTypes } from \"../sal/fields/index.js\";\r\n\r\nexport class ActiveViewer extends ConstrainedEntity {\r\n  id = new TextField({\r\n    displayName: \"ID\",\r\n  });\r\n  viewer = new TextField({\r\n    displayName: \"Viewer\",\r\n  });\r\n  timestamp = new DateField({\r\n    displayName: \"Timestamp\",\r\n    type: dateFieldTypes.datetime,\r\n  });\r\n\r\n  FieldMap = {\r\n    id: this.id,\r\n    viewer: this.viewer,\r\n    timestamp: this.timestamp,\r\n  };\r\n\r\n  static Views = {\r\n    All: [\"id\", \"viewer\", \"timestamp\"],\r\n  };\r\n}\r\n", "import { ActiveViewer } from \"../../value_objects/active_viewer.js\";\r\nimport { appContext } from \"../../infrastructure/application_db_context.js\";\r\n\r\nexport class ActiveViewersComponent {\r\n  constructor({ entity, fieldName }) {\r\n    this.entity = entity;\r\n    this.blobField = entity[fieldName];\r\n    this.fieldName = fieldName;\r\n    this.viewers = this.blobField.TypedValues;\r\n  }\r\n  entity;\r\n  blobField;\r\n  fieldName;\r\n\r\n  pushCurrentUser() {\r\n    this.pushUser(_spPageContextInfo.userLoginName);\r\n  }\r\n\r\n  pushUser(loginName) {\r\n    // Check if our viewer is listed\r\n    var filteredViewers = this.viewers().filter(function (viewer) {\r\n      return viewer.viewer != loginName;\r\n    });\r\n\r\n    this.viewers(filteredViewers);\r\n\r\n    var viewer = new ActiveViewer();\r\n    viewer.fromJSON({\r\n      id: Math.ceil(Math.random() * 1000000).toString(16),\r\n      viewer: loginName,\r\n      timestamp: new Date().toLocaleString(),\r\n    });\r\n    this.viewers.push(viewer);\r\n    this.commitChanges();\r\n  }\r\n\r\n  removeUser(viewerToRemove) {\r\n    this.viewers.remove(viewerToRemove);\r\n    this.commitChanges();\r\n  }\r\n\r\n  removeCurrentuser() {\r\n    this.removeUserByLogin(_spPageContextInfo.userLoginName);\r\n  }\r\n\r\n  removeUserByLogin(loginName) {\r\n    // Check if our viewer is listed\r\n    var viewerToRemove = this.viewers().find(function (viewer) {\r\n      return viewer.viewer == loginName;\r\n    });\r\n\r\n    if (viewerToRemove) {\r\n      this.removeUser(viewerToRemove);\r\n    }\r\n  }\r\n\r\n  onRemove = (viewerToRemove) => {\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      this.removeUser(viewerToRemove);\r\n    }\r\n  };\r\n\r\n  async commitChanges() {\r\n    const set = appContext.Set(this.entity.constructor);\r\n    if (!set) {\r\n      alert(\"Cannot find entity set\", this.entity);\r\n      return;\r\n    }\r\n    await set.UpdateEntity(this.entity, [this.fieldName]);\r\n  }\r\n}\r\n\r\n// TODO: convert to class\r\nexport function ActiveViewersModuleLegacy(requestId, props) {\r\n  var requestListTitle = props.requestListTitle;\r\n  var columnName = props.columnName;\r\n  var initialValue = props.initialValue;\r\n  var arrInitialViewers = [];\r\n  // If we have comments here, try to parse them.\r\n  if (initialValue) {\r\n    try {\r\n      arrInitialViewers = JSON.parse(initialValue);\r\n      arrInitialViewers.forEach(function (viewer) {\r\n        viewer.timestamp = new Date(viewer.timestamp);\r\n      });\r\n    } catch (e) {\r\n      console.error(\"could not parse internal status comments.\");\r\n    }\r\n  }\r\n  var viewers = ko.observableArray(arrInitialViewers);\r\n\r\n  function pushCurrentUser() {\r\n    pushUser(_spPageContextInfo.userLoginName);\r\n  }\r\n\r\n  function pushUser(loginName) {\r\n    // Check if our viewer is listed\r\n    var filteredViewers = viewers().filter(function (viewer) {\r\n      return viewer.viewer != loginName;\r\n    });\r\n\r\n    viewers(filteredViewers);\r\n\r\n    var viewer = {\r\n      id: Math.ceil(Math.random() * 1000000).toString(16),\r\n      viewer: loginName,\r\n      timestamp: new Date(),\r\n    };\r\n    viewers.push(viewer);\r\n    commitChanges();\r\n  }\r\n\r\n  function removeCurrentuser() {\r\n    removeUserByLogin(_spPageContextInfo.userLoginName);\r\n  }\r\n\r\n  function removeUserByLogin(loginName) {\r\n    // Check if our viewer is listed\r\n    var viewerToRemove = viewers().filter(function (viewer) {\r\n      return viewer.viewer == loginName;\r\n    });\r\n\r\n    if (viewerToRemove.length) {\r\n      removeUser(viewerToRemove[0]);\r\n    }\r\n  }\r\n\r\n  function onRemove(viewerToRemove) {\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      removeUser(viewerToRemove);\r\n    }\r\n  }\r\n\r\n  function removeUser(viewerToRemove) {\r\n    var viewerIndex = viewers.indexOf(viewerToRemove);\r\n    viewers.splice(viewerIndex, 1);\r\n    commitChanges();\r\n  }\r\n\r\n  function commitChanges() {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n    //Now push to the request item:\r\n    var requestList = web.get_lists().getByTitle(requestListTitle);\r\n    const oListItem = requestList.getItemById(requestId);\r\n    oListItem.set_item(columnName, JSON.stringify(viewers()));\r\n    oListItem.update();\r\n\r\n    currCtx.load(oListItem);\r\n\r\n    currCtx.executeQueryAsync(\r\n      function onSuccess() {\r\n        // console.log(\"Added User\");\r\n      },\r\n      function onFailure(args, sender) {\r\n        console.error(\"Failed to commit changes - \" + columnName, args);\r\n      }\r\n    );\r\n  }\r\n\r\n  var publicMembers = {\r\n    viewers: viewers,\r\n    pushCurrentUser: pushCurrentUser,\r\n    pushUser: pushUser,\r\n    removeCurrentuser: removeCurrentuser,\r\n    removeUserByLogin: removeUserByLogin,\r\n    onRemove: onRemove,\r\n  };\r\n\r\n  return publicMembers;\r\n}\r\n", "import { html } from \"../../sal/infrastructure/index.js\";\r\n\r\nexport const commentChainTemplate = html`\r\n  <div>\r\n    <!-- ko if: showHistoryBool -->\r\n    <!-- ko foreach: comments -->\r\n    <div class=\"comment\">\r\n      <div data-bind=\"text: text.Value\"></div>\r\n      <div>\r\n        <span\r\n          data-bind=\"text: author.Value() + ' @ ' + timestamp.Value()\"\r\n        ></span\r\n        ><span class=\"remove\" data-bind=\"click: $parent.onRemove\">x</span>\r\n      </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: showHistoryBool -->\r\n    <div class=\"comment\" data-bind=\"with: comments()[comments().length - 1]\">\r\n      <div data-bind=\"text: text.Value\"></div>\r\n      <div>\r\n        <span\r\n          data-bind=\"text: author.Value() + ' @ ' + timestamp.Value()\"\r\n        ></span\r\n        ><span class=\"remove\" data-bind=\"click: $parent.onRemove\">x</span>\r\n      </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <a\r\n      title=\"Show hidden comments\"\r\n      href=\"javascript:void(0)\"\r\n      data-bind=\"click: toggleShowHistory\"\r\n    >\r\n      <span class=\"ui-icon ui-icon-comment\"></span>\r\n      Toggle Comment History (<span data-bind=\"text: comments().length\"></span>\r\n      Total)\r\n    </a>\r\n    <div class=\"newComment\">\r\n      <textarea cols=\"50\" data-bind=\"value: newCommentText\"></textarea>\r\n      <button type=\"button\" data-bind=\"click: onSubmit\">Submit</button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { appContext } from \"../../infrastructure/application_db_context.js\";\r\nimport {\r\n  registerComponent,\r\n  directRegisterComponent,\r\n} from \"../../sal/infrastructure/index.js\";\r\nimport { Comment } from \"../../value_objects/comment.js\";\r\nimport { commentChainTemplate } from \"./CommentChainTemplate.js\";\r\n\r\nconst commentChainComponentName = \"commentChain\";\r\n\r\nexport class CommentChainComponent {\r\n  constructor({ entity, fieldName }) {\r\n    this.entity = entity;\r\n    this.blobField = entity[fieldName];\r\n    this.fieldName = fieldName;\r\n  }\r\n  entity;\r\n  blobField;\r\n  fieldName;\r\n\r\n  componentName = commentChainComponentName;\r\n}\r\n\r\nclass CommentChainModule {\r\n  constructor({ entity, fieldName, blobField }) {\r\n    this.entity = entity;\r\n    this.fieldName = fieldName;\r\n    this.blobField = blobField;\r\n    this.comments = blobField.TypedValues;\r\n  }\r\n\r\n  // comments = ko.observableArray();\r\n  newCommentText = ko.observable();\r\n\r\n  showHistoryBool = ko.observable(false);\r\n\r\n  toggleShowHistory = function () {\r\n    this.showHistoryBool(!this.showHistoryBool());\r\n  };\r\n\r\n  async onSubmit() {\r\n    var comment = Comment.Create({\r\n      id: Math.ceil(Math.random() * 1000000).toString(16),\r\n      text: this.newCommentText(),\r\n      author: _spPageContextInfo.userLoginName,\r\n      timestamp: new Date().toLocaleString(),\r\n    });\r\n    this.blobField.add(comment);\r\n    await this.commitChanges();\r\n    this.newCommentText(\"\");\r\n  }\r\n\r\n  onRemove = (commentToRemove) => {\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      this.blobField.remove(commentToRemove);\r\n      this.commitChanges();\r\n    }\r\n  };\r\n\r\n  async commitChanges() {\r\n    const set = appContext.Set(this.entity.constructor);\r\n    if (!set) {\r\n      alert(\"Cannot find entity set\", this.entity);\r\n      return;\r\n    }\r\n    await set.UpdateEntity(this.entity, [this.fieldName]);\r\n  }\r\n}\r\n\r\ndirectRegisterComponent(commentChainComponentName, {\r\n  template: commentChainTemplate,\r\n  viewModel: CommentChainModule,\r\n});\r\n\r\nexport class CommentChainModuleLegacy {\r\n  constructor(requestId, props) {\r\n    this.requestId = requestId;\r\n    this.requestListTitle = props.requestListTitle;\r\n    this.columnName = props.columnName;\r\n\r\n    const initialValue = props.initialValue;\r\n    if (initialValue) {\r\n      try {\r\n        const arrInitialComments = JSON.parse(initialValue);\r\n        arrInitialComments.map(function (comment) {\r\n          comment.timestamp = new Date(comment.timestamp);\r\n        });\r\n        this.comments(arrInitialComments);\r\n      } catch (e) {\r\n        console.error(\"could not parse internal status comments.\");\r\n      }\r\n    }\r\n  }\r\n\r\n  comments = ko.observableArray();\r\n  newCommentText = ko.observable();\r\n\r\n  showHistoryBool = ko.observable(false);\r\n\r\n  toggleShowHistory = function () {\r\n    this.showHistoryBool(!this.showHistoryBool());\r\n  };\r\n\r\n  onSubmit = () => {\r\n    var comment = {\r\n      id: Math.ceil(Math.random() * 1000000).toString(16),\r\n      text: this.newCommentText(),\r\n      author: _spPageContextInfo.userLoginName,\r\n      timestamp: new Date(),\r\n    };\r\n    this.comments.push(comment);\r\n    this.commitChanges();\r\n    this.newCommentText(\"\");\r\n  };\r\n\r\n  onRemove = (commentToRemove) => {\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      this.comments.remove(commentToRemove);\r\n      this.commitChanges();\r\n    }\r\n  };\r\n\r\n  commitChanges = () => {\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    //Now push to the request item:\r\n    const requestList = web.get_lists().getByTitle(this.requestListTitle);\r\n    const oListItem = requestList.getItemById(this.requestId);\r\n    oListItem.set_item(this.columnName, JSON.stringify(this.comments()));\r\n    oListItem.update();\r\n\r\n    currCtx.load(oListItem);\r\n\r\n    currCtx.executeQueryAsync(\r\n      function onSuccess() {\r\n        // console.log(\"Updated comments\");\r\n      },\r\n      function onFailure(args, sender) {\r\n        console.error(\"Failed to commit changes.\", args);\r\n      }\r\n    );\r\n  };\r\n}\r\n", "import { LookupField, BlobField } from \"../sal/fields/index.js\";\r\n\r\nimport { ConstrainedEntity } from \"../sal/primitives/constrained_entity.js\";\r\n\r\nimport { AuditRequest } from \"./audit_request.js\";\r\nimport { Comment } from \"../value_objects/comment.js\";\r\nimport { ActiveViewer } from \"../value_objects/active_viewer.js\";\r\n\r\nimport { ActiveViewersComponent } from \"../components/active_viewers/active_viewers_module.js\";\r\nimport { CommentChainComponent } from \"../components/comment_chain/comment_chain_module.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport class AuditRequestsInternal extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  ActiveViewers = new BlobField({\r\n    displayName: \"Active Viewers\",\r\n    entityType: ActiveViewer,\r\n    multiple: true,\r\n  });\r\n\r\n  InternalStatus = new BlobField({\r\n    displayName: \"Internal Status\",\r\n    entityType: Comment,\r\n    multiple: true,\r\n  });\r\n\r\n  ReqNum = new LookupField({\r\n    displayName: \"Request\",\r\n    type: AuditRequest,\r\n    lookupCol: \"Title\",\r\n    entitySet: appContext.AuditRequests,\r\n  });\r\n\r\n  commentChainComponent = new CommentChainComponent({\r\n    entity: this,\r\n    fieldName: \"InternalStatus\",\r\n  });\r\n\r\n  activeViewersComponent = new ActiveViewersComponent({\r\n    entity: this,\r\n    fieldName: \"ActiveViewers\",\r\n  });\r\n\r\n  static Views = {\r\n    All: [\"ID\", \"ActiveViewers\", \"InternalStatus\", \"ReqNum\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    title: \"AuditRequestsInternal\",\r\n    name: \"AuditRequestsInternal\",\r\n  };\r\n}\r\n", "import { People } from \"../sal/entities/index.js\";\r\nimport {\r\n  ensureUserByKeyAsync,\r\n  getDefaultGroups,\r\n  getUserPropsAsync,\r\n} from \"../sal/infrastructure/index.js\";\r\n\r\nconst groupNameSpecialPermName1 = \"CGFS Special Access1\";\r\nconst groupNameSpecialPermName2 = \"CGFS Special Access2\";\r\nconst groupNameQA = \"Quality Assurance\";\r\nconst groupNameEA = \"External Auditors\";\r\n\r\nexport function getSiteGroups() {\r\n  const groups = getDefaultGroups();\r\n  const mappedGroups = {};\r\n  Object.entries(groups).map(\r\n    ([key, group]) => (mappedGroups[key] = new People(group))\r\n  );\r\n  return mappedGroups;\r\n}\r\n\r\nexport async function getPeopleByUsername(userName) {\r\n  const user = await ensureUserByKeyAsync(userName);\r\n  if (!user) return null;\r\n  return new People(user);\r\n}\r\n\r\nlet specialGroups = null;\r\nlet specialGroupsLoading = ko.observable(false);\r\nexport async function getSpecialPermGroups() {\r\n  if (specialGroups) return specialGroups;\r\n  if (specialGroupsLoading()) {\r\n    return new Promise((resolve) => {\r\n      const subscriber = specialGroupsLoading.subscribe(() => {\r\n        subscriber.dispose();\r\n        resolve(specialGroups);\r\n      });\r\n    });\r\n  }\r\n\r\n  specialGroupsLoading(true);\r\n  const specialPermGroup1 = await getPeopleByUsername(\r\n    groupNameSpecialPermName1\r\n  );\r\n  const specialPermGroup2 = await getPeopleByUsername(\r\n    groupNameSpecialPermName2\r\n  );\r\n\r\n  specialGroups = {\r\n    specialPermGroup1,\r\n    specialPermGroup2,\r\n  };\r\n\r\n  specialGroupsLoading(false);\r\n\r\n  return specialGroups;\r\n}\r\n\r\nlet qaGroup = null;\r\nlet qaGroupLoading = ko.observable(false);\r\nexport async function getQAGroup() {\r\n  if (qaGroup) return qaGroup;\r\n  if (qaGroupLoading()) {\r\n    return new Promise((resolve) => {\r\n      const subscriber = qaGroupLoading.subscribe(() => {\r\n        subscriber.dispose();\r\n        resolve(qaGroup);\r\n      });\r\n    });\r\n  }\r\n  qaGroupLoading(true);\r\n  qaGroup = await getPeopleByUsername(groupNameQA);\r\n  qaGroupLoading(false);\r\n  return qaGroup;\r\n}\r\n\r\nclass User extends People {\r\n  constructor({\r\n    ID,\r\n    Title,\r\n    LoginName = null,\r\n    LookupValue = null,\r\n    WorkPhone = null,\r\n    EMail = null,\r\n    IsGroup = null,\r\n    IsEnsured = false,\r\n    Groups = null,\r\n  }) {\r\n    super({ ID, Title, LookupValue, LoginName, IsGroup, IsEnsured });\r\n\r\n    this.WorkPhone = WorkPhone;\r\n    this.EMail = EMail;\r\n\r\n    this.Groups = Groups;\r\n  }\r\n\r\n  Groups = [];\r\n\r\n  isInGroup(group) {\r\n    if (!group?.ID) return false;\r\n    return this.getGroupIds().includes(group.ID);\r\n  }\r\n\r\n  getGroupIds() {\r\n    return this.Groups.map((group) => group.ID);\r\n  }\r\n\r\n  IsSiteOwner = ko.pureComputed(() =>\r\n    this.isInGroup(getDefaultGroups().owners)\r\n  );\r\n\r\n  hasSystemRole = (systemRole) => {\r\n    const userIsOwner = this.IsSiteOwner();\r\n    switch (systemRole) {\r\n      case systemRoles.Admin:\r\n        return userIsOwner;\r\n        break;\r\n      case systemRoles.ActionOffice:\r\n        return userIsOwner || this.ActionOffices().length;\r\n      default:\r\n    }\r\n  };\r\n\r\n  static _user = null;\r\n  static Create = async function () {\r\n    if (User._user) return User._user;\r\n    // TODO: Major - Switch to getUserPropertiesAsync since that includes phone # etc\r\n    const userProps = await getUserPropsAsync();\r\n    // const userProps2 = await UserManager.getUserPropertiesAsync();\r\n    User._user = new User(userProps);\r\n    return User._user;\r\n  };\r\n}\r\n\r\nexport const currentUser = User.Create;\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\nimport {\r\n  LookupField,\r\n  BlobField,\r\n  TextField,\r\n  TextAreaField,\r\n  DateField,\r\n  dateFieldTypes,\r\n  SelectField,\r\n  PeopleField,\r\n} from \"../sal/fields/index.js\";\r\n\r\nimport { AuditRequest, AuditOrganization } from \"./index.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nimport { ActiveViewer } from \"../value_objects/active_viewer.js\";\r\nimport { ActiveViewersComponent } from \"../components/active_viewers/active_viewers_module.js\";\r\n\r\nimport { auditOrganizationStore } from \"../infrastructure/store.js\";\r\nimport { currentUser } from \"../services/people_manager.js\";\r\n\r\n// import { appContext } from \"../infrastructure/ServiceContainer.js\";\r\n\r\nexport const AuditResponseStates = {\r\n  Open: \"1-Open\",\r\n  Submitted: \"2-Submitted\",\r\n  ReturnedToAO: \"3-Returned to Action Office\",\r\n  ApprovedForQA: \"4-Approved for QA\",\r\n  ReturnedToGFS: \"5-Returned to GFS\",\r\n  RepostedAfterRejection: \"6-Reposted After Rejection\",\r\n  Closed: \"7-Closed\",\r\n};\r\n\r\nexport class AuditResponse extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  Title = new TextField({\r\n    displayName: \"Name\",\r\n  });\r\n\r\n  ReqNum = new LookupField({\r\n    displayName: \"Request Number\",\r\n    type: AuditRequest,\r\n    entitySet: appContext.AuditRequests,\r\n  });\r\n\r\n  SampleNumber = new TextField({\r\n    displayName: \"Sample Number\",\r\n    isRequired: true,\r\n  });\r\n\r\n  ResStatus = new SelectField({\r\n    displayName: \"Response Status\",\r\n    options: Object.values(AuditResponseStates),\r\n  });\r\n\r\n  ReturnReason = new TextField({\r\n    displayName: \"Return Reason\",\r\n    options: [\"Incomplete Document\", \"Incorrect POC\"],\r\n  });\r\n\r\n  Comments = new TextAreaField({\r\n    displayName: \"Comments\",\r\n    isRichText: true,\r\n    isMinimalEditor: true,\r\n    classList: [\"min-w-full\"],\r\n  });\r\n\r\n  ClosedDate = new DateField({\r\n    displayName: \"Closed Date\",\r\n    type: dateFieldTypes.date,\r\n  });\r\n\r\n  ClosedBy = new PeopleField({\r\n    displayName: \"Closed By\",\r\n  });\r\n\r\n  POC = new PeopleField({\r\n    displayName: \"POC\",\r\n  });\r\n\r\n  POCCC = new PeopleField({\r\n    displayName: \"POCCC\",\r\n  });\r\n\r\n  ActionOffice = new LookupField({\r\n    displayName: \"Action Office\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: ko.pureComputed(() => {\r\n      // Only allow action offices from this coversheets associated request\r\n      const request = ko.unwrap(this.ReqNum.Value);\r\n      if (!request) return (val) => val;\r\n\r\n      const requestActionOffices = ko.unwrap(request.ActionOffice.Value);\r\n\r\n      return (opt) => requestActionOffices.includes(opt);\r\n    }),\r\n    entitySet: appContext.AuditOrganizations,\r\n    lookupCol: \"Title\",\r\n    isRequired: true,\r\n  });\r\n\r\n  ActiveViewers = new BlobField({\r\n    displayName: \"Active Viewers\",\r\n    entityType: ActiveViewer,\r\n    multiple: true,\r\n  });\r\n\r\n  activeViewersComponent = new ActiveViewersComponent({\r\n    entity: this,\r\n    fieldName: \"ActiveViewers\",\r\n  });\r\n\r\n  async uploadResponseDocFile(file) {\r\n    const fileMetadata = {\r\n      Title: file.name,\r\n      ReqNumId: this.ReqNum.Value().ID,\r\n      ResIDId: this.ID,\r\n    };\r\n\r\n    const { appContext } = await import(\r\n      \"../infrastructure/application_db_context.js\"\r\n    );\r\n\r\n    return await appContext.AuditResponseDocs.UploadFileToFolderAndUpdateMetadata(\r\n      file,\r\n      file.name,\r\n      this.Title.Value(),\r\n      fileMetadata\r\n    );\r\n  }\r\n\r\n  markClosed() {\r\n    this.ResStatus.Value(AuditResponseStates.Closed);\r\n    this.ClosedDate.set(new Date());\r\n    this.ClosedBy.set(currentUser());\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"SampleNumber\",\r\n      \"ResStatus\",\r\n      \"ReturnReason\",\r\n      \"Comments\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n      \"POC\",\r\n      \"POCCC\",\r\n      \"ReqNum\",\r\n      \"ActionOffice\",\r\n      \"ActiveViewers\",\r\n    ],\r\n    NewForm: [\"ReqNum\", \"ActionOffice\", \"SampleNumber\", \"Comments\"],\r\n    EditForm: [\r\n      \"ReqNum\",\r\n      \"SampleNumber\",\r\n      \"Title\",\r\n      \"ActionOffice\",\r\n      \"ResStatus\",\r\n      \"ReturnReason\",\r\n      \"Comments\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n      \"POC\",\r\n      \"POCCC\",\r\n    ],\r\n    IACanUpdate: [\r\n      \"Title\",\r\n      \"ActionOffice\",\r\n      \"ResStatus\",\r\n      \"ReturnReason\",\r\n      \"Comments\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n      \"POC\",\r\n      \"POCCC\",\r\n    ],\r\n    IAUpdateClosed: [\"ResStatus\", \"ClosedDate\", \"ClosedBy\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditResponses\",\r\n    title: \"AuditResponses\",\r\n  };\r\n}\r\n", "import { AuditResponse } from \"./index.js\";\r\n\r\nexport class AuditBulkResponse extends AuditResponse {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static ListDef = {\r\n    name: \"AuditBulkResponses\",\r\n    title: \"AuditBulkResponses\",\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\nimport {\r\n  LookupField,\r\n  TextField,\r\n  TextAreaField,\r\n  DateField,\r\n  dateFieldTypes,\r\n  SelectField,\r\n  PeopleField,\r\n} from \"../sal/fields/index.js\";\r\n\r\nimport { AuditResponse } from \"./audit_response.js\";\r\nimport { AuditRequest } from \"./audit_request.js\";\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport const AuditResponseDocStates = {\r\n  Open: \"Open\",\r\n  Submitted: \"Submitted\",\r\n  SentToQA: \"Sent to QA\",\r\n  Approved: \"Approved\",\r\n  Rejected: \"Rejected\",\r\n  Archived: \"Archived\",\r\n  MarkedForDeletion: \"Marked for Deletion\",\r\n};\r\n\r\nexport class AuditResponseDoc extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  Title = new TextField({\r\n    displayName: \"Name\",\r\n  });\r\n\r\n  ReceiptDate = new DateField({\r\n    displayName: \"Receipt Date\",\r\n    type: dateFieldTypes.date,\r\n  });\r\n\r\n  DocumentStatus = new SelectField({\r\n    displayName: \"Document Status\",\r\n    options: Object.values(AuditResponseDocStates),\r\n  });\r\n\r\n  RejectReason = new TextAreaField({\r\n    displayName: \"Reject Reason\",\r\n  });\r\n\r\n  ReqNum = new LookupField({\r\n    displayName: \"Request Number\",\r\n    type: AuditRequest,\r\n    entitySet: appContext.AuditRequests,\r\n  });\r\n\r\n  ResID = new LookupField({\r\n    displayName: \"Response ID\",\r\n    type: AuditResponse,\r\n    entitySet: appContext.AuditResponses,\r\n  });\r\n\r\n  FileName = new TextField({\r\n    displayName: \"Name\",\r\n    systemName: \"FileLeafRef\",\r\n  });\r\n\r\n  FileRef = new TextField({\r\n    displayName: \"File Link\",\r\n    systemName: \"FileRef\",\r\n  });\r\n\r\n  Modified = new DateField({\r\n    displayName: \"Modified\",\r\n    type: dateFieldTypes.datetime,\r\n  });\r\n\r\n  Editor = new PeopleField({\r\n    displayName: \"Modified By\",\r\n  });\r\n\r\n  Created = new DateField({\r\n    displayName: \"Created\",\r\n    type: dateFieldTypes.datetime,\r\n  });\r\n\r\n  FileSizeDisplay = new TextField({\r\n    displayName: \"File\",\r\n  });\r\n\r\n  File_x0020_Type = new TextField({\r\n    displayName: \"File Type\",\r\n    systemName: \"File_x0020_Type\",\r\n  });\r\n\r\n  CheckoutUser = new PeopleField({\r\n    displayName: \"Checked Out To\",\r\n  });\r\n\r\n  markApprovedForRO(newFileName) {\r\n    this.DocumentStatus.Value(AuditResponseDocStates.Approved);\r\n    this.RejectReason.Value(\"\");\r\n    if (this.FileName.Value() != newFileName) this.FileName.Value(newFileName);\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"ReceiptDate\",\r\n      \"DocumentStatus\",\r\n      \"RejectReason\",\r\n      \"ReqNum\",\r\n      \"ResID\",\r\n      \"FileLeafRef\",\r\n      \"FileRef\",\r\n      \"FileSizeDisplay\",\r\n      \"File_x0020_Type\",\r\n      \"CheckoutUser\",\r\n      \"Modified\",\r\n      \"Editor\",\r\n      \"Created\",\r\n    ],\r\n    EditForm: [\r\n      \"FileLeafRef\",\r\n      \"Title\",\r\n      \"ReceiptDate\",\r\n      \"DocumentStatus\",\r\n      \"RejectReason\",\r\n      \"ReqNum\",\r\n      \"ResID\",\r\n    ],\r\n    AOCanUpdate: [\r\n      \"Title\",\r\n      \"ReceiptDate\",\r\n      \"DocumentStatus\",\r\n      \"RejectReason\",\r\n      \"FileLeafRef\",\r\n    ],\r\n    UpdateDocStatus: [\"Title\", \"FileLeafRef\", \"DocumentStatus\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditResponseDocs\",\r\n    title: \"AuditResponseDocs\",\r\n    isLib: true,\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\n\r\nexport class AuditResponseDocRO extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  markApprovedForRO(request, response) {\r\n    this.ReqNum = request.Title;\r\n    this.ResID = response.Title.toString();\r\n    this.FiscalYear = request.FiscalYear.toString();\r\n    this.ReqSubject = request.ReqSubject.toString();\r\n    this.RequestingOffice = request.RequestingOffice.Value()?.UserGroup?.Title;\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"ReqNum\",\r\n      \"ResID\",\r\n      \"FiscalYear\",\r\n      \"RequestingOffice\",\r\n      \"ReqSubject\",\r\n      \"FileLeafRef\",\r\n      \"FileRef\",\r\n    ],\r\n    ApprovedForROUpdate: [\r\n      \"ReqNum\",\r\n      \"ResID\",\r\n      \"FiscalYear\",\r\n      \"ReqSubject\",\r\n      \"RequestingOffice\",\r\n    ],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditResponseDocsRO\",\r\n    title: \"AuditResponseDocsRO\",\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\n\r\nexport class AuditROEmailLog extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  Responses = \"\";\r\n  ResponseCount = 0;\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"RequestingOffice\",\r\n      \"Responses\",\r\n      \"ResponseCount\",\r\n      \"SentEmail\",\r\n    ],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditROEmailLog\",\r\n    title: \"AuditROEmailLog\",\r\n    fields: AuditROEmailLog.Views.All,\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\n\r\nexport class AuditConfiguration extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  key;\r\n  value;\r\n\r\n  FieldMap = {\r\n    Title: {\r\n      get: () => this.key,\r\n      set: (val) => (this.key = val),\r\n    },\r\n    Value: {\r\n      get: () => this.value,\r\n      set: (val) => (this.value = val),\r\n    },\r\n  };\r\n  static Views = {\r\n    All: [\"ID\", \"Title\", \"Value\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"Config\",\r\n    title: \"Config\",\r\n  };\r\n}\r\n", "export * from \"./audit_coversheet.js\";\r\nexport * from \"./audit_email.js\";\r\nexport * from \"./audit_organization.js\";\r\nexport * from \"./audit_request.js\";\r\nexport * from \"./audit_bulk_request.js\";\r\nexport * from \"./audit_request_internal.js\";\r\nexport * from \"./audit_response.js\";\r\nexport * from \"./audit_bulk_response.js\";\r\nexport * from \"./audit_response_doc.js\";\r\nexport * from \"./audit_response_doc_ro.js\";\r\nexport * from \"./audit_ro_email_log.js\";\r\nexport * from \"./config.js\";\r\n", "import { Page } from \"./entities/index.js\";\r\nimport { SPList, copyFileAsync } from \"./infrastructure/index.js\";\r\n\r\nconst DEBUG = false;\r\n\r\nexport class DbContext {\r\n  constructor() {}\r\n\r\n  Pages = new EntitySet(Page);\r\n\r\n  utilities = {\r\n    copyFileAsync,\r\n  };\r\n  virtualSets = new Map();\r\n\r\n  Set = (entityType) => {\r\n    const key = entityType.ListDef.name;\r\n\r\n    // If we have a defined entityset, return that\r\n    const set = Object.values(this)\r\n      .filter((val) => val.constructor.name == EntitySet.name)\r\n      .find((set) => set.ListDef?.name == key);\r\n    if (set) return set;\r\n\r\n    if (!this.virtualSets.has(key)) {\r\n      const newSet = new EntitySet(listDef);\r\n      this.virtualSets.set(key, newSet);\r\n      return newSet;\r\n    }\r\n    return this.virtualSets.get(key);\r\n  };\r\n}\r\n\r\nexport class CachedEntitySet {\r\n  constructor(entityType) {\r\n    this.entitySet = new EntitySet(entityType);\r\n\r\n    this.AllDeclaredFields = this.entitySet.AllDeclaredFields;\r\n  }\r\n  _cache = ko.observable({});\r\n\r\n  FindById = async (id, fields = this.AllDeclaredFields) => {};\r\n}\r\n\r\nexport class EntitySet {\r\n  constructor(entityType) {\r\n    if (!entityType.ListDef) {\r\n      console.error(\"Missing entityType listdef for\", entityType);\r\n      return;\r\n    }\r\n\r\n    // Check if the object we passed in defines a ListDef\r\n    this.entityType = entityType;\r\n\r\n    try {\r\n      const allFieldsSet = new Set();\r\n      entityType.Views?.All?.map((field) => allFieldsSet.add(field));\r\n\r\n      // TODO: this is bombing due to circular dependencies,\r\n      // all fields need to be in View\r\n      // const newEntity = new this.entityType({ ID: null, Title: null });\r\n      // if (newEntity.FieldMap) {\r\n      //   Object.keys(newEntity.FieldMap).map((field) => allFieldsSet.add(field));\r\n      // }\r\n      // const fieldMapKeysSet = new Set(...);\r\n      // entityType.Views.All.map((field) => fieldMapKeysSet.add(field));\r\n      this.AllDeclaredFields = [...allFieldsSet];\r\n    } catch (e) {\r\n      console.warn(\"Could not instantiate\", entityType), console.warn(e);\r\n      this.AllDeclaredFields = entityType.Views?.All ?? [];\r\n    }\r\n\r\n    this.ListDef = entityType.ListDef;\r\n    this.Views = entityType.Views;\r\n    this.Title = entityType.ListDef.title;\r\n    this.Name = entityType.ListDef.name;\r\n\r\n    this.ListRef = new SPList(entityType.ListDef);\r\n\r\n    this.entityConstructor =\r\n      this.entityType.FindInStore || this.entityType.Create || this.entityType;\r\n  }\r\n\r\n  // Queries\r\n  FindById = async (id, fields = this.AllDeclaredFields) => {\r\n    // Hit our cache first\r\n\r\n    const result = await this.ListRef.getById(id, fields);\r\n    if (!result) return null;\r\n    const newEntity = new this.entityType(result);\r\n    mapObjectToEntity(result, newEntity);\r\n    return newEntity;\r\n  };\r\n\r\n  // TODO: Feature - Queries should return options to read e.g. toList, first, toCursor\r\n  /**\r\n   * Takes an array of columns and filter values with an optional comparison operator\r\n   * @param {[{column, op?, value}]} columnFilters\r\n   * @param {*} param1\r\n   * @param {*} param2\r\n   * @param {*} fields\r\n   * @param {*} includeFolders\r\n   * @returns\r\n   */\r\n  FindByColumnValue = async (\r\n    columnFilters,\r\n    { orderByColumn, sortAsc },\r\n    { count = null, includePermissions = false, includeFolders = false },\r\n    fields = this.AllDeclaredFields\r\n  ) => {\r\n    // if we pass in a count, we are expecting a cursor result\r\n    const returnCursor = count != null;\r\n    count = count ?? 5000;\r\n    // else, we should apply a count of 5000 and keep fetching\r\n\r\n    const results = await this.ListRef.findByColumnValueAsync(\r\n      columnFilters,\r\n      { orderByColumn, sortAsc },\r\n      { count, includePermissions, includeFolders },\r\n      fields\r\n    );\r\n\r\n    let cursor = {\r\n      _next: results._next,\r\n      results: results.results.map((item) => {\r\n        const newEntity = new this.entityConstructor(item);\r\n        mapObjectToEntity(item, newEntity);\r\n        return newEntity;\r\n      }),\r\n    };\r\n\r\n    if (returnCursor) {\r\n      return cursor;\r\n    }\r\n\r\n    const resultObj = {\r\n      results: cursor.results,\r\n    };\r\n\r\n    while (cursor._next) {\r\n      cursor = await this.LoadNextPage(cursor);\r\n      resultObj.results = resultObj.results.concat(cursor.results);\r\n    }\r\n\r\n    return resultObj;\r\n  };\r\n\r\n  LoadNextPage = async (cursor) => {\r\n    const results = await this.ListRef.loadNextPage(cursor);\r\n    return {\r\n      _next: results._next,\r\n      results: results.results.map((item) => {\r\n        const newEntity = new this.entityType(item);\r\n        mapObjectToEntity(item, newEntity);\r\n        return newEntity;\r\n      }),\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Return all items in list\r\n   */\r\n  ToList = async (refresh = false) => {\r\n    const fields = this.Views.All;\r\n    const results = await this.ListRef.getListItemsAsync({ fields });\r\n    const allItems = results.map((item) => {\r\n      let entityToLoad = new this.entityType(item);\r\n      mapObjectToEntity(item, entityToLoad);\r\n      return entityToLoad;\r\n    });\r\n    return allItems;\r\n  };\r\n\r\n  LoadEntity = async function (entity, refresh = false) {\r\n    if (!entity.ID) {\r\n      console.error(\"entity missing Id\", entity);\r\n      return false;\r\n    }\r\n\r\n    const result = await this.ListRef.getById(\r\n      entity.ID,\r\n      this.AllDeclaredFields\r\n    );\r\n    if (!result) return null;\r\n\r\n    mapObjectToEntity(result, entity);\r\n    return entity;\r\n  };\r\n\r\n  // Mutators\r\n  AddEntity = async function (entity, folderPath) {\r\n    const creationfunc = mapEntityToObject.bind(this);\r\n    const writeableEntity = creationfunc(entity, this.AllDeclaredFields);\r\n\r\n    if (DEBUG) console.log(writeableEntity);\r\n    const newId = await this.ListRef.createListItemAsync(\r\n      writeableEntity,\r\n      folderPath\r\n    );\r\n    mapObjectToEntity({ ID: newId }, entity);\r\n    return;\r\n  };\r\n\r\n  UpdateEntity = async function (entity, fields = null) {\r\n    const writeableEntity = mapEntityToObject.bind(this)(entity, fields);\r\n    writeableEntity.ID =\r\n      typeof entity.ID == \"function\" ? entity.ID() : entity.ID;\r\n    if (DEBUG) console.log(writeableEntity);\r\n    return this.ListRef.updateListItemAsync(writeableEntity);\r\n  };\r\n\r\n  RemoveEntity = async function (entity) {\r\n    if (!entity.ID) return false;\r\n    await this.ListRef.deleteListItemAsync(entity.ID);\r\n    return true;\r\n  };\r\n\r\n  RemoveEntityById = function (entityId) {\r\n    return this.ListRef.deleteListItemAsync(entityId);\r\n  };\r\n\r\n  // Permissions\r\n  GetItemPermissions = function (entity) {\r\n    return this.ListRef.getItemPermissionsAsync(entity.ID);\r\n  };\r\n\r\n  SetItemPermissions = async function (entity, valuePairs, reset = false) {\r\n    // const salValuePairs = valuePairs\r\n    //   .filter((vp) => vp[0] && vp[1])\r\n    //   .map((vp) => [vp[0].getKey(), vp[1]]);\r\n    return this.ListRef.setItemPermissionsAsync(entity.ID, valuePairs, reset);\r\n  };\r\n\r\n  GetRootPermissions = function () {\r\n    return this.ListRef.getListPermissions();\r\n  };\r\n\r\n  SetRootPermissions = async function (itemPermissions, reset) {\r\n    // const valuePairs = itemPermissions.getValuePairs();\r\n    await this.ListRef.setListPermissionsAsync(itemPermissions, reset);\r\n  };\r\n\r\n  // Folder Methods\r\n  GetFolderUrl = function (relFolderPath = \"\") {\r\n    return this.ListRef.getServerRelativeFolderPath(relFolderPath);\r\n  };\r\n\r\n  GetItemsByFolderPath = async function (\r\n    folderPath,\r\n    fields = this.AllDeclaredFields\r\n  ) {\r\n    //return this.ListRef.getFolderContentsAsync(folderPath, fields);\r\n    const results = await this.ListRef.getFolderContentsAsync(\r\n      folderPath,\r\n      fields\r\n    );\r\n    return results.map((result) => {\r\n      const newEntity = new this.entityType(result);\r\n      mapObjectToEntity(result, newEntity);\r\n      return newEntity;\r\n    });\r\n  };\r\n\r\n  UpsertFolderPath = async function (folderPath) {\r\n    return this.ListRef.upsertFolderPathAsync(folderPath);\r\n  };\r\n\r\n  RemoveFolderByPath = async function (folderPath) {\r\n    const itemResults = await this.FindByColumnValue(\r\n      [{ column: \"FileLeafRef\", value: folderPath }],\r\n      {},\r\n      {},\r\n      [\"ID\", \"Title\", \"FileLeafRef\"],\r\n      true\r\n    );\r\n    const entities = itemResults.results ?? [];\r\n    for (const entity of entities) {\r\n      await this.RemoveEntityById(entity.ID);\r\n    }\r\n  };\r\n\r\n  // Permissions\r\n  SetFolderReadOnly = async function (relFolderPath) {\r\n    return this.ListRef.setFolderReadonlyAsync(relFolderPath);\r\n  };\r\n\r\n  SetFolderPermissions = async function (folderPath, valuePairs, reset = true) {\r\n    const salValuePairs = valuePairs\r\n      .filter((vp) => vp[0] && vp[1])\r\n      .map((vp) => [vp[0].getKey(), vp[1]]);\r\n    return this.ListRef.setFolderPermissionsAsync(\r\n      folderPath,\r\n      salValuePairs,\r\n      reset\r\n    );\r\n  };\r\n\r\n  EnsureFolderPermissions = async function (relFolderPath, valuePairs) {\r\n    // Slightly more expensive operation to verify a user has the required permissions\r\n    // before adding them. This will cut down on the number of unique permissions in the\r\n    // system since a user may already have the permission via group membership.\r\n    const salValuePairs = valuePairs\r\n      .filter((vp) => vp[0] && vp[1])\r\n      .map((vp) => [vp[0].LoginName ?? vp[0].Title, vp[1]]);\r\n    return this.ListRef.ensureFolderPermissionsAsync(\r\n      relFolderPath,\r\n      salValuePairs\r\n    );\r\n  };\r\n\r\n  // Other Functions\r\n  // Upload file directly from browser \"File\" object e.g. from input field\r\n  UploadFileToFolderAndUpdateMetadata = async function (\r\n    file,\r\n    filename,\r\n    folderPath,\r\n    updates,\r\n    progress\r\n  ) {\r\n    const itemId = await this.ListRef.uploadFileToFolderAndUpdateMetadata(\r\n      file,\r\n      filename,\r\n      folderPath,\r\n      updates,\r\n      progress\r\n    );\r\n    const item = await this.ListRef.getById(itemId, this.AllDeclaredFields);\r\n    const newEntity = new this.entityConstructor(item);\r\n    mapObjectToEntity(item, newEntity);\r\n    return newEntity;\r\n  };\r\n\r\n  // Open file upload Modal\r\n  UploadNewDocument = async function (folderPath, args) {\r\n    return this.ListRef.uploadNewDocumentAsync(\r\n      folderPath,\r\n      \"Attach a New Document\",\r\n      args\r\n    );\r\n  };\r\n\r\n  CopyFolderContents = async function (sourceFolder, targetFolder) {\r\n    return this.ListRef.copyFilesAsync(sourceFolder, targetFolder);\r\n  };\r\n\r\n  // Form Methods\r\n  ShowForm = async function (name, title, args) {\r\n    return new Promise((resolve, reject) =>\r\n      this.ListRef.showModal(name, title, args, resolve)\r\n    );\r\n  };\r\n\r\n  CheckInDocument = async function (fileRef) {\r\n    return new Promise((resolve) =>\r\n      this.ListRef.showCheckinModal(fileRef, resolve)\r\n    );\r\n  };\r\n\r\n  EnsureList = async function () {};\r\n}\r\n\r\nfunction mapObjectToEntity(inputObject, targetEntity) {\r\n  if (DEBUG)\r\n    console.log(\r\n      `ApplicationDBContext: ${targetEntity.constructor.name}: `,\r\n      inputObject\r\n    );\r\n  if (!inputObject || !targetEntity) return;\r\n  // Takes an object and attempts to map it to the target entity\r\n  Object.keys(inputObject).forEach((key) => {\r\n    mapValueToEntityProperty(key, inputObject[key], targetEntity);\r\n  });\r\n}\r\n\r\nfunction mapValueToEntityProperty(propertyName, inputValue, targetEntity) {\r\n  if (DEBUG)\r\n    console.log(\r\n      `ApplicationDBContext: ${targetEntity.constructor.name}.${propertyName} to ${inputValue}`\r\n    );\r\n  //1. Check if the targetEntity has a fieldmapping for this property\r\n  if (targetEntity.FieldMap && targetEntity.FieldMap[propertyName]) {\r\n    mapObjectToViewField(inputValue, targetEntity.FieldMap[propertyName]);\r\n    return;\r\n  }\r\n  // 2. This is just a regular property, set it\r\n  if (\r\n    targetEntity[propertyName] &&\r\n    typeof targetEntity[propertyName] == \"function\"\r\n  ) {\r\n    targetEntity[propertyName](inputValue);\r\n    return;\r\n  }\r\n  targetEntity[propertyName] = inputValue;\r\n  return;\r\n}\r\n\r\nfunction mapObjectToViewField(inVal, fieldMapping) {\r\n  // Fieldmap has Three options for setting,\r\n  // 1. observable - the fieldmap represents an observable\r\n  // 2. setter - the fieldmap exposes a setter\r\n  // 3. factory/obs - the fieldmap exposes a factory and an observable to put the result.\r\n\r\n  if (typeof fieldMapping == \"function\") {\r\n    fieldMapping(inVal);\r\n    return;\r\n  }\r\n\r\n  if (typeof fieldMapping != \"object\") {\r\n    fieldMapping = inVal;\r\n    return;\r\n  }\r\n\r\n  if (fieldMapping.set && typeof fieldMapping.set == \"function\") {\r\n    fieldMapping.set(inVal);\r\n    return;\r\n  }\r\n\r\n  if (fieldMapping.obs) {\r\n    if (!inVal) {\r\n      fieldMapping.obs(null);\r\n      return;\r\n    }\r\n    // If the input value is an array, then we are putting an array into the observable.\r\n    const outVal = Array.isArray(inVal)\r\n      ? inVal.map((item) => generateObject(item, fieldMapping))\r\n      : generateObject(inVal, fieldMapping);\r\n\r\n    fieldMapping.obs(outVal);\r\n    return;\r\n  }\r\n\r\n  fieldMapping = inVal;\r\n  //throw \"Error setting fieldmap?\";\r\n}\r\n\r\nfunction generateObject(inVal, fieldMap) {\r\n  // If the fieldMap provides a factory, use that, otherwise return the value\r\n  return fieldMap.factory ? fieldMap.factory(inVal) : inVal;\r\n}\r\n\r\nexport function mapEntityToObject(input, selectedFields = null) {\r\n  const entity = {};\r\n  // We either predefine the fields in the ListDef, or provide a complete fieldmap\r\n  const allWriteableFieldsSet = new Set([]);\r\n  if (this?.ListDef?.fields) {\r\n    this.ListDef.fields.forEach((field) => allWriteableFieldsSet.add(field));\r\n  }\r\n  if (this?.AllDeclaredFields) {\r\n    this.AllDeclaredFields.map((field) => allWriteableFieldsSet.add(field));\r\n  }\r\n  if (input.FieldMap) {\r\n    Object.keys(input.FieldMap).forEach((field) =>\r\n      allWriteableFieldsSet.add(field)\r\n    );\r\n  }\r\n  const allWriteableFields = [...allWriteableFieldsSet];\r\n\r\n  const fields =\r\n    selectedFields ??\r\n    (input.FieldMap ? Object.keys(input.FieldMap) : null) ??\r\n    Object.keys(input);\r\n\r\n  fields\r\n    .filter((field) => allWriteableFields.includes(field))\r\n    .map((field) => {\r\n      if (input.FieldMap && input.FieldMap[field]) {\r\n        const storedFieldKey = input.FieldMap[field].systemName ?? field;\r\n        entity[storedFieldKey] = mapViewFieldToValue(input.FieldMap[field]);\r\n        return;\r\n      }\r\n      entity[field] = input[field];\r\n    });\r\n\r\n  return entity;\r\n}\r\n\r\nfunction mapViewFieldToValue(fieldMap) {\r\n  // Fieldmap has Three options for getting,\r\n  // 1. observable - the fieldmap represents an observable or other function that returns a value\r\n  // 2. get - the fieldmap is an object that exposes a getter function\r\n  // 3. factory/obs - the fieldmap is an object exposes a factory and an observable.\r\n  if (typeof fieldMap == \"function\") {\r\n    return fieldMap();\r\n  }\r\n  if (fieldMap.get && typeof fieldMap.get == \"function\") {\r\n    return fieldMap.get();\r\n  }\r\n\r\n  if (fieldMap.obs) {\r\n    return fieldMap.obs();\r\n  }\r\n\r\n  return fieldMap;\r\n\r\n  // console.error(\"Error setting fieldMap\", fieldMap);\r\n  // throw \"Error getting fieldmap\";\r\n}\r\n", "export { EntitySet, CachedEntitySet, DbContext } from \"./orm.js\";\r\n", "import {\r\n  AuditOrganization,\r\n  AuditRequest,\r\n  AuditBulkRequest,\r\n  AuditEmail,\r\n  AuditRequestsInternal,\r\n  AuditResponse,\r\n  AuditBulkResponse,\r\n  AuditResponseDoc,\r\n  AuditCoversheet,\r\n  AuditConfiguration,\r\n  AuditResponseDocRO,\r\n  AuditROEmailLog,\r\n} from \"../entities/index.js\";\r\nimport { EntitySet, DbContext } from \"../sal/index.js\";\r\n\r\nconst DEBUG = false;\r\n\r\nexport class ApplicationDbContext extends DbContext {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  AuditBulkRequests = new EntitySet(AuditBulkRequest);\r\n\r\n  AuditBulkResponses = new EntitySet(AuditBulkResponse);\r\n\r\n  AuditConfigurations = new EntitySet(AuditConfiguration);\r\n\r\n  AuditCoversheets = new EntitySet(AuditCoversheet);\r\n\r\n  AuditEmails = new EntitySet(AuditEmail);\r\n\r\n  AuditOrganizations = new EntitySet(AuditOrganization);\r\n\r\n  AuditResponses = new EntitySet(AuditResponse);\r\n\r\n  AuditResponseDocs = new EntitySet(AuditResponseDoc);\r\n\r\n  AuditResponseDocsRO = new EntitySet(AuditResponseDocRO);\r\n\r\n  AuditRequests = new EntitySet(AuditRequest);\r\n\r\n  AuditRequestsInternals = new EntitySet(AuditRequestsInternal);\r\n\r\n  AuditROEmailsLog = new EntitySet(AuditROEmailLog);\r\n}\r\n\r\nexport const appContext = new ApplicationDbContext();\r\n", "\uFEFFconst html = String.raw;\r\n\r\nexport const iaDbTemplate = html`\r\n  <link\r\n    href=\"/sites/CGFS/Style Library/apps/audit/lib/quill@2.0.0-rc.2/dist/quill.snow.css\"\r\n    rel=\"stylesheet\"\r\n  />\r\n\r\n  <link\r\n    rel=\"stylesheet\"\r\n    href=\"/sites/CGFS/Style Library/apps/audit/lib/fontawesome-6.5.1/css/fontawesome.min.css\"\r\n  />\r\n  <link\r\n    rel=\"stylesheet\"\r\n    href=\"/sites/CGFS/Style Library/apps/audit/lib/fontawesome-6.5.1/css/solid.min.css\"\r\n  />\r\n  <link\r\n    rel=\"stylesheet\"\r\n    type=\"text/css\"\r\n    href=\"/sites/CGFS/Style Library/apps/audit/lib/jquery-ui-1.13.2/jquery-ui.theme.min.css\"\r\n  />\r\n  <style>\r\n    .o365cs-nav-leftAlign {\r\n      display: revert !important;\r\n    }\r\n\r\n    #suiteBarDelta {\r\n      display: revert !important;\r\n    }\r\n\r\n    #s4-ribbonrow {\r\n      display: revert !important;\r\n    }\r\n  </style>\r\n  <iframe id=\"CsvExpFrame\" style=\"display: none\"></iframe>\r\n\r\n  <div id=\"divRequestID\" style=\"display: none\">\r\n    not in use anymore. do not delete, this is used by the request edit list\r\n    form\r\n  </div>\r\n  <div class=\"audit\">\r\n    <!-- ko foreach: currentDialogs -->\r\n    <div\r\n      data-bind=\"component: { name: 'modal-dialog-component', params: $data }\"\r\n    ></div>\r\n    <!-- /ko -->\r\n    <div\r\n      id=\"divCounter\"\r\n      style=\"display: none\"\r\n      title=\"used to auto refresh the page\"\r\n    >\r\n      1200\r\n    </div>\r\n\r\n    <div id=\"divIA\" class=\"audit-body\" style=\"display: none\">\r\n      <div\r\n        class=\"quick-info-container\"\r\n        data-bind=\"css: {active: showQuickInfo}\"\r\n      >\r\n        <div class=\"quick-info-toolbar\">\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-toolbar\"\r\n            data-bind=\"toggles: showQuickInfo,\r\n          css: {'warn': alertQuickInfo},\r\n          attr: {title: showQuickInfo() ? 'Hide Alerts' : 'Show Pending Alerts'}\"\r\n          >\r\n            <i class=\"fa-solid fa-xl fa-triangle-exclamation\"></i>\r\n            <i\r\n              class=\"fa-solid\"\r\n              data-bind=\"class: showQuickInfo() ? 'fa-chevron-left' : 'fa-chevron-right'\"\r\n            ></i>\r\n          </button>\r\n        </div>\r\n        <div class=\"quick-info\">\r\n          <div id=\"divLoading\">Please Wait... Loading</div>\r\n          <div\r\n            id=\"divRequestsThatNeedToClose\"\r\n            class=\"status-set-container\"\r\n            data-bind=\"visible: arrRequestsThatNeedClosing().length > 0\"\r\n          >\r\n            <fieldset>\r\n              <legend>\r\n                <span class=\"ui-icon ui-icon-alert\"></span\r\n                ><span\r\n                  data-bind=\"text: arrRequestsThatNeedClosing().length\"\r\n                ></span>\r\n                Requests Need Closing\r\n              </legend>\r\n              <table id=\"tblRequestsThatNeedToClose\" class=\"tablesorter report\">\r\n                <thead>\r\n                  <tr valign=\"top\">\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">Request ID</th>\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">\r\n                      Last Response Closed\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody data-bind=\"foreach: arrRequestsThatNeedClosing\">\r\n                  <tr>\r\n                    <td>\r\n                      <button\r\n                        type=\"button\"\r\n                        class=\"btn btn-link primary fw-bold\"\r\n                        title=\"Click here to Go to this Request\"\r\n                        data-bind=\"click: $root.ClickGoToRequest, text: number\"\r\n                      ></button>\r\n                    </td>\r\n                    <td>\r\n                      <b><span data-bind=\"text: lastResponseId\"></span></b\r\n                      >&nbsp;on&nbsp;<b\r\n                        ><span data-bind=\"text: sLastClosedDate\"></span></b\r\n                      >&nbsp;by&nbsp;<b\r\n                        ><span data-bind=\"text: lastClosedBy\"></span\r\n                      ></b>\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </fieldset>\r\n          </div>\r\n          <div\r\n            id=\"divRequestsWithNoEmailSent\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrRequestsWithNoEmailSent().length > 0\"\r\n          >\r\n            <details>\r\n              <summary>\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span\r\n                    data-bind=\"text: arrRequestsWithNoEmailSent().length\"\r\n                  ></span>\r\n                  Requests need Emails sent out\r\n                </div>\r\n              </summary>\r\n              <div id=\"divRequestsWithNoEmailSentItems\">\r\n                <ul data-bind=\"foreach: arrRequestsWithNoEmailSent\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span data-bind=\"text: title\"></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divResponsesSubmitted\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrResponsesSubmittedByAO().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span\r\n                    data-bind=\"text: arrResponsesSubmittedByAO().length\"\r\n                  ></span>\r\n                  Responses have been Submitted by the Action Offices\r\n                </div>\r\n              </summary>\r\n              <div id=\"divResponsesSubmittedItems\">\r\n                <ul data-bind=\"foreach: arrResponsesSubmittedByAO\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span data-bind=\"text: title\"></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divRequestsAlmostInternalDue\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrRequestsInternalAlmostDue().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span\r\n                    data-bind=\"text: arrRequestsInternalAlmostDue().length\"\r\n                  ></span>\r\n                  Requests are reaching their Internal Due Date\r\n                </div>\r\n              </summary>\r\n              <div id=\"divRequestsAlmostInternalDueItems\">\r\n                <ul data-bind=\"foreach: arrRequestsInternalAlmostDue\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span\r\n                        data-bind=\"text: title + ' (' + internalDueDate + ')'\"\r\n                      ></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divRequestsPastInternalDue\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrRequestsInternalPastDue().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span\r\n                    data-bind=\"text: arrRequestsInternalPastDue().length\"\r\n                  ></span>\r\n                  Requests have PASSED their Internal Due Date\r\n                </div>\r\n              </summary>\r\n              <div id=\"divRequestsPastInternalDueItems\">\r\n                <ul data-bind=\"foreach: arrRequestsInternalPastDue\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span\r\n                        data-bind=\"text: title + ' (' + internalDueDate + ')'\"\r\n                      ></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divRequestsAlmostDue\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrRequestsAlmostDue().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span data-bind=\"text: arrRequestsAlmostDue().length\"></span>\r\n                  Requests are reaching their Due Date\r\n                </div>\r\n              </summary>\r\n              <div id=\"divRequestsAlmostDueItems\">\r\n                <ul data-bind=\"foreach: arrRequestsAlmostDue\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span\r\n                        data-bind=\"text: title + ' (' + dueDate + ')'\"\r\n                      ></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divRequestsPastDue\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrRequestsPastDue().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span data-bind=\"text: arrRequestsPastDue().length\"></span>\r\n                  Requests have PASSED their Due Date\r\n                </div>\r\n              </summary>\r\n              <div id=\"divRequestsPastDueItems\">\r\n                <ul data-bind=\"foreach: arrRequestsPastDue\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span\r\n                        data-bind=\"text: title + ' (' + dueDate + ')'\"\r\n                      ></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divCheckedOutResponseDocs\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrResponseDocsCheckedOut().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span\r\n                    data-bind=\"text: arrResponseDocsCheckedOut().length\"\r\n                  ></span>\r\n                  Response Documents are Checked Out\r\n                </div>\r\n              </summary>\r\n              <div id=\"divCheckedOutResponseDocsItems\">\r\n                <ul data-bind=\"foreach: arrResponseDocsCheckedOut\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span data-bind=\"text: title\"></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divResponsesReadyToClose\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrResponsesReadyToClose().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span\r\n                    data-bind=\"text: arrResponsesReadyToClose().length\"\r\n                  ></span>\r\n                  Responses are Ready to Close\r\n                </div>\r\n              </summary>\r\n              <div id=\"divResponsesReadyToCloseItems\">\r\n                <ul data-bind=\"foreach: arrResponsesReadyToClose\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span data-bind=\"text: title\"></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divResponsesWithUnsubmittedResponsDocs\"\r\n            class=\"status-set-container\"\r\n            data-bind=\"visible: arrResponsesWithUnsubmittedResponseDocs().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning btn btn-link\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span\r\n                    data-bind=\"text: arrResponsesWithUnsubmittedResponseDocs().length\"\r\n                  ></span>\r\n                  Responses have Unsubmitted Response Documents\r\n                </div>\r\n              </summary>\r\n              <div id=\"divResponsesWithUnsubmittedResponseDocsItems\">\r\n                <table class=\"tablesorter\">\r\n                  <thead>\r\n                    <tr>\r\n                      <!-- <th>Response ID</th> -->\r\n                      <th>Title</th>\r\n                      <th>Modified</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody\r\n                    data-bind=\"foreach: arrResponsesWithUnsubmittedResponseDocs\"\r\n                  >\r\n                    <tr>\r\n                      <td colspan=\"2\">\r\n                        <span\r\n                          title=\"Go to Response Details\"\r\n                          class=\"btn btn-link fw-semibold primary\"\r\n                          data-bind=\"text: title + ' (' + unsubmittedDocs.length + ' documents)', \r\n                        click: $root.ClickGoToRequest\"\r\n                        ></span>\r\n                      </td>\r\n                    </tr>\r\n                    <!-- ko foreach: unsubmittedDocs -->\r\n                    <tr>\r\n                      <td>\r\n                        <a\r\n                          title=\"Click to Download\"\r\n                          data-bind=\"text: fileName, downloadLink: '../_layouts/download.aspx?SourceUrl=:folder/:fileName'\"\r\n                        ></a>\r\n                      </td>\r\n                      <td data-bind=\"text: modifiedDate\"></td>\r\n                    </tr>\r\n                    <!-- /ko -->\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </details>\r\n          </div>\r\n          <div\r\n            id=\"divRequestsWithNoResponse\"\r\n            class=\"status-set-container\"\r\n            title=\"Click here to View\"\r\n            data-bind=\"visible: arrRequestsWithNoResponses().length > 0\"\r\n          >\r\n            <details>\r\n              <summary class=\"warning btn btn-link\">\r\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\r\n                <div>\r\n                  <span\r\n                    data-bind=\"text: arrRequestsWithNoResponses().length\"\r\n                  ></span>\r\n                  Requests have 0 Responses\r\n                </div>\r\n              </summary>\r\n              <div id=\"divRequestsWithNoResponseItems\" class=\"\">\r\n                <ul data-bind=\"foreach: arrRequestsWithNoResponses\">\r\n                  <li>\r\n                    <a\r\n                      href=\"javascript:void(0);\"\r\n                      title=\"Go to Request Details\"\r\n                      data-bind=\"click: $root.ClickGoToRequest\"\r\n                      ><span data-bind=\"text: title\"></span\r\n                    ></a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </details>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"reports-container\">\r\n        <div class=\"quick-links\">\r\n          <div>\r\n            <a\r\n              title=\"Refresh this page\"\r\n              href=\"javascript:void(0)\"\r\n              data-bind=\"click: refresh\"\r\n              ><span class=\"ui-icon ui-icon-refresh\"></span>Refresh</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a\r\n              title=\"View User Manuals\"\r\n              href=\"javascript:void(0)\"\r\n              onclick=\"Audit.Common.Utilities.ViewUserManuals()\"\r\n              ><span class=\"ui-icon ui-icon-help\"></span>User Manuals</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a\r\n              title=\"View Response Documents Uploaded by Action Offices Today but not yet Submitted\"\r\n              href=\"javascript:void(0)\"\r\n              onclick=\"Audit.IAReport.Report.ViewResponseDocsToday()\"\r\n              ><span class=\"ui-icon ui-icon-search\"></span>View Today's\r\n              Un-submitted Response Documents</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a\r\n              title=\"View Response Documents Returned to GFS\"\r\n              href=\"javascript:void(0)\"\r\n              onclick=\"Audit.IAReport.Report.ViewReturnedDocs()\"\r\n              ><span class=\"ui-icon ui-icon-search\"></span>View Response\r\n              Documents Returned to GFS</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a\r\n              title=\"View Request, Response and Site Permissions\"\r\n              href=\"javascript:void(0)\"\r\n              onclick=\"Audit.IAReport.Report.ViewPermissions()\"\r\n              ><span class=\"ui-icon ui-icon-locked\"></span>View Permissions</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a\r\n              title=\"View Late Requests\"\r\n              href=\"javascript:void(0)\"\r\n              onclick=\"Audit.IAReport.Report.ViewLateRequests()\"\r\n              ><span class=\"ui-icon ui-icon-clock\"></span>View Late Requests</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a\r\n              id=\"linkSubmitBulkReq\"\r\n              href=\"javascript:void(0)\"\r\n              data-bind=\"click: ClickBulkAddRequest\"\r\n              ><span class=\"ui-icon ui-icon-plus\"></span>Bulk Add Request</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a\r\n              id=\"linkSubmitNewReq\"\r\n              href=\"javascript:void(0)\"\r\n              data-bind=\"click: ClickNewRequest\"\r\n              ><span class=\"ui-icon ui-icon-plus\"></span>Create a New Request</a\r\n            >\r\n          </div>\r\n          <div style=\"display: none\">\r\n            <a\r\n              id=\"linkResetPerms\"\r\n              href=\"javascript:void(0)\"\r\n              data-bind=\"click: ClickResetPerms\"\r\n              ><span class=\"ui-icon ui-icon-locked\"></span>Reset App\r\n              Permissions</a\r\n            >\r\n          </div>\r\n        </div>\r\n        <div id=\"tabs\" style=\"margin-top: 20px\">\r\n          <!-- ko using: tabs -->\r\n          <ul class=\"ui-tabs-nav\" data-bind=\"foreach: tabOpts\">\r\n            <li\r\n              data-bind=\"text: linkText, \r\n            click: $parent.clickTabLink, \r\n            css: {active: $parent.isSelected($data)}\"\r\n            ></li>\r\n          </ul>\r\n          <!-- ko foreach: tabOpts -->\r\n          <div\r\n            data-bind=\"template: {\r\n              name: template.id,\r\n              data: template.data\r\n            },\r\n            visible: $parent.isSelected($data)\"\r\n          ></div>\r\n          <!-- /ko -->\r\n          <!-- /ko -->\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div\r\n      id=\"divRanBulkUpdate\"\r\n      title=\"Do not delete Used for checking if bulk update ran\"\r\n      style=\"display: none\"\r\n    ></div>\r\n  </div>\r\n\r\n  <script id=\"requestStatusReportTemplate\" type=\"text/html\">\r\n    <div id=\"divStatusReportRequests\">\r\n      <table\r\n        is=\"data-table\"\r\n        id=\"tblStatusReportRequests\"\r\n        data-title=\"Request Status Report\"\r\n        data-file-prefix=\"RequestStatusReport_\"\r\n        class=\"tablesorter report\"\r\n      >\r\n        <thead>\r\n          <tr\r\n            valign=\"top\"\r\n            class=\"rowFilters\"\r\n            data-bind=\"visible: arrRequests().length > 0\"\r\n          >\r\n            <th\r\n              class=\"sorter-false filter\"\r\n              data-filter=\"search\"\r\n              data-filter-prop=\"ID\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"search\"\r\n              data-filter-prop=\"subject\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              data-filter-prop=\"requestingOffice\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false filter\"\r\n              data-filter=\"multiselect\"\r\n              data-filter-prop=\"sensitivity\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false filter\"\r\n              data-filter=\"multiselect\"\r\n              data-filter-value=\"Open\"\r\n              data-filter-prop=\"status\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"daterange\"\r\n              data-filter-prop=\"internalDueDate\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false filter\"\r\n              data-filter=\"daterange\"\r\n              data-filter-prop=\"dueDate\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false filter\"\r\n              data-filter=\"multiselect\"\r\n              data-filter-prop=\"sample\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false filter\"\r\n              data-filter=\"multiselect\"\r\n              data-filter-prop=\"sentEmail\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false filter\"\r\n              data-filter=\"search\"\r\n              data-filter-prop=\"(r) => r.actionOffices.map(ao => ao.ao)\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n          </tr>\r\n          <tr valign=\"top\">\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Request #</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Subject</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Requesting Office</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Sensitivity</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Status</th>\r\n            <th class=\"sorter-true desc\" nowrap=\"nowrap\">Internal Due Date</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Due Date</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Sample?</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Sent Email?</th>\r\n            <th class=\"sorter-false\" nowrap=\"nowrap\">Action Office(s)</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\"># of Responses</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\"># of Open Responses</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\"># of Documents</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody id=\"fbody1\" data-bind=\"foreach: arrRequests\">\r\n          <tr class=\"sr1-request-item\">\r\n            <td class=\"sr1-request-requestNum\">\r\n              <a\r\n                href=\"javascript:void(0);\"\r\n                title=\"Go to Request Details\"\r\n                data-bind=\"text: reqNumber,\r\n                  click: () => Audit.IAReport.Report.GoToRequest(reqNumber, null)\"\r\n              ></a>\r\n            </td>\r\n            <td class=\"sr1-request-subject\" data-bind=\"text: subject\"></td>\r\n            <td\r\n              class=\"sr1-request-requestingOffice\"\r\n              data-bind=\"text: requestingOffice\"\r\n            ></td>\r\n            <td\r\n              class=\"sr1-request-sensitivity\"\r\n              data-bind=\"text: sensitivity\"\r\n            ></td>\r\n            <td class=\"sr1-request-status\" data-bind=\"text: status\"></td>\r\n            <td\r\n              class=\"sr1-request-internalDueDate\"\r\n              data-bind=\"text: internalDueDate,\r\n                class: internalDueDateStyle\"\r\n            ></td>\r\n            <td\r\n              class=\"sr1-request-dueDate\"\r\n              data-bind=\"text: dueDate,\r\n                class: dueDateStyle\"\r\n            ></td>\r\n            <td class=\"sr1-request-sample\">\r\n              <span\r\n                class=\"ui-icon\"\r\n                data-bind=\"class: sample ? 'ui-icon-check' : 'ui-icon-close',\r\n                text: sample ?? 'false'\"\r\n              ></span>\r\n            </td>\r\n            <td class=\"sr1-request-sentEmail\">\r\n              <span\r\n                class=\"ui-icon\"\r\n                data-bind=\"class: sentEmail ? 'ui-icon-check' : 'ui-icon-close',\r\n                text: sentEmail ?? 'false'\"\r\n              ></span>\r\n            </td>\r\n            <td class=\"sr1-request-actionOffice\">\r\n              <div\r\n                style=\"cursor:pointer; white-space:nowrap\"\r\n                title=\"Click to view\"\r\n              >\r\n                <span class=\"actionOfficeContainer\">\r\n                  <span class=\"ui-icon ui-icon-search\"></span\r\n                  ><a\r\n                    href=\"javascript:void(0)\"\r\n                    data-bind=\"click: $parent.clickExpandActionOffices\"\r\n                    >View Action Offices</a\r\n                  >\r\n                  <ul class=\"sr1-request-actionOffice-items collapsed\">\r\n                    <!-- ko foreach: actionOffices -->\r\n                    <li class=\"sr1-request-actionOffice-item\">\r\n                      <span data-bind=\"text: ao\"></span>;\r\n                    </li>\r\n                    <!-- /ko -->\r\n                  </ul>\r\n                </span>\r\n              </div>\r\n            </td>\r\n            <td\r\n              class=\"sr1-request-responseCount\"\r\n              data-bind=\"text: responseCount\"\r\n            ></td>\r\n            <td\r\n              class=\"sr1-request-responsesOpenCount\"\r\n              data-bind=\"text: responsesOpenCount\"\r\n            ></td>\r\n            <td\r\n              class=\"sr1-request-responseDocCount\"\r\n              data-bind=\"text: responseDocCount\"\r\n            ></td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </script>\r\n\r\n  <script id=\"responseStatusReportTemplate\" type=\"text/html\">\r\n    <div id=\"divStatusReportRespones\">\r\n      <table\r\n        id=\"tblStatusReportResponses\"\r\n        is=\"data-table\"\r\n        data-title=\"Response Status Report\"\r\n        data-file-prefix=\"ResponseStatusReport_\"\r\n        class=\"tablesorter report\"\r\n        data-bind=\"visible: arrResponses().length > 0\"\r\n      >\r\n        <thead>\r\n          <tr\r\n            valign=\"top\"\r\n            class=\"rowFilters\"\r\n            data-bind=\"visible: arrResponses().length > 0\"\r\n          >\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"daterange\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"multiselect\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n            <th\r\n              class=\"sorter-false\"\r\n              data-filter=\"daterange\"\r\n              nowrap=\"nowrap\"\r\n            ></th>\r\n          </tr>\r\n          <tr valign=\"top\">\r\n            <th class=\"sorter-true asc\" nowrap=\"nowrap\">Request #</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Sample #</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Response Name</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Internal Due Date</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Status</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Action Office</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\"># of Documents</th>\r\n            <th class=\"sorter-true\" nowrap=\"nowrap\">Modified</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody id=\"fbody2\" data-bind=\"foreach: arrResponses\">\r\n          <tr class=\"sr2-response-item\">\r\n            <td class=\"sr2-response-requestNum\">\r\n              <a\r\n                href=\"javascript:void(0);\"\r\n                title=\"Go to Request Details\"\r\n                data-bind=\"click: () => Audit.IAReport.Report.GoToRequest(reqNumber, title),\r\n          text: reqNumber\"\r\n              ></a>\r\n            </td>\r\n            <td class=\"sr2-response-sample\" data-bind=\"text: sample\"></td>\r\n            <td class=\"sr2-response-title\" data-bind=\"text: title\"></td>\r\n            <td\r\n              class=\"sr2-response-internalDueDate\"\r\n              data-bind=\"text: internalDueDate\"\r\n            ></td>\r\n            <td class=\"sr2-response-status\" data-bind=\"text: status\"></td>\r\n            <td class=\"sr2-response-ao\" data-bind=\"text: ao\"></td>\r\n            <td class=\"sr2-response-docCount\" data-bind=\"text: docCount\"></td>\r\n            <td class=\"sr2-response-modified\" data-bind=\"text: modified\"></td>\r\n          </tr>\r\n        </tbody>\r\n        <tfoot class=\"footer\"></tfoot>\r\n      </table>\r\n    </div>\r\n  </script>\r\n\r\n  <script id=\"requestDetailTemplate\" type=\"text/html\">\r\n    <div class=\"quick-links secondary\">\r\n      <span>Request: </span\r\n      ><select\r\n        id=\"ddlReqNum\"\r\n        title=\"Select a Request Number\"\r\n        data-bind=\"options: $root.ddOptionsRequestInfoTabRequestName, value: filterRequestInfoTabRequestName, optionsCaption: '-Select-'\"\r\n      ></select>\r\n    </div>\r\n    <div\r\n      data-bind=\"component: {name: requestDetailViewComponent.componentName, params: requestDetailViewComponent}\"\r\n    ></div>\r\n  </script>\r\n\r\n  <script id=\"requestTemplate\" type=\"text/html\"></script>\r\n\r\n  <!-- New Request Detail tab, uses the  -->\r\n  <script id=\"newRequestTemplate\" type=\"text/html\">\r\n    <div data-bind=\"component: {name: componentName, params: params}\"></div>\r\n  </script>\r\n\r\n  <div id=\"divTest\"></div>\r\n`;\r\n", "\uFEFFwindow.Audit = window.Audit || {};\r\nAudit.Common = Audit.Common || {};\r\n\r\nfunction InitReport() {\r\n  Audit.Common.Utilities = new Audit.Common.NewUtilities();\r\n  Audit.Common.Init();\r\n}\r\n\r\nAudit.Common.Init = function () {};\r\n\r\nAudit.Common.NewUtilities = function () {\r\n  var m_siteUrl = _spPageContextInfo.webServerRelativeUrl; //IE11 in sp 2013 does not recognize L_Menu_BaseUrl\r\n\r\n  var m_listTitleRequests = \"AuditRequests\";\r\n  var m_listNameRequests = \"AuditRequests\";\r\n\r\n  var m_listTitleRequestsInternal = \"AuditRequestsInternal\";\r\n  var m_listNameRequestsInternal = \"AuditRequestsInternal\";\r\n\r\n  var m_listTitleResponses = \"AuditResponses\";\r\n  var m_listNameResponses = \"AuditResponses\";\r\n\r\n  var m_libTitleRequestDocs = \"AuditRequestDocs\";\r\n  var m_libNameRequestDocs = \"AuditRequestDocs\";\r\n\r\n  var m_libTitleCoverSheet = \"AuditCoverSheets\";\r\n  var m_libNameCoverSheet = \"AuditCoverSheets\";\r\n\r\n  var m_libTitleResponseDocs = \"AuditResponseDocs\";\r\n  var m_libNameResponseDocs = \"AuditResponseDocs\";\r\n\r\n  var m_libTitleResponseDocsEA = \"AuditResponseDocsEA\";\r\n  var m_libNameResponseDocsEA = \"AuditResponseDocsEA\";\r\n\r\n  var m_listTitleActionOffices = \"AuditOrganizations\";\r\n  var m_listNameActionOffices = \"AuditOrganizations\";\r\n\r\n  var m_listTitleEmailHistory = \"AuditEmails\";\r\n  var m_listNameEmailHistory = \"AuditEmails\";\r\n\r\n  var m_listTitleBulkResponses = \"AuditBulkResponses\";\r\n  var m_listNameBulkResponses = \"AuditBulkResponses\";\r\n\r\n  var m_listTitleBulkPermissions = \"AuditBulkPermissions\";\r\n  var m_listNameBulkPermissions = \"AuditBulkPermissions\";\r\n\r\n  var m_groupNameSpecialPermName1 = \"CGFS Special Access1\";\r\n  var m_groupNameSpecialPermName2 = \"CGFS Special Access2\";\r\n  var m_groupNameQA = \"Quality Assurance\";\r\n  var m_groupNameEA = \"External Auditors\";\r\n\r\n  var m_libResponseDocsLibraryGUID = null;\r\n\r\n  var m_arrSiteGroups = null;\r\n  var m_arrAOs = null;\r\n  /**\r\n   * Reloads the page, trys to preserve current path\r\n   * @param {bool} hard flag to remove all url params\r\n   * @returns\r\n   */\r\n  function m_fnRefresh(hard = false) {\r\n    if (hard) {\r\n      location.href = location.pathname;\r\n      return;\r\n    }\r\n    var curPath = location.pathname;\r\n\r\n    if ($(\"#tabs\").html() != null && $(\"#tabs\").html() != \"\") {\r\n      var tabIndex = 0;\r\n      try {\r\n        tabIndex = $(\"#tabs\").tabs(\"option\", \"active\");\r\n      } catch (ex) {}\r\n\r\n      curPath += \"?Tab=\" + tabIndex;\r\n\r\n      if (tabIndex == 0 && $(\"#ddlResponseName\").val() != \"\") {\r\n        curPath += \"&ResNum=\" + $(\"#ddlResponseName\").val();\r\n      } else if (tabIndex == 1) {\r\n        var responseNumOpen = $(\"#ddlResponsesOpen\").val();\r\n        var responseNumProcessed = $(\"#ddlResponsesProcessed\").val();\r\n\r\n        if (responseNumOpen != null && responseNumOpen != \"\")\r\n          curPath += \"&ResNum=\" + responseNumOpen;\r\n        else if (responseNumProcessed != null && responseNumProcessed != \"\")\r\n          curPath += \"&ResNum=\" + responseNumProcessed;\r\n      }\r\n\r\n      location.href = curPath;\r\n    } else {\r\n      location.reload();\r\n    }\r\n  }\r\n\r\n  function m_fnOnLoadDisplayTimeStamp() {\r\n    var curDate = new Date();\r\n    $(\"#divLoading\").text(\"Loaded at \" + curDate.format(\"MM/dd/yyyy hh:mm tt\"));\r\n  }\r\n\r\n  function m_fnOnLoadDisplayTabAndResponse() {\r\n    var paramTabIndex = GetUrlKeyValue(\"Tab\");\r\n    if (paramTabIndex != null && paramTabIndex != \"\") {\r\n      $(\"#tabs\").tabs(\"option\", \"active\", paramTabIndex);\r\n    }\r\n\r\n    var bFiltered = false;\r\n\r\n    var paramResponseNum = GetUrlKeyValue(\"ResNum\");\r\n    if (paramResponseNum != null && paramResponseNum != \"\") {\r\n      if (paramTabIndex == 0) {\r\n        if (\r\n          $(\"#ddlResponseName option[value='\" + paramResponseNum + \"']\")\r\n            .length > 0\r\n        ) {\r\n          $(\"#ddlResponseName\").val(paramResponseNum).change();\r\n          bFiltered = true;\r\n        }\r\n      } else {\r\n        if (\r\n          $(\"#ddlResponsesOpen option[value='\" + paramResponseNum + \"']\")\r\n            .length > 0\r\n        ) {\r\n          $(\"#ddlResponsesOpen\").val(paramResponseNum).change();\r\n        } else if (\r\n          $(\"#ddlResponsesProcessed option[value='\" + paramResponseNum + \"']\")\r\n            .length > 0\r\n        ) {\r\n          $(\"#ddlResponsesProcessed\").val(paramResponseNum).change();\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!bFiltered) {\r\n      $(\".sr-response-item\").show(); //hiding rows by default\r\n    }\r\n  }\r\n\r\n  function m_fnOnLoadFilterResponses(responseStatus1, responseStatus2) {\r\n    var count = 0;\r\n    var cntOpen = 0;\r\n    var cntReOpened = 0;\r\n    var resStatus1 = 0;\r\n    var resStatus2 = 0;\r\n\r\n    var eacher = $(\".sr-response-item\");\r\n\r\n    eacher.each(function () {\r\n      var reqStatus = $.trim($(this).find(\".sr-response-requestStatus\").text());\r\n      var resStatus = $.trim($(this).find(\".sr-response-status\").text());\r\n\r\n      if (\r\n        (resStatus == responseStatus1 || resStatus == responseStatus2) &&\r\n        (reqStatus == \"Open\" || reqStatus == \"ReOpened\")\r\n      ) {\r\n        $(this).addClass(\"highlighted\");\r\n        count++;\r\n\r\n        if (resStatus == responseStatus1) resStatus1++;\r\n        else if (resStatus == responseStatus2) resStatus2++;\r\n\r\n        if (reqStatus == \"Open\") cntOpen++;\r\n        else if (reqStatus == \"ReOpened\") cntReOpened++;\r\n      }\r\n    });\r\n\r\n    if (count > 0) {\r\n      $(\"#lblStatusReportResponsesMsg\").html(\r\n        \"<span class='ui-icon ui-icon-alert'></span>There are \" +\r\n          count +\r\n          \" Responses pending your review\"\r\n      );\r\n\r\n      if (resStatus1 > 0 && resStatus2 == 0)\r\n        $(\"#ddlResponseStatus\").val(responseStatus1).change();\r\n      else if (resStatus2 > 0 && resStatus1 == 0)\r\n        $(\"#ddlResponseStatus\").val(responseStatus2).change();\r\n    } else\r\n      $(\"#lblStatusReportResponsesMsg\").html(\r\n        \"<span class='ui-icon ui-icon-circle-check'></span>There are 0 Responses pending your review\"\r\n      );\r\n  }\r\n\r\n  function m_fnLoadSiteGroups(itemColl) {\r\n    m_arrSiteGroups = new Array();\r\n\r\n    var listItemEnumerator = itemColl.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var id = oListItem.get_id();\r\n      var loginName = oListItem.get_loginName();\r\n      var title = oListItem.get_title();\r\n\r\n      var groupObject = new Object();\r\n      groupObject[\"ID\"] = id;\r\n      groupObject[\"loginName\"] = loginName;\r\n      groupObject[\"title\"] = title;\r\n      groupObject[\"group\"] = oListItem;\r\n\r\n      m_arrSiteGroups.push(groupObject);\r\n    }\r\n  }\r\n\r\n  function m_fnGetSPSiteGroup(groupName) {\r\n    var userGroup = null;\r\n    if (m_arrSiteGroups != null) {\r\n      for (var x = 0; x < m_arrSiteGroups.length; x++) {\r\n        if (m_arrSiteGroups[x].title == groupName) {\r\n          userGroup = m_arrSiteGroups[x].group;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return userGroup;\r\n  }\r\n\r\n  function m_fnLoadActionOffices(itemColl) {\r\n    m_arrAOs = new Array();\r\n\r\n    var listItemEnumerator = itemColl.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var id = oListItem.get_item(\"ID\");\r\n      var title = oListItem.get_item(\"Title\");\r\n      var userGroup = oListItem.get_item(\"UserGroup\");\r\n      if (userGroup != null) {\r\n        userGroup = userGroup.get_lookupValue();\r\n      } else userGroup = \"\";\r\n\r\n      var aoObject = new Object();\r\n      aoObject[\"ID\"] = id;\r\n      aoObject[\"title\"] = title;\r\n      aoObject[\"userGroup\"] = userGroup;\r\n\r\n      m_arrAOs.push(aoObject);\r\n    }\r\n  }\r\n\r\n  function m_fnGetAOSPGroupName(groupName) {\r\n    //finds the group name corresponding to the lookup field selected\r\n    var userGroup = null;\r\n    if (m_arrAOs != null) {\r\n      for (var x = 0; x < m_arrAOs.length; x++) {\r\n        var oGroup = m_arrAOs[x];\r\n        if (oGroup.title == groupName) {\r\n          userGroup = oGroup.userGroup;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return userGroup;\r\n  }\r\n\r\n  function m_fnCheckSPItemHasGroupPermission(item, groupName, permissionLevel) {\r\n    if (\r\n      item == null ||\r\n      groupName == \"\" ||\r\n      groupName == null ||\r\n      permissionLevel == null\r\n    )\r\n      return false;\r\n\r\n    var match = false;\r\n    var roleAssignments = item.get_roleAssignments();\r\n    if (roleAssignments == null) {\r\n      alert(\"Error retrieving role assignments\");\r\n      return false;\r\n    }\r\n\r\n    var rolesEnumerator = roleAssignments.getEnumerator();\r\n    while (rolesEnumerator.moveNext()) {\r\n      var role = rolesEnumerator.get_current();\r\n      if (role != null) {\r\n        var roleMember = role.get_member();\r\n        if (roleMember.isPropertyAvailable(\"Title\")) {\r\n          var memberTitleName = roleMember.get_title();\r\n\r\n          var roleDefs = role.get_roleDefinitionBindings();\r\n          if (roleDefs != null) {\r\n            var roleDefsEnumerator = roleDefs.getEnumerator();\r\n            while (roleDefsEnumerator.moveNext()) {\r\n              var rd = roleDefsEnumerator.get_current();\r\n              var rdName = rd.get_name();\r\n\r\n              if (\r\n                memberTitleName == groupName &&\r\n                rd.get_basePermissions().has(permissionLevel)\r\n              ) {\r\n                match = true;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return match;\r\n  }\r\n\r\n  function m_fnGoToResponse(responseTitle, isIA) {\r\n    if (!isIA) {\r\n      var bFound = false;\r\n      $(\"#ddlResponsesOpen > option\").each(function () {\r\n        if ($(this).text() == responseTitle) {\r\n          bFound = true;\r\n          notifyId = SP.UI.Notify.addNotification(\r\n            \"Displaying Response (\" + responseTitle + \")\",\r\n            false\r\n          );\r\n          $(\"#ddlResponsesOpen\").val(responseTitle).change();\r\n\r\n          return false;\r\n        }\r\n      });\r\n      if (!bFound) {\r\n        $(\"#ddlResponsesProcessed > option\").each(function () {\r\n          if ($(this).text() == responseTitle) {\r\n            bFound = true;\r\n            notifyId = SP.UI.Notify.addNotification(\r\n              \"Displaying Response (\" + responseTitle + \")\",\r\n              false\r\n            );\r\n            $(\"#ddlResponsesProcessed\").val(responseTitle).change();\r\n\r\n            return false;\r\n          }\r\n        });\r\n      }\r\n\r\n      $(\"#tabs\").tabs({ active: 1 });\r\n    }\r\n  }\r\n\r\n  function m_fnGetResponseDocStyleTag2(documentStatus) {\r\n    var styleTag = {};\r\n    if (documentStatus == \"Archived\")\r\n      styleTag = { \"background-color\": \"Gainsboro\" };\r\n    else if (documentStatus == \"Approved\")\r\n      styleTag = { \"background-color\": \"PaleGreen\" };\r\n    else if (documentStatus == \"Rejected\")\r\n      styleTag = { \"background-color\": \"LightSalmon\" };\r\n    else if (documentStatus == \"Sent to QA\")\r\n      styleTag = { \"background-color\": \"LightCyan\" };\r\n    else if (documentStatus == \"Submitted\")\r\n      styleTag = { \"background-color\": \"LemonChiffon\" };\r\n    else if (documentStatus == \"Marked for Deletion\")\r\n      styleTag = {\r\n        \"background-color\": \"Gainsboro\",\r\n        \"font-style\": \"italic\",\r\n      };\r\n    return styleTag;\r\n    //\t\t\tstyleTag = \" style='background-color:Gainsboro; font-style:italic' title='Marked for Deletion by the Action Office' \";\r\n  }\r\n\r\n  function m_fnGetResponseDocStyleTag(documentStatus) {\r\n    var styleTag = \"\";\r\n\r\n    if (documentStatus == \"Archived\")\r\n      styleTag = \" style='background-color:Gainsboro;' \";\r\n    else if (documentStatus == \"Approved\")\r\n      styleTag = \" style='background-color:PaleGreen;' \";\r\n    else if (documentStatus == \"Rejected\")\r\n      styleTag = \" style='background-color:LightSalmon;' \";\r\n    else if (documentStatus == \"Sent to QA\")\r\n      styleTag = \" style='background-color:LightCyan;' \";\r\n    else if (documentStatus == \"Submitted\")\r\n      styleTag = \" style='background-color:LemonChiffon;' \";\r\n    else if (documentStatus == \"Marked for Deletion\")\r\n      styleTag =\r\n        \" style='background-color:Gainsboro; font-style:italic' title='Marked for Deletion by the Action Office' \";\r\n\r\n    return styleTag;\r\n  }\r\n\r\n  function m_fnCheckIfEmailFolderExists(items, requestNumber) {\r\n    //Check if folder exists in email library\r\n    var bFolderExists = false;\r\n    var listItemEnumerator = items.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var folderItem = listItemEnumerator.get_current();\r\n      var itemName = folderItem.get_displayName();\r\n      if (itemName == requestNumber) {\r\n        var bFolderExists = true;\r\n        break;\r\n      }\r\n    }\r\n    return bFolderExists;\r\n  }\r\n\r\n  var m_cntAddToEmailFolder = 0;\r\n  var m_cntAddedToEmailFolder = 0;\r\n\r\n  function m_fnCreateEmailFolder(list, requestNumber, requestItem, OnComplete) {\r\n    m_cntAddToEmailFolder = 0;\r\n    m_cntAddedToEmailFolder = 0;\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var itemCreateInfo = new SP.ListItemCreationInformation();\r\n    itemCreateInfo.set_underlyingObjectType(SP.FileSystemObjectType.folder);\r\n    itemCreateInfo.set_leafName(requestNumber);\r\n    oNewEmailFolder = list.addItem(itemCreateInfo);\r\n    oNewEmailFolder.set_item(\"Title\", requestNumber);\r\n    oNewEmailFolder.update();\r\n\r\n    this.currentUser = web.get_currentUser();\r\n    this.ownerGroup = web.get_associatedOwnerGroup();\r\n    this.memberGroup = web.get_associatedMemberGroup();\r\n    this.visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n    oNewEmailFolder.resetRoleInheritance();\r\n    oNewEmailFolder.breakRoleInheritance(false, false);\r\n\r\n    var roleDefBindingCollAdmin =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollAdmin.add(\r\n      web.get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n    );\r\n\r\n    var roleDefBindingCollContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollContribute.add(\r\n      web.get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedRead =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedRead.add(\r\n      web.get_roleDefinitions().getByName(\"Restricted Read\")\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedContribute.add(\r\n      web.get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n    );\r\n\r\n    //add associated site groups\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(ownerGroup, roleDefBindingCollAdmin);\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(memberGroup, roleDefBindingCollContribute);\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null)\r\n      oNewEmailFolder\r\n        .get_roleAssignments()\r\n        .add(spGroupQA, roleDefBindingCollRestrictedContribute);\r\n\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .getByPrincipal(currentUser)\r\n      .deleteObject();\r\n\r\n    //Need to break up adding AOs because it exceeds the resource limit (request uses too many resources)\r\n    function onUpdatePermsSucceeded() {\r\n      if (this.requestItem) {\r\n        //this will be null when sending from permissions page\r\n        //add action offices\r\n        var arrActionOffice = this.requestItem.get_item(\"ActionOffice\");\r\n        if (arrActionOffice == null || arrActionOffice.length == 0) {\r\n          if (this.OnComplete) this.OnComplete(true);\r\n          return;\r\n        }\r\n\r\n        for (var x = 0; x < arrActionOffice.length; x++) {\r\n          var actionOfficeName = arrActionOffice[x].get_lookupValue();\r\n\r\n          var actionOfficeGroupName =\r\n            Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n          var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n            actionOfficeGroupName\r\n          );\r\n\r\n          if (actionOfficeGroup != null) {\r\n            m_cntAddToEmailFolder++;\r\n\r\n            var currCtx2 = new SP.ClientContext.get_current();\r\n            var web2 = currCtx2.get_web();\r\n\r\n            var roleDefBindingCollRestrictedContribute =\r\n              SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n            roleDefBindingCollRestrictedContribute.add(\r\n              web2.get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n            );\r\n\r\n            this.oNewEmailFolder\r\n              .get_roleAssignments()\r\n              .add(actionOfficeGroup, roleDefBindingCollRestrictedContribute);\r\n\r\n            function onUpdateAOPermsSucceeded() {\r\n              m_cntAddedToEmailFolder++;\r\n              if (m_cntAddedToEmailFolder == m_cntAddToEmailFolder) {\r\n                if (this.OnComplete) this.OnComplete(true);\r\n              }\r\n            }\r\n            function onUpdateAOPermsFailed(sender, args) {\r\n              m_cntAddedToEmailFolder++;\r\n              if (m_cntAddedToEmailFolder == m_cntAddToEmailFolder) {\r\n                if (this.OnComplete) this.OnComplete(true);\r\n              }\r\n            }\r\n            var data = { OnComplete: this.OnComplete };\r\n            currCtx2.executeQueryAsync(\r\n              Function.createDelegate(data, onUpdateAOPermsSucceeded),\r\n              Function.createDelegate(data, onUpdateAOPermsFailed)\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        if (this.OnComplete) this.OnComplete(true);\r\n      }\r\n    }\r\n\r\n    function onUpdatePermsFailed(sender, args) {\r\n      statusId = SP.UI.Status.addStatus(\r\n        \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    var data = {\r\n      /*item: oListItem, */ requestItem: requestItem,\r\n      oNewEmailFolder: oNewEmailFolder,\r\n      OnComplete: OnComplete,\r\n    };\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onUpdatePermsSucceeded),\r\n      Function.createDelegate(data, onUpdatePermsFailed)\r\n    );\r\n  }\r\n\r\n  function m_fnSortResponseTitleNoCase(a, b) {\r\n    var aTitle = a;\r\n    var bTitle = b;\r\n    let newA, newB;\r\n\r\n    if (aTitle == null) aTitle = \"\";\r\n    if (bTitle == null) bTitle = \"\";\r\n\r\n    var aIndex = aTitle.lastIndexOf(\"-\");\r\n    if (aIndex >= 0) {\r\n      var subA = aTitle.substring(0, aIndex + 1);\r\n      var lastA = aTitle.replace(subA, \"\");\r\n      var intA = parseInt(lastA, 10);\r\n      var newIntA = Audit.Common.Utilities.PadDigits(intA, 5);\r\n      newA = subA + newIntA;\r\n    } else newA = aTitle;\r\n\r\n    var bIndex = bTitle.lastIndexOf(\"-\");\r\n    if (bIndex >= 0) {\r\n      var subB = bTitle.substring(0, bIndex + 1);\r\n      var lastB = bTitle.replace(subB, \"\");\r\n      var intB = parseInt(lastB, 10);\r\n      var newIntB = Audit.Common.Utilities.PadDigits(intB, 5);\r\n      newB = subB + newIntB;\r\n    } else newB = bTitle;\r\n\r\n    return newA.toLowerCase().localeCompare(newB.toLowerCase());\r\n  }\r\n\r\n  function m_fnSortResponseObjectNoCase(a, b) {\r\n    var aTitle = a.title;\r\n    var bTitle = b.title;\r\n    var newA;\r\n    var newB;\r\n    if (aTitle == null) aTitle = \"\";\r\n    if (bTitle == null) bTitle = \"\";\r\n\r\n    var aIndex = aTitle.lastIndexOf(\"-\");\r\n    if (aIndex >= 0) {\r\n      var subA = aTitle.substring(0, aIndex + 1);\r\n      var lastA = aTitle.replace(subA, \"\");\r\n      var intA = parseInt(lastA, 10);\r\n      var newIntA = Audit.Common.Utilities.PadDigits(intA, 5);\r\n      newA = subA + newIntA;\r\n    } else newA = aTitle;\r\n\r\n    var bIndex = bTitle.lastIndexOf(\"-\");\r\n    if (bIndex >= 0) {\r\n      var subB = bTitle.substring(0, bIndex + 1);\r\n      var lastB = bTitle.replace(subB, \"\");\r\n      var intB = parseInt(lastB, 10);\r\n      var newIntB = Audit.Common.Utilities.PadDigits(intB, 5);\r\n      newB = subB + newIntB;\r\n    } else newB = bTitle;\r\n\r\n    return newA.toLowerCase().localeCompare(newB.toLowerCase());\r\n  }\r\n\r\n  function m_fnSortNoCase(a, b) {\r\n    return a.toLowerCase().localeCompare(b.toLowerCase());\r\n  }\r\n\r\n  function m_fnSortDate(a, b) {\r\n    if (a == \"\") return -1;\r\n    if (b == \"\") return 1;\r\n    return new Date(a).getTime() - new Date(b).getTime();\r\n  }\r\n\r\n  //Adds the values in the arr array to the drop down with the specified id\r\n  function m_fnAddOptions(arr, ddlID, dateSort, responseSort) {\r\n    if (arr == null) return;\r\n    if (responseSort) arr.sort(m_fnSortResponseTitleNoCase);\r\n    else if (!dateSort) arr.sort(m_fnSortNoCase);\r\n    else arr.sort(m_fnSortDate);\r\n\r\n    var rOptions = new Array(),\r\n      j = -1;\r\n    rOptions[++j] = \"<option value=''>-Select-</option>\";\r\n\r\n    var arrLength = arr.length;\r\n\r\n    /*\tvar fragment = document.createDocumentFragment();\r\n\t\t\tvar choice = document.createElement('option');\r\n\t\t\tchoice.value = \"\";\r\n\t\t\tchoice.innerHTML = \"-Select-\";\r\n\t\t\tfragment.appendChild(choice);\r\n\t\t*/\r\n    for (var x = 0; x < arrLength; x++) {\r\n      var option = $.trim(arr[x]);\r\n\r\n      rOptions[++j] = \"<option value='\" + option + \"'>\" + option + \"</option>\";\r\n\r\n      /*\t\r\n\t\t\tvar choice = document.createElement('option');\r\n\t        choice.value = option;\r\n\t        choice.innerHTML = option;\r\n\t        fragment.appendChild(choice);*/\r\n    }\r\n\r\n    //ddlID = ddlID.replace(\"#\", \"\");\r\n    //document.getElementById(ddlID).innerHTML = rOptions.join('');\r\n\r\n    var thisDDL = $(ddlID);\r\n    thisDDL.empty().append(rOptions.join(\"\"));\r\n    /*var thisDDL = $(ddlID);\r\n\t\tthisDDL.empty().html( fragment );*/\r\n  }\r\n\r\n  function m_fnExistsInArr(arr, val) {\r\n    if (arr == null) return false;\r\n\r\n    var arrLength = arr.length;\r\n    for (var x = 0; x < arrLength; x++) {\r\n      if (arr[x] == val) return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function m_fnGetTrueFalseIcon(val) {\r\n    if (val == true)\r\n      return \"<span class='ui-icon ui-icon-check'>\" + val + \"</span>\";\r\n    else return \"<span class='ui-icon ui-icon-close'>\" + val + \"</span>\";\r\n  }\r\n\r\n  function m_fnGetFriendlyDisplayName(oListItem, fieldName) {\r\n    var user = oListItem.get_item(fieldName);\r\n    if (user == null) return \"\";\r\n    else return user.get_lookupValue();\r\n  }\r\n\r\n  function m_fnPadDigits(n, totalDigits) {\r\n    n = n.toString();\r\n    var pd = \"\";\r\n    if (totalDigits > n.length) {\r\n      for (let i = 0; i < totalDigits - n.length; i++) {\r\n        pd += \"0\";\r\n      }\r\n    }\r\n    return pd + n.toString();\r\n  }\r\n\r\n  function m_fnPreciseRound(num, decimals) {\r\n    var sign = num >= 0 ? 1 : -1;\r\n    return (\r\n      Math.round(num * Math.pow(10, decimals) + sign * 0.001) /\r\n      Math.pow(10, decimals)\r\n    ).toFixed(decimals);\r\n  }\r\n\r\n  function m_fnGetFriendlyFileSize(fileSize) {\r\n    if (fileSize == null || fileSize == \"\") return \"\";\r\n\r\n    if (fileSize > 1048576) {\r\n      fileSize =\r\n        Audit.Common.Utilities.PreciseRound(fileSize / 1048576, 2) + \" MB\";\r\n    } else if (fileSize > 1024) {\r\n      fileSize =\r\n        Audit.Common.Utilities.PreciseRound(fileSize / 1024, 2) + \" KB\";\r\n    } else {\r\n      fileSize += \" B\";\r\n    }\r\n    return fileSize;\r\n  }\r\n\r\n  function m_fnISODateString(d) {\r\n    function pad(n) {\r\n      return n < 10 ? \"0\" + n : n;\r\n    }\r\n\r\n    return (\r\n      d.getUTCFullYear() +\r\n      \"-\" +\r\n      pad(d.getUTCMonth() + 1) +\r\n      \"-\" +\r\n      pad(d.getUTCDate()) +\r\n      \"T\" +\r\n      pad(d.getUTCHours()) +\r\n      \":\" +\r\n      pad(d.getUTCMinutes()) +\r\n      \":\" +\r\n      pad(d.getUTCSeconds()) +\r\n      \"Z\"\r\n    );\r\n  }\r\n\r\n  function m_fnBindHandlerResponseDoc() {\r\n    $(\".requestInfo-response-doc img\").click(function (event) {\r\n      event.preventDefault();\r\n      var curIcon = $(this).attr(\"src\");\r\n      if (curIcon == \"/_layouts/images/minus.gif\")\r\n        $(this).attr(\"src\", \"/_layouts/images/plus.gif\");\r\n      else $(this).attr(\"src\", \"/_layouts/images/minus.gif\");\r\n\r\n      //$(this).nextUntil('tr.Grouping').slideToggle(200);\r\n      $(this)\r\n        .parent()\r\n        .parent()\r\n        .nextUntil(\"tr.requestInfo-response-doc\")\r\n        .each(function () {\r\n          $(this).toggleClass(\"collapsed\");\r\n        });\r\n    });\r\n  }\r\n\r\n  /************\r\n\tNotice - for some reason, when the list item opens in a dialog or not in the dialog, it renders differently causing the values to get back data differently\r\n\t********/\r\n  /*\r\n\tfunction m_fnGetLookupFieldText( fieldName )\r\n\t{\r\n\t\tvar field = $( \"select[title='\" + fieldName  + \"']\" );\r\n\t\t\r\n\t\tif( field == null || field.html() == null ) //more than 20 items in the lookup\r\n\t\t{\r\n\t\t\tfield = $( \"input[title='\" + fieldName  + \"']\" );\r\n\t\t\treturn field.val();\r\n\t\t}\r\n\t\telse return $(\"select[title='\" + fieldName  + \"'] option:selected\").text();\r\n\t}\r\n\r\n\t*/\r\n\r\n  function m_fnGetLookupFormField(fieldTitle) {\r\n    if ($(\"select[title='\" + fieldTitle + \"']\").html() !== null) {\r\n      return $(\"select[title='\" + fieldTitle + \"']\");\r\n    } else {\r\n      return $(\"input[title='\" + fieldTitle + \"']\");\r\n    }\r\n  }\r\n\r\n  function m_fnGetLookupDisplayText(fieldTitle) {\r\n    //Set default value for lookups with less that 20 items\r\n    if ($(\"select[title='\" + fieldTitle + \"']\").html() !== null) {\r\n      return $(\"select[title='\" + fieldTitle + \"'] option:selected\").text();\r\n    } else {\r\n      return $(\"input[title='\" + fieldTitle + \"']\").val();\r\n    }\r\n  }\r\n\r\n  function m_fnSetLookupFromFieldNameByText(fieldName, text) {\r\n    try {\r\n      if (text == undefined) return;\r\n      var theSelect = m_fnGetTagFromIdentifierAndTitle(\"select\", \"\", fieldName);\r\n\r\n      if (theSelect == null) {\r\n        var theInput = m_fnGetTagFromIdentifierAndTitle(\"input\", \"\", fieldName);\r\n        //builtin\r\n        ShowDropdown(theInput.id);\r\n        var opt = document.getElementById(theInput.opt);\r\n        m_fnSetSelectedOptionByText(opt, text);\r\n        //builtin\r\n        OptLoseFocus(opt);\r\n      } else {\r\n        m_fnSetSelectedOptionByText(theSelect, text);\r\n      }\r\n    } catch (ex) {}\r\n  }\r\n\r\n  function m_fnSetSelectedOptionByText(select, text) {\r\n    var opts = select.options;\r\n    var optLength = opts.length;\r\n    if (select == null) return;\r\n\r\n    for (var i = 0; i < optLength; i++) {\r\n      if (opts[i].text == text) {\r\n        select.selectedIndex = i;\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function m_fnGetTagFromIdentifierAndTitle(tagName, identifier, title) {\r\n    var idLength = identifier.length;\r\n    var tags = document.getElementsByTagName(tagName);\r\n    for (var i = 0; i < tags.length; i++) {\r\n      var tagID = tags[i].id;\r\n      if (\r\n        tags[i].title == title &&\r\n        (identifier == \"\" ||\r\n          tagID.indexOf(identifier) == tagID.length - idLength)\r\n      ) {\r\n        return tags[i];\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  function m_fnViewUserManuals(docType) {\r\n    var options = SP.UI.$create_DialogOptions();\r\n    options.title = \"User Manual\";\r\n    options.height = 250;\r\n    //options.dialogReturnValueCallback = OnCallbackForm;\r\n    if (docType != null)\r\n      options.url =\r\n        Audit.Common.Utilities.GetSiteUrl() +\r\n        \"/pages/AuditUserManuals.aspx?FilterField1=DocType&FilterValue1=\" +\r\n        docType;\r\n    else\r\n      options.url =\r\n        Audit.Common.Utilities.GetSiteUrl() + \"/pages/AuditUserManuals.aspx\";\r\n\r\n    SP.UI.ModalDialog.showModalDialog(options);\r\n  }\r\n\r\n  function m_fnPrintPage(pageTitle, divTbl) {\r\n    var curDate = new Date();\r\n    var siteUrl = Audit.Common.Utilities.GetSiteUrl();\r\n    var cssLink1 =\r\n      siteUrl +\r\n      \"/siteassets/css/tablesorter/style.css?v=\" +\r\n      curDate.format(\"MM_dd_yyyy\");\r\n    var cssLink2 =\r\n      siteUrl +\r\n      \"/siteAssets/css/audit_styles.css?v=\" +\r\n      curDate.format(\"MM_dd_yyyy\");\r\n\r\n    var divOutput = $(divTbl).html();\r\n\r\n    //remove hyperlinks pointing to the job codes\r\n    var updatedDivOutput = $(\"<div>\").append(divOutput);\r\n    updatedDivOutput.find(\".sr-response-title a\").each(function () {\r\n      $(this).removeAttr(\"onclick\");\r\n      $(this).removeAttr(\"href\");\r\n    });\r\n\r\n    divOutput = updatedDivOutput.html();\r\n\r\n    var printDateString = curDate.format(\"MM/dd/yyyy hh:mm tt\");\r\n    printDateString =\r\n      \"<div style='padding-bottom:10px;'>\" + printDateString + \"</div>\";\r\n    divOutput = printDateString + divOutput;\r\n\r\n    var cssFile1 = $(\"<div></div>\");\r\n    var cssFile2 = $(\"<div></div>\");\r\n\r\n    var def1 = $.Deferred();\r\n    var def2 = $.Deferred();\r\n\r\n    var cssFileText = \"\";\r\n    cssFile1.load(cssLink1, function () {\r\n      cssFileText += \"<style>\" + cssFile1.html() + \"</style>\";\r\n      def1.resolve();\r\n    });\r\n    cssFile2.load(cssLink2, function () {\r\n      cssFileText += \"<style>\" + cssFile2.html() + \"</style>\";\r\n      def2.resolve();\r\n    });\r\n\r\n    //gets called asynchronously after the css files have been loaded\r\n    $.when(def1, def2).done(function () {\r\n      var html =\r\n        \"<HTML>\\n\" +\r\n        \"<HEAD>\\n\\n\" +\r\n        \"<Title>\" +\r\n        pageTitle +\r\n        \"</Title>\\n\" +\r\n        cssFileText +\r\n        \"\\n\" +\r\n        \"<style>\" +\r\n        \".hideOnPrint, .rowFilters {display:none}\" +\r\n        \"</style>\\n\" +\r\n        \"</HEAD>\\n\" +\r\n        \"<BODY>\\n\" +\r\n        divOutput +\r\n        \"\\n\" +\r\n        \"</BODY>\\n\" +\r\n        \"</HTML>\";\r\n\r\n      var printWP = window.open(\"\", \"printWebPart\");\r\n      printWP.document.open();\r\n      //insert content\r\n      printWP.document.write(html);\r\n\r\n      printWP.document.close();\r\n      //open print dialog\r\n      printWP.print();\r\n    });\r\n  }\r\n\r\n  //make sure iframe with id csvexprframe is added to page up top\r\n  //http://stackoverflow.com/questions/18185660/javascript-jquery-exporting-data-in-csv-not-working-in-ie\r\n  function m_fnExportToCsv(fileName, tableName, removeHeader) {\r\n    var data = m_fnGetCellValues(tableName);\r\n\r\n    if (removeHeader == true) data = data.slice(1);\r\n\r\n    var csv = m_fnConvertToCsv(data);\r\n    //\tconsole.log( csv );\r\n    if (navigator.userAgent.search(\"Trident\") >= 0) {\r\n      window.CsvExpFrame.document.open(\"text/html\", \"replace\");\r\n      //\t\twindow.CsvExpFrame.document.open(\"application/csv\", \"replace\");\r\n      //\t\twindow.CsvExpFrame.document.charset = \"utf-8\";\r\n      //\t\twindow.CsvExpFrame.document.open(\"application/ms-excel\", \"replace\");\r\n      window.CsvExpFrame.document.write(csv);\r\n      window.CsvExpFrame.document.close();\r\n      window.CsvExpFrame.focus();\r\n      window.CsvExpFrame.document.execCommand(\r\n        \"SaveAs\",\r\n        true,\r\n        fileName + \".csv\"\r\n      );\r\n    } else {\r\n      var uri = \"data:text/csv;charset=utf-8,\" + escape(csv);\r\n      var downloadLink = document.createElement(\"a\");\r\n      downloadLink.href = uri;\r\n      downloadLink.download = fileName + \".csv\";\r\n      document.body.appendChild(downloadLink);\r\n      downloadLink.click();\r\n      document.body.removeChild(downloadLink);\r\n    }\r\n  }\r\n\r\n  function m_fnGetCellValues(tableName) {\r\n    var table = document.getElementById(tableName);\r\n\r\n    //remove headers and footers\r\n    if (table.innerHTML.indexOf(\"rowFilters\") >= 0) {\r\n      var deets = $(\"<div>\").append(table.outerHTML);\r\n      deets.find(\".rowFilters\").each(function () {\r\n        $(this).remove();\r\n      });\r\n      table = deets.find(\"table\")[0];\r\n    }\r\n    if (table.innerHTML.indexOf(\"footer\") >= 0) {\r\n      var deets = $(\"<div>\").append(table.outerHTML);\r\n      deets.find(\".footer\").each(function () {\r\n        $(this).remove();\r\n      });\r\n      table = deets.find(\"table\")[0];\r\n    }\r\n\r\n    var tableArray = [];\r\n    for (var r = 0, n = table.rows.length; r < n; r++) {\r\n      tableArray[r] = [];\r\n      for (var c = 0, m = table.rows[r].cells.length; c < m; c++) {\r\n        var text =\r\n          table.rows[r].cells[c].textContent ||\r\n          table.rows[r].cells[c].innerText;\r\n        tableArray[r][c] = text.trim();\r\n      }\r\n    }\r\n    return tableArray;\r\n  }\r\n\r\n  function m_fnConvertToCsv(objArray) {\r\n    var array = typeof objArray != \"object\" ? JSON.parse(objArray) : objArray;\r\n    var str = \"sep=,\\r\\n\";\r\n    var line = \"\";\r\n    var index;\r\n    var value;\r\n    for (var i = 0; i < array.length; i++) {\r\n      line = \"\";\r\n      var array1 = array[i];\r\n      for (index in array1) {\r\n        if (array1.hasOwnProperty(index)) {\r\n          value = array1[index] + \"\";\r\n          line += '\"' + value.replace(/\"/g, '\"\"') + '\",';\r\n        }\r\n      }\r\n      line = line.slice(0, -1);\r\n      str += line + \"\\r\\n\";\r\n    }\r\n    return str;\r\n  }\r\n\r\n  var publicMembers = {\r\n    GetSiteUrl: function () {\r\n      if (m_siteUrl == \"/\") return \"\";\r\n      else return m_siteUrl;\r\n    },\r\n    GetListTitleRequests: function () {\r\n      return m_listTitleRequests;\r\n    },\r\n    GetListNameRequests: function () {\r\n      return m_listNameRequests;\r\n    },\r\n    GetListTitleRequestsInternal: function () {\r\n      return m_listTitleRequestsInternal;\r\n    },\r\n    GetListNameRequestsInternal: function () {\r\n      return m_listNameRequestsInternal;\r\n    },\r\n    GetListTitleResponses: function () {\r\n      return m_listTitleResponses;\r\n    },\r\n    GetListNameResponses: function () {\r\n      return m_listNameResponses;\r\n    },\r\n    GetLibTitleRequestDocs: function () {\r\n      return m_libTitleRequestDocs;\r\n    },\r\n    GetLibNameRequestDocs: function () {\r\n      return m_libNameRequestDocs;\r\n    },\r\n    GetLibTitleCoverSheets: function () {\r\n      return m_libTitleCoverSheet;\r\n    },\r\n    GetLibNameCoverSheets: function () {\r\n      return m_libNameCoverSheet;\r\n    },\r\n    GetLibTitleResponseDocs: function () {\r\n      return m_libTitleResponseDocs;\r\n    },\r\n    GetLibNameResponseDocs: function () {\r\n      return m_libNameResponseDocs;\r\n    },\r\n    GetLibTitleResponseDocsEA: function () {\r\n      return m_libTitleResponseDocsEA;\r\n    },\r\n    GetLibNameResponseDocsEA: function () {\r\n      return m_libNameResponseDocsEA;\r\n    },\r\n    GetListTitleActionOffices: function () {\r\n      return m_listTitleActionOffices;\r\n    },\r\n    GetListNameActionOffices: function () {\r\n      return m_listNameActionOffices;\r\n    },\r\n    GetListTitleEmailHistory: function () {\r\n      return m_listTitleEmailHistory;\r\n    },\r\n    GetListNameEmailHistory: function () {\r\n      return m_listNameEmailHistory;\r\n    },\r\n    GetListTitleBulkResponses: function () {\r\n      return m_listTitleBulkResponses;\r\n    },\r\n    GetListNameBulkResponses: function () {\r\n      return m_listNameBulkResponses;\r\n    },\r\n    GetListTitleBulkPermissions: function () {\r\n      return m_listTitleBulkPermissions;\r\n    },\r\n    GetListNameBulkPermissions: function () {\r\n      return m_listNameBulkPermissions;\r\n    },\r\n    GetGroupNameSpecialPerm1: function () {\r\n      return m_groupNameSpecialPermName1;\r\n    },\r\n    GetGroupNameSpecialPerm2: function () {\r\n      return m_groupNameSpecialPermName2;\r\n    },\r\n    GetGroupNameQA: function () {\r\n      return m_groupNameQA;\r\n    },\r\n    GetGroupNameEA: function () {\r\n      return m_groupNameEA;\r\n    },\r\n    Refresh: m_fnRefresh,\r\n    OnLoadDisplayTimeStamp: m_fnOnLoadDisplayTimeStamp,\r\n    OnLoadDisplayTabAndResponse: m_fnOnLoadDisplayTabAndResponse,\r\n    OnLoadFilterResponses: function (responseStatus1, responseStatus2) {\r\n      m_fnOnLoadFilterResponses(responseStatus1, responseStatus2);\r\n    },\r\n    SetResponseDocLibGUID: function (libGUID) {\r\n      m_libResponseDocsLibraryGUID = libGUID;\r\n    },\r\n    GetResponseDocLibGUID: function () {\r\n      return m_libResponseDocsLibraryGUID;\r\n    },\r\n    LoadSiteGroups: function (itemColl) {\r\n      m_fnLoadSiteGroups(itemColl);\r\n    },\r\n    GetSPSiteGroup: function (groupName) {\r\n      return m_fnGetSPSiteGroup(groupName);\r\n    },\r\n    LoadActionOffices: function (itemColl) {\r\n      m_fnLoadActionOffices(itemColl);\r\n    },\r\n    GetActionOffices: function () {\r\n      return m_arrAOs;\r\n    },\r\n    GetAOSPGroupName: function (groupName) {\r\n      return m_fnGetAOSPGroupName(groupName);\r\n    },\r\n    CheckSPItemHasGroupPermission: function (item, groupName, permissionLevel) {\r\n      return m_fnCheckSPItemHasGroupPermission(\r\n        item,\r\n        groupName,\r\n        permissionLevel\r\n      );\r\n    },\r\n    GoToResponse: function (responseTitle, isIA) {\r\n      m_fnGoToResponse(responseTitle, isIA);\r\n    },\r\n    GetResponseDocStyleTag: function (documentStatus) {\r\n      return m_fnGetResponseDocStyleTag(documentStatus);\r\n    },\r\n    GetResponseDocStyleTag2: function (documentStatus) {\r\n      return m_fnGetResponseDocStyleTag2(documentStatus);\r\n    },\r\n    CheckIfEmailFolderExists: function (items, requestNumber) {\r\n      return m_fnCheckIfEmailFolderExists(items, requestNumber);\r\n    },\r\n    CreateEmailFolder: function (list, requestNumber, requestItem, OnComplete) {\r\n      return m_fnCreateEmailFolder(\r\n        list,\r\n        requestNumber,\r\n        requestItem,\r\n        OnComplete\r\n      );\r\n    },\r\n    AddOptions: function (arr, ddlID, dateSort, responseSort) {\r\n      m_fnAddOptions(arr, ddlID, dateSort, responseSort);\r\n    },\r\n    ExistsInArr: function (arr, val) {\r\n      return m_fnExistsInArr(arr, val);\r\n    },\r\n    GetTrueFalseIcon: function (val) {\r\n      return m_fnGetTrueFalseIcon(val);\r\n    },\r\n    PadDigits: function (n, totalDigits) {\r\n      return m_fnPadDigits(n, totalDigits);\r\n    },\r\n    PreciseRound: function (num, decimals) {\r\n      return m_fnPreciseRound(num, decimals);\r\n    },\r\n    GetFriendlyFileSize: function (fileSize) {\r\n      return m_fnGetFriendlyFileSize(fileSize);\r\n    },\r\n    GetISODateString: function (d) {\r\n      return m_fnISODateString(d);\r\n    },\r\n    GetFriendlyDisplayName: function (oListItem, fieldName) {\r\n      return m_fnGetFriendlyDisplayName(oListItem, fieldName);\r\n    },\r\n    BindHandlerResponseDoc: m_fnBindHandlerResponseDoc,\r\n    PrintStatusReport: function (pageTitle, divTbl) {\r\n      m_fnPrintPage(pageTitle, divTbl);\r\n    },\r\n    ExportToCsv: function (fileName, tableName, removeHeader) {\r\n      m_fnExportToCsv(fileName, tableName, removeHeader);\r\n    },\r\n    ViewUserManuals: function (docType) {\r\n      m_fnViewUserManuals(docType);\r\n    },\r\n    //GetLookupFieldText: function( fieldName ){ return m_fnGetLookupFieldText( fieldName); },\r\n    GetLookupDisplayText: function (fieldName) {\r\n      return m_fnGetLookupDisplayText(fieldName);\r\n    },\r\n    GetLookupFormField: function (fieldName) {\r\n      return m_fnGetLookupFormField(fieldName);\r\n    },\r\n    SetLookupFromFieldNameByText: function (fieldName, text) {\r\n      return m_fnSetLookupFromFieldNameByText(fieldName, text);\r\n    },\r\n    SortResponseObjects: function (a, b) {\r\n      return m_fnSortResponseObjectNoCase(a, b);\r\n    },\r\n    SortResponseTitles: m_fnSortResponseTitleNoCase,\r\n  };\r\n\r\n  return publicMembers;\r\n};\r\n\r\n// ExecuteOrDelayUntilScriptLoaded(InitReport, \"sp.js\");\r\nInitReport();\r\n", "const html = String.raw;\r\n\r\nexport const searchSelectTemplate = html`\r\n  <div>\r\n    <!-- Hide the element, stylesheet overrides on load -->\r\n    <style>\r\n        .search-group {\r\n        --font-sm: 0.75rem;\r\n        }\r\n\r\n        /* Testing Style HTML Elements */\r\n        .elements-container {\r\n        display: flex;\r\n        column-gap: 20px;\r\n        }\r\n        .select-container {\r\n        width: 150px;\r\n        }\r\n\r\n        /* Actual Elements */\r\n\r\n        div.search-group {\r\n        display: revert;\r\n        position: relative;\r\n        min-height: 1rem;\r\n        }\r\n\r\n        .search-input-group {\r\n        display: flex;\r\n        align-items: center;\r\n        background-color: white;\r\n        /* border: 1px solid lightgray; */\r\n        border: none;\r\n        border-radius: 4px;\r\n        box-sizing: border-box;\r\n        padding: 0;\r\n        }\r\n\r\n        .search-input-group input {\r\n        border: none;\r\n        border-radius: 4px;\r\n        width: 100%;\r\n        color: black;\r\n        padding: 0.1rem 0.3rem;\r\n        font-size: var(--font-sm);\r\n        font-family: \"Segoe UI\";\r\n        }\r\n\r\n        /* .caret {\r\n        content: \"\";\r\n        display: inline-block;\r\n        border: 4px solid transparent;\r\n        border-top-color: transparent;\r\n        border-top-color: black;\r\n        margin-left: 12px;\r\n        margin-top: 4px;\r\n        } */\r\n\r\n        .caret-bg {\r\n        background-image: url(\"#svg-caret-down\");\r\n        background-repeat: no-repeat;\r\n        min-width: 1rem;\r\n        }\r\n\r\n        .search-input-group::after {\r\n        aspect-ratio: 1 / 1;\r\n        height: 1rem;\r\n        content: \"\\276F\";\r\n        color: darkgray;\r\n        font-size: 0.7rem;\r\n        font-weight: bold;\r\n        text-align: center;\r\n        display: flex;\r\n        justify-content: center;\r\n        transition: transform 0.4s ease-in-out;\r\n        }\r\n\r\n        .search-group.active .search-input-group::after {\r\n        transform: rotate(90deg);\r\n        }\r\n\r\n        .search-input-group .vertical-spacer {\r\n        height: 85%;\r\n        min-height: 0.8rem;\r\n        border-left: 1px solid lightGray;\r\n        }\r\n        .search-input-group svg {\r\n        color: lightGray;\r\n        height: 85%;\r\n        transition-duration: 0.5s;\r\n        }\r\n\r\n        .search-group.active .search-input-group svg {\r\n        border: none;\r\n        transform: rotate(180deg);\r\n        }\r\n\r\n        .hidden {\r\n        display: none;\r\n        }\r\n\r\n        .secondary {\r\n        font-style: italic;\r\n        }\r\n\r\n        .test-toggle {\r\n        background-color: green;\r\n        }\r\n\r\n        .selected.item {\r\n        display: flex;\r\n        align-items: center;\r\n        width: fit-content;\r\n        color: #212529;\r\n        font-weight: normal;\r\n        font-size: var(--font-sm);\r\n        background-color: #f8f9fa;\r\n        border-radius: 0.25rem;\r\n        border: 1px solid #dee2e6;\r\n        /* height: 1.5rem; */\r\n        /* top right bottom left */\r\n        /* padding: 0.1rem 0rem 0.1rem 0.5rem; */\r\n        padding-left: 0.75rem;\r\n        margin-bottom: 1px;\r\n        }\r\n\r\n        .selected.item div.remove {\r\n        /* border-style: none;\r\n        border-radius: 50%; */\r\n        border-top-right-radius: 0.25rem;\r\n        border-bottom-right-radius: 0.25rem;\r\n        margin-left: 0.4rem;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        height: 100%;\r\n        width: 1rem;\r\n        color: rgb(108, 117, 125);\r\n        aspect-ratio: 1/1;\r\n        }\r\n\r\n        .selected.item div.remove:hover {\r\n        background-color: darkgrey;\r\n        color: white;\r\n        }\r\n\r\n        .selected.item div.remove svg {\r\n        height: 1.25rem;\r\n        width: 1.25rem;\r\n        }\r\n\r\n        .filtered.item {\r\n        background-color: white;\r\n        padding: 0.1rem 1rem;\r\n        font-weight: normal;\r\n        }\r\n\r\n        .filtered.item.even {\r\n        background-color: rgb(233, 233, 233);\r\n        }\r\n\r\n        .filtered.item:hover {\r\n        background-color: lightgray;\r\n        }\r\n\r\n        .filtered.item.active {\r\n        background-color: lightblue;\r\n        }\r\n\r\n        #selected-items-text {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        }\r\n\r\n        .filtered-items {\r\n        color: black;\r\n        list-style: none;\r\n        padding-left: 0;\r\n        margin-top: 3px;\r\n        /* display: none; */\r\n        position: absolute;\r\n        min-width: 100%;\r\n        max-height: 0px;\r\n        overflow-y: auto;\r\n        z-index: 1;\r\n        border: 0px solid lightgray;\r\n        box-sizing: border-box;\r\n        transition: all 0.4s ease-in-out;\r\n        }\r\n\r\n        .filtered-items.active {\r\n        /* display: block; */\r\n        max-height: 200px;\r\n        border: 1px solid lightgray;\r\n        }\r\n\r\n      .search-group {\r\n        display: none;\r\n      }\r\n    </style>\r\n    <div id=\"search-group\" class=\"search-group\" tabindex=\"-1\">\r\n      <div id=\"selected-items-text\"></div>\r\n      <div class=\"search-input-group\" tabindex=\"-1\">\r\n        <input\r\n          id=\"search-input\"\r\n          class=\"search-input\"\r\n          placeholder=\"Search...\"\r\n          type=\"text\"\r\n          autocomplete=\"off\"\r\n        />\r\n        <div class=\"vertical-spacer\"></div>\r\n      </div>\r\n      <ul id=\"filtered-items-text\" class=\"filtered-items\"></ul>\r\n    </div>\r\n    <div id=\"icons\" class=\"hidden\" style=\"display: none\">\r\n      <div id=\"icon-close\" style=\"display: none; width: 0px; height: 0px\">\r\n        <svg\r\n          style=\"display: none; max-width: 2rem; max-height: 2rem\"\r\n          class=\"position-absolute top-50 start-50 translate-middle\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n        >\r\n          <path\r\n            stroke-linecap=\"round\"\r\n            stroke-linejoin=\"round\"\r\n            stroke-width=\"2\"\r\n            d=\"M6 18L18 6M6 6l12 12\"\r\n          ></path>\r\n        </svg>\r\n      </div>\r\n      <div id=\"icon-caret-down\">\r\n        <svg\r\n          id=\"svg-caret-down\"\r\n          width=\"24px\"\r\n          height=\"24px\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n        >\r\n          <path\r\n            d=\"M6.1018 8C5.02785 8 4.45387 9.2649 5.16108 10.0731L10.6829 16.3838C11.3801 17.1806 12.6197 17.1806 13.3169 16.3838L18.8388 10.0731C19.5459 9.2649 18.972 8 17.898 8H6.1018Z\"\r\n            fill=\"#212121\"\r\n          />\r\n        </svg>\r\n      </div>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { searchSelectTemplate } from \"./SearchSelectTemplate.js\";\r\ncustomElements.define(\r\n  \"search-select\",\r\n  class extends HTMLElement {\r\n    constructor() {\r\n      super();\r\n      // const templateText = document.getElementById(\r\n      //   \"search-select-template\"\r\n      // ).innerHTML;\r\n\r\n      this.selectableItems = [];\r\n\r\n      this.attachShadow({ mode: \"open\" });\r\n\r\n      this.shadowRoot.innerHTML = searchSelectTemplate;\r\n\r\n      this.searchGroupElement = this.shadowRoot.getElementById(\"search-group\");\r\n      this.searchInputGroupElement = this.shadowRoot.querySelector(\r\n        \".search-input-group\"\r\n      );\r\n      this.searchInputElement = this.shadowRoot.getElementById(\"search-input\");\r\n      this.filteredItemsElement = this.shadowRoot.getElementById(\r\n        \"filtered-items-text\"\r\n      );\r\n\r\n      this.selectedItemsElement = this.shadowRoot.getElementById(\r\n        \"selected-items-text\"\r\n      );\r\n\r\n      this.options = this.querySelectorAll(\"option\");\r\n    }\r\n\r\n    initializeFilteredItems = () => {\r\n      this.options = this.querySelectorAll(\"option\");\r\n      this.filteredItemDivs = [...this.options].map((opt, index) => {\r\n        opt.dataset.id = index;\r\n\r\n        this.attributeChangeMutationObserver.observe(opt, {\r\n          attributes: true,\r\n        });\r\n\r\n        // opt.addEventListener(\"change\", (e) => {\r\n        //   console.log(\"option changed\");\r\n        // });\r\n\r\n        let li = document.createElement(\"li\");\r\n        li.classList.add(\"filtered\", \"item\");\r\n        li.classList.toggle(\"even\", index % 2);\r\n        //li.type = \"button\";\r\n        li.innerHTML = opt.innerHTML;\r\n        li.dataset.optionId = opt.dataset.id;\r\n        return li;\r\n      });\r\n\r\n      this.filteredItemsElement.replaceChildren(...this.filteredItemDivs);\r\n      this.updateFilteredItems();\r\n      this.updateSelectedItems(true);\r\n    };\r\n\r\n    updateFilteredItems = () => {\r\n      // Filter based off the search input\r\n      const searchText = this.searchInputElement.value;\r\n      this.filteredItemDivs.forEach((opt) => {\r\n        const optContainsText =\r\n          opt.innerText.toLowerCase().search(searchText.toLowerCase()) >= 0;\r\n\r\n        const shouldBeShown = !searchText || optContainsText;\r\n        opt.classList.toggle(\"hidden\", !shouldBeShown);\r\n      });\r\n\r\n      // Filter based off already selected items\r\n      [...this.options]\r\n        .filter((opt) => opt.hasAttribute(\"selected\"))\r\n        .map((opt) => {\r\n          this.filteredItemDivs\r\n            .find((div) => div.dataset.optionId === opt.dataset.id)\r\n            .classList.add(\"hidden\");\r\n        });\r\n\r\n      var count = [\r\n        ...this.filteredItemsElement.querySelectorAll(\"li:not(.hidden)\"),\r\n      ].map((li, index) => li.classList.toggle(\"even\", index % 2));\r\n\r\n      // Finally, if all items are selected, deactivate dropdown\r\n      //this.filteredItemsElement.classList.toggle(\"active\", count.length);\r\n      //console.log(\"updated filtered items\");\r\n    };\r\n\r\n    updateActiveFilteredItem = (keyDirection) => {\r\n      // We have used our arrow keys to navigate to an item\r\n      // Check that all our items are still visible\r\n      const visibleItems = this.filteredItemDivs.find(\r\n        (opt) => !opt.classList.contains(\"hidden\")\r\n      );\r\n      if (!visibleItems) {\r\n        return;\r\n      }\r\n\r\n      // find the currently active item\r\n      const activeItemIndex = this.filteredItemDivs.findIndex((opt) =>\r\n        opt.classList.contains(\"active\")\r\n      );\r\n\r\n      let index = activeItemIndex + keyDirection;\r\n      let item;\r\n\r\n      do {\r\n        if (index >= this.filteredItemDivs.length) {\r\n          index = 0;\r\n        }\r\n        // Iterate through the items until we find the next one that isn't hidden\r\n        item = this.filteredItemDivs.at(index);\r\n        index += keyDirection;\r\n      } while (item.classList.contains(\"hidden\"));\r\n\r\n      item.classList.add(\"active\");\r\n      if (activeItemIndex >= 0) {\r\n        this.filteredItemDivs[activeItemIndex].classList.remove(\"active\");\r\n      }\r\n    };\r\n\r\n    selectActiveFilteredItem = () => {\r\n      // We have hit enter after navigating to an item in our list\r\n      // find the currently active item\r\n      const activeItem = this.filteredItemDivs.find((opt) =>\r\n        opt.classList.contains(\"active\")\r\n      );\r\n\r\n      if (activeItem) {\r\n        this.selectFilteredItem(activeItem);\r\n        this.updateActiveFilteredItem(1);\r\n      }\r\n    };\r\n\r\n    updateSelectedItems = (initial = false) => {\r\n      this.selectedOptions = [...this.options].filter((opt) =>\r\n        opt.hasAttribute(\"selected\")\r\n      );\r\n\r\n      const closeCopy = this.shadowRoot.getElementById(\"icon-close\").innerHTML;\r\n      // const closeCopy = document.createElement(\"img\");\r\n      // closeCopy.setAttribute(\"src\", \"./icon/close.svg\");\r\n\r\n      const selectedItemDivs = this.selectedOptions.map((opt) => {\r\n        // const itemGroup = document.createElement(\"div\");\r\n        // itemGroup.classList.add(\"input-group\", \"input-group-sm\");\r\n        // itemGroup.dataset.value = opt.value;\r\n\r\n        // let itemText = document.createElement(\"div\");\r\n        // itemText.classList.add(\"input-group-text\");\r\n        // itemText.innerText = opt.innerHTML;\r\n\r\n        // const itemClose = document.createElement(\"button\");\r\n        // itemClose.classList.add(\"btn\", \"btn-sm\", \"btn-outline-secondary\");\r\n        // itemClose.style.width = \"1.5rem\";\r\n        // itemClose.innerHTML = closeCopy;\r\n\r\n        // itemGroup.appendChild(itemText);\r\n        // // itemGroup.append(itemText, itemClose);\r\n        // itemGroup.appendChild(itemClose);\r\n        // return itemGroup;\r\n        const itemGroup = document.createElement(\"div\");\r\n        itemGroup.classList.add(\"selected\", \"item\");\r\n        itemGroup.dataset.optionId = opt.dataset.id;\r\n\r\n        const itemText = document.createElement(\"div\");\r\n        // itemText.classList.add(\"input-group-text\");\r\n        itemText.innerText = opt.innerHTML;\r\n\r\n        // Append our close button\r\n        const close = document.createElement(\"div\");\r\n        close.classList.add(\"remove\");\r\n\r\n        //Add our svg close button\r\n        close.innerHTML = closeCopy;\r\n\r\n        itemGroup.appendChild(itemText);\r\n        itemGroup.appendChild(close);\r\n        return itemGroup;\r\n      });\r\n      this.selectedItemsElement.replaceChildren(...selectedItemDivs);\r\n      for (const svg of this.selectedItemsElement.getElementsByTagName(\"svg\")) {\r\n        svg.style.display = \"revert\";\r\n      }\r\n\r\n      if (!initial) {\r\n        this.dispatchEvent(new Event(\"change\"));\r\n      }\r\n    };\r\n\r\n    selectFilteredItem = (item) => {\r\n      if (!item) return;\r\n      // We have clicked or otherwise selected an item.\r\n      [...this.options]\r\n        .find((opt) => opt.dataset.id === item.dataset.optionId)\r\n        .setAttribute(\"selected\", \"\");\r\n    };\r\n\r\n    removeSelectedItem = (item) => {\r\n      if (!item) return;\r\n      // We are removing an item from our selected items\r\n      [...this.options]\r\n        .find((opt) => opt.dataset.id === item.dataset.optionId)\r\n        .removeAttribute(\"selected\");\r\n      this.updateSelectedItems();\r\n      this.updateFilteredItems();\r\n    };\r\n\r\n    connectedCallback() {\r\n      // Child node added mutation listener\r\n      const mutationCallback = (mutationList, observer) => {\r\n        for (const mutation of mutationList) {\r\n          if (mutation.type === \"childList\") {\r\n            this.initializeFilteredItems();\r\n          }\r\n        }\r\n      };\r\n\r\n      const attributeChangeMutationCallback = (mutationList, observer) => {\r\n        for (const mutation of mutationList) {\r\n          if (mutation.type === \"attributes\") {\r\n            // console.log(\r\n            //   `The ${mutation.attributeName} attribute was modified.`\r\n            // );\r\n            this.updateSelectedItems();\r\n            this.updateFilteredItems();\r\n          }\r\n        }\r\n      };\r\n\r\n      this.attributeChangeMutationObserver = new MutationObserver(\r\n        attributeChangeMutationCallback\r\n      );\r\n\r\n      this.mutationObserver = new MutationObserver(mutationCallback);\r\n      this.mutationObserver.observe(this, {\r\n        attributes: true,\r\n        childList: true,\r\n      });\r\n\r\n      this.filteredItemsElement.classList.toggle(\"active\", false);\r\n      this.initializeFilteredItems();\r\n\r\n      this.searchGroupElement.addEventListener(\"focusin\", (e) => {\r\n        //console.log(this.getAttribute(\"name\") + \" Adding active\");\r\n        this.filteredItemsElement.classList.toggle(\"active\", true);\r\n        this.searchGroupElement.classList.toggle(\"active\", true);\r\n        clearTimeout(this.focusOutTimeout);\r\n      });\r\n\r\n      this.searchGroupElement.addEventListener(\"focusout\", (e) => {\r\n        //console.log(this.getAttribute(\"name\") + \" focused out by \", e.target);\r\n\r\n        this.focusOutTimeout = setTimeout(() => {\r\n          //console.log(this.getAttribute(\"name\") + \" Removing active\");\r\n          this.filteredItemsElement.classList.remove(\"active\");\r\n          this.searchGroupElement.classList.remove(\"active\");\r\n        }, 0);\r\n      });\r\n\r\n      this.searchInputElement.addEventListener(\"input\", (e) => {\r\n        // console.log(\"search-select: \", e);\r\n        e.preventDefault();\r\n        //this.dispatchEvent(new Event(\"input\"));\r\n        this.searchText = this.searchInputElement.value;\r\n        this.updateFilteredItems();\r\n      });\r\n\r\n      this.searchInputElement.addEventListener(\"focusout\", (e) => {\r\n        //console.log(\r\n        //this.getAttribute(\"name\") + \" input focused out by \", e.target;\r\n        //);\r\n      });\r\n\r\n      this.searchGroupElement.addEventListener(\"keydown\", (e) => {\r\n        // get the key\r\n        switch (e.code) {\r\n          case \"Tab\":\r\n            // tab\r\n            //this.filteredItemsElement.style.display = \"none\";\r\n            this.filteredItemsElement.classList.remove(\"active\");\r\n            break;\r\n          case \"ArrowDown\":\r\n            // down arrow\r\n            this.updateActiveFilteredItem(1);\r\n            break;\r\n          case \"ArrowUp\":\r\n            // up arrow\r\n            this.updateActiveFilteredItem(-1);\r\n            break;\r\n          case \"Enter\":\r\n            // Enter\r\n            this.handlingClick = true;\r\n            this.selectActiveFilteredItem();\r\n            break;\r\n          default:\r\n          // console.log(e.keyCode);\r\n        }\r\n      });\r\n\r\n      this.filteredItemsElement.addEventListener(\"click\", (e) => {\r\n        // console.log(\"clicked \" + e.target.innerHTML);\r\n        this.selectFilteredItem(e.target);\r\n      });\r\n\r\n      this.selectedItemsElement.addEventListener(\"click\", (e) => {\r\n        this.removeSelectedItem(e.target.closest(\"div.item\"));\r\n      });\r\n\r\n      // this.searchGroupElement.style.display = \"revert\";\r\n    }\r\n\r\n    disconnectedCallback() {\r\n      try {\r\n        // this.searchGroupElement.removeEventListener();\r\n        // this.filteredItemsElement.removeEventListener();\r\n        // this.searchInputElement.removeEventListener();\r\n        // this.removeEventListener();\r\n        this.mutationObserver.disconnect();\r\n        this.attributeChangeMutationObserver.disconnect();\r\n      } catch (e) {\r\n        console.warn(\"cannot remove event listeners\");\r\n      }\r\n    }\r\n  }\r\n);\r\n", "customElements.define(\r\n  \"data-table\",\r\n  class DataTable extends HTMLTableElement {\r\n    constructor() {\r\n      const self = super();\r\n      this.table = self;\r\n      this.head = this.table.querySelector(\"thead\");\r\n      this.body = this.table.querySelector(\"tbody\");\r\n      // this.rows = this.body.rows;\r\n      // this.connectedCallback();\r\n    }\r\n\r\n    onFilterEventHandler = (e) => {\r\n      [...this.table.querySelectorAll(\"tbody tr.hidden\")].map((row) =>\r\n        row.classList.remove(\"hidden\")\r\n      );\r\n\r\n      [...this.table.querySelectorAll(\"tbody td.filtered\")].map((cell) =>\r\n        cell.closest(\"tr\").classList.add(\"hidden\")\r\n      );\r\n\r\n      this.filteredCntElement.innerText = this.table.querySelectorAll(\r\n        \"tbody tr:not(.hidden)\"\r\n      ).length;\r\n    };\r\n\r\n    onSearchEventHandler = (e) => {\r\n      [...this.table.querySelectorAll(\"tbody tr:not(.hidden)\")].map((row) =>\r\n        row.classList.add(\"hidden\")\r\n      );\r\n\r\n      [...this.table.querySelectorAll(\"tbody td.included\")].map((cell) =>\r\n        cell.closest(\"tr\").classList.remove(\"hidden\")\r\n      );\r\n      //updateFilters()\r\n    };\r\n\r\n    onSortEventHandler = (e) => {\r\n      const headerCells = this.table.querySelectorAll(\"thead th.sorter-true\");\r\n\r\n      let sortOrder = 0;\r\n      let sortIndex = 0;\r\n      for (const th of headerCells) {\r\n        const cellIndex = th.cellIndex;\r\n        const classList = th.classList;\r\n        const i = th.querySelector(\"i\");\r\n        i.classList.remove(\"fa-sort-down\", \"fa-sort-up\", \"fa-sort\");\r\n\r\n        if (classList.contains(\"desc\")) {\r\n          i.classList.add(\"fa-sort-down\");\r\n          sortOrder = 1;\r\n          sortIndex = cellIndex;\r\n        } else if (classList.contains(\"asc\")) {\r\n          i.classList.add(\"fa-sort-up\");\r\n          sortOrder = -1;\r\n          sortIndex = cellIndex;\r\n        } else {\r\n          i.classList.add(\"fa-sort\");\r\n        }\r\n      }\r\n\r\n      if (!sortOrder) return;\r\n\r\n      var collator = new Intl.Collator([], { numeric: true });\r\n      const rowsArr = [...this.table.querySelectorAll(\"tbody tr\")];\r\n\r\n      rowsArr.sort((tr1, tr2) => {\r\n        const tr1Text = tr1.cells[sortIndex].textContent;\r\n        const tr2Text = tr2.cells[sortIndex].textContent;\r\n        //const comp = tr1Text.localeCompare(tr2Text)\r\n        const comp = collator.compare(tr1Text, tr2Text);\r\n        return comp * sortOrder;\r\n      });\r\n\r\n      this.table.querySelector(\"tbody\").append(...rowsArr);\r\n    };\r\n\r\n    createSortListeners = () => {\r\n      const headerCells = this.table.querySelectorAll(\"thead th.sorter-true\");\r\n\r\n      for (const th of headerCells) {\r\n        if (th.querySelector(\"i[class*=fa-sort\")) return;\r\n        // Add our sort icon\r\n        let i = document.createElement(\"i\");\r\n        i.classList.add(\"fa-solid\", \"fa-sort\");\r\n\r\n        th.append(i);\r\n\r\n        // Add the onclick event listener\r\n\r\n        th.addEventListener(\"click\", (e) => {\r\n          const headerCells = this.table.querySelectorAll(\r\n            \"thead th.sorter-true\"\r\n          );\r\n          const cellIndex = th.cellIndex;\r\n          // Reset our other sort icons\r\n          for (const otherTh of headerCells) {\r\n            if (!otherTh.classList.contains(\"sorter-true\")) continue;\r\n\r\n            if (otherTh != th) {\r\n              otherTh.classList.remove(\"asc\", \"desc\");\r\n              otherTh\r\n                .querySelector(\"i\")\r\n                .classList.remove(\"fa-sort-up\", \"fa-sort-down\");\r\n              otherTh.querySelector(\"i\").classList.add(\"fa-sort\");\r\n            }\r\n          }\r\n\r\n          th.querySelector(\"i\").classList.remove(\"fa-sort\");\r\n\r\n          let sortOrder = 0;\r\n          const classList = th.classList;\r\n          if (classList.contains(\"desc\")) {\r\n            //   th.querySelector(\"i\").classList.replace(\"fa-sort-down\", \"fa-sort-up\");\r\n            classList.replace(\"desc\", \"asc\");\r\n            //   sortOrder = -1;\r\n          } else if (classList.contains(\"asc\")) {\r\n            //   th.querySelector(\"i\").classList.replace(\"fa-sort-up\", \"fa-sort-down\");\r\n            classList.replace(\"asc\", \"desc\");\r\n            //   sortOrder = 1;\r\n          } else {\r\n            //   th.querySelector(\"i\").classList.add(\"fa-sort-down\");\r\n            classList.add(\"desc\");\r\n            //   sortOrder = 1;\r\n          }\r\n\r\n          const event = new Event(\"sort\");\r\n          this.table.dispatchEvent(event);\r\n\r\n          return;\r\n          var collator = new Intl.Collator([], { numeric: true });\r\n          const rowsArr = [...this.rows];\r\n          rowsArr.sort((tr1, tr2) => {\r\n            const tr1Text = tr1.cells[cellIndex].textContent;\r\n            const tr2Text = tr2.cells[cellIndex].textContent;\r\n            //const comp = tr1Text.localeCompare(tr2Text)\r\n            const comp = collator.compare(tr1Text, tr2Text);\r\n            return comp * sortOrder;\r\n          });\r\n\r\n          this.body.append(...rowsArr);\r\n        });\r\n      }\r\n    };\r\n\r\n    createFilters = () => {\r\n      const filterTypes = {\r\n        checkbox: checkboxElement,\r\n        daterange: dateRangeElement,\r\n        multiselect: multiselectElement,\r\n        search: searchElement,\r\n      };\r\n\r\n      let filters = [];\r\n\r\n      this.table.querySelectorAll(\"[data-filter]\").forEach((filterCell) => {\r\n        //   const index = [...filterCell.parentElement.children].indexOf(filterCell);\r\n        const index = filterCell.cellIndex;\r\n\r\n        const filterType = filterTypes[filterCell.dataset.filter];\r\n\r\n        if (filterType) {\r\n          const filter = new filterType(\r\n            this.table,\r\n            index,\r\n            filterCell.dataset.filterText\r\n          );\r\n          filterCell.replaceChildren(filter.element);\r\n          filters.push(filter);\r\n          if (filterCell.dataset.filterValue) {\r\n            filter.setFilter(filterCell.dataset.filterValue);\r\n          }\r\n        }\r\n      });\r\n\r\n      return filters;\r\n    };\r\n\r\n    filterByColIndex = (col, value) => {\r\n      const th = this.table.querySelector(\r\n        `tr.rowFilters th:nth-of-type(${col + 1})`\r\n      );\r\n      // if (!(\"filterValue\" in th.dataset))\r\n\r\n      th.dataset.filterValue = value;\r\n      this.update();\r\n    };\r\n\r\n    createExportOptions = () => {\r\n      // const tr = document.createElement(\"tr\");\r\n      // const cell = document.createElement(\"th\");\r\n      // cell.setAttribute(\r\n      //   \"colspan\",\r\n      //   this.table.querySelector(\"tr\").children.length\r\n      // );\r\n\r\n      const div = document.createElement(\"div\");\r\n      div.classList.add(\"export-options\", \"quick-links\", \"secondary\");\r\n\r\n      const printButton = document.createElement(\"button\");\r\n      printButton.setAttribute(\"type\", \"button\");\r\n      printButton.setAttribute(\"title\", \"Click here to Print\");\r\n      printButton.classList.add(\"btn\", \"btn-link\");\r\n      printButton.innerHTML = `<i class=\"fa-solid fa-print\"></i>`;\r\n      printButton.addEventListener(\"click\", () => {\r\n        PrintPage(this.table.parentElement);\r\n      });\r\n\r\n      const exportButton = document.createElement(\"button\");\r\n      exportButton.setAttribute(\"type\", \"button\");\r\n      exportButton.setAttribute(\"title\", \"Export to CSV\");\r\n      exportButton.classList.add(\"btn\", \"btn-link\");\r\n      exportButton.innerHTML = `<i class=\"fa-solid fa-file-csv\"></i>`;\r\n      exportButton.addEventListener(\"click\", () => {\r\n        const fileName =\r\n          this.table.dataset.filePrefix + new Date().format(\"yyyyMMdd_hhmmtt\");\r\n        exportTableToCsv(fileName, this.table);\r\n      });\r\n\r\n      div.append(printButton, exportButton);\r\n      // div.innerHTML = `<div>\r\n      // <button type=\"button\" title=\"Print Table\" class=\"btn btn-link\"><i class=\"fa-solid fa-print\"></i></button>\r\n      // <button type=\"button\" title=\"Export CSV\" class=\"btn btn-link\"><i class=\"fa-solid fa-file-csv\"></i></button>\r\n      // </div>`;\r\n\r\n      // tr.append(cell);\r\n\r\n      // const tfoot =\r\n      //   this.table.querySelector(\"tfoot\") ??\r\n      //   this.table.append(document.createElement(\"tfoot\"));\r\n\r\n      // tfoot.append(tr);\r\n      this.table.before(div);\r\n    };\r\n\r\n    createRowCount = () => {\r\n      const tr = document.createElement(\"tr\");\r\n      const cell = document.createElement(\"th\");\r\n      cell.setAttribute(\r\n        \"colspan\",\r\n        this.table.querySelector(\"tr\").children.length\r\n      );\r\n\r\n      // cell.innerHTML = `Displaying\r\n      // <span\r\n      //   class=\"table-count filtered-count\"\r\n      //   >0</span\r\n      // >\r\n      // out of\r\n      // <span\r\n      //   class=\"table-count total-count\"\r\n      //   >0</span\r\n      // > items\r\n      // `;\r\n\r\n      this.filteredCntElement = document.createElement(\"span\");\r\n      this.filteredCntElement.classList.add(\"table-count\", \"filtered-count\");\r\n\r\n      this.totalCntElement = document.createElement(\"span\");\r\n      this.totalCntElement.classList.add(\"table-count\", \"total-count\");\r\n\r\n      cell.append(\r\n        \"Displaying \",\r\n        this.filteredCntElement,\r\n        \" out of \",\r\n        this.totalCntElement,\r\n        \" items\"\r\n      );\r\n      tr.append(cell);\r\n\r\n      let tfoot = this.table.querySelector(\"tfoot\");\r\n      if (!tfoot) {\r\n        tfoot = document.createElement(\"tfoot\");\r\n        this.table.append(tfoot);\r\n      }\r\n\r\n      tfoot.append(tr);\r\n    };\r\n\r\n    updateCounts = () => {\r\n      const itemCount = this.table.querySelectorAll(\"tbody tr\").length;\r\n\r\n      // this.filteredCntElement.innerText = itemCount;\r\n      this.totalCntElement.innerText = itemCount;\r\n      this.rowCount = itemCount;\r\n      this.colCount = this.table.querySelectorAll(\"thead > tr th\").length;\r\n    };\r\n\r\n    //   search = (searchTerm) => {\r\n    //     //remove our search designator from all items\r\n    //     [...this.querySelectorAll(\".included\")].map((cell) =>\r\n    //       cell.classList.remove(\"included\")\r\n    //     );\r\n\r\n    //     let includedCells = [];\r\n    //     this.filters.map(\r\n    //       (filter) =>\r\n    //         (includedCells = includedCells.concat(filter.search(searchTerm)))\r\n    //     );\r\n\r\n    //     includedCells.map((cell) => cell.classList.add(\"included\"));\r\n\r\n    //     const searchEvent = new Event(\"search\");\r\n    //     this.table.dispatchEvent(searchEvent);\r\n    //   };\r\n\r\n    update = () => {\r\n      this.isUpdating = true;\r\n      this.filters = this.createFilters();\r\n      this.createSortListeners();\r\n\r\n      this.onSortEventHandler();\r\n      this.onFilterEventHandler();\r\n\r\n      this.updateCounts();\r\n    };\r\n\r\n    init = () => {\r\n      this.createExportOptions();\r\n      this.createRowCount();\r\n      this.update();\r\n      // run our sort for pre-sorted fields\r\n    };\r\n\r\n    connectedCallback() {\r\n      // const rowsArr = [...this.rows];\r\n\r\n      /* TODO: \r\n        - Column Sorting and \r\n        - row count changes trigger select updates\r\n        - implement search feature\r\n        */\r\n\r\n      let tableSearchEventListener = this.table.addEventListener(\r\n        \"search\",\r\n        (e) => this.onSearchEventHandler(e)\r\n      );\r\n\r\n      // Track our column level filters, includes filter element and other column filter methods\r\n      let tableFilterEventListener = this.table.addEventListener(\r\n        \"filter\",\r\n        (e) => this.onFilterEventHandler(e)\r\n      );\r\n\r\n      let sortEventListener = this.table.addEventListener(\"sort\", (e) => {\r\n        this.isUpdating = true;\r\n        this.onSortEventHandler(e);\r\n      });\r\n\r\n      this.init();\r\n\r\n      // TO LISTEN TO DOM CHANGES, UNCOMMENT BELOW LINES\r\n      // const headerMutationCallback = (mutationList, observer) => {\r\n      //   // This table manages a limited set of nodes:\r\n      //   // search input filters: thead tr\r\n      //   // sort function: tbody tr\r\n      //   if (this.isUpdating) {\r\n      //     this.isUpdating = false;\r\n      //     return;\r\n      //   } else {\r\n      //     this.update();\r\n      //   }\r\n      // };\r\n\r\n      // this.headerMutationObserver = new MutationObserver(\r\n      //   headerMutationCallback\r\n      // );\r\n\r\n      // this.headerMutationObserver.observe(\r\n      //   this.table.querySelector(\"thead > tr\"),\r\n      //   {\r\n      //     childList: true,\r\n      //   }\r\n      // );\r\n      // this.headerMutationObserver.observe(this.table.querySelector(\"tbody\"), {\r\n      //   childList: true,\r\n      // });\r\n    }\r\n\r\n    disconnectedCallback() {\r\n      try {\r\n        this.headerMutationObserver.disconnect();\r\n        // this.bodyMutationCallback.disconnect();\r\n      } catch (e) {\r\n        console.warn(\"failed to disconnect data-table\");\r\n      }\r\n    }\r\n  },\r\n  { extends: \"table\" }\r\n);\r\n\r\nconst MAX_TIMESTAMP = 8640000000000000;\r\n\r\nfunction dateRangeElement(tbl, colIndex, text) {\r\n  const datesChangeHandler = (e) => {\r\n    filter(dateStartElement.value, dateEndElement.value);\r\n\r\n    const event = new Event(\"filter\");\r\n    tbl.dispatchEvent(event);\r\n  };\r\n  const dateStartElement = document.createElement(\"input\");\r\n  dateStartElement.setAttribute(\"type\", \"date\");\r\n  dateStartElement.classList.add(\"form-control\", \"small\");\r\n  const labelFrom = document.createElement(\"label\");\r\n  labelFrom.append(\"From: \", dateStartElement);\r\n  labelFrom.setAttribute(\"title\", \"Filter Start Date\");\r\n\r\n  dateStartElement.addEventListener(\"change\", datesChangeHandler);\r\n\r\n  const dateEndElement = document.createElement(\"input\");\r\n  dateEndElement.setAttribute(\"type\", \"date\");\r\n  dateEndElement.classList.add(\"form-control\", \"small\");\r\n  const labelTo = document.createElement(\"label\");\r\n  labelTo.append(\"To: \", dateEndElement);\r\n  labelTo.setAttribute(\"title\", \"Filter End Date\");\r\n\r\n  dateEndElement.addEventListener(\"change\", datesChangeHandler);\r\n\r\n  const clearButton = document.createElement(\"button\");\r\n  clearButton.setAttribute(\"title\", \"Clear Filter\");\r\n  clearButton.setAttribute(\"type\", \"button\");\r\n  clearButton.classList.add(\"btn\", \"btn-link\");\r\n  clearButton.append(\"clear filters\");\r\n  clearButton.addEventListener(\"click\", clearDateInputs);\r\n\r\n  function clearDateInputs() {\r\n    dateStartElement.value = dateStartElement.defaultValue;\r\n    dateEndElement.value = dateEndElement.defaultValue;\r\n\r\n    datesChangeHandler();\r\n  }\r\n\r\n  const inputsContainer = document.createElement(\"div\");\r\n  inputsContainer.append(labelFrom, labelTo, clearButton);\r\n  inputsContainer.classList.add(\"filter-inputs\");\r\n\r\n  const filtersContainer = document.createElement(\"div\");\r\n\r\n  const presetsSelect = document.createElement(\"select\");\r\n  presetsSelect.innerHTML = `\r\n  <option value=\"\">Select...</option>\r\n  <option value=\"week\">Last 7 Days</option>\r\n  <option value=\"month\">This Month</option>\r\n  <option value=\"quarter\">This Quarter</option>\r\n  <option value=\"custom\">Custom</option>\r\n  `;\r\n  presetsSelect.classList.add(\"form-select\", \"small\");\r\n\r\n  presetsSelect.addEventListener(\"change\", (e) => {\r\n    let ds = new Date();\r\n    ds.setHours(0, 0, 0, 0);\r\n\r\n    const de = new Date();\r\n    de.setHours(0, 0, 0, 0);\r\n\r\n    switch (e.target.value) {\r\n      case \"\":\r\n        clearDateInputs();\r\n        inputsContainer.classList.remove(\"active\");\r\n        return;\r\n      case \"week\":\r\n        ds = new Date(ds.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        break;\r\n      case \"month\":\r\n        ds.setDate(1);\r\n        de.setMonth(de.getMonth() + 1);\r\n        de.setDate(0);\r\n        break;\r\n      case \"quarter\":\r\n        ds.setDate(1);\r\n        let dmonth = ds.getMonth();\r\n        if (dmonth <= 2) {\r\n          ds.setMonth(0);\r\n          de.setMonth(3);\r\n        } else if (dmonth <= 5) {\r\n          ds.setMonth(3);\r\n          de.setMonth(6);\r\n        } else if (dmonth <= 8) {\r\n          ds.setMonth(6);\r\n          de.setMonth(9);\r\n        } else if (dmonth <= 11) {\r\n          ds.setMonth(9);\r\n          de.setMonth(12);\r\n        }\r\n        de.setDate(0);\r\n        break;\r\n      default:\r\n        // \"Custom\" date ranges case\r\n        inputsContainer.classList.add(\"active\");\r\n        return;\r\n    }\r\n\r\n    inputsContainer.classList.add(\"active\");\r\n\r\n    dateStartElement.value = ds.toISOString().split(\"T\")[0];\r\n    dateEndElement.value = de.toISOString().split(\"T\")[0];\r\n\r\n    // presetsSelect.value = \"\";\r\n    datesChangeHandler();\r\n  });\r\n\r\n  filtersContainer.append(presetsSelect, inputsContainer);\r\n  filtersContainer.classList.add(\"filter-date-range\");\r\n\r\n  const cells = [\r\n    ...tbl.querySelectorAll(`tbody tr td:nth-of-type(${colIndex + 1})`),\r\n  ];\r\n\r\n  const filter = (dateStart, dateEnd = null) => {\r\n    dateStart = dateStart ? new Date(dateStart) : new Date(0);\r\n    dateEnd = dateEnd ? new Date(dateEnd) : new Date(MAX_TIMESTAMP);\r\n\r\n    cells.map((cell) => {\r\n      const val = cell.innerText.trim();\r\n      if (!val) return;\r\n      const cellDate = new Date(val);\r\n      cell.classList.toggle(\r\n        \"filtered\",\r\n        !(dateStart <= cellDate && cellDate <= dateEnd)\r\n      );\r\n    });\r\n  };\r\n\r\n  const search = (searchTerm) => searchCells(cells, searchTerm);\r\n\r\n  return {\r\n    element: filtersContainer,\r\n    search,\r\n    filter,\r\n  };\r\n}\r\n\r\nfunction searchElement(tbl, col, text) {\r\n  // const rows = tbl.tbody.rows;\r\n  const rows = tbl.querySelectorAll(\"tbody tr\");\r\n\r\n  const inputElem = document.createElement(\"input\");\r\n  inputElem.classList.add(\r\n    \"border\",\r\n    \"border-lightGray\",\r\n    \"rounded\",\r\n    \"w-[90%]\",\r\n    \"form-control\",\r\n    \"small\"\r\n  );\r\n  inputElem.setAttribute(\"placeholder\", \"Search...\");\r\n\r\n  const cells = [];\r\n  for (let i = 0; i < rows.length; i++) {\r\n    const cell = rows[i].getElementsByTagName(\"td\")[col];\r\n    cells.push(cell);\r\n  }\r\n\r\n  inputElem.addEventListener(\"keyup\", (e) => {\r\n    //cells.map(cell => cell.classList.remove('filtered'))\r\n    const searchTerm = e.target.value;\r\n\r\n    filter(searchTerm);\r\n\r\n    const event = new Event(\"filter\");\r\n    tbl.dispatchEvent(event);\r\n  });\r\n\r\n  const search = (searchTerm) => searchCells(cells, searchTerm);\r\n  const filter = (filterTerm) => filterCells(cells, filterTerm);\r\n\r\n  //function search(searchVal) {\r\n  //    cells.forEach(cell => {\r\n  //        const val = cell.innerHTML.toString().toLowerCase()\r\n  //        if (!val.includes(searchVal)) {\r\n  //            cell.classList.add('filtered')\r\n  //        } else {\r\n  //            cell.classList.remove('filtered')\r\n  //        }\r\n  //    })\r\n  //}\r\n\r\n  return {\r\n    element: inputElem,\r\n    search,\r\n    filter,\r\n  };\r\n}\r\n\r\nfunction checkboxElement(tbl, colIndex, text) {\r\n  // const rows = tbl.tbody.rows;\r\n  const rows = tbl.querySelectorAll(\"tbody tr\");\r\n\r\n  const inputElem = document.createElement(\"input\");\r\n  inputElem.classList.add(\"form-check-input\", \"small\");\r\n  inputElem.setAttribute(\"type\", \"checkbox\");\r\n  inputElem.setAttribute(\"autocomplete\", \"off\");\r\n  inputElem.checked = \"true\";\r\n\r\n  const cells = [];\r\n  for (let i = 0; i < rows.length; i++) {\r\n    const cell = rows[i].getElementsByTagName(\"td\")[colIndex];\r\n    cells.push(cell);\r\n  }\r\n\r\n  inputElem.addEventListener(\"change\", (e) => {\r\n    //cells.map(cell => cell.classList.remove('filtered'))\r\n    const searchTerm = e.target.checked ? \"true\" : \"false\";\r\n\r\n    filter(e.target.checked);\r\n\r\n    const event = new Event(\"filter\");\r\n    tbl.dispatchEvent(event);\r\n  });\r\n\r\n  const filter = (isChecked) => filterCheckBoxCells(cells, isChecked);\r\n  const search = (searchTerm) => searchCells(cells, searchTerm);\r\n\r\n  return {\r\n    element: inputElem,\r\n    search,\r\n    filter,\r\n  };\r\n}\r\n\r\nfunction multiselectElement(tbl, colIndex, text) {\r\n  // const rows = tbl.tbody.rows;\r\n  const rows = tbl.querySelectorAll(\"tbody tr\");\r\n\r\n  const selectElem = document.createElement(\"search-select\");\r\n  selectElem.setAttribute(\"multiple\", true);\r\n  selectElem.classList.add(\"multiple\");\r\n\r\n  let cells = [\r\n    ...tbl.querySelectorAll(`tbody tr td:nth-of-type(${colIndex + 1})`),\r\n  ];\r\n  const selectVals = new Set();\r\n\r\n  function populateOptions() {\r\n    // Add our clear value\r\n    //const opt = document.createElement('option')\r\n    //opt.value = \"\"\r\n    //opt.innerHTML = \"Select...\";\r\n    //selectElem.appendChild(opt)\r\n\r\n    cells.map((cell) => {\r\n      if (cell.innerText) selectVals.add(cell.innerText.trim());\r\n    });\r\n\r\n    // for (const row of rows) {\r\n    //   const cell = row.getElementsByTagName(\"td\")[colIndex];\r\n    //   if (!cell) return;\r\n    //   cells.push(cell);\r\n    //   const val = cell.innerText;\r\n    //   if (val) {\r\n    //     selectVals.add(val);\r\n    //   }\r\n    // }\r\n\r\n    const opts = [...selectVals].sort().map((val) => {\r\n      const opt = document.createElement(\"option\");\r\n      opt.value = val;\r\n      opt.innerText = val;\r\n      return opt;\r\n    });\r\n\r\n    selectElem.replaceChildren(...opts);\r\n  }\r\n\r\n  function tblRowsUpdate() {\r\n    console.log(\"Rows added to table\");\r\n    for (let i = 0; i < rows.length; i++) {\r\n      if (rows[i].classList.contains(\"hidden\")) {\r\n        selectVals.delete(cells[i].innerHTML);\r\n      } else {\r\n        selectVals.add(cells[i].innerHTML);\r\n      }\r\n    }\r\n\r\n    [...selectVals].sort().forEach((val) => {\r\n      const opt = document.createElement(\"option\");\r\n      opt.value = val;\r\n      opt.innerHTML = val;\r\n      selectElem.appendChild(opt);\r\n    });\r\n  }\r\n\r\n  // tbl.addEventListener('filter', update)\r\n  function setFilter(value) {\r\n    [...selectElem.options]\r\n      .find((opt) => opt.value == value)\r\n      ?.setAttribute(\"selected\", \"\");\r\n  }\r\n\r\n  selectElem.addEventListener(\"change\", (e) => {\r\n    const selectedVals = [...selectElem.selectedOptions].map(\r\n      (opt) => opt.value\r\n    );\r\n    // Check if we're clearing this field\r\n    const isClear = selectedVals[0] == \"\";\r\n    filterArr(selectedVals);\r\n    const event = new Event(\"filter\");\r\n    tbl.dispatchEvent(event);\r\n  });\r\n\r\n  const search = (searchTerm) => searchCells(cells, searchTerm);\r\n  const filter = (filterTerm) => filterCells(cells, filterTerm);\r\n  const filterArr = (filterTerms) => filterCellsArr(cells, filterTerms);\r\n\r\n  populateOptions();\r\n\r\n  return {\r\n    setFilter,\r\n    element: selectElem,\r\n    search,\r\n    filter,\r\n  };\r\n}\r\n\r\nfunction searchCells(cells, searchTerm) {\r\n  searchTerm = searchTerm.toLowerCase();\r\n  return cells.filter((cell) => {\r\n    const val = cell.innerText.toString().trim().toLowerCase();\r\n    return val.includes(searchTerm);\r\n  });\r\n}\r\n\r\nfunction filterCells(cells, searchTerm) {\r\n  searchTerm = searchTerm.toLowerCase();\r\n  cells.map((cell) => {\r\n    const val = cell.innerText.toString().trim().toLowerCase();\r\n    cell.classList.toggle(\"filtered\", !val.includes(searchTerm));\r\n  });\r\n}\r\n\r\nfunction filterCheckBoxCells(cells, isChecked) {\r\n  cells.map((cell) => {\r\n    cell.classList.toggle(\r\n      \"filtered\",\r\n      cell.querySelector(\"input\").checked != isChecked\r\n    );\r\n  });\r\n}\r\n\r\n// Must match exact values in searchTerms array\r\nfunction filterCellsArr(cells, searchTermsArr) {\r\n  const isClear = searchTermsArr.flatMap((term) => term) == \"\";\r\n  cells.map((cell) => {\r\n    const val = cell.innerText?.trim();\r\n    cell.classList.toggle(\r\n      \"filtered\",\r\n      !isClear && !searchTermsArr.includes(val)\r\n    );\r\n  });\r\n}\r\n\r\n/* Export Functionality */\r\n\r\nfunction PrintPage(divTbl) {\r\n  const pageTitle = divTbl.dataset.title;\r\n  var curDate = new Date();\r\n  var siteUrl = Audit.Common.Utilities.GetSiteUrl();\r\n  var cssLink1 =\r\n    siteUrl +\r\n    \"/siteassets/css/tablesorter/style.css?v=\" +\r\n    curDate.format(\"MM_dd_yyyy\");\r\n  var cssLink2 =\r\n    siteUrl +\r\n    \"/siteAssets/css/audit_styles.css?v=\" +\r\n    curDate.format(\"MM_dd_yyyy\");\r\n\r\n  var divOutput = $(divTbl).html();\r\n\r\n  //remove hyperlinks pointing to the job codes\r\n  var updatedDivOutput = $(\"<div>\").append(divOutput);\r\n  updatedDivOutput.find(\".sr1-request-requestNum a\").each(function () {\r\n    $(this).removeAttr(\"onclick\");\r\n    $(this).removeAttr(\"href\");\r\n  });\r\n\r\n  updatedDivOutput.find(\".sr2-response-requestNum a\").each(function () {\r\n    $(this).removeAttr(\"onclick\");\r\n    $(this).removeAttr(\"href\");\r\n  });\r\n\r\n  divOutput = updatedDivOutput.html();\r\n\r\n  var printDateString = curDate.format(\"MM/dd/yyyy hh:mm tt\");\r\n  printDateString =\r\n    \"<div style='padding-bottom:10px;'>\" +\r\n    printDateString +\r\n    \" - \" +\r\n    pageTitle +\r\n    \"</div>\";\r\n\r\n  divOutput = printDateString + divOutput;\r\n\r\n  var cssFile1 = $(\"<div></div>\");\r\n  var cssFile2 = $(\"<div></div>\");\r\n\r\n  var def1 = $.Deferred();\r\n  var def2 = $.Deferred();\r\n\r\n  var cssFileText = \"\";\r\n  cssFile1.load(cssLink1, function () {\r\n    cssFileText += \"<style>\" + cssFile1.html() + \"</style>\";\r\n    def1.resolve();\r\n  });\r\n  cssFile2.load(cssLink2, function () {\r\n    cssFileText += \"<style>\" + cssFile2.html() + \"</style>\";\r\n    def2.resolve();\r\n  });\r\n\r\n  //gets called asynchronously after the css files have been loaded\r\n  $.when(def1, def2).done(function () {\r\n    var html =\r\n      \"<HTML>\\n\" +\r\n      \"<HEAD>\\n\\n\" +\r\n      \"<Title>\" +\r\n      pageTitle +\r\n      \"</Title>\\n\" +\r\n      cssFileText +\r\n      \"\\n\" +\r\n      \"<style>\" +\r\n      \".hideOnPrint, .rowFilters, .actionOfficeContainer {display:none}\" +\r\n      \"</style>\\n\" +\r\n      \"</HEAD>\\n\" +\r\n      \"<BODY>\\n\" +\r\n      divOutput +\r\n      \"\\n\" +\r\n      \"</BODY>\\n\" +\r\n      \"</HTML>\";\r\n\r\n    var printWP = window.open(\"\", \"Print Web Part\");\r\n    if (!printWP) {\r\n      alert(\"No printWebPart!\");\r\n      return;\r\n    }\r\n    printWP.document.open();\r\n    //insert content\r\n    printWP.document.write(html);\r\n\r\n    printWP.document.close();\r\n    //open print dialog\r\n    printWP.print();\r\n  });\r\n}\r\n//make sure iframe with id csvexprframe is added to page up top\r\n//http://stackoverflow.com/questions/18185660/javascript-jquery-exporting-data-in-csv-not-working-in-ie\r\nfunction exportTableToCsv(fileName, table, removeHeader) {\r\n  var data = getCellValues(table);\r\n\r\n  if (!data) {\r\n    alert(\"No data!\");\r\n    return;\r\n  }\r\n\r\n  if (removeHeader == true) data = data.slice(1);\r\n\r\n  var csv = ConvertToCsv(data);\r\n  //\tconsole.log( csv );\r\n  if (navigator.userAgent.search(\"Trident\") >= 0) {\r\n    window.CsvExpFrame.document.open(\"text/html\", \"replace\");\r\n    //\t\twindow.CsvExpFrame.document.open(\"application/csv\", \"replace\");\r\n    //\t\twindow.CsvExpFrame.document.charset = \"utf-8\";\r\n    //\t\twindow.CsvExpFrame.document.open(\"application/ms-excel\", \"replace\");\r\n    window.CsvExpFrame.document.write(csv);\r\n    window.CsvExpFrame.document.close();\r\n    window.CsvExpFrame.focus();\r\n    window.CsvExpFrame.document.execCommand(\"SaveAs\", true, fileName + \".csv\");\r\n  } else {\r\n    var uri = \"data:text/csv;charset=utf-8,\" + escape(csv);\r\n    var downloadLink = document.createElement(\"a\");\r\n    downloadLink.href = uri;\r\n    downloadLink.download = fileName + \".csv\";\r\n    document.body.appendChild(downloadLink);\r\n    downloadLink.click();\r\n    document.body.removeChild(downloadLink);\r\n  }\r\n}\r\n\r\nfunction getCellValues(table) {\r\n  //   var table = document.getElementById(tableName);\r\n\r\n  if (!table) return;\r\n  //remove headers and footers\r\n  if (table.innerHTML.indexOf(\"rowFilters\") >= 0) {\r\n    var deets = $(\"<div>\").append(table.outerHTML);\r\n    deets.find(\".rowFilters\").each(function () {\r\n      $(this).remove();\r\n    });\r\n    table = deets.find(\"table\")[0];\r\n  }\r\n  if (table.innerHTML.indexOf(\"footer\") >= 0) {\r\n    var deets = $(\"<div>\").append(table.outerHTML);\r\n    deets.find(\".footer\").each(function () {\r\n      $(this).remove();\r\n    });\r\n    table = deets.find(\"table\")[0];\r\n  }\r\n\r\n  if (table.innerHTML.indexOf(\"actionOfficeContainer\") >= 0) {\r\n    var deets = $(\"<div>\").append(table.outerHTML);\r\n    deets.find(\".actionOfficeContainer\").each(function () {\r\n      $(this).remove();\r\n    });\r\n\r\n    deets.find(\".sr1-request-actionOffice-item\").each(function () {\r\n      var curText = $(this).text() + \", \";\r\n\r\n      $(this).text(curText);\r\n    });\r\n\r\n    table = deets.find(\"table\")[0];\r\n  }\r\n\r\n  var tableArray = [];\r\n  for (var r = 0, n = table.rows.length; r < n; r++) {\r\n    tableArray[r] = [];\r\n    for (var c = 0, m = table.rows[r].cells.length; c < m; c++) {\r\n      var text =\r\n        table.rows[r].cells[c].textContent || table.rows[r].cells[c].innerText;\r\n      tableArray[r][c] = text.trim();\r\n    }\r\n  }\r\n  return tableArray;\r\n}\r\n\r\nfunction ConvertToCsv(objArray) {\r\n  var array = typeof objArray != \"object\" ? JSON.parse(objArray) : objArray;\r\n  var str = \"sep=,\\r\\n\";\r\n  var line = \"\";\r\n  var index;\r\n  var value;\r\n  for (var i = 0; i < array.length; i++) {\r\n    line = \"\";\r\n    var array1 = array[i];\r\n    for (index in array1) {\r\n      if (array1.hasOwnProperty(index)) {\r\n        value = array1[index] + \"\";\r\n        line += '\"' + value.replace(/\"/g, '\"\"') + '\",';\r\n      }\r\n    }\r\n    line = line.slice(0, -1);\r\n    str += line + \"\\r\\n\";\r\n  }\r\n  return str;\r\n}\r\n", "\uFEFFimport { iaDbTemplate } from \"./IA_DB_Template.js\";\r\nimport \"../../common/utilities.js\";\r\nimport \"../../../lib/webcomponents/searchselect/searchselect.js\";\r\nimport \"../../../lib/webcomponents/data-table/data-table.js\";\r\n\r\nimport { InitSal, executeQuery } from \"../../sal/infrastructure/index.js\";\r\nimport { appContext } from \"../../infrastructure/application_db_context.js\";\r\nimport { TabsModule, Tab } from \"../../components/tabs/tabs_module.js\";\r\nimport { setUrlParam } from \"../../common/router.js\";\r\nimport { CommentChainModuleLegacy } from \"../../components/comment_chain/comment_chain_module.js\";\r\nimport { ActiveViewersModuleLegacy } from \"../../components/active_viewers/active_viewers_module.js\";\r\n\r\nimport * as ModalDialog from \"../../sal/components/modal/index.js\";\r\nimport * as FormManager from \"../../sal/infrastructure/form_manager.js\";\r\n\r\nimport { NewRequestFormComponent } from \"../../components/forms/request/new_form/new_request_form.js\";\r\nimport { RequestDetailView } from \"../../components/request_detail_view/request_detail_view.js\";\r\nimport { EditRequestForm } from \"../../components/forms/request/edit_form/edit_request_form.js\";\r\nimport { EditCoverSheetForm } from \"../../components/forms/cover_sheet/edit_form/edit_cover_sheet_form.js\";\r\nimport {\r\n  AuditResponse,\r\n  AuditResponseStates,\r\n} from \"../../entities/audit_response.js\";\r\nimport { NewResponseForm } from \"../../components/forms/response/new_form/new_response_form.js\";\r\nimport { EditResponseForm } from \"../../components/forms/response/edit_form/edit_response_form.js\";\r\nimport { EditResponseDocForm } from \"../../components/forms/response_doc/edit_form/edit_response_doc_form.js\";\r\n\r\nimport {\r\n  auditOrganizationStore,\r\n  configurationsStore,\r\n} from \"../../infrastructure/store.js\";\r\nimport {\r\n  AUDITREQUESTTYPES,\r\n  AuditResponseDocStates,\r\n} from \"../../entities/index.js\";\r\nimport {\r\n  addTask,\r\n  blockingTasks,\r\n  finishTask,\r\n  runningTasks,\r\n  taskDefs,\r\n} from \"../../services/tasks.js\";\r\nimport {\r\n  ensureAllAppPerms,\r\n  ensureDBPermissions,\r\n} from \"../../services/permission_manager.js\";\r\nimport { ensureROEmailFolder } from \"../../services/audit_email_service.js\";\r\nimport { sortByTitle } from \"../../sal/infrastructure/index.js\";\r\nimport { BulkAddRequestForm } from \"../../components/bulk_add_request/bulk_add_request.js\";\r\n\r\ndocument.getElementById(\"app\").innerHTML = iaDbTemplate;\r\n\r\nwindow.Audit = window.Audit || {};\r\nAudit.IAReport = Audit.IAReport || {};\r\n\r\nconst requestParam = \"ReqNum\";\r\nconst responseParam = \"ResNum\";\r\n\r\nexport async function InitReport() {\r\n  /*********NOTE: the Contribute permission level needs to have manage permissions turned on ************/\r\n\r\n  await InitSal();\r\n\r\n  const configurationsPromise = appContext.AuditConfigurations.ToList().then(\r\n    (configurations) => {\r\n      configurations.map(\r\n        (config) => (configurationsStore[config.key] = config.value)\r\n      );\r\n    }\r\n  );\r\n\r\n  const auditOrganizationsPromise = appContext.AuditOrganizations.ToList().then(\r\n    (organizations) => {\r\n      ko.utils.arrayPushAll(\r\n        auditOrganizationStore,\r\n        organizations.sort(sortByTitle)\r\n      );\r\n    }\r\n  );\r\n\r\n  await Promise.all([configurationsPromise, auditOrganizationsPromise]);\r\n\r\n  ensureDBPermissions();\r\n\r\n  Audit.IAReport.Report = new Audit.IAReport.NewReportPage();\r\n  Audit.IAReport.Init();\r\n}\r\n\r\nAudit.IAReport.Init = function () {\r\n  function SetTimer() {\r\n    var intervalRefreshID = setInterval(function () {\r\n      var divVal = $(\"#divCounter\").text();\r\n      var count = divVal * 1 - 1;\r\n      $(\"#divCounter\").text(count);\r\n      if (count <= 0) {\r\n        if (!Audit.IAReport.Report.IsTransactionExecuting())\r\n          Audit.IAReport.Report.Refresh();\r\n        else {\r\n          clearInterval(intervalRefreshID);\r\n          $(\"#divCounter\").text(\"1200\");\r\n          SetTimer();\r\n        }\r\n      }\r\n    }, 1000);\r\n  }\r\n\r\n  SetTimer();\r\n};\r\n\r\nAudit.IAReport.NewReportPage = function () {\r\n  _myViewModel = new ViewModel();\r\n  ko.applyBindings(_myViewModel);\r\n\r\n  LoadInfo();\r\n\r\n  var publicMembers = {\r\n    Load: m_fnLoadData,\r\n    ViewPermissions: m_fnViewPermissions,\r\n    ViewLateRequests: m_fnViewLateRequests,\r\n    ViewResponseDocsToday: m_fnViewResponseDocsToday,\r\n    ViewReturnedDocs: m_fnViewReturnedDocs,\r\n    GoToRequest: function (requestNum, responseTitle) {\r\n      m_fnGoToRequest(requestNum, responseTitle);\r\n    },\r\n    IsTransactionExecuting: function () {\r\n      return m_bIsTransactionExecuting;\r\n    },\r\n    Refresh: m_fnRefresh,\r\n    CreateInternalRequestItem: m_fnCreateRequestInternalItem,\r\n  };\r\n\r\n  return publicMembers;\r\n};\r\n\r\nvar m_libCoverSheetLibraryGUID = null; //set below\r\nvar m_libRequestDocsLibraryGUID = null; //set below\r\nvar m_libResponseDocsLibraryGUID = null; //set below\r\n\r\nvar m_coversheetDocsLibrary = null;\r\nvar m_requestDocsLibrary = null;\r\nvar m_responseDocsLibrary = null;\r\n\r\n// var m_bigMap = new Object();\r\nconst m_bigMap = {};\r\nfunction m_getArrRequests() {\r\n  return Object.entries(m_bigMap)\r\n    .filter(([key, value]) => {\r\n      return key.startsWith(\"request-\");\r\n    })\r\n    .map(([key, value]) => value);\r\n}\r\nvar m_arrRequestsToClose = new Array();\r\nvar m_arrPermissionsResponseFolders = new Array();\r\n\r\n// var m_requestItems = null;\r\n// var m_requestInternalItems = null;\r\n\r\n// var m_responseItems = null;\r\n// var m_ResponseDocsItems = null;\r\n// var m_ResponseDocsFoldersItems = null;\r\n\r\nvar m_userPermissionAccess = null;\r\nvar m_PageItems = null;\r\n\r\nvar m_itemID = null;\r\nvar m_requestNum = null;\r\nvar m_responseTitle = null;\r\nvar m_responseStatus = null;\r\n\r\nvar m_bIsTransactionExecuting = false;\r\nvar m_statusId = null;\r\nvar notifyId = null;\r\n\r\nvar m_bIsSiteOwner = true;\r\nvar m_sGoToResponseTitle = null;\r\n\r\nvar m_oRequestTitleAndDocCount = new Object();\r\nvar m_oResponseTitleAndDocCount = new Object();\r\n\r\nvar m_sResponseStatusToFilterOn = \"1-Open\";\r\nvar m_sRequestStatusToFilterOn = \"Open\";\r\nvar _myViewModel = null;\r\n\r\nfunction ViewModel() {\r\n  var self = this;\r\n\r\n  self.refresh = () => window.location.reload();\r\n\r\n  self.debugMode = ko.observable(false);\r\n  self.siteUrl = Audit.Common.Utilities.GetSiteUrl();\r\n\r\n  self.showQuickInfo = ko.observable(false);\r\n\r\n  //cant add rate limit because it'll affect the refresh\r\n  //self.arrResponses = ko.observableArray( null ).extend({ rateLimit: 500 });\r\n  self.arrRequests = ko.observableArray(null);\r\n  self.arrResponses = ko.observableArray(null);\r\n  self.cntPendingReview = ko.observable(0);\r\n\r\n  /* alerts */\r\n  self.arrRequestsThatNeedClosing = ko.observableArray(null);\r\n  self.arrResponseDocsCheckedOut = ko.observableArray(null);\r\n  self.arrResponsesWithUnsubmittedResponseDocs = ko.observableArray();\r\n  self.arrRequestsInternalAlmostDue = ko.observableArray(null);\r\n  self.arrRequestsInternalPastDue = ko.observableArray(null);\r\n  self.arrRequestsAlmostDue = ko.observableArray(null);\r\n  self.arrRequestsPastDue = ko.observableArray(null);\r\n  self.arrRequestsWithNoResponses = ko.observableArray(null);\r\n  self.arrRequestsWithNoEmailSent = ko.observableArray(null);\r\n  self.arrResponsesSubmittedByAO = ko.observableArray(null);\r\n  self.arrResponsesReadyToClose = ko.observableArray();\r\n\r\n  self.alertQuickInfo = ko.pureComputed(() => {\r\n    return (\r\n      self.arrRequestsThatNeedClosing().length ||\r\n      self.arrResponseDocsCheckedOut().length ||\r\n      self.arrResponsesWithUnsubmittedResponseDocs().length ||\r\n      self.arrRequestsInternalAlmostDue().length ||\r\n      self.arrRequestsInternalPastDue().length ||\r\n      self.arrRequestsAlmostDue().length ||\r\n      self.arrRequestsPastDue().length ||\r\n      self.arrRequestsWithNoResponses().length ||\r\n      self.arrRequestsWithNoEmailSent().length ||\r\n      self.arrResponsesSubmittedByAO().length ||\r\n      self.arrResponsesReadyToClose().length\r\n    );\r\n  });\r\n\r\n  /* request tab */\r\n  self.clickExpandActionOffices = (item, e) => {\r\n    e.target.parentElement\r\n      .querySelector(\".sr1-request-actionOffice-items\")\r\n      .classList.toggle(\"collapsed\");\r\n  };\r\n\r\n  self.ddOptionsRequestInfoTabRequestName = ko.pureComputed(() => {\r\n    return self\r\n      .arrRequests()\r\n      .map((req) => req.reqNumber)\r\n      .sort();\r\n  });\r\n  self.filterRequestInfoTabRequestName = ko.observableArray();\r\n\r\n  self.currentRequest = ko.observable();\r\n  self.arrCurrentRequestRequestDocs = ko.observableArray(null);\r\n  self.arrCurrentRequestCoverSheets = ko.observableArray(null);\r\n  // self.arrCurrentRequestResponses = ko.observableArray(null);\r\n  // self.arrCurrentRequestResponseDocs = ko.observableArray(null);\r\n  // self.cntResponseDocs = ko.observable(0);\r\n  self.bDisplayClose = ko.observable(false);\r\n\r\n  self.showUpload = ko.observable(false);\r\n  self.showSubmit = ko.observable(false);\r\n\r\n  self.currentDialogs = ModalDialog.currentDialogs;\r\n\r\n  self.tabOpts = {\r\n    Requests: new Tab(\"request-report\", \"Request Status Report\", {\r\n      id: \"requestStatusReportTemplate\",\r\n      data: self,\r\n    }),\r\n    Responses: new Tab(\"response-report\", \"Response Status Report\", {\r\n      id: \"responseStatusReportTemplate\",\r\n      data: self,\r\n    }),\r\n    // RequestDetail: new Tab(\"request-detail-dep\", \"Request Information\", {\r\n    //   id: \"requestDetailTemplateDeprecated\",\r\n    //   data: self,\r\n    // }),\r\n    RequestDetail: new Tab(\"request-detail\", \"Request Information\", {\r\n      id: \"requestDetailTemplate\",\r\n      data: self,\r\n    }),\r\n    // NewRequest: new Tab(\"new-request\", \"New Request\", {\r\n    //   id: \"newRequestTemplate\",\r\n    //   data: new NewRequestFormComponent({\r\n    //     onComplete: OnCallbackFormNewRequest,\r\n    //   }),\r\n    // }),\r\n  };\r\n\r\n  self.tabs = new TabsModule(Object.values(self.tabOpts));\r\n\r\n  self.runningTasks = runningTasks;\r\n  self.blockingTasks = blockingTasks;\r\n\r\n  /** Behaviors **/\r\n\r\n  self.ClickNewRequest = () => {\r\n    m_fnCreateRequest();\r\n  };\r\n\r\n  self.ClickResetPerms = () => {\r\n    ensureAllAppPerms();\r\n  };\r\n\r\n  self.ClickBulkAddRequest = () => {\r\n    m_fnBulkAddRequest();\r\n  };\r\n\r\n  self.ClickGoToRequest = function (oRequest) {\r\n    if (oRequest && oRequest.number) m_fnGoToRequest(oRequest.number);\r\n  };\r\n\r\n  self.ClickViewRequest = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.ID) m_fnViewRequest(oRequest.ID);\r\n  };\r\n\r\n  self.ClickEditRequest = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number)\r\n      m_fnEditRequest(oRequest.ID, oRequest.number);\r\n  };\r\n\r\n  self.ClickViewRequestDoc = function (oRD) {\r\n    if (oRD && oRD.ID) m_fnViewRequestDoc(oRD.ID);\r\n  };\r\n\r\n  self.ClickEditRequestDoc = function (oRD) {\r\n    var oRequest = self.currentRequest();\r\n    if (oRD && oRD.ID && oRequest && oRequest.number)\r\n      m_fnEditRequestDoc(oRD.ID, oRequest.number);\r\n  };\r\n\r\n  self.ClickViewCoversheet = function (oCS) {\r\n    if (oCS && oCS.ID) m_fnViewCoverSheet(oCS.ID);\r\n  };\r\n\r\n  self.ClickEditCoversheet = function (oCS) {\r\n    var oRequest = self.currentRequest();\r\n    if (oCS && oCS.ID && oRequest && oRequest.number)\r\n      m_fnEditCoverSheet(oCS.ID, oRequest.number);\r\n  };\r\n\r\n  self.ClickCloseRequest = function () {\r\n    m_fnCloseRequest();\r\n  };\r\n\r\n  self.ClickGrantSpecialPermissions = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number)\r\n      m_fnGrantSpecialPermissions(oRequest.number);\r\n  };\r\n\r\n  self.ClickRemoveSpecialPermissions = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number)\r\n      m_fnRemoveSpecialPermissions(oRequest.number);\r\n  };\r\n\r\n  self.ClickUploadRequestDoc = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number) m_fnUploadRequestDoc(oRequest.number);\r\n  };\r\n\r\n  self.ClickSendEmail = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.ID) m_fnSendEmail(oRequest.ID);\r\n  };\r\n\r\n  self.ClickViewEmailHistoryFolder = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number)\r\n      m_fnViewEmailHistoryFolder(oRequest.number);\r\n  };\r\n\r\n  self.ClickSyncEmailActionOffices = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.ID) m_fnSyncEmailActionOffices(oRequest.ID);\r\n  };\r\n\r\n  self.ClickViewResponse = function (oResponse) {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number && oResponse)\r\n      m_fnViewResponse(\r\n        oRequest.number,\r\n        oResponse.ID,\r\n        oResponse.title,\r\n        oResponse.resStatus\r\n      );\r\n  };\r\n\r\n  self.ClickEditResponse = function (oResponse) {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number && oResponse)\r\n      m_fnEditResponse(\r\n        oRequest.number,\r\n        oResponse.ID,\r\n        oResponse.title,\r\n        oResponse.resStatus\r\n      );\r\n  };\r\n\r\n  self.ClickReviewingResponse = function (oResponse) {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number && oResponse)\r\n      m_fnReviewingResponse(oResponse.activeViewers);\r\n  };\r\n\r\n  self.ClickReOpenResponse = function (oResponse) {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number && oResponse)\r\n      m_fnReOpenResponse(oRequest.number, oResponse.title);\r\n  };\r\n\r\n  self.ClickAddResponse = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number)\r\n      m_fnAddResponse(oRequest.ID, oRequest.number);\r\n  };\r\n\r\n  self.ClickBulkAddResponse = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number) m_fnBulkAddResponse(oRequest.number);\r\n  };\r\n\r\n  self.ClickBulkEditResponse = function () {\r\n    var oRequest = self.currentRequest();\r\n    if (oRequest && oRequest.number) m_fnBulkEditResponse(oRequest.number);\r\n  };\r\n\r\n  self.ClickCheckInResponseDocument = function (oResponseDoc) {\r\n    if (oResponseDoc && oResponseDoc.folder && oResponseDoc.fileName)\r\n      m_fnCheckInResponseDoc(oResponseDoc.folder, oResponseDoc.fileName);\r\n  };\r\n\r\n  self.ClickViewResponseDocFolder = function (oResponse) {\r\n    if (oResponse && oResponse.title)\r\n      m_fnViewResponseDocFolder(oResponse.title);\r\n  };\r\n\r\n  self.ClickViewResponseDoc = function (oResponseDoc) {\r\n    if (oResponseDoc && oResponseDoc.requestID && oResponseDoc.responseTitle)\r\n      m_fnViewResponseDoc(\r\n        oResponseDoc.ID,\r\n        oResponseDoc.requestID,\r\n        oResponseDoc.responseTitle\r\n      );\r\n  };\r\n\r\n  self.ClickEditResponseDoc = function (oResponseDoc) {\r\n    if (oResponseDoc && oResponseDoc.requestID && oResponseDoc.responseTitle)\r\n      m_fnEditResponseDoc(\r\n        oResponseDoc.ID,\r\n        oResponseDoc.requestID,\r\n        oResponseDoc.responseTitle\r\n      );\r\n  };\r\n\r\n  self.ClickDeleteResponseDoc = function (oResponseDoc) {\r\n    if (oResponseDoc && oResponseDoc.ID) m_fnDeleteResponseDoc(oResponseDoc.ID);\r\n  };\r\n\r\n  self.ClickResendRejectedResponseDocToQA = function (oResponseDoc) {\r\n    if (oResponseDoc && oResponseDoc.ID)\r\n      m_fnResendRejectedResponseDocToQA(oResponseDoc.ID);\r\n  };\r\n\r\n  self.requestDetailViewComponent = new RequestDetailView(self);\r\n\r\n  self.filterRequestInfoTable = (prop, value) => {\r\n    const tbl = document.getElementById(\"tblStatusReportRequests\");\r\n    tbl.filterByColIndex();\r\n  };\r\n\r\n  /** Subscriptions **/\r\n  self.arrRequests.subscribe((arrayChanges) => {\r\n    document.getElementById(\"tblStatusReportRequests\")?.update();\r\n  }, \"arrayChange\");\r\n\r\n  self.arrResponses.subscribe((arrayChanges) => {\r\n    document.getElementById(\"tblStatusReportResponses\")?.update();\r\n  }, \"arrayChange\");\r\n\r\n  self.filterStatusTables = (newValue) => {\r\n    Audit.Common.Utilities.OnLoadDisplayTimeStamp();\r\n\r\n    var paramTabIndex = GetUrlKeyValue(\"Tab\");\r\n    var paramRequestNum = GetUrlKeyValue(\"ReqNum\");\r\n    var paramResNum = GetUrlKeyValue(\"ResNum\");\r\n\r\n    if (paramTabIndex != null && paramTabIndex != \"\") {\r\n      self.tabs.selectById(paramTabIndex);\r\n    } else {\r\n      self.tabs.selectTab(self.tabOpts.Requests);\r\n    }\r\n\r\n    if (paramRequestNum != null && paramRequestNum != \"\") {\r\n      if (paramTabIndex == self.tabOpts.Responses.id)\r\n        // self.filterRequestTabRequestID(paramRequestNum);\r\n        document\r\n          .getElementById(\"tblStatusReportResponses\")\r\n          .filterByColIndex(0, paramRequestNum);\r\n      //if (paramTabIndex == self.tabOpts.RequestDetail.id)\r\n      else self.filterRequestInfoTabRequestName(paramRequestNum);\r\n    }\r\n    /**Note: on the jsrender of the request/response tables, I set the rows to display none; the filters below show the rows I want **/\r\n    // self.filterRequestTabRequestStatus(m_sRequestStatusToFilterOn);\r\n\r\n    if (\r\n      paramResNum != null &&\r\n      paramResNum != \"\" &&\r\n      paramTabIndex == self.tabOpts.Responses.id\r\n    ) {\r\n      // self.filterResponseTabResponseName(paramResNum);\r\n      document\r\n        .getElementById(\"tblStatusReportResponses\")\r\n        .filterByColIndex(2, paramResNum);\r\n    }\r\n    //dont filter here because IA has received a link to the response and we don't want the status to be filtered\r\n    else\r\n      document\r\n        .getElementById(\"tblStatusReportResponses\")\r\n        .filterByColIndex(4, m_sResponseStatusToFilterOn);\r\n  };\r\n\r\n  var requestUnloadEventHandler = function (oRequest) {\r\n    return function (event) {\r\n      // console.log(\"unloading\", oRequest);\r\n      oRequest.activeViewers.removeCurrentuser();\r\n    };\r\n  };\r\n\r\n  var currentRequestUnloadEventHandler;\r\n  /* 3rd tab */\r\n  // Before Change\r\n  self.filterRequestInfoTabRequestName.subscribe(\r\n    function (oldValue) {\r\n      var oRequest = m_bigMap[\"request-\" + oldValue];\r\n      if (oRequest && oRequest.activeViewers) {\r\n        oRequest.activeViewers.removeCurrentuser();\r\n        window.removeEventListener(\r\n          \"beforeunload\",\r\n          currentRequestUnloadEventHandler\r\n        );\r\n      }\r\n    },\r\n    null,\r\n    \"beforeChange\"\r\n  );\r\n\r\n  // After Change\r\n  self.filterRequestInfoTabRequestName.subscribe(function (newValue) {\r\n    self.currentRequest(null);\r\n    self.arrCurrentRequestRequestDocs([]);\r\n    self.arrCurrentRequestCoverSheets([]);\r\n    // self.arrCurrentRequestResponses([]);\r\n    // self.arrCurrentRequestResponseDocs.removeAll();\r\n    // self.cntResponseDocs(0);\r\n    self.bDisplayClose(false);\r\n\r\n    // self.currentRequest.valueHasMutated();\r\n    // self.arrCurrentRequestRequestDocs.valueHasMutated();\r\n    // self.arrCurrentRequestCoverSheets.valueHasMutated();\r\n    // self.arrCurrentRequestResponses.valueHasMutated();\r\n    // self.cntResponseDocs.valueHasMutated();\r\n    // self.bDisplayClose.valueHasMutated();\r\n\r\n    var oRequest = m_bigMap[\"request-\" + newValue];\r\n    if (oRequest) {\r\n      if (oRequest.activeViewers) {\r\n        oRequest.activeViewers.pushCurrentUser();\r\n        currentRequestUnloadEventHandler = requestUnloadEventHandler(oRequest);\r\n        window.addEventListener(\r\n          \"beforeunload\",\r\n          currentRequestUnloadEventHandler\r\n        );\r\n      }\r\n      m_fnRequeryRequest(oRequest.ID);\r\n    } else {\r\n    }\r\n  });\r\n\r\n  window.addEventListener(\"popstate\", (event) => {\r\n    // Handle our window history state change.\r\n    if (event.state && event.state[requestParam]) {\r\n      self.filterRequestInfoTabRequestName(event.state[requestParam]);\r\n    }\r\n  });\r\n  self.currentRequest.subscribe((request) => {\r\n    if (request) setUrlParam(requestParam, request.number);\r\n  });\r\n}\r\n\r\nfunction LoadInfo() {\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var requestList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequests());\r\n  var requestQuery = new SP.CamlQuery();\r\n  requestQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy></Query></View>'\r\n  );\r\n  const m_requestItems = requestList.getItems(requestQuery);\r\n  //need to check permissions because of displaying special perms and granting special perms\r\n  //currCtx.load( m_requestItems, 'Include(ID, Title, ReqSubject, ReqStatus, IsSample, ReqDueDate, InternalDueDate, ActionOffice, EmailActionOffice, Reviewer, Owner, ReceiptDate, RelatedAudit, ActionItems, Comments, EmailSent, ClosedDate, ClosedBy, Modified, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))');\r\n  currCtx.load(\r\n    m_requestItems,\r\n    \"Include(ID, Title, ReqType, ReqSubject, ReqStatus, RequestingOffice, FiscalYear, IsSample, ReqDueDate, InternalDueDate, ActionOffice, EmailActionOffice, Reviewer, Owner, ReceiptDate, RelatedAudit, ActionItems, Comments, EmailSent, ClosedDate, ClosedBy, Modified, Sensitivity)\"\r\n  );\r\n\r\n  var requestInternalList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequestsInternal());\r\n  var requestInternalQuery = new SP.CamlQuery();\r\n  requestInternalQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy></Query></View>'\r\n  );\r\n  const m_requestInternalItems =\r\n    requestInternalList.getItems(requestInternalQuery);\r\n  currCtx.load(\r\n    m_requestInternalItems,\r\n    \"Include(ID, Title, ReqNum, InternalStatus, ActiveViewers)\"\r\n  );\r\n\r\n  var responseList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n  var responseQuery = new SP.CamlQuery();\r\n  responseQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"ReqNum\"/></OrderBy></Query></View>'\r\n  );\r\n  const m_responseItems = responseList.getItems(responseQuery);\r\n  //need to check permissions because of granting/removing special perms\r\n  //currCtx.load( m_responseItems, 'Include(ID, Title, ReqNum, ActionOffice, ReturnReason, SampleNumber, ResStatus, Comments, Modified, ClosedDate, ClosedBy, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))' );\r\n  currCtx.load(\r\n    m_responseItems,\r\n    \"Include(ID, Title, ReqNum, ActionOffice, ReturnReason, SampleNumber, ResStatus, ActiveViewers, Comments, Modified, ClosedDate, ClosedBy, POC, POCCC)\"\r\n  );\r\n\r\n  //make sure to only pull documents (fsobjtype = 0)\r\n  var responseDocsLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n  var responseDocsQuery = new SP.CamlQuery();\r\n  responseDocsQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><OrderBy><FieldRef Name=\"ReqNum\"/><FieldRef Name=\"ResID\"/></OrderBy><Where><Eq><FieldRef Name=\"ContentType\"/><Value Type=\"Text\">Document</Value></Eq></Where></Query></View>'\r\n  );\r\n  const m_ResponseDocsItems = responseDocsLib.getItems(responseDocsQuery);\r\n  currCtx.load(\r\n    m_ResponseDocsItems,\r\n    \"Include(ID, Title, ReqNum, ResID, DocumentStatus, RejectReason, ReceiptDate, FileLeafRef, FileDirRef, File_x0020_Size, CheckoutUser, Modified, Editor, Created)\"\r\n  );\r\n\r\n  const m_groupColl = web.get_siteGroups();\r\n  currCtx.load(m_groupColl);\r\n\r\n  var aoList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleActionOffices());\r\n  var aoQuery = new SP.CamlQuery();\r\n  aoQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy></Query></View>'\r\n  );\r\n  const m_aoItems = aoList.getItems(aoQuery);\r\n  currCtx.load(m_aoItems, \"Include(ID, Title, UserGroup)\");\r\n\r\n  var ob = new SP.BasePermissions();\r\n  ob.set(SP.PermissionKind.deleteListItems); //site owners and members should have this\r\n  m_userPermissionAccess = web.doesUserHavePermissions(ob);\r\n\r\n  currCtx.executeQueryAsync(OnSuccess, OnFailure);\r\n  function OnSuccess(sender, args) {\r\n    m_bIsSiteOwner = m_userPermissionAccess.get_value();\r\n    //alert( m_bIsSiteOwner );\r\n\r\n    if (m_bIsSiteOwner) {\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      //make sure to only pull documents (fsobjtype = 0)\r\n      var pagesLib = web.get_lists().getByTitle(\"Pages\");\r\n      var pagesQuery = new SP.CamlQuery();\r\n      pagesQuery.set_viewXml(\r\n        '<View Scope=\"RecursiveAll\"><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy><Where><Or><Eq><FieldRef Name=\"FileLeafRef\"/><Value Type=\"Text\">AO_DB.aspx</Value></Eq><Eq><FieldRef Name=\"FileLeafRef\"/><Value Type=\"Text\">RO_DB.aspx</Value></Eq></Or></Where></Query></View>'\r\n      );\r\n      m_PageItems = pagesLib.getItems(pagesQuery);\r\n      currCtx.load(\r\n        m_PageItems,\r\n        \"Include(ID, Title, FileLeafRef, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n      );\r\n\r\n      var emailList = web\r\n        .get_lists()\r\n        .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n      var emailListQuery = new SP.CamlQuery();\r\n      emailListQuery.set_viewXml(\r\n        '<View><Query><OrderBy><FieldRef Name=\"ID\"/></OrderBy><Where><And><Eq><FieldRef Name=\"Title\"/><Value Type=\"Text\">EANotifications</Value></Eq><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">1</Value></Eq></And></Where></Query></View>'\r\n      );\r\n      var emailListFolderItemsEA = emailList.getItems(emailListQuery);\r\n      currCtx.load(emailListFolderItemsEA, \"Include(ID, Title, DisplayName)\");\r\n\r\n      function OnSuccessLoadPages(sender, args) {\r\n        $(\"#divIA\").show();\r\n        //if they can iterate the pages and the permissions on the pages, we'll consider them a site owner\r\n\r\n        m_fnLoadInitialData(\r\n          m_aoItems,\r\n          m_groupColl,\r\n          m_requestItems,\r\n          m_requestInternalItems,\r\n          m_responseItems,\r\n          m_ResponseDocsItems\r\n        );\r\n        // m_fnResetAODBPerms(m_PageItems);\r\n        ensureROEmailFolder();\r\n        // m_fnCheckForEAEmailFolder(emailListFolderItemsEA);\r\n      }\r\n      function OnFailureLoadPages(sender, args) {\r\n        $(\"#divIA\").show();\r\n        m_fnLoadInitialData(\r\n          m_aoItems,\r\n          m_groupColl,\r\n          m_requestItems,\r\n          m_requestInternalItems,\r\n          m_responseItems,\r\n          m_ResponseDocsItems\r\n        );\r\n      }\r\n      currCtx.executeQueryAsync(OnSuccessLoadPages, OnFailureLoadPages);\r\n    } else {\r\n      $(\"#divIA\").show();\r\n      m_bIsSiteOwner = false;\r\n      m_fnLoadInitialData(\r\n        m_aoItems,\r\n        m_groupColl,\r\n        m_requestItems,\r\n        m_requestInternalItems,\r\n        m_responseItems,\r\n        m_ResponseDocsItems\r\n      );\r\n    }\r\n\r\n    setTimeout(function () {\r\n      m_fnLoadRemainder();\r\n    }, 100);\r\n  }\r\n  function OnFailure(sender, args) {\r\n    $(\"#divLoading\").hide();\r\n    const statusId = SP.UI.Status.addStatus(\r\n      \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n    SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n    m_bIsSiteOwner = false;\r\n  }\r\n}\r\n\r\nfunction m_fnRefresh(requestNumber) {\r\n  window.location.reload();\r\n}\r\n\r\n// function m_fnLoadInit(\r\n//   m_requestItems,\r\n//   m_requestInternalItems,\r\n//   m_responseItems,\r\n//   m_ResponseDocsItems\r\n// ) {\r\n//   Audit.Common.Utilities.LoadSiteGroups(m_groupColl);\r\n//   Audit.Common.Utilities.LoadActionOffices(m_aoItems);\r\n\r\n//   LoadRequests(m_requestItems);\r\n//   LoadRequestsInternal(m_requestInternalItems);\r\n//   LoadResponses(m_responseItems);\r\n//   LoadResponseDocs(m_ResponseDocsItems);\r\n//   LoadResponseCounts();\r\n\r\n//   DisplayRequestsThatShouldClose();\r\n\r\n//   LoadTabStatusReport1();\r\n//   LoadTabStatusReport2();\r\n// }\r\n\r\nfunction m_fnLoadInitialData(\r\n  m_aoItems,\r\n  m_groupColl,\r\n  m_requestItems,\r\n  m_requestInternalItems,\r\n  m_responseItems,\r\n  m_ResponseDocsItems\r\n) {\r\n  Audit.Common.Utilities.LoadSiteGroups(m_groupColl);\r\n  Audit.Common.Utilities.LoadActionOffices(m_aoItems);\r\n\r\n  m_fnLoadData(\r\n    m_requestItems,\r\n    m_requestInternalItems,\r\n    m_responseItems,\r\n    m_ResponseDocsItems\r\n  );\r\n}\r\n\r\nfunction m_fnLoadData(\r\n  m_requestItems,\r\n  m_requestInternalItems,\r\n  m_responseItems,\r\n  m_ResponseDocsItems\r\n) {\r\n  LoadRequests(m_requestItems);\r\n  LoadRequestsInternal(m_requestInternalItems);\r\n  LoadResponses(m_responseItems);\r\n  LoadResponseDocs(m_ResponseDocsItems);\r\n  LoadResponseCounts();\r\n\r\n  DisplayRequestsThatShouldClose();\r\n\r\n  LoadTabStatusReport1();\r\n  LoadTabStatusReport2();\r\n}\r\n\r\nexport async function m_fnRefreshData(requestId = null) {\r\n  if (!requestId) requestId = _myViewModel.currentRequest()?.ID;\r\n  await m_fnRequeryRequest(requestId);\r\n\r\n  return;\r\n  // TODO: reload data without blocking entire page.\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var requestList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequests());\r\n  var requestQuery = new SP.CamlQuery();\r\n  requestQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy></Query></View>'\r\n  );\r\n  const m_requestItems = requestList.getItems(requestQuery);\r\n  //need to check permissions because of displaying special perms and granting special perms\r\n  //currCtx.load( m_requestItems, 'Include(ID, Title, ReqSubject, ReqStatus, IsSample, ReqDueDate, InternalDueDate, ActionOffice, EmailActionOffice, Reviewer, Owner, ReceiptDate, RelatedAudit, ActionItems, Comments, EmailSent, ClosedDate, ClosedBy, Modified, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))');\r\n  currCtx.load(\r\n    m_requestItems,\r\n    \"Include(ID, Title, ReqType, ReqSubject, ReqStatus, RequestingOffice, FiscalYear, IsSample, ReqDueDate, InternalDueDate, ActionOffice, EmailActionOffice, Reviewer, Owner, ReceiptDate, RelatedAudit, ActionItems, Comments, EmailSent, ClosedDate, ClosedBy, Modified, Sensitivity)\"\r\n  );\r\n\r\n  var requestInternalList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequestsInternal());\r\n  var requestInternalQuery = new SP.CamlQuery();\r\n  requestInternalQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy></Query></View>'\r\n  );\r\n  const m_requestInternalItems =\r\n    requestInternalList.getItems(requestInternalQuery);\r\n  currCtx.load(\r\n    m_requestInternalItems,\r\n    \"Include(ID, Title, ReqNum, InternalStatus, ActiveViewers)\"\r\n  );\r\n\r\n  var responseList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n  var responseQuery = new SP.CamlQuery();\r\n  responseQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"ReqNum\"/></OrderBy></Query></View>'\r\n  );\r\n  const m_responseItems = responseList.getItems(responseQuery);\r\n  //need to check permissions because of granting/removing special perms\r\n  //currCtx.load( m_responseItems, 'Include(ID, Title, ReqNum, ActionOffice, ReturnReason, SampleNumber, ResStatus, Comments, Modified, ClosedDate, ClosedBy, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))' );\r\n  currCtx.load(\r\n    m_responseItems,\r\n    \"Include(ID, Title, ReqNum, ActionOffice, ReturnReason, SampleNumber, ResStatus, ActiveViewers, Comments, Modified, ClosedDate, ClosedBy, POC, POCCC)\"\r\n  );\r\n\r\n  //make sure to only pull documents (fsobjtype = 0)\r\n  var responseDocsLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n  var responseDocsQuery = new SP.CamlQuery();\r\n  responseDocsQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><OrderBy><FieldRef Name=\"ReqNum\"/><FieldRef Name=\"ResID\"/></OrderBy><Where><Eq><FieldRef Name=\"ContentType\"/><Value Type=\"Text\">Document</Value></Eq></Where></Query></View>'\r\n  );\r\n  const m_ResponseDocsItems = responseDocsLib.getItems(responseDocsQuery);\r\n  currCtx.load(\r\n    m_ResponseDocsItems,\r\n    \"Include(ID, Title, ReqNum, ResID, DocumentStatus, RejectReason, ReceiptDate, FileLeafRef, FileDirRef, File_x0020_Size, CheckoutUser, Modified, Editor, Created)\"\r\n  );\r\n\r\n  await executeQuery(currCtx).catch(({ sender, args }) => {\r\n    const statusId = SP.UI.Status.addStatus(\r\n      \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n    SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n  });\r\n\r\n  m_fnLoadData(\r\n    m_requestItems,\r\n    m_requestInternalItems,\r\n    m_responseItems,\r\n    m_ResponseDocsItems\r\n  );\r\n  // TODO: Update status reports and other data.\r\n  // LoadTabStatusReport1();\r\n  // LoadTabStatusReport2();\r\n}\r\nexport async function m_fnRequeryRequest(requestId = null) {\r\n  const refreshTask = addTask(taskDefs.refresh);\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var requestList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequests());\r\n  var requestQuery = new SP.CamlQuery();\r\n  requestQuery.set_viewXml(\r\n    '<View><Query><Where><Eq><FieldRef Name=\"ID\"/><Value Type=\"Text\">' +\r\n      requestId +\r\n      \"</Value></Eq></Where></Query></View>\"\r\n  );\r\n  var m_aRequestItem = requestList.getItems(requestQuery);\r\n  if (m_bIsSiteOwner) {\r\n    $(\".response-permissions\").hide(); //resets this in case it was toggled to show\r\n    currCtx.load(\r\n      m_aRequestItem,\r\n      \"Include(ID, Title, ReqType, ReqSubject, RequestingOffice, ReqStatus, FiscalYear, IsSample, ReqDueDate, InternalDueDate, ActionOffice, EmailActionOffice, Reviewer, Owner, ReceiptDate, RelatedAudit, ActionItems, Comments, EmailSent, ClosedDate, ClosedBy, Modified, Sensitivity, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n  } else {\r\n    currCtx.load(\r\n      m_aRequestItem,\r\n      \"Include(ID, Title, ReqType, ReqSubject, RequestingOffice, ReqStatus, FiscalYear, IsSample, ReqDueDate, InternalDueDate, ActionOffice, EmailActionOffice, Reviewer, Owner, ReceiptDate, RelatedAudit, ActionItems, Comments, EmailSent, ClosedDate, ClosedBy, Modified, Sensitivity)\"\r\n    );\r\n  }\r\n\r\n  var requestInternalList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequestsInternal());\r\n  var requestInternalQuery = new SP.CamlQuery();\r\n  requestInternalQuery.set_viewXml(\r\n    \"<View><Query><Where>\" +\r\n      `<Eq><FieldRef Name=\"ReqNum\" LookupId='TRUE'/><Value Type=\"Lookup\">${requestId}</Value></Eq>` +\r\n      '</Where><OrderBy><FieldRef Name=\"Title\"/></OrderBy></Query><RowLimit>1</RowLimit></View>'\r\n  );\r\n  const m_requestInternalItems =\r\n    requestInternalList.getItems(requestInternalQuery);\r\n  currCtx.load(\r\n    m_requestInternalItems,\r\n    \"Include(ID, Title, ReqNum, InternalStatus, ActiveViewers)\"\r\n  );\r\n\r\n  await new Promise((resolve, reject) =>\r\n    currCtx.executeQueryAsync(resolve, (sender, args) =>\r\n      reject({ sender, args })\r\n    )\r\n  ).catch(({ sender, args }) => {\r\n    console.error(\"Unable to requery request: \" + requestId);\r\n    return;\r\n  });\r\n\r\n  LoadRequests(m_aRequestItem);\r\n  LoadRequestsInternal(m_requestInternalItems);\r\n\r\n  const oRequest = m_fnGetRequestByID(requestId);\r\n\r\n  if (!oRequest) {\r\n    alert(\"Request was not successfully reloaded!\");\r\n    return;\r\n  }\r\n\r\n  //Update the item field on the request\r\n  var listItemEnumerator = m_aRequestItem.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n    oRequest.item = oListItem;\r\n    break;\r\n  }\r\n\r\n  if (m_bIsSiteOwner) {\r\n    //07/06/2017 - if the permissions on the request are inheriting for any reason, then reset the permissions and refresh the page\r\n    if (!oRequest.item.get_hasUniqueRoleAssignments()) {\r\n      const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n        \"Information\",\r\n        \"Please wait... Updating Request permissions\",\r\n        200,\r\n        400\r\n      );\r\n      await m_fnBreakRequestPermissions(oRequest.item, false);\r\n      m_fnRefresh();\r\n      return;\r\n    } //07/06/2017 - ensure each action office has access to the request\r\n    else {\r\n      var bUpdateRequestPermissions = false;\r\n      for (var x = 0; x < oRequest.actionOffices.length; x++) {\r\n        var sActionOfficeGroupNameTitle = oRequest.actionOffices[x].ao;\r\n        var sActionOfficeGroupName = Audit.Common.Utilities.GetAOSPGroupName(\r\n          sActionOfficeGroupNameTitle\r\n        );\r\n        if (\r\n          sActionOfficeGroupName != null &&\r\n          $.trim(sActionOfficeGroupName) != \"\"\r\n        ) {\r\n          var bAOHasAccess =\r\n            Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n              oRequest.item,\r\n              sActionOfficeGroupName,\r\n              SP.PermissionKind.viewListItems\r\n            );\r\n          if (!bAOHasAccess) {\r\n            bUpdateRequestPermissions = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (bUpdateRequestPermissions) {\r\n        const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n          \"Information\",\r\n          \"Please wait... Updating Request permissions\",\r\n          200,\r\n          400\r\n        );\r\n        await m_fnBreakRequestPermissions(oRequest.item, false);\r\n        m_fnRefresh();\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  var match1 = false;\r\n  var match2 = false;\r\n\r\n  if (m_bIsSiteOwner) {\r\n    var permissionsToCheck = SP.PermissionKind.viewListItems;\r\n    match1 = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n      oRequest.item,\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1(),\r\n      permissionsToCheck\r\n    );\r\n    match2 = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n      oRequest.item,\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2(),\r\n      permissionsToCheck\r\n    );\r\n\r\n    if (match1 && match2) oRequest.specialPerms = true;\r\n    else oRequest.specialPerms = false;\r\n  }\r\n\r\n  _myViewModel.currentRequest(oRequest);\r\n\r\n  _myViewModel.bDisplayClose(false);\r\n  if (m_arrRequestsToClose && m_arrRequestsToClose.length > 0) {\r\n    for (var x = 0; x < m_arrRequestsToClose.length; x++) {\r\n      var oIt = m_arrRequestsToClose[x];\r\n      if (oIt.number == oRequest.number) {\r\n        _myViewModel.bDisplayClose(true);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // LoadTabRequestInfoRequestDocs(oRequest);\r\n  // these can be loaded in parallel\r\n  await Promise.all([\r\n    LoadTabRequestInfoCoverSheets(oRequest),\r\n    LoadTabRequestInfoResponses(oRequest),\r\n  ]);\r\n\r\n  // This needs to run after the responses have been loaded\r\n  await LoadTabRequestInfoResponseDocs(oRequest);\r\n\r\n  _myViewModel.currentRequest.valueHasMutated();\r\n  finishTask(refreshTask);\r\n}\r\n\r\nfunction RequestFinishedLoading() {\r\n  var paramSection = GetUrlKeyValue(\"Sect\");\r\n  if (paramSection) {\r\n    document.getElementById(paramSection)?.scrollIntoView(true);\r\n  }\r\n}\r\n\r\nfunction m_fnLoadRemainder() {\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  m_coversheetDocsLibrary = currCtx\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleCoverSheets());\r\n  currCtx.load(m_coversheetDocsLibrary, \"Title\", \"Id\");\r\n\r\n  m_requestDocsLibrary = currCtx\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleRequestDocs());\r\n  currCtx.load(m_requestDocsLibrary, \"Title\", \"Id\");\r\n\r\n  m_responseDocsLibrary = currCtx\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n  currCtx.load(m_responseDocsLibrary, \"Title\", \"Id\");\r\n\r\n  function OnSuccess(sender, args) {\r\n    m_libResponseDocsLibraryGUID = m_responseDocsLibrary.get_id();\r\n    m_libCoverSheetLibraryGUID = m_coversheetDocsLibrary.get_id();\r\n    m_libRequestDocsLibraryGUID = m_requestDocsLibrary.get_id();\r\n  }\r\n  function OnFailure(sender, args) {\r\n    const statusId = SP.UI.Status.addStatus(\r\n      \"Failed loading: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n    SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n  }\r\n  currCtx.executeQueryAsync(OnSuccess, OnFailure);\r\n}\r\n\r\nfunction m_fnResetAllDBPerms(pageItems) {\r\n  var listItemEnumerator = pageItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n\r\n    if (oListItem.get_item(\"FileLeafRef\") == \"AO_DB.aspx\") {\r\n      var arrOffices = Audit.Common.Utilities.GetActionOffices();\r\n      m_fnResetPageDBPerms(oListItem, arrOffices);\r\n    } else if (oListItem.get_item(\"FileLeafRef\") == \"RO_DB.aspx\") {\r\n      var arrOffices = Audit.Common.Utilities.GetRequestingOffices();\r\n      m_fnResetPageDBPerms(oListItem, arrOffices);\r\n    }\r\n  }\r\n}\r\n\r\n//always check ao permissions and reset them\r\nfunction m_fnResetAODBPerms(pageItems) {\r\n  var listItemEnumerator = pageItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n\r\n    var bReset = false;\r\n\r\n    if (!oListItem.get_hasUniqueRoleAssignments()) bReset = true;\r\n\r\n    var arrAOs = Audit.Common.Utilities.GetActionOffices();\r\n\r\n    if (!bReset) {\r\n      // check to see if all action offices have access to the AO_DB.aspx page\r\n      if (arrAOs != null) {\r\n        for (var x = 0; x < arrAOs.length; x++) {\r\n          var bFound = false;\r\n\r\n          var actionOfficeGroup = arrAOs[x].userGroup;\r\n          if (actionOfficeGroup != null && actionOfficeGroup != \"\") {\r\n            var roleAssignments = oListItem.get_roleAssignments();\r\n            var rolesEnumerator = roleAssignments.getEnumerator();\r\n            while (rolesEnumerator.moveNext()) {\r\n              var role = rolesEnumerator.get_current();\r\n              var roleMember = role.get_member();\r\n              var memeberLoginName = roleMember.get_loginName();\r\n              var memberTitleName = roleMember.get_title();\r\n\r\n              if (memberTitleName == actionOfficeGroup) bFound = true;\r\n            }\r\n\r\n            if (!bFound) {\r\n              bReset = true;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (bReset) {\r\n      //if at least one doesnt have access, reset the permissions on that page\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      const currentUser = web.get_currentUser();\r\n      const ownerGroup = web.get_associatedOwnerGroup();\r\n      const memberGroup = web.get_associatedMemberGroup();\r\n      const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n      oListItem.resetRoleInheritance();\r\n      oListItem.breakRoleInheritance(false, false);\r\n\r\n      var roleDefBindingCollContribute =\r\n        SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n      roleDefBindingCollContribute.add(\r\n        web.get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n      );\r\n\r\n      var roleDefBindingCollRestrictedRead =\r\n        SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n      roleDefBindingCollRestrictedRead.add(\r\n        web.get_roleDefinitions().getByName(\"Restricted Read\")\r\n      );\r\n\r\n      //add site associated groups\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(ownerGroup, roleDefBindingCollContribute);\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(memberGroup, roleDefBindingCollContribute);\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .getByPrincipal(currentUser)\r\n        .deleteObject();\r\n\r\n      //Need to break up adding AOs because it exceeds the resource limit (request uses too many resources)\r\n      function onUpdatAOPageSucceeded() {\r\n        //add action offices\r\n        if (arrAOs != null && arrAOs.length > 0) {\r\n          for (var x = 0; x < arrAOs.length; x++) {\r\n            var actionOfficeGroupName = arrAOs[x].userGroup;\r\n            var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n              actionOfficeGroupName\r\n            );\r\n\r\n            if (actionOfficeGroup != null && actionOfficeGroup != \"\") {\r\n              var roleDefBindingCollRestrictedRead =\r\n                SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n              roleDefBindingCollRestrictedRead.add(\r\n                web.get_roleDefinitions().getByName(\"Restricted Read\")\r\n              );\r\n\r\n              this.item\r\n                .get_roleAssignments()\r\n                .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n\r\n              function onUpdatAOPageSucceeded2() {}\r\n              function onUpdatAOPageFailed2(sender, args) {\r\n                //statusId = SP.UI.Status.addStatus(\"Request failed: \"  + args.get_message() + \"\\n\" + args.get_stackTrace());\r\n              }\r\n              currCtx.executeQueryAsync(\r\n                Function.createDelegate(data, onUpdatAOPageSucceeded2),\r\n                Function.createDelegate(data, onUpdatAOPageFailed2)\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      function onUpdatAOPageFailed(sender, args) {\r\n        const statusId = SP.UI.Status.addStatus(\r\n          \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n        );\r\n      }\r\n\r\n      var data = { item: oListItem };\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onUpdatAOPageSucceeded),\r\n        Function.createDelegate(data, onUpdatAOPageFailed)\r\n      );\r\n    }\r\n    break;\r\n  }\r\n}\r\n\r\n//always check\r\nfunction m_fnCheckForEAEmailFolder(emailListFolderItemsEA) {\r\n  var bFound = false;\r\n  var listItemEnumerator = emailListFolderItemsEA.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n    bFound = true;\r\n    break;\r\n  }\r\n\r\n  if (!bFound) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var emailList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n\r\n    var itemCreateInfo = new SP.ListItemCreationInformation();\r\n    itemCreateInfo.set_underlyingObjectType(SP.FileSystemObjectType.folder);\r\n    itemCreateInfo.set_leafName(\"EANotifications\");\r\n    const oNewEmailFolder = emailList.addItem(itemCreateInfo);\r\n    oNewEmailFolder.set_item(\"Title\", \"EANotifications\");\r\n    oNewEmailFolder.update();\r\n\r\n    const currentUser = web.get_currentUser();\r\n    const ownerGroup = web.get_associatedOwnerGroup();\r\n    const memberGroup = web.get_associatedMemberGroup();\r\n    const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n    oNewEmailFolder.resetRoleInheritance();\r\n    oNewEmailFolder.breakRoleInheritance(false, false);\r\n\r\n    var roleDefBindingCollAdmin =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollAdmin.add(\r\n      web.get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n    );\r\n\r\n    var roleDefBindingCollContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollContribute.add(\r\n      web.get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedRead =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedRead.add(\r\n      web.get_roleDefinitions().getByName(\"Restricted Read\")\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedContribute.add(\r\n      web.get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n    );\r\n\r\n    //add associated site groups\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(ownerGroup, roleDefBindingCollAdmin);\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(memberGroup, roleDefBindingCollContribute);\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null)\r\n      oNewEmailFolder\r\n        .get_roleAssignments()\r\n        .add(spGroupQA, roleDefBindingCollRestrictedContribute);\r\n\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .getByPrincipal(currentUser)\r\n      .deleteObject();\r\n\r\n    //Need to break up adding AOs because it exceeds the resource limit (request uses too many resources)\r\n    function onUpdatePermsSucceeded() {\r\n      //alert(\"done\");\r\n    }\r\n\r\n    function onUpdatePermsFailed(sender, args) {\r\n      const statusId = SP.UI.Status.addStatus(\r\n        \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    var data = {};\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onUpdatePermsSucceeded),\r\n      Function.createDelegate(data, onUpdatePermsFailed)\r\n    );\r\n  }\r\n}\r\n\r\n//QA doesnt have edit permissions rights on the response/response folder\r\n//Therefore, when IA gets alerted that the response has been updated by QA, check if response status is updated\r\n//and then update the permissions\r\nasync function m_fnCheckIfResponsePermissionsNeedUpdating(\r\n  requestStatus,\r\n  title,\r\n  OnCompletedChecking\r\n) {\r\n  const oResponse = m_bigMap[\"response-\" + title];\r\n\r\n  if (!oResponse) return;\r\n  await m_fnBreakResponseAndFolderPermissions(\r\n    requestStatus,\r\n    oResponse,\r\n    false,\r\n    true,\r\n    false,\r\n    false\r\n  );\r\n  return true;\r\n}\r\n\r\nfunction LoadRequests(m_requestItems) {\r\n  // m_bigMap = new Object();\r\n  const arrRequests = new Array();\r\n\r\n  try {\r\n    var listItemEnumerator = m_requestItems.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var id = oListItem.get_item(\"ID\");\r\n      var number = oListItem.get_item(\"Title\");\r\n      var status = oListItem.get_item(\"ReqStatus\");\r\n      const reqType = oListItem.get_item(\"ReqType\");\r\n\r\n      var subject = oListItem.get_item(\"ReqSubject\");\r\n      if (subject == null) subject = \"\";\r\n\r\n      var sensitivity = oListItem.get_item(\"Sensitivity\");\r\n      if (sensitivity == null) sensitivity = \"None\";\r\n\r\n      var requestingOffice = oListItem.get_item(\"RequestingOffice\");\r\n      if (requestingOffice != null)\r\n        requestingOffice = requestingOffice.get_lookupValue();\r\n      else requestingOffice = \"\";\r\n\r\n      var fiscalYear = oListItem.get_item(\"FiscalYear\");\r\n      var sample = oListItem.get_item(\"IsSample\");\r\n      var dueDate = oListItem.get_item(\"ReqDueDate\");\r\n      var internalDueDate = oListItem.get_item(\"InternalDueDate\");\r\n      var receiptDate = oListItem.get_item(\"ReceiptDate\");\r\n      var closedDate = oListItem.get_item(\"ClosedDate\");\r\n\r\n      dueDate != null\r\n        ? (dueDate = dueDate.format(\"yyyy-MM-dd\"))\r\n        : (dueDate = \"\");\r\n      internalDueDate != null\r\n        ? (internalDueDate = internalDueDate.format(\"yyyy-MM-dd\"))\r\n        : (internalDueDate = \"\");\r\n      receiptDate != null\r\n        ? (receiptDate = receiptDate.format(\"yyyy-MM-dd\"))\r\n        : (receiptDate = \"\");\r\n      closedDate != null\r\n        ? (closedDate = closedDate.format(\"yyyy-MM-dd\"))\r\n        : (closedDate = \"\");\r\n\r\n      var arrAOs = new Array();\r\n      var arrActionOffice = oListItem.get_item(\"ActionOffice\");\r\n      if (arrActionOffice.length > 0) {\r\n        var tempAOs = new Array();\r\n        for (var x = 0; x < arrActionOffice.length; x++)\r\n          tempAOs.push(arrActionOffice[x].get_lookupValue());\r\n        tempAOs = tempAOs.sort();\r\n\r\n        for (var x = 0; x < tempAOs.length; x++)\r\n          arrAOs.push({ ao: tempAOs[x] });\r\n      }\r\n\r\n      var arrEmailAOs = new Array();\r\n      var arrEmailActionOffice = oListItem.get_item(\"EmailActionOffice\");\r\n      if (arrEmailActionOffice.length > 0) {\r\n        var tempAOs = new Array();\r\n        for (var x = 0; x < arrEmailActionOffice.length; x++)\r\n          tempAOs.push(arrEmailActionOffice[x].get_lookupValue());\r\n        tempAOs = tempAOs.sort();\r\n\r\n        for (var x = 0; x < tempAOs.length; x++)\r\n          arrEmailAOs.push({ ao: tempAOs[x] });\r\n      }\r\n\r\n      var comments = oListItem.get_item(\"Comments\");\r\n      var emailSent = oListItem.get_item(\"EmailSent\");\r\n      var reviewer = oListItem.get_item(\"Reviewer\");\r\n      var owner = oListItem.get_item(\"Owner\");\r\n      var relatedAudit = oListItem.get_item(\"RelatedAudit\");\r\n      var actionItems = oListItem.get_item(\"ActionItems\");\r\n\r\n      if (comments == null) comments = \"\";\r\n      if (reviewer == null) reviewer = \"\";\r\n      if (owner == null) owner = \"\";\r\n      if (relatedAudit == null) relatedAudit = \"\";\r\n      if (actionItems == null) actionItems = \"\";\r\n\r\n      var closedBy = Audit.Common.Utilities.GetFriendlyDisplayName(\r\n        oListItem,\r\n        \"ClosedBy\"\r\n      );\r\n\r\n      // We may be reloading data from another query, don't break any references\r\n      var requestObject = m_bigMap[\"request-\" + number] ?? {};\r\n      requestObject[\"ID\"] = id;\r\n      requestObject[\"reqType\"] = reqType;\r\n      requestObject[\"number\"] = number;\r\n      requestObject[\"subject\"] = subject;\r\n      requestObject[\"sensitivity\"] = sensitivity;\r\n      requestObject[\"requestingOffice\"] = requestingOffice;\r\n      requestObject[\"fiscalYear\"] = fiscalYear;\r\n      requestObject[\"dueDate\"] = dueDate;\r\n      requestObject[\"status\"] = status;\r\n      requestObject[\"internalDueDate\"] = internalDueDate;\r\n      requestObject[\"sample\"] = sample;\r\n      requestObject[\"requestDocs\"] = new Array();\r\n      requestObject[\"coversheets\"] = new Array();\r\n      requestObject[\"responses\"] = new Array();\r\n      requestObject[\"responsesOpenCnt\"] = 0;\r\n      requestObject[\"actionOffices\"] = arrAOs;\r\n      requestObject[\"emailActionOffices\"] = arrEmailAOs;\r\n      requestObject[\"comments\"] = comments;\r\n      requestObject[\"emailSent\"] = emailSent;\r\n      requestObject[\"closedDate\"] = closedDate;\r\n      requestObject[\"closedBy\"] = closedBy;\r\n      requestObject[\"reviewer\"] = reviewer;\r\n      requestObject[\"owner\"] = owner;\r\n      requestObject[\"receiptDate\"] = receiptDate;\r\n      requestObject[\"relatedAudit\"] = relatedAudit;\r\n      requestObject[\"actionItems\"] = actionItems;\r\n      requestObject[\"specialPerms\"] = null;\r\n      requestObject[\"item\"] = oListItem;\r\n\r\n      arrRequests.push(requestObject);\r\n\r\n      m_bigMap[\"request-\" + number] = requestObject;\r\n    }\r\n  } catch (err) {\r\n    alert(err);\r\n  }\r\n  return arrRequests;\r\n}\r\nfunction LoadRequestsInternal(m_requestInternalItems) {\r\n  // Also load our Internal Request Status here and bolt these objects onto the requests\r\n  try {\r\n    var listItemEnumerator = m_requestInternalItems.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var id = oListItem.get_item(\"ID\");\r\n      var reqNum = oListItem.get_item(\"ReqNum\");\r\n\r\n      if (!reqNum || !reqNum.get_lookupValue()) {\r\n        console.warn(\"Unaffiliated Internal Status ID:\", id);\r\n        continue;\r\n      }\r\n\r\n      var requestObject = m_fnGetRequestByNumber(reqNum.get_lookupValue());\r\n      if (!requestObject) continue;\r\n\r\n      requestObject.internalStatus = new CommentChainModuleLegacy(id, {\r\n        requestListTitle: Audit.Common.Utilities.GetListTitleRequestsInternal(),\r\n        columnName: \"InternalStatus\",\r\n        initialValue: oListItem.get_item(\"InternalStatus\"),\r\n      });\r\n      requestObject.activeViewers = new ActiveViewersModuleLegacy(id, {\r\n        requestListTitle: Audit.Common.Utilities.GetListTitleRequestsInternal(),\r\n        columnName: \"ActiveViewers\",\r\n        initialValue: oListItem.get_item(\"ActiveViewers\"),\r\n      });\r\n      // break;\r\n    }\r\n  } catch (err) {\r\n    alert(err);\r\n  }\r\n}\r\n\r\nfunction LoadResponses(responseItemsColl) {\r\n  try {\r\n    var listItemEnumerator = responseItemsColl.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var number = oListItem.get_item(\"ReqNum\");\r\n      if (number != null) {\r\n        number = number.get_lookupValue();\r\n\r\n        if (number == null)\r\n          //this will happen if the request was deleted but the responses weren't\r\n          continue;\r\n\r\n        var oRequestBigMap = m_bigMap[\"request-\" + number];\r\n\r\n        var returnReason = oListItem.get_item(\"ReturnReason\");\r\n        if (returnReason == null) returnReason = \"\";\r\n\r\n        var title = oListItem.get_item(\"Title\");\r\n        var responseObject = m_bigMap[\"response-\" + title] ?? new Object();\r\n        responseObject[\"ID\"] = oListItem.get_item(\"ID\");\r\n        responseObject[\"number\"] = number;\r\n        responseObject[\"title\"] = title;\r\n        responseObject[\"item\"] = oListItem;\r\n\r\n        var comments = oListItem.get_item(\"Comments\");\r\n        try {\r\n          comments = $(comments).html();\r\n          if (comments == null || comments == \"\")\r\n            responseObject[\"comments\"] = \"\";\r\n          else {\r\n            comments = comments.replace(/[^a-z0-9\\s]/gi, \" \");\r\n            responseObject[\"comments\"] = comments;\r\n          }\r\n        } catch (commentsErr) {\r\n          if (comments == null || comments == \"\")\r\n            responseObject[\"comments\"] = \"\";\r\n          comments = comments.replace(/[^a-z0-9\\s]/gi, \" \");\r\n          responseObject[\"comments\"] = comments;\r\n        }\r\n\r\n        var modified = oListItem\r\n          .get_item(\"Modified\")\r\n          .format(\"yyyy-MM-dd hh:mm tt\");\r\n        responseObject[\"modified\"] = modified;\r\n\r\n        var closedDate = oListItem.get_item(\"ClosedDate\");\r\n        closedDate != null\r\n          ? (closedDate = closedDate.format(\"yyyy-MM-dd\"))\r\n          : (closedDate = \"\");\r\n        responseObject[\"closedDate\"] = closedDate;\r\n\r\n        responseObject[\"closedBy\"] =\r\n          Audit.Common.Utilities.GetFriendlyDisplayName(oListItem, \"ClosedBy\");\r\n\r\n        responseObject[\"sample\"] = oListItem.get_item(\"SampleNumber\");\r\n        if (responseObject[\"sample\"] == null) responseObject[\"sample\"] = \"\";\r\n\r\n        responseObject[\"actionOffice\"] = oListItem.get_item(\"ActionOffice\");\r\n        if (responseObject[\"actionOffice\"] == null)\r\n          responseObject[\"actionOffice\"] = \"\";\r\n        else\r\n          responseObject[\"actionOffice\"] =\r\n            responseObject[\"actionOffice\"].get_lookupValue();\r\n\r\n        responseObject[\"poc\"] = oListItem.get_item(\"POC\");\r\n        if (responseObject[\"poc\"] == null) responseObject[\"poc\"] = \"\";\r\n        else responseObject[\"poc\"] = responseObject[\"poc\"].get_email();\r\n\r\n        responseObject[\"pocCC\"] = oListItem.get_item(\"POCCC\");\r\n        if (responseObject[\"pocCC\"] == null) responseObject[\"pocCC\"] = \"\";\r\n        else responseObject[\"pocCC\"] = responseObject[\"pocCC\"].get_email();\r\n\r\n        responseObject[\"returnReason\"] = returnReason;\r\n        responseObject[\"resStatus\"] = oListItem.get_item(\"ResStatus\");\r\n\r\n        if (responseObject[\"resStatus\"] != \"7-Closed\")\r\n          oRequestBigMap.responsesOpenCnt = oRequestBigMap.responsesOpenCnt + 1; //\tm_arrRequests[x].responsesOpenCnt = m_arrRequests[x].responsesOpenCnt + 1;\r\n\r\n        responseObject[\"responseDocs\"] = new Array();\r\n        responseObject[\"responseFolderItem\"] = null;\r\n\r\n        //m_arrRequests[x][\"responses\"].push( responseObject );\r\n        oRequestBigMap.responses.push(responseObject);\r\n        m_bigMap[\"response-\" + title] = responseObject;\r\n      }\r\n    }\r\n  } catch (err) {\r\n    alert(err);\r\n  }\r\n}\r\n\r\nfunction LoadResponseDocs(m_ResponseDocsItems) {\r\n  _myViewModel.arrResponseDocsCheckedOut([]);\r\n  _myViewModel.arrResponseDocsCheckedOut.valueHasMutated();\r\n  var arrResponseDocsCheckedOut = new Array();\r\n\r\n  m_fnMapResponseDocs(m_ResponseDocsItems, m_bigMap);\r\n\r\n  var listItemEnumerator = m_ResponseDocsItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n\r\n    const checkedOutBy = Audit.Common.Utilities.GetFriendlyDisplayName(\r\n      oListItem,\r\n      \"CheckoutUser\"\r\n    );\r\n\r\n    if (checkedOutBy != \"\") {\r\n      var requestNumber = oListItem.get_item(\"ReqNum\");\r\n      if (requestNumber != null)\r\n        requestNumber = requestNumber.get_lookupValue();\r\n\r\n      var oResponseDocCheckedOut = new Object();\r\n      oResponseDocCheckedOut[\"number\"] = requestNumber;\r\n      oResponseDocCheckedOut[\"title\"] = oListItem.get_item(\"Title\");\r\n      oResponseDocCheckedOut[\"checkedOutBy\"] = checkedOutBy;\r\n\r\n      arrResponseDocsCheckedOut.push(oResponseDocCheckedOut);\r\n    }\r\n  }\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrResponseDocsCheckedOut(),\r\n    arrResponseDocsCheckedOut\r\n  );\r\n  _myViewModel.arrResponseDocsCheckedOut.valueHasMutated();\r\n}\r\n\r\nfunction m_fnMapResponseDocs(responseDocItemsColl, m_bigMap) {\r\n  try {\r\n    var listItemEnumerator = responseDocItemsColl.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var responseDocID = oListItem.get_item(\"ID\");\r\n\r\n      var requestNumber = oListItem.get_item(\"ReqNum\");\r\n      if (requestNumber != null)\r\n        requestNumber = requestNumber.get_lookupValue();\r\n\r\n      var responseID = oListItem.get_item(\"ResID\");\r\n      if (responseID != null) responseID = responseID.get_lookupValue();\r\n\r\n      if (requestNumber == null || responseID == null) continue;\r\n\r\n      var oRequest = m_bigMap[\"request-\" + requestNumber];\r\n      if (!oRequest) continue;\r\n\r\n      const oResponse = oRequest.responses.find(\r\n        (response) => response.title == responseID\r\n      );\r\n      if (!oResponse) continue;\r\n\r\n      var responseDocObject = new Object();\r\n      responseDocObject[\"ID\"] = oListItem.get_item(\"ID\");\r\n      responseDocObject[\"response\"] = oResponse;\r\n      responseDocObject[\"request\"] = oRequest;\r\n      responseDocObject[\"fileName\"] = oListItem.get_item(\"FileLeafRef\");\r\n      responseDocObject[\"title\"] = oListItem.get_item(\"Title\");\r\n      if (responseDocObject[\"title\"] == null) responseDocObject[\"title\"] = \"\";\r\n      responseDocObject[\"folder\"] = oListItem.get_item(\"FileDirRef\");\r\n      responseDocObject[\"documentStatus\"] =\r\n        oListItem.get_item(\"DocumentStatus\");\r\n      responseDocObject[\"rejectReason\"] = oListItem.get_item(\"RejectReason\");\r\n      if (responseDocObject[\"rejectReason\"] == null)\r\n        responseDocObject[\"rejectReason\"] = \"\";\r\n      else\r\n        responseDocObject[\"rejectReason\"] = responseDocObject[\r\n          \"rejectReason\"\r\n        ].replace(/(\\r\\n|\\n|\\r)/gm, \"<br/>\");\r\n\r\n      var fileSize = oListItem.get_item(\"File_x0020_Size\");\r\n      fileSize = Audit.Common.Utilities.GetFriendlyFileSize(fileSize);\r\n      responseDocObject[\"fileSize\"] = fileSize;\r\n\r\n      var receiptDate = \"\";\r\n      if (\r\n        oListItem.get_item(\"ReceiptDate\") != null &&\r\n        oListItem.get_item(\"ReceiptDate\") != \"\"\r\n      )\r\n        receiptDate = oListItem.get_item(\"ReceiptDate\").format(\"yyyy-MM-dd\");\r\n      responseDocObject[\"receiptDate\"] = receiptDate;\r\n\r\n      var modifiedDate = \"\";\r\n      if (\r\n        oListItem.get_item(\"Modified\") != null &&\r\n        oListItem.get_item(\"Modified\") != \"\"\r\n      )\r\n        modifiedDate = oListItem\r\n          .get_item(\"Modified\")\r\n          .format(\"yyyy-MM-dd hh:mm tt\");\r\n      responseDocObject[\"modifiedDate\"] = modifiedDate;\r\n\r\n      responseDocObject[\"modifiedBy\"] =\r\n        Audit.Common.Utilities.GetFriendlyDisplayName(oListItem, \"Editor\");\r\n      responseDocObject[\"checkedOutBy\"] =\r\n        Audit.Common.Utilities.GetFriendlyDisplayName(\r\n          oListItem,\r\n          \"CheckoutUser\"\r\n        );\r\n\r\n      if (responseDocObject[\"checkedOutBy\"] != \"\") {\r\n        // arrResponseDocsCheckedOut.push(oResponseDocCheckedOut);\r\n      }\r\n      responseDocObject[\"item\"] = oListItem;\r\n\r\n      oResponse[\"responseDocs\"].push(responseDocObject);\r\n    }\r\n  } catch (err) {\r\n    alert(err);\r\n  }\r\n}\r\n\r\nfunction LoadResponseCounts() {\r\n  const m_arrRequests = m_getArrRequests();\r\n  m_oRequestTitleAndDocCount = new Object();\r\n  m_oResponseTitleAndDocCount = new Object();\r\n\r\n  var requestLength = m_arrRequests.length;\r\n  for (var x = 0; x < requestLength; x++) {\r\n    var oRequest = m_arrRequests[x];\r\n    if (oRequest.responses.length > 0) {\r\n      var responseLength = oRequest.responses.length;\r\n      for (var y = 0; y < responseLength; y++) {\r\n        var responseCount = oRequest.responses[y].responseDocs.length;\r\n        m_oResponseTitleAndDocCount[oRequest.responses[y].title] =\r\n          responseCount;\r\n\r\n        var curCount = m_oRequestTitleAndDocCount[oRequest.number];\r\n        if (curCount == null)\r\n          m_oRequestTitleAndDocCount[oRequest.number] = responseCount;\r\n        else m_oRequestTitleAndDocCount[oRequest.number] += responseCount;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction LoadResponseDocFolders(m_ResponseDocsFoldersItems) {\r\n  m_arrPermissionsResponseFolders = new Array();\r\n\r\n  try {\r\n    var cntToBreak = 0;\r\n    var cntBroken = 0;\r\n\r\n    if (m_ResponseDocsFoldersItems != null) {\r\n      var listItemEnumerator = m_ResponseDocsFoldersItems.getEnumerator();\r\n      while (listItemEnumerator.moveNext()) {\r\n        var oListItem = listItemEnumerator.get_current();\r\n\r\n        var itemName = oListItem.get_displayName();\r\n        var itemId = oListItem.get_id();\r\n        var itemUrl = oListItem.get_item(\"EncodedAbsUrl\");\r\n\r\n        //Set the title if for whatever reason the folder didnt have it's title set\r\n        if (oListItem.get_item(\"Title\") == null) {\r\n          var currCtx = new SP.ClientContext.get_current();\r\n          var web = currCtx.get_web();\r\n\r\n          oListItem.set_item(\"Title\", itemName);\r\n          oListItem.update();\r\n\r\n          function OnSuccessUpdateTitle(sender, args) {}\r\n          function OnFailureUpdateTitle(sender, args) {}\r\n          currCtx.executeQueryAsync(OnSuccessUpdateTitle, OnFailureUpdateTitle);\r\n        }\r\n\r\n        var objFold = new Object();\r\n        objFold[\"ID\"] = itemId;\r\n        objFold[\"ItemName\"] = itemName;\r\n        objFold[\"Item\"] = oListItem;\r\n        objFold[\"UserPermissions\"] = new Array();\r\n        objFold[\"GroupPermissions\"] = new Array();\r\n\r\n        if (m_bIsSiteOwner) {\r\n          var roleAssignments = oListItem.get_roleAssignments();\r\n          var rolesEnumerator = roleAssignments.getEnumerator();\r\n          while (rolesEnumerator.moveNext()) {\r\n            var role = rolesEnumerator.get_current();\r\n            var roleMember = role.get_member();\r\n            var memeberLoginName = roleMember.get_loginName();\r\n            var memberTitleName = roleMember.get_title();\r\n\r\n            var permissionType = \"UserPermissions\";\r\n            var principalType = roleMember.get_principalType();\r\n            if (\r\n              principalType == SP.Utilities.PrincipalType.securityGroup ||\r\n              principalType == SP.Utilities.PrincipalType.sharePointGroup\r\n            ) {\r\n              permissionType = \"GroupPermissions\";\r\n            }\r\n\r\n            var roleDefs = role.get_roleDefinitionBindings();\r\n\r\n            var roleDefsEnumerator = roleDefs.getEnumerator();\r\n            while (roleDefsEnumerator.moveNext()) {\r\n              var rd = roleDefsEnumerator.get_current();\r\n              var rdName = rd.get_name();\r\n\r\n              objFold[permissionType].push(rdName + \" - \" + memberTitleName);\r\n            }\r\n          }\r\n        }\r\n\r\n        m_arrPermissionsResponseFolders.push(objFold);\r\n\r\n        const oResponse = m_bigMap[\"response-\" + itemName];\r\n        if (!oResponse) continue;\r\n        oResponse.responseFolderItem = oListItem;\r\n\r\n        // const oRequest = m_bigMap[\"request-\" + oResponse.number];\r\n\r\n        // for (var x = 0; x < m_arrRequests.length; x++) {\r\n        //   var oRequest = m_arrRequests[x];\r\n        //   for (var y = 0; y < oRequest.responses.length; y++) {\r\n        //     if (oRequest.responses[y].title == itemName) {\r\n        //       oRequest.responses[y].responseFolderItem = oListItem;\r\n        //       m_bigMap[\"response-\" + itemName].responseFolderItem = oListItem;\r\n        //       break;\r\n        //     }\r\n        //   }\r\n        // }\r\n      }\r\n    }\r\n  } catch (err) {}\r\n}\r\n\r\nfunction LoadTabRequestInfoRequestDocs(oRequest) {\r\n  _myViewModel.arrCurrentRequestRequestDocs([]);\r\n  _myViewModel.arrCurrentRequestRequestDocs.valueHasMutated();\r\n  oRequest.requestDocs = new Array();\r\n\r\n  var arrRD = new Array();\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var requestDocLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleRequestDocs());\r\n  var requestDocQuery = new SP.CamlQuery();\r\n  requestDocQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><Where><Eq><FieldRef Name=\"ReqNum\"/><Value Type=\"Text\">' +\r\n      oRequest.number +\r\n      \"</Value></Eq></Where></Query></View>\"\r\n  );\r\n  var m_RequestDocItems = requestDocLib.getItems(requestDocQuery);\r\n  currCtx.load(\r\n    m_RequestDocItems,\r\n    \"Include(ID, Title, ReqNum, FileLeafRef, FileDirRef)\"\r\n  );\r\n\r\n  var data = { oRequest: oRequest };\r\n  function OnSuccess(sender, args) {\r\n    var listItemEnumerator = m_RequestDocItems.getEnumerator();\r\n\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var number = oListItem.get_item(\"ReqNum\");\r\n      if (number != null) {\r\n        number = number.get_lookupValue();\r\n        if (number == oRequest.number) {\r\n          var requestDocObject = new Object();\r\n          requestDocObject[\"ID\"] = oListItem.get_item(\"ID\");\r\n          requestDocObject[\"title\"] = oListItem.get_item(\"FileLeafRef\");\r\n          requestDocObject[\"folder\"] = oListItem.get_item(\"FileDirRef\");\r\n          requestDocObject[\"requestStatus\"] = oRequest.status;\r\n          oRequest.requestDocs.push(requestDocObject);\r\n        }\r\n      }\r\n    }\r\n\r\n    ko.utils.arrayPushAll(\r\n      _myViewModel.arrCurrentRequestRequestDocs(),\r\n      oRequest.requestDocs\r\n    );\r\n    _myViewModel.arrCurrentRequestRequestDocs.valueHasMutated();\r\n  }\r\n  function OnFailure(sender, args) {}\r\n\r\n  currCtx.executeQueryAsync(\r\n    Function.createDelegate(data, OnSuccess),\r\n    Function.createDelegate(data, OnFailure)\r\n  );\r\n}\r\n\r\nasync function LoadTabRequestInfoCoverSheets(oRequest) {\r\n  _myViewModel.arrCurrentRequestCoverSheets([]);\r\n  _myViewModel.arrCurrentRequestCoverSheets.valueHasMutated();\r\n  oRequest.coversheets = new Array();\r\n\r\n  var arrCS = new Array();\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var coverSheetLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleCoverSheets());\r\n  var coverSheetQuery = new SP.CamlQuery();\r\n  coverSheetQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><Where><Eq><FieldRef Name=\"ReqNum\"/><Value Type=\"Text\">' +\r\n      oRequest.number +\r\n      \"</Value></Eq></Where></Query></View>\"\r\n  );\r\n  var m_CoverSheetItems = coverSheetLib.getItems(coverSheetQuery);\r\n  if (m_bIsSiteOwner)\r\n    currCtx.load(\r\n      m_CoverSheetItems,\r\n      \"Include(ID, Title, ReqNum, ActionOffice, FileLeafRef, FileDirRef, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n  else\r\n    currCtx.load(\r\n      m_CoverSheetItems,\r\n      \"Include(ID, Title, ReqNum, ActionOffice, FileLeafRef, FileDirRef)\"\r\n    );\r\n\r\n  await new Promise((resolve, reject) => {\r\n    currCtx.executeQueryAsync(resolve, reject);\r\n  }).catch((e) => {\r\n    console.error(\"Unable to load Coversheets.\");\r\n  });\r\n\r\n  var listItemEnumerator = m_CoverSheetItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n\r\n    var number = oListItem.get_item(\"ReqNum\");\r\n    if (number != null) {\r\n      number = number.get_lookupValue();\r\n      if (number == oRequest.number) {\r\n        //just double checking here\r\n        var coversheetObject = new Object();\r\n        coversheetObject[\"ID\"] = oListItem.get_item(\"ID\");\r\n        coversheetObject[\"number\"] = number;\r\n\r\n        var arrActionOffice = new Array();\r\n        var actionOffices = oListItem.get_item(\"ActionOffice\");\r\n\r\n        if (actionOffices && actionOffices.length > 0) {\r\n          for (var y = 0; y < actionOffices.length; y++) {\r\n            arrActionOffice.push({\r\n              actionOffice: actionOffices[y].get_lookupValue(),\r\n            });\r\n          }\r\n        }\r\n\r\n        coversheetObject[\"actionOffices\"] = arrActionOffice;\r\n        coversheetObject[\"title\"] = oListItem.get_item(\"FileLeafRef\");\r\n        coversheetObject[\"folder\"] = oListItem.get_item(\"FileDirRef\");\r\n        coversheetObject[\"item\"] = oListItem;\r\n        coversheetObject[\"requestStatus\"] = oRequest.status;\r\n\r\n        oRequest.coversheets.push(coversheetObject);\r\n      }\r\n    }\r\n  }\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrCurrentRequestCoverSheets(),\r\n    oRequest.coversheets\r\n  );\r\n  _myViewModel.arrCurrentRequestCoverSheets.valueHasMutated();\r\n}\r\n\r\n//when action office or qa updates the response and it comes back to IA, IA gets emailed a link with the response number; When they open the link in the browser, it will ]\r\n//take them to 2nd tab; When they click on the response (which is filtered), it will display tab 3 with the request details. At that point, it will try to check to see if the response permissions\r\n//need to be updated\r\nasync function m_fnLoadResponseDocFolder(responseTitle, OnComplete) {\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var responseList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n  var responseQuery = new SP.CamlQuery();\r\n  responseQuery.set_viewXml(\r\n    '<View><Query><Where><Eq><FieldRef Name=\"Title\"/><Value Type=\"Text\">' +\r\n      responseTitle +\r\n      \"</Value></Eq></Where></Query></View>\"\r\n  );\r\n  const m_aResponseItem = responseList.getItems(responseQuery);\r\n  //need to check permissions because of granting/removing special perms\r\n  currCtx.load(\r\n    m_aResponseItem,\r\n    \"Include(ID, Title, ReqNum, ActionOffice, ReturnReason, SampleNumber, ResStatus, Comments, Modified, ClosedDate, ClosedBy, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n  );\r\n\r\n  var responseDocsLibFolderslist = currCtx\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n  var responseDocsLibFolderslistQuery = new SP.CamlQuery();\r\n  //include the dash\r\n  responseDocsLibFolderslistQuery.set_viewXml(\r\n    '<View><Query><Where><And><Eq><FieldRef Name=\"Title\"/><Value Type=\"Text\">' +\r\n      responseTitle +\r\n      '</Value></Eq><Eq><FieldRef Name=\"ContentType\" /><Value Type=\"Text\">Folder</Value></Eq></And></Where></Query></View>'\r\n  );\r\n  const m_ResponseDocsFoldersItems = responseDocsLibFolderslist.getItems(\r\n    responseDocsLibFolderslistQuery\r\n  );\r\n  currCtx.load(\r\n    m_ResponseDocsFoldersItems,\r\n    \"Include( DisplayName, Title, Id, EncodedAbsUrl, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n  );\r\n\r\n  await new Promise((resolve, reject) =>\r\n    currCtx.executeQueryAsync(resolve, reject)\r\n  ).catch((sender, args) => {\r\n    return false;\r\n  });\r\n\r\n  var oResponseItem = null;\r\n  //Requery the response item to now have the permissions on the responses; Avoid doing it at the top because it impacts load time\r\n  var listItemEnumerator = m_aResponseItem.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n\r\n    const oResponse = m_bigMap[\"response-\" + responseTitle];\r\n\r\n    if (!oResponse) continue;\r\n    oResponse.item = oListItem;\r\n\r\n    break;\r\n  }\r\n\r\n  LoadResponseDocFolders(m_ResponseDocsFoldersItems); //really, this only runs through the one response and we're only doing this to set the response item's folder so that we can query the permissions on it\r\n  return true;\r\n}\r\n\r\nasync function LoadTabRequestInfoResponses(oRequest) {\r\n  if (m_bIsSiteOwner) {\r\n    /* for this specific response selected, check that the permissions don't need updating*/\r\n    if (m_sGoToResponseTitle != null && m_sGoToResponseTitle != \"\") {\r\n      const doneLoadingThisResponseFolder = await m_fnLoadResponseDocFolder(\r\n        m_sGoToResponseTitle\r\n      );\r\n      if (doneLoadingThisResponseFolder) {\r\n        const doneCheckingResponseFolder =\r\n          await m_fnCheckIfResponsePermissionsNeedUpdating(\r\n            oRequest.status,\r\n            m_sGoToResponseTitle\r\n          );\r\n      }\r\n    }\r\n  }\r\n\r\n  // _myViewModel.arrCurrentRequestResponses([]);\r\n  // _myViewModel.arrCurrentRequestResponses.valueHasMutated();\r\n\r\n  document.body.style.cursor = \"wait\";\r\n  var m_notifyIDLoadingResponses = SP.UI.Notify.addNotification(\r\n    \"Loading Responses...\",\r\n    true\r\n  );\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var responseList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n  var responseQuery = new SP.CamlQuery();\r\n  responseQuery.set_viewXml(\r\n    '<View><Query><Where><Eq><FieldRef Name=\"ReqNum\"/><Value Type=\"Text\">' +\r\n      oRequest.number +\r\n      \"</Value></Eq></Where></Query></View>\"\r\n  );\r\n  var m_subsetResponseItems = responseList.getItems(responseQuery);\r\n  //need to check permissions because of granting/removing special perms\r\n  if (m_bIsSiteOwner)\r\n    currCtx.load(\r\n      m_subsetResponseItems,\r\n      \"Include(ID, Title, ReqNum, ActionOffice, ReturnReason, SampleNumber, ResStatus, Comments, ActiveViewers, Modified, ClosedDate, ClosedBy, POC, POCCC, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n  else\r\n    currCtx.load(\r\n      m_subsetResponseItems,\r\n      \"Include(ID, Title, ReqNum, ActionOffice, ReturnReason, SampleNumber, ResStatus, Comments, ActiveViewers, Modified, ClosedDate, ClosedBy, POC, POCCC)\"\r\n    );\r\n\r\n  var responseDocsLibFolderslist = currCtx\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n  var responseDocsLibFolderslistQuery = new SP.CamlQuery();\r\n  //include the dash\r\n  responseDocsLibFolderslistQuery.set_viewXml(\r\n    '<View><Query><Where><And><BeginsWith><FieldRef Name=\"Title\"/><Value Type=\"Text\">' +\r\n      oRequest.number +\r\n      '-</Value></BeginsWith><Eq><FieldRef Name=\"ContentType\" /><Value Type=\"Text\">Folder</Value></Eq></And></Where></Query></View>'\r\n  );\r\n  const m_ResponseDocsFoldersItems = responseDocsLibFolderslist.getItems(\r\n    responseDocsLibFolderslistQuery\r\n  );\r\n  if (m_bIsSiteOwner)\r\n    currCtx.load(\r\n      m_ResponseDocsFoldersItems,\r\n      \"Include( DisplayName, Title, Id, EncodedAbsUrl, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n  else\r\n    currCtx.load(\r\n      m_ResponseDocsFoldersItems,\r\n      \"Include( DisplayName, Title, Id, EncodedAbsUrl)\"\r\n    );\r\n\r\n  await new Promise((resolve, reject) =>\r\n    currCtx.executeQueryAsync(resolve, (sender, args) =>\r\n      reject({ sender, args })\r\n    )\r\n  ).catch(({ sender, args }) => {\r\n    const statusId = SP.UI.Status.addStatus(\r\n      \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n    SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n    return;\r\n  });\r\n\r\n  LoadResponses(m_subsetResponseItems);\r\n\r\n  var listItemEnumerator = m_subsetResponseItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n    var responseTitle = oListItem.get_item(\"Title\");\r\n\r\n    if (m_bigMap[\"response-\" + responseTitle])\r\n      m_bigMap[\"response-\" + responseTitle].item = oListItem; //update the response item with an item that has the permission attributes\r\n\r\n    if (m_bIsSiteOwner) {\r\n      if (!oListItem.get_hasUniqueRoleAssignments()) {\r\n        m_fnBreakResponsePermissions(oListItem, false, true);\r\n      }\r\n    }\r\n  }\r\n\r\n  LoadResponseDocFolders(m_ResponseDocsFoldersItems);\r\n\r\n  var sResponses = \"\";\r\n  var responseCount = oRequest.responses.length;\r\n\r\n  oRequest.responses.sort(function (a, b) {\r\n    a = parseInt(a.sample, 10);\r\n    b = parseInt(b.sample, 10);\r\n    return a - b;\r\n  });\r\n\r\n  if (responseCount == 0)\r\n    notifyId = SP.UI.Notify.addNotification(\r\n      oRequest.number + \" has 0 responses. Please create a Response\",\r\n      false\r\n    );\r\n\r\n  var arrResponses = new Array();\r\n\r\n  for (var y = 0; y < responseCount; y++) {\r\n    var oResponse = oRequest.responses[y];\r\n\r\n    var groupPerms = \"\";\r\n    for (var x = 0; x < m_arrPermissionsResponseFolders.length; x++) {\r\n      if (m_arrPermissionsResponseFolders[x].ItemName == oResponse.title) {\r\n        const arrGroupPerms =\r\n          m_arrPermissionsResponseFolders[x].GroupPermissions;\r\n\r\n        var grouppermissionsArr = arrGroupPerms.sort();\r\n        grouppermissionsArr.sort(function (a, b) {\r\n          return a.toLowerCase().localeCompare(b.toLowerCase());\r\n        });\r\n\r\n        for (var z = 0; z < grouppermissionsArr.length; z++) {\r\n          groupPerms += \"<div>\" + grouppermissionsArr[z] + \"</div>\";\r\n        }\r\n        break;\r\n      }\r\n    }\r\n    var specialPerms = false;\r\n    if (\r\n      groupPerms.indexOf(Audit.Common.Utilities.GetGroupNameSpecialPerm1()) >=\r\n        0 &&\r\n      groupPerms.indexOf(Audit.Common.Utilities.GetGroupNameSpecialPerm2()) >= 0\r\n    ) {\r\n      specialPerms = true;\r\n    }\r\n\r\n    var arrRequestActionOffices = oRequest.item.get_item(\"ActionOffice\");\r\n    var responseActionOfficeIsInRequest = false;\r\n    if (arrRequestActionOffices != null) {\r\n      for (var x = 0; x < arrRequestActionOffices.length; x++) {\r\n        if (\r\n          arrRequestActionOffices[x].get_lookupValue() == oResponse.actionOffice\r\n        ) {\r\n          responseActionOfficeIsInRequest = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    var styleTag = new Object();\r\n    var toolTip = \"\";\r\n    if (!responseActionOfficeIsInRequest) {\r\n      styleTag = {\r\n        \"background-color\": \"lightsalmon\",\r\n        \"font-style\": \"italic\",\r\n        \"font-weight\": \"bold\",\r\n        color: \"red\",\r\n      };\r\n\r\n      toolTip =\r\n        \"This Action Office is not found in the Action Office list for the Request\";\r\n    }\r\n\r\n    oResponse[\"groupPerms\"] = groupPerms;\r\n    oResponse[\"specialPerms\"] = specialPerms;\r\n    oResponse[\"styleTag\"] = styleTag;\r\n    oResponse[\"toolTip\"] = toolTip;\r\n    oResponse[\"activeViewers\"] = new ActiveViewersModuleLegacy(oResponse.ID, {\r\n      requestListTitle: Audit.Common.Utilities.GetListTitleResponses(),\r\n      columnName: \"ActiveViewers\",\r\n      initialValue: oResponse.item.get_item(\"ActiveViewers\"),\r\n    });\r\n\r\n    arrResponses.push(oResponse);\r\n  }\r\n\r\n  SP.UI.Notify.removeNotification(m_notifyIDLoadingResponses);\r\n  m_notifyIDLoadingResponses = null;\r\n\r\n  // ko.utils.arrayPushAll(_myViewModel.arrCurrentRequestResponses, arrResponses);\r\n\r\n  document.body.style.cursor = \"default\";\r\n\r\n  m_fnHighlightResponse();\r\n}\r\n\r\nfunction m_fnHighlightResponse() {\r\n  if (m_sGoToResponseTitle != null && m_sGoToResponseTitle != \"\") {\r\n    // TODO: this is happening synchronously, but the request detail view may not be fully loaded\r\n    const requestDetailView = _myViewModel.requestDetailViewComponent;\r\n    requestDetailView.highlightResponse(m_sGoToResponseTitle);\r\n    return;\r\n    $(\"[id='response-item-title-\" + m_sGoToResponseTitle + \"']\")\r\n      .parent()\r\n      .css({ \"background-color\": \"palegreen\", \"font-weight\": \"inherit\" });\r\n    $(\"[id='response-item-title-\" + m_sGoToResponseTitle + \"']\")\r\n      .get(0)\r\n      .scrollIntoView();\r\n\r\n    function resetColor(index) {\r\n      $(\"[id='response-item-title-\" + m_sGoToResponseTitle + \"']\")\r\n        .parent()\r\n        .css({ \"background-color\": \"inherit\", \"font-weight\": \"inherit\" });\r\n\r\n      m_sGoToResponseTitle = null;\r\n    }\r\n    setTimeout(function () {\r\n      resetColor(m_sGoToResponseTitle);\r\n    }, 2000);\r\n  }\r\n}\r\n\r\nasync function LoadTabRequestInfoResponseDocs(oRequest) {\r\n  // _myViewModel.arrCurrentRequestResponseDocs.removeAll();\r\n\r\n  // _myViewModel.cntResponseDocs(0);\r\n  // _myViewModel.cntResponseDocs.valueHasMutated();\r\n\r\n  let currCtx = new SP.ClientContext.get_current();\r\n  let web = currCtx.get_web();\r\n\r\n  var responseDocsLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n\r\n  var responseDocsQuery = new SP.CamlQuery();\r\n  responseDocsQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><Where><Eq><FieldRef Name=\"ReqNum\"/><Value Type=\"Text\">' +\r\n      oRequest.number +\r\n      '</Value></Eq></Where><OrderBy><FieldRef Name=\"ReqNum\"/><FieldRef Name=\"ResID\"/></OrderBy><Where><Eq><FieldRef Name=\"ContentType\"/><Value Type=\"Text\">Document</Value></Eq></Where></Query></View>'\r\n  );\r\n  const requestResponseDocsItems = responseDocsLib.getItems(responseDocsQuery);\r\n  currCtx.load(\r\n    requestResponseDocsItems,\r\n    \"Include(ID, Title, ReqNum, ResID, DocumentStatus, RejectReason, ReceiptDate, FileLeafRef, FileDirRef, File_x0020_Size, CheckoutUser, Modified, Editor, Created)\"\r\n  );\r\n\r\n  await new Promise((resolve, reject) =>\r\n    currCtx.executeQueryAsync(resolve, reject)\r\n  );\r\n\r\n  oRequest.responses.map((response) => (response.responseDocs = []));\r\n  m_fnMapResponseDocs(requestResponseDocsItems, m_bigMap);\r\n\r\n  currCtx = new SP.ClientContext.get_current();\r\n  web = currCtx.get_web();\r\n\r\n  var bHasResponseDoc = false;\r\n  if (oRequest && oRequest.responses && oRequest.responses.length > 0) {\r\n    for (var y = 0; y < oRequest.responses.length; y++) {\r\n      var oResponse = oRequest.responses[y];\r\n      if (\r\n        oResponse &&\r\n        oResponse.responseDocs &&\r\n        oResponse.responseDocs.length > 0\r\n      ) {\r\n        for (var z = 0; z < oResponse.responseDocs.length; z++) {\r\n          var oResponseDoc = oResponse.responseDocs[z];\r\n\r\n          //this loads on execute\r\n          oResponseDoc[\"docIcon\"] = web.mapToIcon(\r\n            oResponseDoc.fileName,\r\n            \"\",\r\n            SP.Utilities.IconSize.Size16\r\n          ); // m_siteUrl + \"/\" + _spPageContextInfo.layoutsUrl + \"/images/\" + docIcon;\r\n\r\n          bHasResponseDoc = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!bHasResponseDoc) {\r\n    RequestFinishedLoading();\r\n    return;\r\n  }\r\n\r\n  await executeQuery(currCtx).catch(({ sender, args }) => {\r\n    const statusId = SP.UI.Status.addStatus(\r\n      \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n    SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n  });\r\n\r\n  oRequest.responses.sort(Audit.Common.Utilities.SortResponseObjects);\r\n\r\n  RequestFinishedLoading();\r\n}\r\n\r\nfunction DisplayRequestsThatShouldClose() {\r\n  _myViewModel.arrRequestsThatNeedClosing([]);\r\n  _myViewModel.arrRequestsThatNeedClosing.valueHasMutated();\r\n\r\n  const m_arrRequests = m_getArrRequests();\r\n  if (m_arrRequests == null || m_arrRequests.length == 0) return;\r\n\r\n  m_arrRequestsToClose = new Array();\r\n  for (var x = 0; x < m_arrRequests.length; x++) {\r\n    var oRequest = m_arrRequests[x];\r\n\r\n    if (oRequest.status != \"Closed\") {\r\n      //check if all responses are closed\r\n      var countClosed = 0;\r\n      for (var y = 0; y < oRequest.responses.length; y++) {\r\n        if (oRequest.responses[y].resStatus == \"7-Closed\") countClosed++;\r\n      }\r\n\r\n      if (\r\n        oRequest.responses.length > 0 &&\r\n        oRequest.responses.length == countClosed\r\n      ) {\r\n        var lastClosedDate = null;\r\n        var lastClosedBy = null;\r\n        var lastResponseId = null;\r\n        var oResponse = null;\r\n        var sLastClosedDate = \"\";\r\n\r\n        for (var y = 0; y < oRequest.responses.length; y++) {\r\n          var closedDate = oRequest.responses[y].item.get_item(\"ClosedDate\");\r\n          if (lastClosedDate == null || lastClosedDate < closedDate) {\r\n            lastClosedDate = closedDate;\r\n            lastClosedBy = oRequest.responses[y].closedBy;\r\n            lastResponseId = oRequest.responses[y].title;\r\n            oResponse = oRequest.responses[y];\r\n\r\n            //used in ko databinding\r\n            if (lastClosedDate != null && lastClosedDate != \"\")\r\n              sLastClosedDate = lastClosedDate.format(\"yyyy-MM-dd hh:mm tt\");\r\n          }\r\n        }\r\n\r\n        m_arrRequestsToClose.push({\r\n          number: oRequest.number,\r\n          lastResponseId: lastResponseId,\r\n          lastClosedDate: lastClosedDate,\r\n          lastClosedBy: lastClosedBy,\r\n          sLastClosedDate: sLastClosedDate,\r\n          oResponse: oResponse,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrRequestsThatNeedClosing(),\r\n    m_arrRequestsToClose\r\n  );\r\n  _myViewModel.arrRequestsThatNeedClosing.valueHasMutated();\r\n}\r\n\r\nfunction LoadTabStatusReport1() {\r\n  const arr = m_getArrRequests();\r\n\r\n  _myViewModel.arrRequests([]);\r\n  _myViewModel.arrRequests.valueHasMutated();\r\n\r\n  _myViewModel.arrRequestsInternalAlmostDue([]);\r\n  _myViewModel.arrRequestsInternalAlmostDue.valueHasMutated();\r\n\r\n  _myViewModel.arrRequestsAlmostDue([]);\r\n  _myViewModel.arrRequestsAlmostDue.valueHasMutated();\r\n\r\n  _myViewModel.arrRequestsInternalPastDue([]);\r\n  _myViewModel.arrRequestsInternalPastDue.valueHasMutated();\r\n\r\n  _myViewModel.arrRequestsPastDue([]);\r\n  _myViewModel.arrRequestsPastDue.valueHasMutated();\r\n\r\n  _myViewModel.arrRequestsWithNoResponses([]);\r\n  _myViewModel.arrRequestsWithNoResponses.valueHasMutated();\r\n\r\n  _myViewModel.arrRequestsWithNoEmailSent([]);\r\n  _myViewModel.arrRequestsWithNoEmailSent.valueHasMutated();\r\n\r\n  if (arr == null) return;\r\n\r\n  //var bLoadTest = GetUrlKeyValue(\"LoadTest\");\r\n\r\n  var requestArr = new Array();\r\n  var arrInternalAlmostDue = new Array();\r\n  var arrInternalPastDue = new Array();\r\n  var arrAlmostDue = new Array();\r\n  var arrPastDue = new Array();\r\n  var arrRequestsWithNoResponses = new Array();\r\n  var arrRequestsWithNoEmailSent = new Array();\r\n\r\n  var arrLength = arr.length;\r\n  while (arrLength--) {\r\n    var oRequest = arr[arrLength];\r\n\r\n    var internalDueDateStyle = \"\";\r\n    var dueDateStyle = \"\";\r\n    if (m_fnIsRequestPastDue(oRequest, oRequest.internalDueDate)) {\r\n      internalDueDateStyle = \"past-due\";\r\n      arrInternalPastDue.push({\r\n        title: oRequest.number,\r\n        number: oRequest.number,\r\n        internalDueDate: oRequest.internalDueDate,\r\n        dueDate: oRequest.dueDate,\r\n      });\r\n    } else if (m_fnIsRequestAlmostDue(oRequest, oRequest.internalDueDate)) {\r\n      internalDueDateStyle = \"almost-due\";\r\n      arrInternalAlmostDue.push({\r\n        title: oRequest.number,\r\n        number: oRequest.number,\r\n        internalDueDate: oRequest.internalDueDate,\r\n        dueDate: oRequest.dueDate,\r\n      });\r\n    }\r\n\r\n    if (m_fnIsRequestPastDue(oRequest, oRequest.dueDate)) {\r\n      dueDateStyle = \"past-due\";\r\n      arrPastDue.push({\r\n        title: oRequest.number,\r\n        number: oRequest.number,\r\n        internalDueDate: oRequest.internalDueDate,\r\n        dueDate: oRequest.dueDate,\r\n      });\r\n    } else if (m_fnIsRequestAlmostDue(oRequest, oRequest.dueDate)) {\r\n      dueDateStyle = \"almost-due\";\r\n      arrAlmostDue.push({\r\n        title: oRequest.number,\r\n        number: oRequest.number,\r\n        internalDueDate: oRequest.internalDueDate,\r\n        dueDate: oRequest.dueDate,\r\n      });\r\n    }\r\n\r\n    if (oRequest.responses.length == 0)\r\n      arrRequestsWithNoResponses.push({\r\n        title: oRequest.number,\r\n        number: oRequest.number,\r\n      });\r\n\r\n    if (!oRequest.emailSent)\r\n      arrRequestsWithNoEmailSent.push({\r\n        title: oRequest.number,\r\n        number: oRequest.number,\r\n      });\r\n\r\n    var resCount = m_oRequestTitleAndDocCount[oRequest.number];\r\n    if (!resCount) resCount = 0;\r\n\r\n    var aRequest = {\r\n      reqNumber: oRequest.number,\r\n      subject: oRequest.subject,\r\n      sensitivity: oRequest.sensitivity,\r\n      requestingOffice: oRequest.requestingOffice,\r\n      status: oRequest.status,\r\n      internalDueDate: oRequest.internalDueDate,\r\n      dueDate: oRequest.dueDate,\r\n      internalDueDateStyle: internalDueDateStyle,\r\n      dueDateStyle: dueDateStyle,\r\n      sample: oRequest.sample,\r\n      sentEmail: oRequest.emailSent,\r\n      actionOffices: oRequest.actionOffices,\r\n      emailActionOffices: oRequest.emailActionOffices,\r\n      responseCount: oRequest.responses.length,\r\n      responsesOpenCount: oRequest.responsesOpenCnt,\r\n      responseDocCount: resCount,\r\n    };\r\n    requestArr.push(aRequest);\r\n\r\n    /*if( bLoadTest )\r\n\t\t\t{\r\n\t\t\t\tfor( var z = 0; z < 99; z++)\r\n\t\t\t\t{\r\n\t\t\t\t\trequestArr.push( aRequest );\r\n\t\t\t\t}\r\n\t\t\t}*/\r\n  }\r\n\r\n  ko.utils.arrayPushAll(_myViewModel.arrRequests, requestArr);\r\n  _myViewModel.arrRequests.valueHasMutated();\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrRequestsInternalAlmostDue(),\r\n    arrInternalAlmostDue\r\n  );\r\n  _myViewModel.arrRequestsInternalAlmostDue.valueHasMutated();\r\n\r\n  ko.utils.arrayPushAll(_myViewModel.arrRequestsAlmostDue(), arrAlmostDue);\r\n  _myViewModel.arrRequestsAlmostDue.valueHasMutated();\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrRequestsInternalPastDue(),\r\n    arrInternalPastDue\r\n  );\r\n  _myViewModel.arrRequestsInternalPastDue.valueHasMutated();\r\n\r\n  ko.utils.arrayPushAll(_myViewModel.arrRequestsPastDue(), arrPastDue);\r\n  _myViewModel.arrRequestsPastDue.valueHasMutated();\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrRequestsWithNoResponses(),\r\n    arrRequestsWithNoResponses\r\n  );\r\n  _myViewModel.arrRequestsWithNoResponses.valueHasMutated();\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrRequestsWithNoEmailSent(),\r\n    arrRequestsWithNoEmailSent\r\n  );\r\n  _myViewModel.arrRequestsWithNoEmailSent.valueHasMutated();\r\n}\r\n\r\nfunction LoadTabStatusReport2() {\r\n  const arr = m_getArrRequests();\r\n  if (arr == null) return;\r\n\r\n  _myViewModel.arrResponsesWithUnsubmittedResponseDocs([]);\r\n\r\n  var arrSubmittedResponsesByAO = new Array();\r\n  var arrUnsubmittedResponseDocs = [];\r\n  const arrResponsesReadyToClose = [];\r\n\r\n  //var bLoadTest = GetUrlKeyValue(\"LoadTest\");\r\n  var responseArr = new Array();\r\n\r\n  var requestLength = arr.length;\r\n\r\n  function responseReadyToClose(response) {\r\n    if (response.resStatus == AuditResponseStates.Closed) return false;\r\n    return (\r\n      response.responseDocs.length &&\r\n      !response.responseDocs.find((responseDoc) =>\r\n        [\r\n          AuditResponseDocStates.Open,\r\n          AuditResponseDocStates.Submitted,\r\n        ].includes(responseDoc.documentStatus)\r\n      )\r\n    );\r\n  }\r\n\r\n  for (var x = 0; x < requestLength; x++) {\r\n    var oRequest = arr[x];\r\n\r\n    var responseLength = oRequest.responses.length;\r\n    for (var y = 0; y < responseLength; y++) {\r\n      var oResponse = oRequest.responses[y];\r\n\r\n      var responseTitle = oResponse.title;\r\n      var responseStatus = oResponse.resStatus;\r\n\r\n      var resCount = m_oResponseTitleAndDocCount[oResponse.title];\r\n      if (!resCount) resCount = 0;\r\n\r\n      var responseUnsubmittedDocs = [];\r\n      if (\r\n        resCount &&\r\n        [AuditResponseStates.Open, AuditResponseStates.ReturnedToAO].includes(\r\n          responseStatus\r\n        )\r\n      ) {\r\n        // Check if there are unsubmitted response docs\r\n        responseUnsubmittedDocs = oResponse.responseDocs.filter(\r\n          (responseDoc) =>\r\n            responseDoc.documentStatus == AuditResponseDocStates.Open\r\n        );\r\n      }\r\n\r\n      var aResponse = {\r\n        visibleRow: ko.observable(true),\r\n        reqNumber: oRequest.number,\r\n        sample: oResponse.sample,\r\n        title: responseTitle,\r\n        internalDueDate: oRequest.internalDueDate,\r\n        status: responseStatus,\r\n        ao: oResponse.actionOffice,\r\n        docCount: resCount,\r\n        modified: oResponse.modified,\r\n        request: ko.observable(oRequest),\r\n      };\r\n      responseArr.push(aResponse);\r\n\r\n      if (\r\n        oRequest.reqType == AUDITREQUESTTYPES.TASKER &&\r\n        responseReadyToClose(oResponse)\r\n      ) {\r\n        arrResponsesReadyToClose.push(oResponse);\r\n      }\r\n      /*if( bLoadTest )\r\n\t\t\t\t{\r\n\t\t\t\t\tfor( var z = 0; z < 99; z++ )\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tresponseArr.push( aResponse );\r\n\t\t\t\t\t}\r\n\t\t\t\t}*/\r\n\r\n      if (oResponse.resStatus == \"2-Submitted\")\r\n        arrSubmittedResponsesByAO.push({\r\n          title: oResponse.title,\r\n          number: oRequest.number,\r\n        });\r\n\r\n      if (responseUnsubmittedDocs.length) {\r\n        arrUnsubmittedResponseDocs.push({\r\n          title: oResponse.title,\r\n          number: oRequest.number,\r\n          unsubmittedDocs: responseUnsubmittedDocs,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  //if( bLoadTest )\r\n  //\t_myViewModel.debugMode( true );\r\n\r\n  if (responseArr.length > 0) {\r\n    ko.utils.arrayPushAll(_myViewModel.arrResponses, responseArr);\r\n    _myViewModel.arrResponses.valueHasMutated();\r\n  }\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrResponsesSubmittedByAO(),\r\n    arrSubmittedResponsesByAO\r\n  );\r\n  _myViewModel.arrResponsesSubmittedByAO.valueHasMutated();\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrResponsesReadyToClose,\r\n    arrResponsesReadyToClose\r\n  );\r\n\r\n  ko.utils.arrayPushAll(\r\n    _myViewModel.arrResponsesWithUnsubmittedResponseDocs,\r\n    arrUnsubmittedResponseDocs\r\n  );\r\n\r\n  _myViewModel.filterStatusTables(true);\r\n  _myViewModel.showQuickInfo(_myViewModel.alertQuickInfo());\r\n}\r\n\r\nfunction m_fnViewLateRequests() {\r\n  window.open(\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n      \"/pages/AuditReport_RequestsStatus.aspx\",\r\n    \"_blank\"\r\n  );\r\n}\r\n\r\nfunction m_fnViewPermissions() {\r\n  window.open(\r\n    Audit.Common.Utilities.GetSiteUrl() + \"/pages/AuditPermissions.aspx\",\r\n    \"_blank\"\r\n  );\r\n}\r\n\r\nfunction m_fnViewResponseDocsToday() {\r\n  window.open(\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n      \"/pages/AuditUnSubmittedResponseDocuments.aspx\",\r\n    \"_blank\"\r\n  );\r\n}\r\n\r\nfunction m_fnViewReturnedDocs() {\r\n  window.open(\r\n    Audit.Common.Utilities.GetSiteUrl() + \"/pages/AuditReturnedResponses.aspx\",\r\n    \"_blank\"\r\n  );\r\n}\r\n\r\nfunction m_fnIsRequestAlmostDue(oRequest, dueDate) {\r\n  var todayDate = new Date();\r\n\r\n  if (dueDate == null || dueDate == \"\") return false;\r\n\r\n  dueDate = new Date(dueDate);\r\n\r\n  var one_day = 1000 * 60 * 60 * 24;\r\n  var difference = Math.ceil(\r\n    (todayDate.getTime() - dueDate.getTime()) / one_day\r\n  );\r\n\r\n  if (\r\n    (oRequest.status == \"Open\" || oRequest.status == \"ReOpened\") &&\r\n    difference >= 0 &&\r\n    difference <= 3\r\n  )\r\n    return true;\r\n\r\n  return false;\r\n}\r\n\r\nfunction m_fnIsRequestPastDue(oRequest, dueDate = null) {\r\n  var todayDate = new Date();\r\n  todayDate.setHours(0, 0, 0, 0);\r\n\r\n  if (dueDate == null || dueDate == \"\") return false;\r\n\r\n  const dueDateD = new Date(dueDate);\r\n\r\n  if (\r\n    (oRequest.status == \"Open\" || oRequest.status == \"ReOpened\") &&\r\n    todayDate.getTime() > dueDateD.getTime()\r\n  )\r\n    return true;\r\n\r\n  return false;\r\n}\r\n\r\nfunction m_fnCreateRequest() {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  const newRequestForm = new NewRequestFormComponent();\r\n  const options = {\r\n    title: \"Create a New Request\",\r\n    form: newRequestForm,\r\n    dialogReturnValueCallback: OnCallbackFormNewRequest,\r\n  };\r\n\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nfunction m_fnBulkAddRequest() {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  const bulkAddRequestForm = new BulkAddRequestForm();\r\n  const options = {\r\n    title: \"Bulk Add Request\",\r\n    form: bulkAddRequestForm,\r\n    dialogReturnValueCallback: OnCallbackFormReload,\r\n  };\r\n\r\n  ModalDialog.showModalDialog(options);\r\n  // m_bIsTransactionExecuting = true;\r\n\r\n  // var options = SP.UI.$create_DialogOptions();\r\n  // options.title = \"Bulk Add Requests\";\r\n  // options.dialogReturnValueCallback = m_fnRefresh;\r\n  // options.height = 800;\r\n  // options.url =\r\n  //   Audit.Common.Utilities.GetSiteUrl() + \"/pages/AuditBulkAddRequest.aspx\";\r\n\r\n  // SP.UI.ModalDialog.showModalDialog(options);\r\n}\r\n\r\nasync function m_fnViewRequest(id) {\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  const request = await appContext.AuditRequests.FindById(id);\r\n  // const requestViewForm = AuditRequest.components.view(request);\r\n  const requestViewForm = FormManager.DispForm(request);\r\n\r\n  const options = {\r\n    title: \"View Request (ID:\" + id + \")\",\r\n    form: requestViewForm,\r\n    dialogReturnValueCallback: OnCallbackForm,\r\n  };\r\n\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nasync function m_fnEditRequest(id, requestNum) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  m_itemID = id;\r\n  m_requestNum = requestNum;\r\n\r\n  const request = await appContext.AuditRequests.FindById(id);\r\n  const form = new EditRequestForm({ entity: request });\r\n  const options = {\r\n    title: \"Edit Request (\" + requestNum + \")\",\r\n    form,\r\n    dialogReturnValueCallback: OnCallbackFormEditRequest,\r\n  };\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nasync function m_fnViewCoverSheet(id) {\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  const coverSheet = await appContext.AuditCoversheets.FindById(id);\r\n\r\n  const coverSheetViewForm = FormManager.DispForm(coverSheet);\r\n\r\n  const options = {\r\n    title: \"View Coversheet (ID:\" + id + \")\",\r\n    form: coverSheetViewForm,\r\n    dialogReturnValueCallback: OnCallbackForm,\r\n  };\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nasync function m_fnEditCoverSheet(id, requestNum) {\r\n  m_bIsTransactionExecuting = true;\r\n  m_requestNum = requestNum;\r\n\r\n  const coverSheet = await appContext.AuditCoversheets.FindById(id);\r\n  const coverSheetForm = new EditCoverSheetForm({ entity: coverSheet });\r\n\r\n  const options = {\r\n    form: coverSheetForm,\r\n  };\r\n  options.title = \"Edit Coversheet (ID:\" + id + \")\";\r\n  options.dialogReturnValueCallback = OnCallbackFormCoverSheet;\r\n\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nfunction m_fnBulkAddResponse(id) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var options = SP.UI.$create_DialogOptions();\r\n  options.title = \"Bulk Add Responses (\" + id + \")\";\r\n  options.dialogReturnValueCallback = OnCallbackFormBulkAddResponse;\r\n  options.height = 800;\r\n  options.url =\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n    \"/pages/AuditBulkAddResponse.aspx?ReqNum=\" +\r\n    id +\r\n    GetSourceUrlForForms();\r\n\r\n  SP.UI.ModalDialog.showModalDialog(options);\r\n}\r\n\r\nfunction m_fnBulkEditResponse(id) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var options = SP.UI.$create_DialogOptions();\r\n  options.title = \"Bulk Edit Responses (\" + id + \")\";\r\n  options.dialogReturnValueCallback = OnCallbackFormBulkEditResponse;\r\n  options.height = 850;\r\n  options.width = 1100;\r\n  options.allowMaximize = true;\r\n  options.allowResize = true;\r\n  options.args = {\r\n    bigMap: m_bigMap,\r\n    m_fnBreakCoversheetPermissions: m_fnBreakCoversheetPermissions,\r\n    m_fnBreakResponsePermissions: m_fnBreakResponsePermissions,\r\n    m_fnBreakResponseFolderPermissions: m_fnBreakResponseFolderPermissions,\r\n  };\r\n  options.url =\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n    \"/pages/AuditBulkEditResponse.aspx?ReqNum=\" +\r\n    id +\r\n    GetSourceUrlForForms();\r\n\r\n  SP.UI.ModalDialog.showModalDialog(options);\r\n}\r\n\r\nfunction m_fnGetNextSampleNumber(requestNumber) {\r\n  var sampleNumber = 0;\r\n  const oRequest = m_fnGetRequestByNumber(requestNumber);\r\n\r\n  for (var y = 0; y < oRequest.responses.length; y++) {\r\n    if (oRequest.responses[y].sample > sampleNumber)\r\n      sampleNumber = oRequest.responses[y].sample;\r\n  }\r\n\r\n  if (oRequest.responses.length > 0) sampleNumber++;\r\n\r\n  return sampleNumber;\r\n}\r\n\r\nasync function m_fnAddResponse(id, reqNum) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var sampleNumber = m_fnGetNextSampleNumber(reqNum);\r\n\r\n  const request = await appContext.AuditRequests.FindById(id);\r\n  const newResponse = new AuditResponse();\r\n\r\n  newResponse.ReqNum.Value(request);\r\n  newResponse.SampleNumber.Value(sampleNumber);\r\n\r\n  const newResponseForm = new NewResponseForm({ entity: newResponse });\r\n\r\n  const options = {\r\n    form: newResponseForm,\r\n  };\r\n  options.title = \"Add Response to (Request Number:\" + id + \")\";\r\n  options.dialogReturnValueCallback = OnCallbackFormNewResponse;\r\n\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nasync function m_fnViewResponse(\r\n  requestNumber,\r\n  id,\r\n  responseTitle,\r\n  responseStatus\r\n) {\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  const response = await appContext.AuditResponses.FindById(id);\r\n\r\n  if (!response) {\r\n    SP.UI.Notify.addNotification(\"Response not found! \" + id, false);\r\n    alert();\r\n    return;\r\n  }\r\n  const viewResponseForm = FormManager.DispForm(response);\r\n\r\n  var options = {\r\n    form: viewResponseForm,\r\n  };\r\n\r\n  options.title = \"View Response (\" + responseTitle + \")\";\r\n  options.height = 600;\r\n  options.dialogReturnValueCallback = OnCallbackForm;\r\n\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nasync function m_fnEditResponse(\r\n  requestNumber,\r\n  id,\r\n  responseTitle,\r\n  responseStatus\r\n) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  m_requestNum = requestNumber;\r\n  m_itemID = id;\r\n  m_responseTitle = responseTitle;\r\n  m_responseStatus = responseStatus;\r\n\r\n  const response = await appContext.AuditResponses.FindById(id);\r\n\r\n  if (!response) {\r\n    SP.UI.Notify.addNotification(\"Response not found! \" + id, false);\r\n    alert();\r\n    return;\r\n  }\r\n\r\n  const editReponseForm = new EditResponseForm({ entity: response });\r\n\r\n  const options = {\r\n    form: editReponseForm,\r\n  };\r\n  options.title = \"Edit Response (\" + responseTitle + \")\";\r\n  options.dialogReturnValueCallback = OnCallbackFormEditResponse;\r\n\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nfunction m_fnReviewingResponse(activeViewers) {\r\n  SP.UI.Notify.addNotification(\"Reviewing Response...\", false);\r\n\r\n  activeViewers.pushCurrentUser();\r\n}\r\n\r\nasync function m_fnViewResponseDoc(id, requestID, responseID) {\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  const responseDoc = await appContext.AuditResponseDocs.FindById(id);\r\n  const responseDocForm = FormManager.DispForm(responseDoc);\r\n\r\n  const options = {\r\n    form: responseDocForm,\r\n  };\r\n\r\n  options.title = \"View Response Doc (ID:\" + id + \")\";\r\n  options.height = \"600\";\r\n  options.dialogReturnValueCallback = OnCallbackForm;\r\n\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\nasync function m_fnEditResponseDoc(id, requestID, responseID) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  m_bIsTransactionExecuting = true;\r\n  const responseDoc = await appContext.AuditResponseDocs.FindById(id);\r\n  const responseDocForm = new EditResponseDocForm({ entity: responseDoc });\r\n\r\n  const options = {\r\n    form: responseDocForm,\r\n  };\r\n  options.title = \"Edit ResponseDoc (ID:\" + id + \")\";\r\n  options.dialogReturnValueCallback = OnCallbackForm;\r\n\r\n  ModalDialog.showModalDialog(options);\r\n}\r\n\r\n/**\r\n * Approves subset of response docs for a given request, updates permissions for\r\n * response, request, response doc folder, and coversheets.\r\n * Notifies QA of approved response docs.\r\n * @param {oRequest} oRequest The request item from big map\r\n * @param {Array<oResponseDoc>} oResponseDocs the response docs to be approved\r\n */\r\nexport async function m_fnApproveResponseDocsForQA(oRequest, oResponseDocs) {\r\n  if (!oRequest.sensitivity) {\r\n    alert(\"Request Sensitivity has not been set!\");\r\n    return false;\r\n  }\r\n\r\n  for (const oResponse of oRequest.responses) {\r\n    const responseApprovedResponseDocs = oResponse.responseDocs.filter(\r\n      (responseDoc) => oResponseDocs.includes(responseDoc)\r\n    );\r\n\r\n    // Only proceed if this response has approved response docs\r\n    if (!responseApprovedResponseDocs.length) {\r\n      continue;\r\n    }\r\n\r\n    // Update Response Doc Status\r\n    for (const oResponseDoc of responseApprovedResponseDocs) {\r\n      var ctx2 = new SP.ClientContext.get_current();\r\n      var oList = ctx2\r\n        .get_web()\r\n        .get_lists()\r\n        .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n\r\n      const newResponseDocFileName = m_fnGetNewResponseDocTitle(\r\n        oResponseDoc.item,\r\n        oResponseDoc.responseTitle,\r\n        oRequest.sensitivity\r\n      );\r\n\r\n      const approveResponseDocTask = addTask(\r\n        taskDefs.approveResponseDoc(newResponseDocFileName)\r\n      );\r\n\r\n      const oListItem = oList.getItemById(oResponseDoc.item.get_item(\"ID\"));\r\n      ctx2.load(oListItem);\r\n      await new Promise((resolve, reject) => {\r\n        ctx2.executeQueryAsync(resolve, reject);\r\n      });\r\n\r\n      oListItem.set_item(\"DocumentStatus\", AuditResponseDocStates.SentToQA);\r\n      oListItem.set_item(\"RejectReason\", \"\");\r\n      oListItem.set_item(\"FileLeafRef\", newResponseDocFileName);\r\n      oListItem.update();\r\n      await new Promise((resolve, reject) => {\r\n        ctx2.executeQueryAsync(resolve, reject);\r\n      });\r\n      finishTask(approveResponseDocTask);\r\n    }\r\n\r\n    // Update Response Status\r\n    if (oResponse.resStatus != AuditResponseStates.Submitted) continue;\r\n\r\n    const ctx = new SP.ClientContext.get_current();\r\n\r\n    ctx.load(oResponse.item);\r\n    oResponse.item.set_item(\"ResStatus\", AuditResponseStates.ApprovedForQA);\r\n    oResponse.item.update();\r\n\r\n    await executeQuery(ctx).catch(({ sender, args }) => {\r\n      console.error(\"Unable to set response status approved for QA\", oResponse);\r\n    });\r\n\r\n    // Break Response Permissions\r\n    await m_fnBreakResponseAndFolderPermissions(\r\n      oRequest.status,\r\n      oResponse,\r\n      false,\r\n      true\r\n    );\r\n  }\r\n\r\n  // Break Request Permissions\r\n  await m_fnBreakRequestPermissions(\r\n    oRequest.item,\r\n    false,\r\n    AuditResponseStates.ApprovedForQA\r\n  );\r\n\r\n  // Break Coversheet permissions\r\n  if (oRequest.coversheets?.length) {\r\n    await Promise.all(\r\n      oRequest.coversheets.map((coversheet) =>\r\n        m_fnBreakCoversheetPermissions(coversheet.item, true)\r\n      )\r\n    );\r\n  }\r\n\r\n  // Finally, notify QA\r\n  await m_fnNotifyQAApprovalPending(oRequest, oResponseDocs);\r\n\r\n  return true;\r\n}\r\n\r\nexport async function m_fnRejectResponseDoc(\r\n  oRequest,\r\n  oResponseDoc,\r\n  rejectReason\r\n) {\r\n  // const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n  //   \"Rejecting Response Document\",\r\n  //   \"Please wait... Rejecting Response Document\",\r\n  //   200,\r\n  //   400\r\n  // );\r\n\r\n  var clientContext = SP.ClientContext.get_current();\r\n  var oList = clientContext\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n\r\n  const oListItem = oList.getItemById(oResponseDoc.ID);\r\n  clientContext.load(oListItem);\r\n\r\n  await new Promise((resolve, reject) =>\r\n    clientContext.executeQueryAsync(resolve, (sender, args) =>\r\n      reject({ sender, args })\r\n    )\r\n  ).catch(({ sender, args }) => {\r\n    alert(\r\n      \"Request failed. \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n  });\r\n\r\n  var ctx2 = new SP.ClientContext.get_current();\r\n\r\n  var oList = ctx2\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n\r\n  //refetch to avoid version conflict\r\n  // oListItem = oList.getItemById(m_itemID);\r\n  oListItem.set_item(\"DocumentStatus\", \"Rejected\");\r\n  oListItem.set_item(\"RejectReason\", rejectReason);\r\n  //changed - updating response doc file name here\r\n\r\n  var sensitivity = \"\";\r\n  if (oRequest) sensitivity = oRequest.sensitivity;\r\n  var newResponseDocFileName = m_fnGetNewResponseDocTitle(\r\n    oListItem,\r\n    oResponseDoc.responseTitle,\r\n    sensitivity\r\n  );\r\n\r\n  oListItem.set_item(\"FileLeafRef\", newResponseDocFileName);\r\n  oListItem.set_item(\"RejectReason\", rejectReason);\r\n\r\n  oListItem.update();\r\n\r\n  var siteUrl =\r\n    location.protocol +\r\n    \"//\" +\r\n    location.host +\r\n    _spPageContextInfo.webServerRelativeUrl +\r\n    \"/\";\r\n  const filePath = oListItem.get_item(\"FileDirRef\");\r\n  // fileName = oListItem.get_item(\"FileLeafRef\");\r\n  var lastInd = filePath.lastIndexOf(\"/\");\r\n  var urlpath = filePath.substring(0, lastInd + 1);\r\n  var responseTitle = filePath.replace(urlpath, \"\");\r\n\r\n  var folderPath =\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n    \"/\" +\r\n    Audit.Common.Utilities.GetLibNameResponseDocs() +\r\n    \"/\" +\r\n    responseTitle;\r\n  var aresponseDocList = ctx2\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n  var aresponseDocQuery = new SP.CamlQuery();\r\n  aresponseDocQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy><Where><And><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">0</Value></Eq><Eq><FieldRef Name=\"FileDirRef\"/><Value Type=\"Text\">' +\r\n      folderPath +\r\n      \"</Value></Eq></And></Where></Query></View>\"\r\n  );\r\n  const aresponseDocItems = aresponseDocList.getItems(aresponseDocQuery);\r\n  ctx2.load(aresponseDocItems);\r\n\r\n  var aresponseList = ctx2\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n  var aresponseQuery = new SP.CamlQuery();\r\n  aresponseQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy><Where><Eq><FieldRef Name=\"Title\"/><Value Type=\"Text\">' +\r\n      responseTitle +\r\n      \"</Value></Eq></Where></Query><RowLimit>1</RowLimit></View>\"\r\n  );\r\n  const aresponseItems = aresponseList.getItems(aresponseQuery);\r\n  ctx2.load(aresponseItems);\r\n\r\n  var emailList = ctx2\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n  var emailListQuery = new SP.CamlQuery();\r\n  emailListQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"ID\"/></OrderBy><Where><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">1</Value></Eq></Where></Query></View>'\r\n  );\r\n  const emailListFolderItems = emailList.getItems(emailListQuery);\r\n  ctx2.load(emailListFolderItems, \"Include(ID, FSObjType, Title, DisplayName)\");\r\n\r\n  await new Promise((resolve, reject) =>\r\n    ctx2.executeQueryAsync(resolve, (sender, args) => reject({ sender, args }))\r\n  ).catch(({ sender, args }) => {\r\n    alert(\r\n      \"Request failed. \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n    return;\r\n  });\r\n\r\n  // TODO: Notify Action Office? If all docs rejected, Reject Response?\r\n  const notifyId = SP.UI.Notify.addNotification(\r\n    \"Rejected Response Document\",\r\n    false\r\n  );\r\n\r\n  //added\r\n  // m_waitDialog.close();\r\n}\r\nfunction m_fnCheckInResponseDoc(folder, fileName) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var options = SP.UI.$create_DialogOptions();\r\n  options.title = \"Check in Response Document\";\r\n  options.height = \"600\";\r\n  options.dialogReturnValueCallback = OnCallbackForm;\r\n\r\n  options.url =\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n    \"/_layouts/checkin.aspx?List={\" +\r\n    m_libResponseDocsLibraryGUID +\r\n    \"}&FileName=\" +\r\n    folder +\r\n    \"/\" +\r\n    fileName;\r\n\r\n  SP.UI.ModalDialog.showModalDialog(options);\r\n}\r\n\r\nfunction m_fnViewResponseDocFolder(title) {\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var options = SP.UI.$create_DialogOptions();\r\n  options.title = \"View Response Folder\";\r\n  options.height = \"600\";\r\n  options.dialogReturnValueCallback = OnCallbackForm;\r\n\r\n  //if they delete a document in this window, we want them to return to the current page\r\n  options.url =\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n    \"/pages/AuditResponseDocs.aspx?RootFolder=\" +\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n    \"/\" +\r\n    Audit.Common.Utilities.GetLibNameResponseDocs() +\r\n    \"/\" +\r\n    title;\r\n  //options.url = Audit.Common.Utilities.GetSiteUrl() + \"/pages/AuditResponseDocs.aspx?RootFolder=\" + Audit.Common.Utilities.GetSiteUrl() + \"/\" + Audit.Common.Utilities.GetLibNameResponseDocs() + \"/\" + title + GetSourceUrlForForms();\r\n  //options.url = m_siteUrl + \"/\"+ m_libNameResponseDocs + \"/\" + title;\r\n  //options.url = m_siteUrl + \"/\"+ m_libNameResponseDocs + \"?RootFolder=\" + m_siteUrl + \"/\"+ m_libNameResponseDocs + \"/\" + title;\r\n  SP.UI.ModalDialog.showModalDialog(options);\r\n}\r\n\r\nfunction m_fnViewEmailHistoryFolder(reqNum) {\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var options = SP.UI.$create_DialogOptions();\r\n  options.title = \"View Email History\";\r\n  options.autoSize = true;\r\n  options.dialogReturnValueCallback = OnCallbackForm;\r\n\r\n  options.url =\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n    \"/pages/AuditEmailHistory.aspx?RootFolder=\" +\r\n    Audit.Common.Utilities.GetSiteUrl() +\r\n    \"/Lists/\" +\r\n    Audit.Common.Utilities.GetListNameEmailHistory() +\r\n    \"/\" +\r\n    reqNum +\r\n    GetSourceUrlForForms();\r\n\r\n  SP.UI.ModalDialog.showModalDialog(options);\r\n}\r\n\r\nfunction m_fnDeleteResponseDoc(itemID) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (\r\n    confirm(\"Are you sure you would like to Delete this Response Document?\")\r\n  ) {\r\n    m_bIsTransactionExecuting = true;\r\n\r\n    var currCtx = new SP.ClientContext();\r\n    var responseDocsLib = currCtx\r\n      .get_web()\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetLibNameResponseDocs());\r\n\r\n    var oListItem = responseDocsLib.getItemById(itemID);\r\n    oListItem.recycle();\r\n\r\n    function OnSuccess(sender, args) {\r\n      m_fnRefresh();\r\n    }\r\n    function OnFailure(sender, args) {\r\n      const statusId = SP.UI.Status.addStatus(\r\n        \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n      );\r\n      SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n    }\r\n    currCtx.executeQueryAsync(OnSuccess, OnFailure);\r\n  }\r\n}\r\n\r\nfunction m_fnResendRejectedResponseDocToQA(itemID) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (\r\n    confirm(\r\n      \"Are you sure you would like to Update the Response Document status by clearing the Rejected status marked by QA?\"\r\n    )\r\n  ) {\r\n    m_bIsTransactionExecuting = true;\r\n\r\n    var currCtx = new SP.ClientContext();\r\n    var responseDocsLib = currCtx\r\n      .get_web()\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetLibNameResponseDocs());\r\n\r\n    var oListItem = responseDocsLib.getItemById(itemID);\r\n    oListItem.set_item(\"DocumentStatus\", \"Submitted\");\r\n    oListItem.set_item(\"RejectReason\", \"\");\r\n    oListItem.update();\r\n\r\n    function OnSuccess(sender, args) {\r\n      m_fnRefreshData();\r\n    }\r\n    function OnFailure(sender, args) {\r\n      const statusId = SP.UI.Status.addStatus(\r\n        \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n      );\r\n      SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n    }\r\n    currCtx.executeQueryAsync(OnSuccess, OnFailure);\r\n  }\r\n}\r\n\r\n//if request is closed, re-open request and reset perms\r\n//reset perms on response\r\nasync function m_fnReOpenResponse(requestNumber, responseTitle) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (\r\n    confirm(\r\n      \"Are you sure you would like to re-open this response (\" +\r\n        responseTitle +\r\n        \")?\"\r\n    )\r\n  ) {\r\n    m_bIsTransactionExecuting = true;\r\n\r\n    document.body.style.cursor = \"wait\";\r\n\r\n    var currCtx2 = new SP.ClientContext.get_current();\r\n\r\n    var oRequestBigMap = m_bigMap[\"request-\" + requestNumber];\r\n    if (oRequestBigMap) {\r\n      for (var z = 0; z < oRequestBigMap.responses.length; z++) {\r\n        //update the status of the response to open\r\n        if (oRequestBigMap.responses[z].title == responseTitle) {\r\n          oRequestBigMap.responses[z].item.set_item(\"ResStatus\", \"1-Open\");\r\n          oRequestBigMap.responses[z].item.update();\r\n          await m_fnBreakResponseAndFolderPermissions(\r\n            \"ReOpened\",\r\n            oRequestBigMap.responses[z],\r\n            false,\r\n            true,\r\n            false,\r\n            false\r\n          );\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      //make sure the status of the request is open\r\n      //Todo: check here if request was closed, that it's now Reopened. If it was closed or canceled, open it. if it was open, do nothing to request\r\n      var oListItem = oRequestBigMap.item;\r\n      var curRequestStatus = oListItem.get_item(\"ReqStatus\");\r\n      if (curRequestStatus == \"Closed\") {\r\n        oListItem.set_item(\"ReqStatus\", \"ReOpened\");\r\n        oListItem.update();\r\n      } else if (curRequestStatus != \"Open\") {\r\n        oListItem.set_item(\"ReqStatus\", \"Open\");\r\n        oListItem.update();\r\n      }\r\n\r\n      await m_fnBreakRequestPermissions(oListItem, false);\r\n    }\r\n\r\n    currCtx2.executeQueryAsync(\r\n      function () {\r\n        setTimeout(function () {\r\n          m_fnRefresh();\r\n        }, 1000); //add delay on this so that the other requests can refresh permissions and it will display properly\r\n      },\r\n      function (sender, args) {\r\n        alert(\r\n          \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n        );\r\n        setTimeout(function () {\r\n          m_fnRefresh();\r\n        }, 1000); //add delay on this so that the other requests can refresh permissions and it will display properly\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\nasync function m_fnCloseRequest() {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  var requestNumberToClose = $(\"#ddlReqNum\").val();\r\n\r\n  if (\r\n    confirm(\r\n      \"Are you sure you would like to Close this Request (\" +\r\n        requestNumberToClose +\r\n        \")?\"\r\n    )\r\n  ) {\r\n    m_bIsTransactionExecuting = true;\r\n\r\n    for (var x = 0; x < m_arrRequestsToClose.length; x++) {\r\n      var oIt = m_arrRequestsToClose[x];\r\n      var requestNumber = oIt.number;\r\n\r\n      if (requestNumberToClose != requestNumber) continue;\r\n\r\n      var closedDate = oIt.lastClosedDate;\r\n      var closedBy = oIt.lastClosedBy;\r\n\r\n      var oRequest = m_fnGetRequestByNumber(requestNumber);\r\n\r\n      oRequest.item.set_item(\r\n        \"ClosedDate\",\r\n        oIt.oResponse.item.get_item(\"ClosedDate\")\r\n      );\r\n      oRequest.item.set_item(\r\n        \"ClosedBy\",\r\n        oIt.oResponse.item.get_item(\"ClosedBy\")\r\n      );\r\n      oRequest.item.set_item(\"ReqStatus\", \"Closed\");\r\n\r\n      oRequest.item.update();\r\n\r\n      const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n        \"Information\",\r\n        \"Please wait... updating permissions on the Request\",\r\n        100,\r\n        600\r\n      );\r\n      //Removed 06/05/2017 m_fnBreakRequestPermissions( oRequest.item, true );\r\n      m_fnBreakRequestPermissions(oRequest.item, false);\r\n\r\n      //Added 06/05/2017\r\n      //ensure this will always update the permissions\r\n      var doneUpdatingResponses = false;\r\n      await m_fnUpdateAllResponsePermissions(\r\n        \"Closed\",\r\n        requestNumberToClose,\r\n        true\r\n      );\r\n      setTimeout(function () {\r\n        m_fnRefresh();\r\n      }, 100);\r\n\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\nfunction m_fnGetRequestByNumber(requestNumber) {\r\n  //this can be stale...\r\n  var oRequest = null;\r\n  oRequest = m_bigMap[\"request-\" + requestNumber];\r\n  return oRequest;\r\n}\r\n\r\nfunction m_fnGetRequestByID(requestID) {\r\n  const oRequest = Object.entries(m_bigMap).find(([key, value]) => {\r\n    return key.startsWith(\"request-\") && value.ID == requestID;\r\n  });\r\n  if (!oRequest) return;\r\n  return oRequest[1];\r\n}\r\n\r\nfunction m_fnGetResponseByTitle(responseTitle) {\r\n  return m_bigMap[\"response-\" + responseTitle];\r\n}\r\n\r\nfunction m_fnFormatEmailBodyToAO(oRequest, responseTitles, poc) {\r\n  var emailText =\r\n    \"<div>Audit Request Reference: <b>{REQUEST_NUMBER}</b></div>\" +\r\n    \"<div>Audit Request Subject: <b>{REQUEST_SUBJECT}</b></div>\" +\r\n    \"<div>Audit Request Due Date: <b>{REQUEST_DUEDATE}</b></div>\" +\r\n    \"{POC}\" +\r\n    \"{REQUEST_RELATEDAUDIT}<br/>\" +\r\n    \"<div>Below are the listed action items that have been requested for the Audit: </div>\" +\r\n    \"<div>{REQUEST_ACTIONITEMS}<br/></div>\" +\r\n    \"<div>Please provide responses for the following Sample(s): </div><br/>\" +\r\n    \"<div>{RESPONSE_TITLES}</div>\";\r\n\r\n  emailText = emailText.replace(\"{REQUEST_NUMBER}\", oRequest.number);\r\n  emailText = emailText.replace(\"{REQUEST_SUBJECT}\", oRequest.subject);\r\n  emailText = emailText.replace(\"{REQUEST_DUEDATE}\", oRequest.internalDueDate);\r\n  emailText = emailText.replace(\"{REQUEST_ACTIONITEMS}\", oRequest.actionItems);\r\n\r\n  if (poc == null || poc == \"\") emailText = emailText.replace(\"{POC}\", \"<br/>\");\r\n  else\r\n    emailText = emailText.replace(\"{POC}\", \"<br/><b>POC: \" + poc + \"</b><br/>\");\r\n\r\n  if (responseTitles != null && responseTitles.length > 0) {\r\n    function sortNumber(a, b) {\r\n      a = parseInt(a.sample, 10);\r\n      b = parseInt(b.sample, 10);\r\n\r\n      return a - b;\r\n    }\r\n    responseTitles.sort(sortNumber);\r\n\r\n    var responseTitleBody = \"<ul>\";\r\n    for (var x = 0; x < responseTitles.length; x++) {\r\n      responseTitleBody += \"<li>\" + responseTitles[x].title + \"</li>\";\r\n    }\r\n    responseTitleBody += \"</ul>\";\r\n    emailText = emailText.replace(\"{RESPONSE_TITLES}\", responseTitleBody);\r\n  } else emailText = emailText.replace(\"{RESPONSE_TITLES}\", \"\");\r\n\r\n  if (oRequest.relatedAudit == null || oRequest.relatedAudit == \"\")\r\n    emailText = emailText.replace(\r\n      \"{REQUEST_RELATEDAUDIT}\",\r\n      \"<div>This is a new request, not similar to previous audit cycles.</div>\"\r\n    );\r\n  else\r\n    emailText = emailText.replace(\r\n      \"{REQUEST_RELATEDAUDIT}\",\r\n      \"<div>This request is similar to this previous cycle audit: \" +\r\n        oRequest.relatedAudit +\r\n        \"</div>\"\r\n    );\r\n  return emailText;\r\n}\r\n\r\n// Synchronize email action offices with AO's\r\nfunction m_fnSyncEmailActionOffices(requestID) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (\r\n    confirm(\r\n      \"Are you sure you would like to replace all Email Action Offices with current Action Offices?\"\r\n    )\r\n  ) {\r\n    m_bIsTransactionExecuting = true;\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    const oRequest = m_fnGetRequestByID(requestID);\r\n\r\n    if (oRequest == null) {\r\n      alert(\"Error occurred\");\r\n      return;\r\n    }\r\n\r\n    if (oRequest.status != \"Open\" && oRequest.status != \"ReOpened\") {\r\n      SP.UI.Notify.addNotification(\"This request is not Open.\", false);\r\n      return;\r\n    }\r\n\r\n    //var arrActionOffice = new Array();\r\n    var emailActionOffices = oRequest.item.get_item(\"ActionOffice\");\r\n\r\n    var requestList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetListTitleRequests());\r\n    const oListItem = requestList.getItemById(requestID);\r\n\r\n    oListItem.set_item(\"EmailActionOffice\", emailActionOffices);\r\n    oListItem.update();\r\n\r\n    currCtx.executeQueryAsync(\r\n      function () {\r\n        SP.UI.Notify.addNotification(\"Email Action Offices Set. \", false);\r\n        setTimeout(function () {\r\n          m_fnRefreshData();\r\n        }, 1000);\r\n      },\r\n      function (sender, args) {\r\n        alert(\r\n          \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n        );\r\n        m_fnRefresh();\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\nfunction m_fnSendEmail(requestID) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (\r\n    !confirm(\r\n      \"Are you sure you would like to notify all Action Offices listed in the Email Action Offices field?\"\r\n    )\r\n  )\r\n    return;\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  const oRequest = m_fnGetRequestByID(requestID);\r\n\r\n  if (oRequest == null) {\r\n    alert(\"Error occurred\");\r\n    return;\r\n  }\r\n\r\n  if (oRequest.status != \"Open\" && oRequest.status != \"ReOpened\") {\r\n    SP.UI.Notify.addNotification(\"This request is not Open.\", false);\r\n    return;\r\n  }\r\n\r\n  var responseCount = oRequest.responses.length;\r\n  if (responseCount == 0) {\r\n    SP.UI.Notify.addNotification(\r\n      \"There are no responses associated with this request.\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  var arrEmailActionOffice = oRequest.item\r\n    .get_item(\"EmailActionOffice\")\r\n    ?.map((actionOffice) => actionOffice.get_lookupValue());\r\n\r\n  if (arrEmailActionOffice.length == 0) {\r\n    SP.UI.Notify.addNotification(\r\n      \"Unable to send an email. 0 Action Offices listed in the Email Action Office field\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  var arrEmails = new Array();\r\n\r\n  for (var y = 0; y < responseCount; y++) {\r\n    var oResponse = oRequest.responses[y];\r\n    if (\r\n      oResponse.resStatus != \"1-Open\" &&\r\n      oResponse.resStatus != \"3-Returned to Action Office\"\r\n    ) {\r\n      SP.UI.Notify.addNotification(\r\n        \"Skipping Response (\" +\r\n          oResponse.title +\r\n          \"). It's not Open or Returned to Action Office\",\r\n        false\r\n      );\r\n      continue;\r\n    }\r\n\r\n    var actionOfficeGroupName = Audit.Common.Utilities.GetAOSPGroupName(\r\n      oResponse.actionOffice\r\n    );\r\n    var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n      actionOfficeGroupName\r\n    );\r\n\r\n    if (\r\n      actionOfficeGroupName == \"\" ||\r\n      actionOfficeGroupName == null ||\r\n      actionOfficeGroup == null\r\n    ) {\r\n      SP.UI.Notify.addNotification(\r\n        \"Unable to send an email. Action Office (\" +\r\n          oResponse.actionOffice +\r\n          \") does not have a group associated with it\",\r\n        false\r\n      );\r\n      return;\r\n    }\r\n\r\n    //Iterate through the aos listed in the email action office field and if it matches this AO, then continue to create email for this AO\r\n    // var bAddThisAO = false;\r\n    // for (var x = 0; x < arrEmailActionOffice.length; x++) {\r\n    //   if (arrEmailActionOffice[x] == oResponse.actionOffice) {\r\n    //     bAddThisAO = true;\r\n    //     break;\r\n    //   }\r\n    // }\r\n\r\n    if (!arrEmailActionOffice.includes(oResponse.actionOffice)) continue;\r\n\r\n    // if (bAddThisAO) {\r\n    //this means that this response's ao is in the email action offices field for this request and this ao should get a unique email with all the open responses\r\n    var ao = actionOfficeGroupName;\r\n    if (oResponse.poc != null && oResponse.poc != \"\")\r\n      //if poc field is provided, email the poc and poccc, not the Action office group\r\n      ao = oResponse.poc + \";\" + oResponse.pocCC;\r\n\r\n    var emailTo = oResponse.poc\r\n      ? oResponse.poc + \";\" + oResponse.pocCC\r\n      : oResponse.actionOffice;\r\n\r\n    var bFound = false;\r\n    for (var x = 0; x < arrEmails.length; x++) {\r\n      if (arrEmails[x].actionOffice == ao) {\r\n        var oResSample = new Object();\r\n        oResSample[\"sample\"] = oResponse.sample;\r\n        oResSample[\"title\"] = oResponse.title;\r\n        arrEmails[x].responseTitles.push(oResSample);\r\n        bFound = true;\r\n      }\r\n    }\r\n\r\n    if (!bFound) {\r\n      var emailObject = new Object();\r\n      emailObject.actionOffice = ao;\r\n      emailObject.emailTo = emailTo;\r\n      emailObject.poc = oResponse.poc;\r\n      emailObject.responseTitles = new Array();\r\n\r\n      var oResSample = new Object();\r\n      oResSample[\"sample\"] = oResponse.sample;\r\n      oResSample[\"title\"] = oResponse.title;\r\n\r\n      emailObject.responseTitles.push(oResSample);\r\n      arrEmails.push(emailObject);\r\n    }\r\n    // }\r\n  }\r\n\r\n  if (arrEmails.length == 0) {\r\n    SP.UI.Notify.addNotification(\r\n      \"Unable to send an email. 0 Action Offices in the Email Action Office field match the Responses\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n    \"Sending Emails\",\r\n    \"Please wait... sending email notifications to Action Offices\",\r\n    100,\r\n    400\r\n  );\r\n\r\n  document.body.style.cursor = \"wait\";\r\n\r\n  var emailList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n\r\n  var emailListQuery = new SP.CamlQuery();\r\n  emailListQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"ID\"/></OrderBy><Where><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">1</Value></Eq></Where></Query></View>'\r\n  );\r\n  const emailListFolderItems = emailList.getItems(emailListQuery);\r\n  currCtx.load(emailListFolderItems, \"Include(ID, Title, DisplayName)\");\r\n\r\n  function OnSuccess(sender, args) {\r\n    const m_emailCount = arrEmails.length;\r\n    var cnt = 0;\r\n    for (var y = 0; y < m_emailCount; y++) {\r\n      var emailSubject =\r\n        \"Your Response Has Been Requested for Request Number: \" +\r\n        oRequest.number;\r\n      var emailText = m_fnFormatEmailBodyToAO(\r\n        oRequest,\r\n        arrEmails[y].responseTitles,\r\n        arrEmails[y].poc\r\n      );\r\n\r\n      var itemCreateInfo = new SP.ListItemCreationInformation();\r\n      itemCreateInfo.set_folderUrl(\r\n        location.protocol +\r\n          \"//\" +\r\n          location.host +\r\n          Audit.Common.Utilities.GetSiteUrl() +\r\n          \"/Lists/\" +\r\n          Audit.Common.Utilities.GetListNameEmailHistory() +\r\n          \"/\" +\r\n          oRequest.number\r\n      );\r\n      const oListItem = emailList.addItem(itemCreateInfo);\r\n      oListItem.set_item(\"Title\", emailSubject);\r\n      oListItem.set_item(\"Body\", emailText);\r\n      oListItem.set_item(\"To\", arrEmails[y].emailTo);\r\n      oListItem.set_item(\"ReqNum\", oRequest.number);\r\n      oListItem.set_item(\"NotificationType\", \"AO Notification\");\r\n      oListItem.update();\r\n\r\n      currCtx.executeQueryAsync(\r\n        function () {\r\n          cnt++;\r\n          if (cnt == m_emailCount) {\r\n            document.body.style.cursor = \"default\";\r\n\r\n            var requestList = web\r\n              .get_lists()\r\n              .getByTitle(Audit.Common.Utilities.GetListTitleRequests());\r\n            const oListItem = requestList.getItemById(requestID);\r\n            oListItem.set_item(\"EmailSent\", 1);\r\n            oListItem.update();\r\n\r\n            currCtx.executeQueryAsync(\r\n              function () {\r\n                SP.UI.Notify.addNotification(\r\n                  \"Email Sent to Action Offices. \",\r\n                  false\r\n                );\r\n                setTimeout(function () {\r\n                  m_waitDialog.close();\r\n                  m_fnRefreshData();\r\n                }, 1000);\r\n              },\r\n              function (sender, args) {\r\n                alert(\r\n                  \"Request failed: \" +\r\n                    args.get_message() +\r\n                    \"\\n\" +\r\n                    args.get_stackTrace()\r\n                );\r\n                m_fnRefresh();\r\n              }\r\n            );\r\n          }\r\n        },\r\n        function (sender, args) {\r\n          document.body.style.cursor = \"default\";\r\n\r\n          alert(\r\n            \"Request failed: \" +\r\n              args.get_message() +\r\n              \"\\n\" +\r\n              args.get_stackTrace()\r\n          );\r\n          m_fnRefresh();\r\n        }\r\n      );\r\n    }\r\n  }\r\n  function OnFailure(sender, args) {\r\n    document.body.style.cursor = \"default\";\r\n    alert(\r\n      \"Request failed. \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n  }\r\n\r\n  currCtx.executeQueryAsync(OnSuccess, OnFailure);\r\n}\r\n\r\nexport async function m_fnNotifyQAApprovalPending(oRequest, oResponseDocs) {\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var emailList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n\r\n  const reqNum = oRequest.number;\r\n  const emailSubject =\r\n    \"Your Approval Has Been Requested for Request Number: \" + reqNum;\r\n\r\n  var emailText =\r\n    \"<div>Audit Request Reference: <b>\" +\r\n    reqNum +\r\n    \"</b></div>\" +\r\n    \"<div>Audit Request Subject: <b>\" +\r\n    oRequest.subject +\r\n    \"</b></div>\" +\r\n    \"<div>Audit Request Due Date: <b>\" +\r\n    oRequest.internalDueDate +\r\n    \"</b></div><br/>\" +\r\n    \"<div>Response(s): <ul>\";\r\n\r\n  emailText += oRequest.responses\r\n    .map((oResponse) => {\r\n      const responseApprovedResponseDocs = oResponse.responseDocs.filter(\r\n        (responseDoc) => oResponseDocs.includes(responseDoc)\r\n      );\r\n\r\n      // Only proceed if this response has approved response docs\r\n      if (!responseApprovedResponseDocs.length) {\r\n        return;\r\n      }\r\n\r\n      return `<li><b>${oResponse.title}:</b> ${responseApprovedResponseDocs.length} document(s)</li>`;\r\n    })\r\n    .join(\"\");\r\n\r\n  emailText += \"</ul></div><br/>\";\r\n\r\n  var itemCreateInfo = new SP.ListItemCreationInformation();\r\n  itemCreateInfo.set_folderUrl(\r\n    location.protocol +\r\n      \"//\" +\r\n      location.host +\r\n      Audit.Common.Utilities.GetSiteUrl() +\r\n      \"/Lists/\" +\r\n      Audit.Common.Utilities.GetListNameEmailHistory() +\r\n      \"/\" +\r\n      reqNum\r\n  );\r\n  const oListItemEmail = emailList.addItem(itemCreateInfo);\r\n  oListItemEmail.set_item(\"Title\", emailSubject);\r\n  oListItemEmail.set_item(\"Body\", emailText);\r\n  oListItemEmail.set_item(\"To\", Audit.Common.Utilities.GetGroupNameQA());\r\n  oListItemEmail.set_item(\"NotificationType\", \"QA Notification\");\r\n  oListItemEmail.set_item(\"ReqNum\", reqNum);\r\n  oListItemEmail.update();\r\n\r\n  return new Promise((resolve, reject) => {\r\n    currCtx.executeQueryAsync(resolve, reject);\r\n  });\r\n}\r\n\r\nasync function m_fnUpdateSensitivityOnRequest(\r\n  requestNumber,\r\n  requestSensitivity,\r\n  oldSensitivity,\r\n  OnComplete\r\n) {\r\n  let m_cntResponseDocsSensToUpdate = 0;\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var responseDocsLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n  var responseDocsQuery = new SP.CamlQuery();\r\n  responseDocsQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><Where><And><Eq><FieldRef Name=\"ReqNum\"/><Value Type=\"Text\">' +\r\n      requestNumber +\r\n      '</Value></Eq><Eq><FieldRef Name=\"ContentType\"/><Value Type=\"Text\">Document</Value></Eq></And></Where></Query></View>'\r\n  );\r\n  const responseDocsItems = responseDocsLib.getItems(responseDocsQuery);\r\n  currCtx.load(\r\n    responseDocsItems,\r\n    \"Include(ID, ReqNum, ResID, DocumentStatus, FileLeafRef, Created )\"\r\n  );\r\n\r\n  var earesponseDocsLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocsEA());\r\n  var earesponseDocsQuery = new SP.CamlQuery();\r\n  earesponseDocsQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><Where><And><Eq><FieldRef Name=\"RequestNumber\"/><Value Type=\"Text\">' +\r\n      requestNumber +\r\n      '</Value></Eq><Eq><FieldRef Name=\"ContentType\"/><Value Type=\"Text\">Document</Value></Eq></And></Where></Query></View>'\r\n  );\r\n  const earesponseDocsItems = earesponseDocsLib.getItems(earesponseDocsQuery);\r\n  currCtx.load(\r\n    earesponseDocsItems,\r\n    \"Include(ID, RequestNumber, ResponseID, FileLeafRef)\"\r\n  );\r\n\r\n  var requestDocLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleRequestDocs());\r\n  var requestDocQuery = new SP.CamlQuery();\r\n  requestDocQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><Where><Eq><FieldRef Name=\"ReqNum\"/><Value Type=\"Text\">' +\r\n      requestNumber +\r\n      \"</Value></Eq></Where></Query></View>\"\r\n  );\r\n  const requestDocItems = requestDocLib.getItems(requestDocQuery);\r\n  currCtx.load(\r\n    requestDocItems,\r\n    \"Include(ID, Title, ReqNum, FileLeafRef, FileDirRef)\"\r\n  );\r\n\r\n  var coverSheetLib = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleCoverSheets());\r\n  var coverSheetQuery = new SP.CamlQuery();\r\n  coverSheetQuery.set_viewXml(\r\n    '<View Scope=\"RecursiveAll\"><Query><Where><Eq><FieldRef Name=\"ReqNum\"/><Value Type=\"Text\">' +\r\n      requestNumber +\r\n      \"</Value></Eq></Where></Query></View>\"\r\n  );\r\n  const coverSheetItems = coverSheetLib.getItems(coverSheetQuery);\r\n  currCtx.load(\r\n    coverSheetItems,\r\n    \"Include(ID, Title, ReqNum, ActionOffice, FileLeafRef, FileDirRef)\"\r\n  );\r\n\r\n  await new Promise((resolve, reject) =>\r\n    currCtx.executeQueryAsync(resolve, reject)\r\n  ).catch((sender, args) => {\r\n    const statusId = SP.UI.Status.addStatus(\r\n      \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n    );\r\n    SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n  });\r\n\r\n  var listItemEnumerator = responseDocsItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n    var docStatus = oListItem.get_item(\"DocumentStatus\");\r\n    if (docStatus != \"Open\" && docStatus != \"Submitted\") {\r\n      m_cntResponseDocsSensToUpdate++;\r\n    }\r\n  }\r\n\r\n  m_cntResponseDocsSensToUpdate += earesponseDocsItems.get_count();\r\n  m_cntResponseDocsSensToUpdate += requestDocItems.get_count();\r\n  m_cntResponseDocsSensToUpdate += coverSheetItems.get_count();\r\n\r\n  if (m_cntResponseDocsSensToUpdate == 0) {\r\n    return true;\r\n  }\r\n\r\n  //update the names in the response document folders\r\n  const updateDocPromises = [];\r\n  var listItemEnumerator = responseDocsItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var oListItem = listItemEnumerator.get_current();\r\n    var docStatus = oListItem.get_item(\"DocumentStatus\");\r\n    if (docStatus != \"Open\" && docStatus != \"Submitted\") {\r\n      var responseTitle = oListItem.get_item(\"ResID\");\r\n      if (responseTitle) responseTitle = responseTitle.get_lookupValue();\r\n\r\n      var curFileName = oListItem.get_item(\"FileLeafRef\");\r\n      var newFileName = m_fnGetNewResponseDocTitle(\r\n        oListItem,\r\n        responseTitle,\r\n        requestSensitivity\r\n      );\r\n      oListItem.set_item(\"FileLeafRef\", newFileName);\r\n      oListItem.update();\r\n\r\n      updateDocPromises.push(\r\n        new Promise((resolve, reject) => {\r\n          currCtx.executeQueryAsync(resolve, reject);\r\n        }).catch((sender, args) => {\r\n          alert(\r\n            \"Error occurred updating sensitivity title on Response document: \" +\r\n              curFileName +\r\n              \" to \" +\r\n              newFileName +\r\n              \" \" +\r\n              args.get_message() +\r\n              \"\\n\" +\r\n              args.get_stackTrace()\r\n          );\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  //update the names in the external auditors folders\r\n  var listItemEnumerator2 = earesponseDocsItems.getEnumerator();\r\n  while (listItemEnumerator2.moveNext()) {\r\n    var oListItem = listItemEnumerator2.get_current();\r\n\r\n    var curDocFileNameAndExt = oListItem.get_item(\"FileLeafRef\");\r\n    var curDocFileName = curDocFileNameAndExt.substring(\r\n      0,\r\n      curDocFileNameAndExt.lastIndexOf(\".\")\r\n    );\r\n    var curDocExt = curDocFileNameAndExt.replace(curDocFileName, \"\");\r\n\r\n    //var curDocRequest = oListItem.get_item(\"RequestNumber\");\r\n    var curDocResponseTitle = oListItem.get_item(\"ResponseID\");\r\n    var dateStamp = curDocFileName.replace(curDocResponseTitle + \"_\", \"\");\r\n    if (dateStamp.indexOf(\"_\") >= 0) {\r\n      //then it had some sensitivity\r\n      dateStamp = dateStamp.substring(0, dateStamp.indexOf(\"_\"));\r\n    }\r\n\r\n    var newFileName = \"\";\r\n\r\n    if (\r\n      requestSensitivity != null &&\r\n      requestSensitivity != \"\" &&\r\n      requestSensitivity != \"None\"\r\n    )\r\n      newFileName =\r\n        curDocResponseTitle +\r\n        \"_\" +\r\n        dateStamp +\r\n        \"_\" +\r\n        requestSensitivity +\r\n        curDocExt;\r\n    else newFileName = curDocResponseTitle + \"_\" + dateStamp + curDocExt;\r\n\r\n    if (newFileName != \"\") {\r\n      oListItem.set_item(\"FileLeafRef\", newFileName);\r\n      oListItem.update();\r\n    }\r\n\r\n    updateDocPromises.push(\r\n      new Promise((resolve, reject) => {\r\n        currCtx.executeQueryAsync(resolve, reject);\r\n      }).catch((sender, args) => {\r\n        alert(\r\n          \"Error occurred updating sensitivity title on External Auditor Response document: \" +\r\n            curFileName +\r\n            \" to \" +\r\n            newFileName +\r\n            \" \" +\r\n            args.get_message() +\r\n            \"\\n\" +\r\n            args.get_stackTrace()\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  if (oldSensitivity == null) oldSensitivity = \"\";\r\n\r\n  //update the names in the request docs\r\n  var listItemEnumerator3 = requestDocItems.getEnumerator();\r\n  while (listItemEnumerator3.moveNext()) {\r\n    var oListItem = listItemEnumerator3.get_current();\r\n    var curDocFileNameAndExt = oListItem.get_item(\"FileLeafRef\");\r\n    var newFileName = m_fnGetNewFileNameForSensitivity(\r\n      oListItem,\r\n      oldSensitivity,\r\n      requestSensitivity\r\n    );\r\n    if (newFileName != \"\") {\r\n      oListItem.set_item(\"FileLeafRef\", newFileName);\r\n      oListItem.update();\r\n    }\r\n\r\n    updateDocPromises.push(\r\n      new Promise((resolve, reject) => {\r\n        currCtx.executeQueryAsync(resolve, reject);\r\n      }).catch((sender, args) => {\r\n        alert(\r\n          \"Error occurred updating sensitivity title on Request document: \" +\r\n            curFileName +\r\n            \" to \" +\r\n            newFileName +\r\n            \" \" +\r\n            args.get_message() +\r\n            \"\\n\" +\r\n            args.get_stackTrace()\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  //update the names in the coversheets docs\r\n  var listItemEnumerator4 = coverSheetItems.getEnumerator();\r\n  while (listItemEnumerator4.moveNext()) {\r\n    var oListItem = listItemEnumerator4.get_current();\r\n    var curDocFileNameAndExt = oListItem.get_item(\"FileLeafRef\");\r\n    var newFileName = m_fnGetNewFileNameForSensitivity(\r\n      oListItem,\r\n      oldSensitivity,\r\n      requestSensitivity\r\n    );\r\n    if (newFileName != \"\") {\r\n      oListItem.set_item(\"FileLeafRef\", newFileName);\r\n      oListItem.update();\r\n    }\r\n    updateDocPromises.push(\r\n      new Promise((resolve, reject) => {\r\n        currCtx.executeQueryAsync(resolve, reject);\r\n      }).catch((sender, args) => {\r\n        alert(\r\n          \"Error occurred updating sensitivity title on Coversheet document: \" +\r\n            curFileName +\r\n            \" to \" +\r\n            newFileName +\r\n            \" \" +\r\n            args.get_message() +\r\n            \"\\n\" +\r\n            args.get_stackTrace()\r\n        );\r\n      })\r\n    );\r\n  }\r\n  await Promise.all(updateDocPromises);\r\n  return true;\r\n}\r\n\r\nfunction m_fnGetNewFileNameForSensitivity(\r\n  oListItem,\r\n  oldSensitivity,\r\n  requestSensitivity\r\n) {\r\n  var newFileName = null;\r\n\r\n  var curDocFileNameAndExt = oListItem.get_item(\"FileLeafRef\");\r\n  var curDocFileName = curDocFileNameAndExt.substring(\r\n    0,\r\n    curDocFileNameAndExt.lastIndexOf(\".\")\r\n  );\r\n  var curDocExt = curDocFileNameAndExt.replace(curDocFileName, \"\");\r\n\r\n  newFileName = curDocFileName;\r\n  if (oldSensitivity != null && oldSensitivity != \"\") {\r\n    if (curDocFileName.endsWith(\"_\" + oldSensitivity)) {\r\n      newFileName = newFileName.replace(\"_\" + oldSensitivity, \"\");\r\n    }\r\n  }\r\n\r\n  if (\r\n    requestSensitivity != null &&\r\n    requestSensitivity != \"\" &&\r\n    requestSensitivity != \"None\"\r\n  ) {\r\n    if (!curDocFileName.endsWith(\"_\" + requestSensitivity))\r\n      newFileName = newFileName + \"_\" + requestSensitivity;\r\n  }\r\n\r\n  return newFileName;\r\n}\r\n\r\nfunction m_fnGetNewResponseDocTitle(\r\n  responseDocItem,\r\n  responseName,\r\n  sensitivity\r\n) {\r\n  var createdDate = responseDocItem.get_item(\"Created\");\r\n  var newResponseDocTitle =\r\n    responseName +\r\n    \"_\" +\r\n    createdDate.format(\"yyyyMMddTHHmmss\") +\r\n    \"_\" +\r\n    Math.ceil(Math.random() * 10000);\r\n\r\n  if (sensitivity != null && sensitivity != \"\" && sensitivity != \"None\")\r\n    newResponseDocTitle += \"_\" + sensitivity;\r\n\r\n  var oldResponseDocTitle = responseDocItem.get_item(\"FileLeafRef\");\r\n  var docName = oldResponseDocTitle.substring(\r\n    0,\r\n    oldResponseDocTitle.lastIndexOf(\".\")\r\n  );\r\n  var docExt = oldResponseDocTitle.replace(docName, \"\");\r\n  newResponseDocTitle += docExt;\r\n  return newResponseDocTitle;\r\n}\r\n\r\nasync function m_fnBreakRequestPermissions(\r\n  oListItem,\r\n  refreshPageOnUpdate = false,\r\n  responseStatus,\r\n  OnComplete\r\n) {\r\n  if (refreshPageOnUpdate) alert(\"trying to refresh page!\");\r\n  if (!m_bIsSiteOwner) {\r\n    return;\r\n  }\r\n  const breakRequestPermissionsTask = addTask(taskDefs.permissionsRequest);\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  const currentUser = web.get_currentUser();\r\n  const ownerGroup = web.get_associatedOwnerGroup();\r\n  const memberGroup = web.get_associatedMemberGroup();\r\n  const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n  var qaHasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameQA(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special1HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm1(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special2HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm2(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  oListItem.resetRoleInheritance();\r\n  oListItem.breakRoleInheritance(false, false);\r\n\r\n  var roleDefBindingCollAdmin =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollAdmin.add(\r\n    web.get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n  );\r\n\r\n  var roleDefBindingCollContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollContribute.add(\r\n    web.get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedRead =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedRead.add(\r\n    web.get_roleDefinitions().getByName(\"Restricted Read\")\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedContribute.add(\r\n    web.get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n  );\r\n\r\n  //add site associated groups\r\n  oListItem.get_roleAssignments().add(ownerGroup, roleDefBindingCollAdmin);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(memberGroup, roleDefBindingCollContribute);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n  if (qaHasRead || responseStatus == \"4-Approved for QA\") {\r\n    //make sure qa gets read if it had access\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  if (special1HasRead) {\r\n    //make sure qa gets read if it had access\r\n    var group1SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n    );\r\n    if (group1SpecialPerm != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(group1SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  if (special2HasRead) {\r\n    //make sure qa gets read if it had access\r\n    var group2SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n    );\r\n    if (group2SpecialPerm != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(group2SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  oListItem.get_roleAssignments().getByPrincipal(currentUser).deleteObject();\r\n\r\n  await new Promise((resolve, reject) => {\r\n    function onUpdateReqPermsSucceeed() {\r\n      let m_CntRequestAOsToAdd = 0;\r\n      let m_CntRequestAOsAdded = 0;\r\n\r\n      //add action offices\r\n      var arrActionOffice = oListItem.get_item(\"ActionOffice\");\r\n      if (arrActionOffice != null && arrActionOffice.length > 0) {\r\n        for (var x = 0; x < arrActionOffice.length; x++) {\r\n          var actionOfficeName = arrActionOffice[x].get_lookupValue();\r\n\r\n          var actionOfficeGroupName =\r\n            Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n          var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n            actionOfficeGroupName\r\n          );\r\n\r\n          if (actionOfficeGroup != null) {\r\n            m_CntRequestAOsToAdd++;\r\n\r\n            var currCtx2 = new SP.ClientContext.get_current();\r\n            var web2 = currCtx2.get_web();\r\n\r\n            var roleDefBindingCollRestrictedRead =\r\n              SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n            roleDefBindingCollRestrictedRead.add(\r\n              web2.get_roleDefinitions().getByName(\"Restricted Read\")\r\n            );\r\n\r\n            this.oListItem\r\n              .get_roleAssignments()\r\n              .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n\r\n            function onUpdatedReqAOSucceeded() {\r\n              m_CntRequestAOsAdded++;\r\n\r\n              if (m_CntRequestAOsAdded == m_CntRequestAOsToAdd) {\r\n                resolve(true);\r\n              }\r\n            }\r\n            function onUpdatedReqAOFailed(sender, args) {\r\n              m_CntRequestAOsAdded++;\r\n\r\n              if (m_CntRequestAOsAdded == m_CntRequestAOsToAdd) {\r\n                resolve(true); //return true to continue executing\r\n              }\r\n            }\r\n\r\n            var data = {\r\n              refreshPage: this.refreshPage,\r\n              resolve,\r\n            };\r\n            currCtx2.executeQueryAsync(\r\n              Function.createDelegate(data, onUpdatedReqAOSucceeded),\r\n              Function.createDelegate(data, onUpdatedReqAOFailed)\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        resolve(true);\r\n      }\r\n    }\r\n\r\n    function onUpdateReqPermsFailed(sender, args) {\r\n      SP.UI.Notify.addNotification(\r\n        \"Failed to update permissions on Request: \" +\r\n          this.title +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace(),\r\n        false\r\n      );\r\n      // Continue regardless of success?\r\n      this.reject(sender, args);\r\n    }\r\n\r\n    var data = {\r\n      title: oListItem.get_item(\"Title\"),\r\n      refreshPage: refreshPageOnUpdate,\r\n      oListItem: oListItem,\r\n      resolve,\r\n      reject,\r\n      OnComplete: OnComplete,\r\n    };\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onUpdateReqPermsSucceeed),\r\n      Function.createDelegate(data, onUpdateReqPermsFailed)\r\n    );\r\n  });\r\n\r\n  finishTask(breakRequestPermissionsTask);\r\n}\r\n\r\nvar m_cntAOToAddToEmailFolder = 0;\r\nvar m_cntAOAddedToEmailFolder = 0;\r\nasync function m_fnBreakEmailFolderPermissions(\r\n  oListItem,\r\n  oRequestItem,\r\n  refreshPageOnUpdate,\r\n  OnComplete\r\n) {\r\n  const breakEmailFolderPermissionsTask = addTask(\r\n    taskDefs.permissionsEmailFolder\r\n  );\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  const currentUser = web.get_currentUser();\r\n  const ownerGroup = web.get_associatedOwnerGroup();\r\n  const memberGroup = web.get_associatedMemberGroup();\r\n  const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n  oListItem.resetRoleInheritance();\r\n  oListItem.breakRoleInheritance(false, false);\r\n\r\n  var roleDefBindingCollAdmin =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollAdmin.add(\r\n    web.get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n  );\r\n\r\n  var roleDefBindingCollContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollContribute.add(\r\n    web.get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedRead =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedRead.add(\r\n    web.get_roleDefinitions().getByName(\"Restricted Read\")\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedContribute.add(\r\n    web.get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n  );\r\n\r\n  //add site associated groups\r\n  oListItem.get_roleAssignments().add(ownerGroup, roleDefBindingCollAdmin);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(memberGroup, roleDefBindingCollContribute);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n  var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n    Audit.Common.Utilities.GetGroupNameQA()\r\n  );\r\n  if (spGroupQA != null)\r\n    oListItem\r\n      .get_roleAssignments()\r\n      .add(spGroupQA, roleDefBindingCollRestrictedContribute);\r\n\r\n  oListItem.get_roleAssignments().getByPrincipal(currentUser).deleteObject();\r\n\r\n  await new Promise((resolve, reject) => {\r\n    function onUpdateEmailFolderPermsSucceeed() {\r\n      if (!this.oRequestItem) resolve();\r\n      //add action offices\r\n      var arrActionOffice = this.oRequestItem.get_item(\"ActionOffice\");\r\n      if (arrActionOffice != null && arrActionOffice.length > 0) {\r\n        for (var x = 0; x < arrActionOffice.length; x++) {\r\n          var actionOfficeName = arrActionOffice[x].get_lookupValue();\r\n\r\n          var actionOfficeGroupName =\r\n            Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n          var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n            actionOfficeGroupName\r\n          );\r\n\r\n          if (actionOfficeGroup != null) {\r\n            m_cntAOToAddToEmailFolder++;\r\n\r\n            var currCtx2 = new SP.ClientContext.get_current();\r\n            var web2 = currCtx.get_web();\r\n\r\n            var roleDefBindingCollRestrictedContribute =\r\n              SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n            roleDefBindingCollRestrictedContribute.add(\r\n              web2.get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n            );\r\n\r\n            this.oListItem\r\n              .get_roleAssignments()\r\n              .add(actionOfficeGroup, roleDefBindingCollRestrictedContribute);\r\n\r\n            function onAOAddedToEmailFolderSucceeded() {\r\n              m_cntAOAddedToEmailFolder++;\r\n\r\n              if (m_cntAOAddedToEmailFolder == m_cntAOToAddToEmailFolder) {\r\n                resolve();\r\n              }\r\n            }\r\n            function onAOAddedToEmailFolderFailed(sender, args) {\r\n              m_cntAOAddedToEmailFolder++;\r\n\r\n              if (m_cntAOAddedToEmailFolder == m_cntAOToAddToEmailFolder) {\r\n                reject({ sender, args });\r\n              }\r\n            }\r\n\r\n            var data = {\r\n              refreshPage: this.refreshPage,\r\n              OnComplete: this.OnComplete,\r\n            };\r\n            currCtx2.executeQueryAsync(\r\n              Function.createDelegate(data, onAOAddedToEmailFolderSucceeded),\r\n              Function.createDelegate(data, onAOAddedToEmailFolderFailed)\r\n            );\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    function onUpdateEmailFolderPermsFailed(sender, args) {\r\n      reject({ sender, args });\r\n    }\r\n\r\n    var data = {\r\n      title: oListItem.get_item(\"Title\"),\r\n      refreshPage: refreshPageOnUpdate,\r\n      oListItem: oListItem,\r\n      oRequestItem: oRequestItem,\r\n      OnComplete: OnComplete,\r\n    };\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onUpdateEmailFolderPermsSucceeed),\r\n      Function.createDelegate(data, onUpdateEmailFolderPermsFailed)\r\n    );\r\n  });\r\n\r\n  finishTask(breakEmailFolderPermissionsTask);\r\n}\r\n\r\nvar m_countCSToAdd = 0;\r\nvar m_countCSAdded = 0;\r\n\r\nvar oCntCSAOAdd = new Object();\r\nasync function m_fnBreakCoversheetPermissions(oListItem, grantQARead) {\r\n  if (oListItem == null) return;\r\n  const breakCoversheetPermissionsTask = addTask(\r\n    taskDefs.permissionsCoversheet\r\n  );\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var currentUser = currCtx.get_web().get_currentUser();\r\n  var ownerGroup = web.get_associatedOwnerGroup();\r\n  var memberGroup = web.get_associatedMemberGroup();\r\n  var visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n  var qaHasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameQA(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special1HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm1(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special2HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm2(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  //check this because if it's inheriting, they'll have access\r\n  if (!oListItem.get_hasUniqueRoleAssignments()) {\r\n    qaHasRead = false;\r\n    special1HasRead = false;\r\n    special2HasRead = false;\r\n  }\r\n\r\n  oListItem.resetRoleInheritance();\r\n  oListItem.breakRoleInheritance(false, false);\r\n\r\n  var roleDefBindingCollAdmin =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollAdmin.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n  );\r\n\r\n  var roleDefBindingCollContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedRead =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedRead.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n  );\r\n\r\n  //add associated site groups\r\n  oListItem.get_roleAssignments().add(ownerGroup, roleDefBindingCollAdmin);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(memberGroup, roleDefBindingCollContribute);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n  if (qaHasRead || grantQARead) {\r\n    //make sure qa gets read if it had access\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  if (special1HasRead) {\r\n    //make sure qa gets read if it had access\r\n    var group1SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n    );\r\n    if (group1SpecialPerm != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(group1SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  if (special2HasRead) {\r\n    //make sure qa gets read if it had access\r\n    var group2SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n    );\r\n    if (group2SpecialPerm != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(group2SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  oListItem.get_roleAssignments().getByPrincipal(currentUser).deleteObject();\r\n\r\n  await new Promise((resolve, reject) => {\r\n    async function onUpdatedCSSucceeded() {\r\n      var currCtx2 = new SP.ClientContext.get_current();\r\n\r\n      var roleDefBindingCollRestrictedRead =\r\n        SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n      roleDefBindingCollRestrictedRead.add(\r\n        currCtx2.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n      );\r\n\r\n      //add action offices\r\n      var arrActionOffice = this.oListItem.get_item(\"ActionOffice\");\r\n      if (arrActionOffice == null || arrActionOffice.length == 0) {\r\n        resolve();\r\n      }\r\n\r\n      // Map Action Office to sp groups,\r\n      // filter null,\r\n      // return a new promise to update the coversheets permissions for the group\r\n      await Promise.all(\r\n        arrActionOffice\r\n          .map((oActionOffice) => {\r\n            var actionOfficeName = oActionOffice.get_lookupValue();\r\n            var actionOfficeGroupName =\r\n              Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n            var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n              actionOfficeGroupName\r\n            );\r\n            return actionOfficeGroup;\r\n          })\r\n          .filter((actionOfficeGroupName) => actionOfficeGroupName != null)\r\n          .map((actionOfficeGroup) => {\r\n            var roleDefBindingCollRestrictedRead =\r\n              SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n            roleDefBindingCollRestrictedRead.add(\r\n              currCtx2\r\n                .get_web()\r\n                .get_roleDefinitions()\r\n                .getByName(\"Restricted Read\")\r\n            );\r\n            this.oListItem\r\n              .get_roleAssignments()\r\n              .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n\r\n            return new Promise((resolve2, reject2) => {\r\n              currCtx2.executeQueryAsync(resolve2, reject2);\r\n            });\r\n          })\r\n      );\r\n\r\n      resolve(true);\r\n    }\r\n\r\n    function onUpdatedCSFailed(sender, args) {\r\n      SP.UI.Notify.addNotification(\r\n        \"Failed to update permissions on Coversheet\" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace(),\r\n        false\r\n      );\r\n\r\n      resolve(true); //return true to continue executing(?)\r\n    }\r\n\r\n    var data = {\r\n      oListItem: oListItem,\r\n    };\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onUpdatedCSSucceeded),\r\n      Function.createDelegate(data, onUpdatedCSFailed)\r\n    );\r\n  });\r\n\r\n  finishTask(breakCoversheetPermissionsTask);\r\n}\r\n\r\nasync function m_fnBreakCoversheetPermissionsOnSpecialPerms(\r\n  currCtx,\r\n  oListItem,\r\n  addSpecialPerms,\r\n  refreshPageOnUpdate,\r\n  OnComplete\r\n) {\r\n  if (oListItem == null) return;\r\n  const breakCoversheetPermissionsTask = addTask(\r\n    taskDefs.permissionsCoversheet\r\n  );\r\n\r\n  var web = currCtx.get_web();\r\n\r\n  const currentUser = currCtx.get_web().get_currentUser();\r\n  const ownerGroup = web.get_associatedOwnerGroup();\r\n  const memberGroup = web.get_associatedMemberGroup();\r\n  const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n  oListItem.resetRoleInheritance();\r\n  oListItem.breakRoleInheritance(false, false);\r\n\r\n  var qaHasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameQA(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  var roleDefBindingCollAdmin =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollAdmin.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n  );\r\n\r\n  var roleDefBindingCollContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedRead =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedRead.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n  );\r\n\r\n  //add associated site groups\r\n  oListItem.get_roleAssignments().add(ownerGroup, roleDefBindingCollAdmin);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(memberGroup, roleDefBindingCollContribute);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n  if (qaHasRead) {\r\n    //make sure qa gets read if it had access\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  if (addSpecialPerms) {\r\n    //make sure qa gets read if it had access\r\n    var group1SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n    );\r\n    if (group1SpecialPerm != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(group1SpecialPerm, roleDefBindingCollRestrictedRead);\r\n\r\n    var group2SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n    );\r\n    if (group2SpecialPerm != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(group2SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  oListItem.get_roleAssignments().getByPrincipal(currentUser).deleteObject();\r\n\r\n  await new Promise((resolve, reject) => {\r\n    currCtx.executeQueryAsync(resolve, (sender, args) =>\r\n      reject({ sender, args })\r\n    );\r\n  }).catch((e) => {\r\n    return;\r\n  });\r\n\r\n  var currCtx2 = new SP.ClientContext.get_current();\r\n\r\n  //add action offices\r\n  var arrActionOffice = this.oListItem.get_item(\"ActionOffice\");\r\n\r\n  if (arrActionOffice == null || arrActionOffice.length == 0) {\r\n    if (this.OnComplete) this.OnComplete(true);\r\n    return;\r\n  }\r\n\r\n  var csID = this.oListItem.get_item(\"ID\");\r\n  oCntCSAOAdd[csID + \"toAdd\"] = 0;\r\n  oCntCSAOAdd[csID + \"added\"] = 0;\r\n\r\n  for (var x = 0; x < arrActionOffice.length; x++) {\r\n    var actionOfficeName = arrActionOffice[x].get_lookupValue();\r\n    var actionOfficeGroupName =\r\n      Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n    var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n      actionOfficeGroupName\r\n    );\r\n    if (actionOfficeGroup != null) {\r\n      oCntCSAOAdd[csID + \"toAdd\"] = oCntCSAOAdd[csID + \"toAdd\"] + 1;\r\n\r\n      var roleDefBindingCollRestrictedRead =\r\n        SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n      roleDefBindingCollRestrictedRead.add(\r\n        currCtx2.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n      );\r\n\r\n      this.oListItem\r\n        .get_roleAssignments()\r\n        .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n\r\n      await new Promise((resolve, reject) => {\r\n        currCtx2.executeQueryAsync(resolve, reject);\r\n      }).catch((e) => {\r\n        console.error(\"Error setting special perms: \", actionOfficeGroupName);\r\n      });\r\n    }\r\n  }\r\n\r\n  finishTask(breakCoversheetPermissionsTask);\r\n}\r\n\r\n//This gets executed when on refresh if a response does not have broken permissions. When a new response is created from the list form, we\r\n//cant set the permissions until it's been created. So, on callback, refresh is called and checks for responses that don't have broken permissions\r\nasync function m_fnBreakResponseAndFolderPermissions(\r\n  requestStatus,\r\n  oResponse,\r\n  refreshPageOnUpdate = false,\r\n  checkStatus = false,\r\n  bForceGrantSP = false,\r\n  bForceRemoveSP = false\r\n) {\r\n  if (!m_bIsSiteOwner) {\r\n    return;\r\n  }\r\n\r\n  const breakResponsePermissionsTask = addTask(\r\n    taskDefs.permissionsResponseAndFolder(oResponse.title)\r\n  );\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  const currentUser = currCtx.get_web().get_currentUser();\r\n  const ownerGroup = web.get_associatedOwnerGroup();\r\n  const memberGroup = web.get_associatedMemberGroup();\r\n  const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n  var qaHasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oResponse.item,\r\n    Audit.Common.Utilities.GetGroupNameQA(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special1HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oResponse.item,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm1(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special2HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oResponse.item,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm2(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  if (!oResponse.item.get_hasUniqueRoleAssignments()) {\r\n    qaHasRead = false;\r\n    special1HasRead = false;\r\n    special2HasRead = false;\r\n  }\r\n  if (bForceGrantSP) {\r\n    special1HasRead = true;\r\n    special2HasRead = true;\r\n  } else if (bForceRemoveSP) {\r\n    special1HasRead = false;\r\n    special2HasRead = false;\r\n  }\r\n\r\n  oResponse.item.resetRoleInheritance();\r\n  oResponse.item.breakRoleInheritance(false, false);\r\n\r\n  if (oResponse.responseFolderItem) {\r\n    oResponse.responseFolderItem.resetRoleInheritance();\r\n    oResponse.responseFolderItem.breakRoleInheritance(false, false);\r\n  }\r\n\r\n  var roleDefBindingCollAdmin =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollAdmin.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n  );\r\n\r\n  var roleDefBindingCollContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedRead =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedRead.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n  );\r\n\r\n  //add associated site groups\r\n  oResponse.item.get_roleAssignments().add(ownerGroup, roleDefBindingCollAdmin);\r\n  oResponse.item\r\n    .get_roleAssignments()\r\n    .add(memberGroup, roleDefBindingCollContribute);\r\n  oResponse.item\r\n    .get_roleAssignments()\r\n    .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n  if (oResponse.responseFolderItem) {\r\n    //add associated site groups\r\n    oResponse.responseFolderItem\r\n      .get_roleAssignments()\r\n      .add(ownerGroup, roleDefBindingCollAdmin);\r\n    oResponse.responseFolderItem\r\n      .get_roleAssignments()\r\n      .add(memberGroup, roleDefBindingCollContribute);\r\n    oResponse.responseFolderItem\r\n      .get_roleAssignments()\r\n      .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  if (\r\n    qaHasRead ||\r\n    oResponse.item.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n    oResponse.item.get_item(\"ResStatus\") == \"6-Reposted After Rejection\"\r\n  ) {\r\n    //make sure qa gets read if it had access\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null) {\r\n      if (\r\n        checkStatus &&\r\n        (oResponse.item.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n          oResponse.item.get_item(\"ResStatus\") ==\r\n            \"6-Reposted After Rejection\") &&\r\n        (requestStatus == \"Open\" || requestStatus == \"ReOpened\")\r\n      ) {\r\n        oResponse.item\r\n          .get_roleAssignments()\r\n          .add(spGroupQA, roleDefBindingCollRestrictedContribute);\r\n        if (oResponse.responseFolderItem) {\r\n          oResponse.responseFolderItem\r\n            .get_roleAssignments()\r\n            .add(spGroupQA, roleDefBindingCollRestrictedContribute);\r\n        }\r\n      } else {\r\n        oResponse.item\r\n          .get_roleAssignments()\r\n          .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n        if (oResponse.responseFolderItem) {\r\n          oResponse.responseFolderItem\r\n            .get_roleAssignments()\r\n            .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (\r\n    special1HasRead &&\r\n    (oResponse.item.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n      oResponse.item.get_item(\"ResStatus\") == \"6-Reposted After Rejection\" ||\r\n      oResponse.item.get_item(\"ResStatus\") == \"7-Closed\")\r\n  ) {\r\n    var group1SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n    );\r\n    if (group1SpecialPerm != null) {\r\n      oResponse.item\r\n        .get_roleAssignments()\r\n        .add(group1SpecialPerm, roleDefBindingCollRestrictedRead);\r\n      if (oResponse.responseFolderItem) {\r\n        oResponse.responseFolderItem\r\n          .get_roleAssignments()\r\n          .add(group1SpecialPerm, roleDefBindingCollRestrictedRead);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (\r\n    special2HasRead &&\r\n    (oResponse.item.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n      oResponse.item.get_item(\"ResStatus\") == \"6-Reposted After Rejection\" ||\r\n      oResponse.item.get_item(\"ResStatus\") == \"7-Closed\")\r\n  ) {\r\n    var group2SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n    );\r\n    if (group2SpecialPerm != null) {\r\n      oResponse.item\r\n        .get_roleAssignments()\r\n        .add(group2SpecialPerm, roleDefBindingCollRestrictedRead);\r\n      if (oResponse.responseFolderItem) {\r\n        oResponse.responseFolderItem\r\n          .get_roleAssignments()\r\n          .add(group2SpecialPerm, roleDefBindingCollRestrictedRead);\r\n      }\r\n    }\r\n  }\r\n\r\n  //add action offices\r\n  var actionOffice = oResponse.item.get_item(\"ActionOffice\");\r\n  if (actionOffice != null) {\r\n    var actionOfficeName = actionOffice.get_lookupValue();\r\n    var actionOfficeGroupName =\r\n      Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n    var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n      actionOfficeGroupName\r\n    );\r\n\r\n    if (actionOfficeGroup != null) {\r\n      if (\r\n        checkStatus &&\r\n        (oResponse.item.get_item(\"ResStatus\") == \"1-Open\" ||\r\n          oResponse.item.get_item(\"ResStatus\") ==\r\n            \"3-Returned to Action Office\") &&\r\n        (requestStatus == \"Open\" || requestStatus == \"ReOpened\")\r\n      ) {\r\n        oResponse.item\r\n          .get_roleAssignments()\r\n          .add(actionOfficeGroup, roleDefBindingCollRestrictedContribute);\r\n        if (oResponse.responseFolderItem)\r\n          oResponse.responseFolderItem\r\n            .get_roleAssignments()\r\n            .add(actionOfficeGroup, roleDefBindingCollRestrictedContribute);\r\n      } else {\r\n        oResponse.item\r\n          .get_roleAssignments()\r\n          .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n        if (oResponse.responseFolderItem) {\r\n          oResponse.responseFolderItem\r\n            .get_roleAssignments()\r\n            .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  oResponse.item\r\n    .get_roleAssignments()\r\n    .getByPrincipal(currentUser)\r\n    .deleteObject();\r\n  if (oResponse.responseFolderItem)\r\n    oResponse.responseFolderItem\r\n      .get_roleAssignments()\r\n      .getByPrincipal(currentUser)\r\n      .deleteObject();\r\n\r\n  await new Promise((resolve, reject) => {\r\n    currCtx.executeQueryAsync(resolve, (sender, args) => {\r\n      SP.UI.Notify.addNotification(\r\n        \"Failed to update permissions on Response: \" +\r\n          oResponse.item.get_item(\"Title\") +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace(),\r\n        false\r\n      );\r\n      reject({ sender, args });\r\n    });\r\n  });\r\n\r\n  finishTask(breakResponsePermissionsTask);\r\n}\r\n\r\n//This gets executed when on refresh if a response does not have broken permissions. When a new response is created from the list form, we\r\n//cant set the permissions until it's been created. So, on callback, refresh is called and checks for responses that don't have broken permissions\r\nasync function m_fnBreakResponsePermissions(\r\n  oListItem,\r\n  refreshPageOnUpdate,\r\n  checkStatus\r\n) {\r\n  if (!m_bIsSiteOwner) {\r\n    return;\r\n  }\r\n  const breakResponsePermissionsTask = addTask(\r\n    taskDefs.permissionsResponse(oListItem.get_item(\"Title\"))\r\n  );\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  const currentUser = currCtx.get_web().get_currentUser();\r\n  const ownerGroup = web.get_associatedOwnerGroup();\r\n  const memberGroup = web.get_associatedMemberGroup();\r\n  const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n  //check QA before resetting\r\n  var permissionsToCheck = SP.PermissionKind.viewListItems;\r\n  var qaHasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameQA(),\r\n    permissionsToCheck\r\n  );\r\n  var special1HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm1(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special2HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItem,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm2(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  if (!oListItem.get_hasUniqueRoleAssignments()) {\r\n    qaHasRead = false;\r\n    special1HasRead = false;\r\n    special2HasRead = false;\r\n  }\r\n\r\n  oListItem.resetRoleInheritance();\r\n  oListItem.breakRoleInheritance(false, false);\r\n\r\n  var roleDefBindingCollAdmin =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollAdmin.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n  );\r\n\r\n  var roleDefBindingCollContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedRead =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedRead.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n  );\r\n\r\n  //add associated site groups\r\n  oListItem.get_roleAssignments().add(ownerGroup, roleDefBindingCollAdmin);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(memberGroup, roleDefBindingCollContribute);\r\n  oListItem\r\n    .get_roleAssignments()\r\n    .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n  //add action offices\r\n  var actionOffice = oListItem.get_item(\"ActionOffice\");\r\n  if (actionOffice != null) {\r\n    var actionOfficeName = actionOffice.get_lookupValue();\r\n    var actionOfficeGroupName =\r\n      Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n    var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n      actionOfficeGroupName\r\n    );\r\n\r\n    if (actionOfficeGroup != null) {\r\n      if (\r\n        checkStatus &&\r\n        (oListItem.get_item(\"ResStatus\") == \"1-Open\" ||\r\n          oListItem.get_item(\"ResStatus\") == \"3-Returned to Action Office\")\r\n      )\r\n        oListItem\r\n          .get_roleAssignments()\r\n          .add(actionOfficeGroup, roleDefBindingCollRestrictedContribute);\r\n      else\r\n        oListItem\r\n          .get_roleAssignments()\r\n          .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n    }\r\n  }\r\n\r\n  if (\r\n    qaHasRead ||\r\n    oListItem.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n    oListItem.get_item(\"ResStatus\") == \"6-Reposted After Rejection\"\r\n  ) {\r\n    //make sure qa gets read if it had access\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null) {\r\n      if (\r\n        (oListItem.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n          oListItem.get_item(\"ResStatus\") == \"6-Reposted After Rejection\") &&\r\n        checkStatus\r\n      )\r\n        oListItem\r\n          .get_roleAssignments()\r\n          .add(spGroupQA, roleDefBindingCollRestrictedContribute);\r\n      else\r\n        oListItem\r\n          .get_roleAssignments()\r\n          .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n    }\r\n  }\r\n\r\n  if (\r\n    special1HasRead &&\r\n    (oListItem.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n      oListItem.get_item(\"ResStatus\") == \"6-Reposted After Rejection\" ||\r\n      oListItem.get_item(\"ResStatus\") == \"7-Closed\")\r\n  ) {\r\n    var group1SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n    );\r\n    if (group1SpecialPerm != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(group1SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  if (\r\n    special2HasRead &&\r\n    (oListItem.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n      oListItem.get_item(\"ResStatus\") == \"6-Reposted After Rejection\" ||\r\n      oListItem.get_item(\"ResStatus\") == \"7-Closed\")\r\n  ) {\r\n    var group2SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n    );\r\n    if (group2SpecialPerm != null)\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .add(group2SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  oListItem.get_roleAssignments().getByPrincipal(currentUser).deleteObject();\r\n\r\n  await new Promise((resolve, reject) =>\r\n    currCtx.executeQueryAsync(resolve, (sender, args) =>\r\n      reject({ sender, args })\r\n    )\r\n  ).catch((e) => {\r\n    console.error(\"Failed to update permissions on response: \", oListItem);\r\n  });\r\n\r\n  if (refreshPageOnUpdate) m_fnRefreshData();\r\n  finishTask(breakResponsePermissionsTask);\r\n}\r\n\r\nasync function m_fnBreakResponseFolderPermissions(\r\n  oListItemFolder,\r\n  oListItemResponse,\r\n  refreshPageOnUpdate,\r\n  bCheckStatus,\r\n  OnComplete\r\n) {\r\n  if (!m_bIsSiteOwner) {\r\n    return;\r\n  }\r\n  const breakResponsePermissionsTask = addTask(\r\n    taskDefs.permissionsResponseFolder(oListItemResponse.get_item(\"Title\"))\r\n  );\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  const currentUser = currCtx.get_web().get_currentUser();\r\n  const ownerGroup = web.get_associatedOwnerGroup();\r\n  const memberGroup = web.get_associatedMemberGroup();\r\n  const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n  var qaHasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItemFolder,\r\n    Audit.Common.Utilities.GetGroupNameQA(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special1HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItemFolder,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm1(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  var special2HasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n    oListItemFolder,\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm2(),\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  if (!oListItemFolder.get_hasUniqueRoleAssignments()) {\r\n    qaHasRead = false;\r\n    special1HasRead = false;\r\n    special2HasRead = false;\r\n  }\r\n\r\n  oListItemFolder.resetRoleInheritance();\r\n  oListItemFolder.breakRoleInheritance(false, false);\r\n\r\n  var roleDefBindingCollAdmin =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollAdmin.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n  );\r\n\r\n  var roleDefBindingCollContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedRead =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedRead.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n  );\r\n\r\n  var roleDefBindingCollRestrictedContribute =\r\n    SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n  roleDefBindingCollRestrictedContribute.add(\r\n    currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n  );\r\n\r\n  //add associated site groups\r\n  oListItemFolder\r\n    .get_roleAssignments()\r\n    .add(ownerGroup, roleDefBindingCollAdmin);\r\n  oListItemFolder\r\n    .get_roleAssignments()\r\n    .add(memberGroup, roleDefBindingCollContribute);\r\n  oListItemFolder\r\n    .get_roleAssignments()\r\n    .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n  //add action offices\r\n  var actionOffice = oListItemResponse.get_item(\"ActionOffice\");\r\n  if (actionOffice != null) {\r\n    var actionOfficeName = actionOffice.get_lookupValue();\r\n    var actionOfficeGroupName =\r\n      Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n    var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n      actionOfficeGroupName\r\n    );\r\n\r\n    if (actionOfficeGroup != null) {\r\n      if (\r\n        bCheckStatus &&\r\n        (oListItemResponse.get_item(\"ResStatus\") == \"1-Open\" ||\r\n          oListItemResponse.get_item(\"ResStatus\") ==\r\n            \"3-Returned to Action Office\")\r\n      )\r\n        oListItemFolder\r\n          .get_roleAssignments()\r\n          .add(actionOfficeGroup, roleDefBindingCollRestrictedContribute);\r\n      else\r\n        oListItemFolder\r\n          .get_roleAssignments()\r\n          .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n    }\r\n  }\r\n\r\n  if (\r\n    qaHasRead ||\r\n    oListItemResponse.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n    oListItemResponse.get_item(\"ResStatus\") == \"6-Reposted After Rejection\"\r\n  ) {\r\n    //make sure qa gets read if it had access\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null) {\r\n      if (\r\n        bCheckStatus &&\r\n        (oListItemResponse.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n          oListItemResponse.get_item(\"ResStatus\") ==\r\n            \"6-Reposted After Rejection\")\r\n      )\r\n        oListItemFolder\r\n          .get_roleAssignments()\r\n          .add(spGroupQA, roleDefBindingCollRestrictedContribute);\r\n      else\r\n        oListItemFolder\r\n          .get_roleAssignments()\r\n          .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n    }\r\n  }\r\n\r\n  if (\r\n    special1HasRead &&\r\n    (oListItemResponse.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n      oListItemResponse.get_item(\"ResStatus\") == \"6-Reposted After Rejection\" ||\r\n      oListItemResponse.get_item(\"ResStatus\") == \"7-Closed\")\r\n  ) {\r\n    var group1SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n    );\r\n    if (group1SpecialPerm != null)\r\n      oListItemFolder\r\n        .get_roleAssignments()\r\n        .add(group1SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  if (\r\n    special2HasRead &&\r\n    (oListItemResponse.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n      oListItemResponse.get_item(\"ResStatus\") == \"6-Reposted After Rejection\" ||\r\n      oListItemResponse.get_item(\"ResStatus\") == \"7-Closed\")\r\n  ) {\r\n    var group2SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n    );\r\n    if (group2SpecialPerm != null)\r\n      oListItemFolder\r\n        .get_roleAssignments()\r\n        .add(group2SpecialPerm, roleDefBindingCollRestrictedRead);\r\n  }\r\n\r\n  oListItemFolder\r\n    .get_roleAssignments()\r\n    .getByPrincipal(currentUser)\r\n    .deleteObject();\r\n\r\n  await executeQuery(currCtx).catch((e) =>\r\n    console.error(\r\n      \"Failed to update permissions on Response Folder: \",\r\n      oListItemResponse.get_item(\"Title\")\r\n    )\r\n  );\r\n\r\n  finishTask(breakResponsePermissionsTask);\r\n}\r\n\r\nvar m_countAOSPToAdd = 0;\r\nvar m_countAOSPAdded = 0;\r\nfunction m_fnGrantAOSpecialPermsOnRequest(oRequest, OnComplete) {\r\n  if (oRequest == null) {\r\n    if (OnComplete) OnComplete(true);\r\n    return;\r\n  }\r\n\r\n  m_countAOSPToAdd = 0;\r\n  m_countAOSPAdded = 0;\r\n\r\n  //add action offices to request\r\n  var arrActionOffice = oRequest.item.get_item(\"ActionOffice\");\r\n\r\n  if (arrActionOffice == null || arrActionOffice.length == 0) {\r\n    if (this.OnComplete) this.OnComplete(true);\r\n\r\n    return;\r\n  }\r\n\r\n  for (var x = 0; x < arrActionOffice.length; x++) {\r\n    var actionOfficeName = arrActionOffice[x].get_lookupValue();\r\n    var actionOfficeGroupName =\r\n      Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n    var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n      actionOfficeGroupName\r\n    );\r\n\r\n    if (actionOfficeGroup != null) {\r\n      m_countAOSPToAdd++;\r\n\r\n      var currCtx2 = new SP.ClientContext.get_current();\r\n      var web = currCtx2.get_web();\r\n\r\n      var roleDefBindingCollRestrictedRead =\r\n        SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n      roleDefBindingCollRestrictedRead.add(\r\n        currCtx2.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n      );\r\n\r\n      oRequest.item\r\n        .get_roleAssignments()\r\n        .add(actionOfficeGroup, roleDefBindingCollRestrictedRead);\r\n\r\n      function onGrantAOSpecialPermsSucceeded() {\r\n        m_countAOSPAdded++;\r\n\r\n        $(\"#divGrantCntr\").text(\r\n          \"Ensured \" +\r\n            m_countAOSPAdded +\r\n            \" of \" +\r\n            m_countAOSPToAdd +\r\n            \" Action Offices have permissions to Request\"\r\n        );\r\n        if (m_countAOSPAdded == m_countAOSPToAdd) {\r\n          if (this.OnComplete) this.OnComplete(true);\r\n        }\r\n      }\r\n      function onGrantAOSpecialPermsFailed(sender, args) {\r\n        m_countAOSPAdded++;\r\n\r\n        $(\"#divGrantCntr\").text(\r\n          \"Ensured \" +\r\n            m_countAOSPAdded +\r\n            \" of \" +\r\n            m_countAOSPToAdd +\r\n            \" Action Offices have permissions to Request\"\r\n        );\r\n        if (m_countAOSPAdded == m_countAOSPToAdd) {\r\n          if (this.OnComplete) this.OnComplete(true);\r\n        }\r\n      }\r\n\r\n      var data = { OnComplete: OnComplete };\r\n      currCtx2.executeQueryAsync(\r\n        Function.createDelegate(data, onGrantAOSpecialPermsSucceeded),\r\n        Function.createDelegate(data, onGrantAOSpecialPermsFailed)\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction m_fnGrantSpecialPermsOnCS(\r\n  oRequest,\r\n  currCtx,\r\n  addSpecialPerms,\r\n  OnComplete\r\n) {\r\n  m_countCSToAdd = 0;\r\n  m_countCSAdded = 0;\r\n\r\n  if (\r\n    oRequest == null ||\r\n    oRequest.coversheets == null ||\r\n    oRequest.coversheets.length == 0\r\n  ) {\r\n    if (OnComplete) OnComplete(true);\r\n    return;\r\n  }\r\n\r\n  oCntCSAOAdd = new Object();\r\n\r\n  //Update coversheets to give special permissions access\r\n  for (var x = 0; x < oRequest.coversheets.length; x++) {\r\n    var coversheetItem = oRequest.coversheets[x].item;\r\n    if (coversheetItem) {\r\n      m_countCSToAdd++;\r\n\r\n      var bDoneBreakingCSPermsOnSpecialPerms = false;\r\n      m_fnBreakCoversheetPermissionsOnSpecialPerms(\r\n        currCtx,\r\n        coversheetItem,\r\n        addSpecialPerms,\r\n        false,\r\n        function (bDoneBreakingCSPermsOnSpecialPerms) {\r\n          if (bDoneBreakingCSPermsOnSpecialPerms) {\r\n            m_countCSAdded++;\r\n            $(\"#divGrantCntr\").text(\r\n              \"Updated \" +\r\n                m_countCSAdded +\r\n                \" of \" +\r\n                m_countCSToAdd +\r\n                \" Coversheet permissions\"\r\n            );\r\n          } else {\r\n            m_countCSAdded++; //log here, but continue executing\r\n            $(\"#divGrantCntr\").text(\r\n              \"Updated \" +\r\n                m_countCSAdded +\r\n                \" of \" +\r\n                m_countCSToAdd +\r\n                \" Coversheet permissions\"\r\n            );\r\n          }\r\n\r\n          if (m_countCSAdded == m_countCSToAdd) {\r\n            if (OnComplete) OnComplete(true);\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nvar m_countSPResFolderToAdd = 0;\r\nvar m_countSPResFolderAdded = 0;\r\nasync function m_fnGrantSpecialPermsOnResponseAndFolder(\r\n  oRequest,\r\n  addSpecialPerms,\r\n  OnComplete\r\n) {\r\n  if (\r\n    oRequest == null ||\r\n    oRequest.responses == null ||\r\n    oRequest.responses.length == 0\r\n  ) {\r\n    if (OnComplete) OnComplete(true);\r\n\r\n    return;\r\n  }\r\n\r\n  for (var y = 0; y < oRequest.responses.length; y++) {\r\n    var oResponse = oRequest.responses[y];\r\n    if (\r\n      oResponse.resStatus == \"4-Approved for QA\" ||\r\n      oResponse.resStatus == \"6-Reposted After Rejection\" ||\r\n      oResponse.resStatus == \"7-Closed\"\r\n    ) {\r\n      m_countSPResFolderToAdd++;\r\n\r\n      var bBrokeResponseAndFolderPermissions = false;\r\n\r\n      var bForceAdd = false;\r\n      var bForceRemove = false;\r\n      if (addSpecialPerms) bForceAdd = true;\r\n      else bForceRemove = true;\r\n\r\n      await m_fnBreakResponseAndFolderPermissions(\r\n        oRequest.status,\r\n        oResponse,\r\n        false,\r\n        true,\r\n        bForceAdd,\r\n        bForceRemove\r\n      );\r\n\r\n      m_countSPResFolderAdded++; //log here, but continue executing\r\n\r\n      $(\"#divGrantCntr\").text(\r\n        \"Updated \" +\r\n          m_countSPResFolderAdded +\r\n          \" of \" +\r\n          m_countSPResFolderToAdd +\r\n          \" Response permissions\"\r\n      );\r\n\r\n      if (m_countSPResFolderAdded == m_countSPResFolderToAdd) {\r\n        if (OnComplete) OnComplete(true);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction m_fnGrantSpecialPermissions(requestNumber) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  //this can be stale...\r\n  var oRequest = m_fnGetRequestByNumber(requestNumber);\r\n  if (oRequest == null) return;\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var cntGranted = 0;\r\n  var cntToGrant = 0;\r\n  var responseCount = oRequest.responses.length;\r\n  for (var y = 0; y < responseCount; y++) {\r\n    var oResponse = oRequest.responses[y];\r\n\r\n    if (\r\n      oResponse.resStatus == \"4-Approved for QA\" ||\r\n      oResponse.resStatus == \"6-Reposted After Rejection\" ||\r\n      oResponse.resStatus == \"7-Closed\"\r\n    ) {\r\n      cntToGrant++;\r\n    }\r\n  }\r\n\r\n  if (\r\n    confirm(\r\n      \"Are you sure you would like to grant special permissions on this Request and to (\" +\r\n        cntToGrant +\r\n        \") Responses?\"\r\n    )\r\n  ) {\r\n    const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n      \"Information\",\r\n      \"Please wait... granting Special Permissions to Request and Responses <div id='divGrantCntr'></div>\",\r\n      200,\r\n      600\r\n    );\r\n\r\n    var group1SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n    );\r\n    var group2SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n    );\r\n\r\n    var currCtx = SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    const currentUser = web.get_currentUser();\r\n    const ownerGroup = web.get_associatedOwnerGroup();\r\n    const memberGroup = web.get_associatedMemberGroup();\r\n    const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n    var qaHasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n      oRequest.item,\r\n      Audit.Common.Utilities.GetGroupNameQA(),\r\n      SP.PermissionKind.viewListItems\r\n    );\r\n\r\n    ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    //Update permissions to Request. everyone should get restricted read except for the associated member groups\r\n    oRequest.item.resetRoleInheritance();\r\n    oRequest.item.breakRoleInheritance(false, false);\r\n\r\n    var roleDefBindingCollAdmin =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollAdmin.add(\r\n      currCtx\r\n        .get_web()\r\n        .get_roleDefinitions()\r\n        .getByType(SP.RoleType.administrator)\r\n    );\r\n\r\n    var roleDefBindingCollContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollContribute.add(\r\n      currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedRead =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedRead.add(\r\n      currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedContribute.add(\r\n      currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n    );\r\n\r\n    //add associated site groups to request\r\n    oRequest.item\r\n      .get_roleAssignments()\r\n      .add(ownerGroup, roleDefBindingCollAdmin);\r\n    oRequest.item\r\n      .get_roleAssignments()\r\n      .add(memberGroup, roleDefBindingCollContribute);\r\n    oRequest.item\r\n      .get_roleAssignments()\r\n      .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n    //add special permissions to request\r\n    if (group1SpecialPerm != null)\r\n      oRequest.item\r\n        .get_roleAssignments()\r\n        .add(group1SpecialPerm, roleDefBindingCollRestrictedRead);\r\n    if (group2SpecialPerm != null)\r\n      oRequest.item\r\n        .get_roleAssignments()\r\n        .add(group2SpecialPerm, roleDefBindingCollRestrictedRead);\r\n\r\n    //make sure qa gets read on request if it previously had access\r\n    if (qaHasRead) {\r\n      var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n        Audit.Common.Utilities.GetGroupNameQA()\r\n      );\r\n      if (spGroupQA != null)\r\n        oRequest.item\r\n          .get_roleAssignments()\r\n          .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n    }\r\n\r\n    oRequest.item\r\n      .get_roleAssignments()\r\n      .getByPrincipal(currentUser)\r\n      .deleteObject();\r\n\r\n    //on success, the request permissions will be updated, but now we have to update the ao permissions on the request one by one\r\n    //do this to avoid resource exceeded error\r\n    function onUpdated1() {\r\n      var bDoneGrantingAOSpecialPerms = false;\r\n      m_fnGrantAOSpecialPermsOnRequest(\r\n        oRequest,\r\n        function (bDoneGrantingAOSpecialPerms) {\r\n          if (bDoneGrantingAOSpecialPerms) {\r\n            var bDoneGrantingCSSpecialPerms = false;\r\n            m_fnGrantSpecialPermsOnCS(\r\n              oRequest,\r\n              currCtx,\r\n              true,\r\n              function (bDoneGrantingCSSpecialPerms) {\r\n                if (bDoneGrantingCSSpecialPerms) {\r\n                  var responseCount = oRequest.responses.length;\r\n\r\n                  if (responseCount == 0 || cntToGrant == 0) {\r\n                    currCtx.executeQueryAsync(\r\n                      function () {\r\n                        document.body.style.cursor = \"default\";\r\n\r\n                        notifyId = SP.UI.Notify.addNotification(\r\n                          \"Completed granting Special Permissions\",\r\n                          false\r\n                        );\r\n                        setTimeout(function () {\r\n                          m_waitDialog.close();\r\n                          m_fnRefreshData();\r\n                        }, 200);\r\n                      },\r\n                      function (sender, args) {\r\n                        document.body.style.cursor = \"default\";\r\n\r\n                        notifyId = SP.UI.Notify.addNotification(\r\n                          \"Request failed1: \" +\r\n                            args.get_message() +\r\n                            \"\\n\" +\r\n                            args.get_stackTrace(),\r\n                          false\r\n                        );\r\n                        setTimeout(function () {\r\n                          m_fnRefresh();\r\n                        }, 200);\r\n                      }\r\n                    );\r\n                    return;\r\n                  } else {\r\n                    //Update permissions responses - everyone should get restricted read, except for the associated member groups. action offices get contribute if open or returned to action office\r\n                    var bDoneGrantingSpecialPermsOnResponsesAndFolders = false;\r\n                    m_fnGrantSpecialPermsOnResponseAndFolder(\r\n                      oRequest,\r\n                      true,\r\n                      function (\r\n                        bDoneGrantingSpecialPermsOnResponsesAndFolders\r\n                      ) {\r\n                        if (bDoneGrantingSpecialPermsOnResponsesAndFolders) {\r\n                          document.body.style.cursor = \"default\";\r\n\r\n                          notifyId = SP.UI.Notify.addNotification(\r\n                            \"Completed granting Special Permissions\",\r\n                            false\r\n                          );\r\n                          setTimeout(function () {\r\n                            m_waitDialog();\r\n                            m_fnRefreshData();\r\n                          }, 200);\r\n                        } else {\r\n                          document.body.style.cursor = \"default\";\r\n\r\n                          notifyId = SP.UI.Notify.addNotification(\r\n                            \"Unable to update all responses and folders\",\r\n                            false\r\n                          );\r\n                          setTimeout(function () {\r\n                            m_fnRefresh();\r\n                          }, 200);\r\n                        }\r\n                      }\r\n                    );\r\n                  }\r\n                }\r\n              }\r\n            );\r\n          }\r\n        }\r\n      );\r\n    }\r\n    function onFailed1(sender, args) {}\r\n\r\n    var data = { oRequest: oRequest };\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onUpdated1),\r\n      Function.createDelegate(data, onFailed1)\r\n    );\r\n  } else m_bIsTransactionExecuting = false;\r\n}\r\n\r\nfunction m_fnRemoveSpecialPermissions(id) {\r\n  if (!m_bIsSiteOwner) {\r\n    SP.UI.Notify.addNotification(\r\n      \"You do not have access to perform this action...\",\r\n      false\r\n    );\r\n    return;\r\n  }\r\n\r\n  //this can be stale...\r\n  var oRequest = m_fnGetRequestByNumber(id);\r\n  if (oRequest == null) return;\r\n\r\n  m_bIsTransactionExecuting = true;\r\n\r\n  var cntRemoved = 0;\r\n  var cntToRemove = 0;\r\n  var responseCount = oRequest.responses.length;\r\n  for (var y = 0; y < responseCount; y++) {\r\n    var oResponse = oRequest.responses[y];\r\n\r\n    if (\r\n      oResponse.resStatus == \"4-Approved for QA\" ||\r\n      oResponse.resStatus == \"6-Reposted After Rejection\" ||\r\n      oResponse.resStatus == \"7-Closed\"\r\n    ) {\r\n      cntToRemove++;\r\n    }\r\n  }\r\n\r\n  if (\r\n    confirm(\r\n      \"Are you sure you would like to remove special permissions on this Request and on (\" +\r\n        cntToRemove +\r\n        \") Responses?\"\r\n    )\r\n  ) {\r\n    const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n      \"Information\",\r\n      \"Please wait... removing Special Permissions on Request and Responses <div id='divGrantCntr'></div>\",\r\n      200,\r\n      600\r\n    );\r\n\r\n    var currCtx = SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    const currentUser = web.get_currentUser();\r\n    const ownerGroup = web.get_associatedOwnerGroup();\r\n    const memberGroup = web.get_associatedMemberGroup();\r\n    const visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n    var qaHasRead = Audit.Common.Utilities.CheckSPItemHasGroupPermission(\r\n      oRequest.item,\r\n      Audit.Common.Utilities.GetGroupNameQA(),\r\n      SP.PermissionKind.viewListItems\r\n    );\r\n\r\n    var group1SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n    );\r\n    var group2SpecialPerm = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n    );\r\n\r\n    oRequest.item.resetRoleInheritance();\r\n    oRequest.item.breakRoleInheritance(false, false);\r\n\r\n    var roleDefBindingCollAdmin =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollAdmin.add(\r\n      currCtx\r\n        .get_web()\r\n        .get_roleDefinitions()\r\n        .getByType(SP.RoleType.administrator)\r\n    );\r\n\r\n    var roleDefBindingCollContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollContribute.add(\r\n      currCtx.get_web().get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedRead =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedRead.add(\r\n      currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedContribute.add(\r\n      currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n    );\r\n\r\n    //add site groups\r\n    oRequest.item\r\n      .get_roleAssignments()\r\n      .add(ownerGroup, roleDefBindingCollAdmin);\r\n    oRequest.item\r\n      .get_roleAssignments()\r\n      .add(memberGroup, roleDefBindingCollContribute);\r\n    oRequest.item\r\n      .get_roleAssignments()\r\n      .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n    if (qaHasRead) {\r\n      //make sure qa gets read if it had access\r\n      var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n        Audit.Common.Utilities.GetGroupNameQA()\r\n      );\r\n      if (spGroupQA != null)\r\n        oRequest.item\r\n          .get_roleAssignments()\r\n          .add(spGroupQA, roleDefBindingCollRestrictedRead);\r\n    }\r\n    oRequest.item\r\n      .get_roleAssignments()\r\n      .getByPrincipal(currentUser)\r\n      .deleteObject();\r\n\r\n    //on success, the request permissions will be updated, but now we have to update the ao permissions on the request one by one\r\n    //do this to avoid resource exceeded error\r\n    function onUpdated1() {\r\n      var bDoneGrantingAOSpecialPerms = false;\r\n      m_fnGrantAOSpecialPermsOnRequest(\r\n        oRequest,\r\n        function (bDoneGrantingAOSpecialPerms) {\r\n          if (bDoneGrantingAOSpecialPerms) {\r\n            var bDoneGrantingCSSpecialPerms = false;\r\n            m_fnGrantSpecialPermsOnCS(\r\n              oRequest,\r\n              currCtx,\r\n              false,\r\n              function (bDoneGrantingCSSpecialPerms) {\r\n                if (bDoneGrantingCSSpecialPerms) {\r\n                  var responseCount = oRequest.responses.length;\r\n\r\n                  if (responseCount == 0 || cntToRemove == 0) {\r\n                    currCtx.executeQueryAsync(\r\n                      function () {\r\n                        document.body.style.cursor = \"default\";\r\n\r\n                        notifyId = SP.UI.Notify.addNotification(\r\n                          \"Completed removing Special Permissions\",\r\n                          false\r\n                        );\r\n                        setTimeout(function () {\r\n                          m_fnRefresh();\r\n                        }, 200);\r\n                      },\r\n                      function (sender, args) {\r\n                        document.body.style.cursor = \"default\";\r\n\r\n                        notifyId = SP.UI.Notify.addNotification(\r\n                          \"Request failed1: \" +\r\n                            args.get_message() +\r\n                            \"\\n\" +\r\n                            args.get_stackTrace(),\r\n                          false\r\n                        );\r\n                        setTimeout(function () {\r\n                          m_fnRefresh();\r\n                        }, 200);\r\n                      }\r\n                    );\r\n                    return;\r\n                  } else {\r\n                    //Update permissions responses - everyone should get restricted read, except for the associated member groups. action offices get contribute if open or returned to action office\r\n                    var bDoneGrantingSpecialPermsOnResponsesAndFolders = false;\r\n                    m_fnGrantSpecialPermsOnResponseAndFolder(\r\n                      oRequest,\r\n                      false,\r\n                      function (\r\n                        bDoneGrantingSpecialPermsOnResponsesAndFolders\r\n                      ) {\r\n                        if (bDoneGrantingSpecialPermsOnResponsesAndFolders) {\r\n                          document.body.style.cursor = \"default\";\r\n\r\n                          notifyId = SP.UI.Notify.addNotification(\r\n                            \"Completed removing Special Permissions\",\r\n                            false\r\n                          );\r\n                          setTimeout(function () {\r\n                            m_fnRefresh();\r\n                          }, 200);\r\n                        } else {\r\n                          document.body.style.cursor = \"default\";\r\n\r\n                          notifyId = SP.UI.Notify.addNotification(\r\n                            \"Unable to update all responses and folders\",\r\n                            false\r\n                          );\r\n                          setTimeout(function () {\r\n                            m_fnRefresh();\r\n                          }, 200);\r\n                        }\r\n                      }\r\n                    );\r\n                  }\r\n                }\r\n              }\r\n            );\r\n          }\r\n        }\r\n      );\r\n    }\r\n    function onFailed1(sender, args) {}\r\n\r\n    var data = { oRequest: oRequest };\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onUpdated1),\r\n      Function.createDelegate(data, onFailed1)\r\n    );\r\n  } else m_bIsTransactionExecuting = false;\r\n}\r\n\r\nfunction GetSourceUrlForForms() {\r\n  var curPath = location.pathname + \"?\";\r\n\r\n  // var tabIndex = _myViewModel.tabs.selectedTab()?.id;\r\n\r\n  // curPath += \"?Tab=\" + tabIndex;\r\n\r\n  var requestNum = $(\"#ddlReqNum\").val();\r\n  if (requestNum != \"\") curPath += \"%26ReqNum=\" + requestNum;\r\n\r\n  var source = \"&Source=\" + curPath;\r\n  return source;\r\n}\r\n\r\nfunction OnCallbackForm(result, value) {\r\n  if (result === SP.UI.DialogResult.OK) {\r\n    //alert( value );\r\n    m_fnRefreshData();\r\n  } else m_bIsTransactionExecuting = false;\r\n}\r\n\r\nfunction OnCallbackFormReload(result, value) {\r\n  if (result === SP.UI.DialogResult.OK) {\r\n    //alert( value );\r\n    m_fnRefresh();\r\n  } else m_bIsTransactionExecuting = false;\r\n}\r\n\r\nfunction OnCallbackFormNewRequest(result, value) {\r\n  if (result !== SP.UI.DialogResult.OK) return;\r\n  const newRequestTask = addTask(taskDefs.newRequest);\r\n\r\n  // const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n  //   \"Information\",\r\n  //   \"Please wait... Updating Request Permissions\",\r\n  //   200,\r\n  //   400\r\n  // );\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var requestList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequests());\r\n  var requestQuery = new SP.CamlQuery();\r\n  requestQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"ID\" Ascending=\"FALSE\"/></OrderBy></Query><RowLimit>1</RowLimit></View>'\r\n  );\r\n  const requestItems = requestList.getItems(requestQuery);\r\n  //request status has internal name as response status in the request list\r\n  currCtx.load(\r\n    requestItems,\r\n    \"Include(ID, Title, ReqType, ActionOffice, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n  );\r\n\r\n  const emailList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n  var emailListQuery = new SP.CamlQuery();\r\n  emailListQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"ID\"/></OrderBy><Where><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">1</Value></Eq></Where></Query></View>'\r\n  );\r\n  const emailListFolderItems = emailList.getItems(emailListQuery);\r\n  currCtx.load(emailListFolderItems, \"Include(ID, Title, DisplayName)\");\r\n\r\n  currCtx.executeQueryAsync(\r\n    async function () {\r\n      var oListItem = null;\r\n\r\n      var listItemEnumerator = requestItems.getEnumerator();\r\n      while (listItemEnumerator.moveNext()) {\r\n        oListItem = listItemEnumerator.get_current();\r\n        break;\r\n      }\r\n\r\n      if (oListItem) {\r\n        m_fnCreateRequestInternalItem(oListItem.get_item(\"ID\"));\r\n\r\n        if (!oListItem.get_hasUniqueRoleAssignments()) {\r\n          var bDoneBreakingReqPermisions = false;\r\n          await m_fnBreakRequestPermissions(oListItem, false, null);\r\n          var bDoneCreatingEmailFolder = false;\r\n          Audit.Common.Utilities.CreateEmailFolder(\r\n            emailList,\r\n            oListItem.get_item(\"Title\"),\r\n            oListItem,\r\n            function (bDoneCreatingEmailFolder) {\r\n              _myViewModel.tabs.selectTab(_myViewModel.tabOpts.RequestDetail);\r\n              finishTask(newRequestTask);\r\n              m_fnRefreshData(oListItem.get_item(\"ID\"));\r\n            }\r\n          );\r\n        } else {\r\n          var bDoneCreatingEmailFolder = false;\r\n          Audit.Common.Utilities.CreateEmailFolder(\r\n            emailList,\r\n            oListItem.get_item(\"Title\"),\r\n            oListItem,\r\n            function (bDoneCreatingEmailFolder) {\r\n              _myViewModel.tabs.selectTab(_myViewModel.tabOpts.RequestDetail);\r\n              finishTask(newRequestTask);\r\n              m_fnRefreshData(oListItem.get_item(\"ID\"));\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n    function (sender, args) {\r\n      //alert( \"Request failed: \"  + args.get_message() + \"\\n\" + args.get_stackTrace() );\r\n      m_fnRefresh();\r\n    }\r\n  );\r\n}\r\n\r\nfunction m_fnCreateRequestInternalItem(requestNumber) {\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var requestInternalList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequestsInternal());\r\n\r\n  var itemCreateInfo = new SP.ListItemCreationInformation();\r\n  var newRequestInternalItem = requestInternalList.addItem(itemCreateInfo);\r\n  newRequestInternalItem.set_item(\"ReqNum\", requestNumber);\r\n  newRequestInternalItem.update();\r\n\r\n  currCtx.executeQueryAsync(\r\n    function () {},\r\n    function (sender, args) {\r\n      alert(\"error creating internal request item\");\r\n      console.error(sender, args);\r\n    }\r\n  );\r\n}\r\n\r\nasync function m_fnUpdateAllResponsePermissions(\r\n  requestStatus,\r\n  requestNum,\r\n  bCheckStatus,\r\n  OnCompleteUpdateResponsePerms\r\n) {\r\n  var cntResponsesBroken = 0;\r\n\r\n  var oRequestBigMap = m_bigMap[\"request-\" + requestNum];\r\n  if (!oRequestBigMap) return;\r\n  var cntResponsesToBreak = oRequestBigMap.responses.length;\r\n\r\n  for (const response of oRequestBigMap.responses) {\r\n    await m_fnBreakResponseAndFolderPermissions(\r\n      requestStatus,\r\n      response,\r\n      false,\r\n      bCheckStatus,\r\n      false,\r\n      false\r\n    );\r\n    cntResponsesBroken++;\r\n    // document.getElementById(\"divMsgEditRequest\").innerText =\r\n    //   \"Updated \" +\r\n    //   cntResponsesBroken +\r\n    //   \" of \" +\r\n    //   cntResponsesToBreak +\r\n    //   \" Response permissions\";\r\n  }\r\n}\r\n\r\n//reset permissions on EA folder here\r\n//rename all ea items\r\n//rename all response docs\r\n//rename all ea folders\r\n//rename all ea docs\r\n\r\n/*var folderPath = Audit.Common.Utilities.GetSiteUrl() + \"/\" + Audit.Common.Utilities.GetLibNameResponseDocs() + \"/\" + m_responseTitle;\r\nvar responseDocQuery2 = new SP.CamlQuery();\r\nresponseDocQuery2.set_viewXml('<View Scope=\"RecursiveAll\"><Query><Where><And><Eq><FieldRef Name=\\'FileDirRef\\'/><Value Type=\\'Text\\'>' + folderPath + '</Value></Eq><Eq><FieldRef Name=\\'DocumentStatus\\'/><Value Type=\\'Text\\'>Submitted</Value></Eq></And></Where></Query></View>');\r\nresponseDocSubmittedItems = responseDocLib.getItems( responseDocQuery2 );\r\ncurrCtx.load(responseDocSubmittedItems, \"Include(ID, DocumentStatus, FileDirRef)\");\r\n*/\r\n\r\nfunction m_fnRenameResponses(oRequest, oldRrequestNumber, newRequestNumber) {\r\n  for (var x = 0; x < oRequest.responses.length; x++) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var title = oRequest.responses[x].title;\r\n    var newTitle = title.replace(oldRrequestNumber, newRequestNumber);\r\n    oRequest.responses[x].item.set_item(\"Title\", newTitle);\r\n    oRequest.responses[x].item.update();\r\n\r\n    currCtx.executeQueryAsync(\r\n      function () {},\r\n      function (sender, args) {}\r\n    );\r\n  }\r\n}\r\n\r\nfunction m_fnRenameResponseFolders(\r\n  responseDocsFoldersItems,\r\n  oldRrequestNumber,\r\n  newRequestNumber\r\n) {\r\n  var listItemEnumerator = responseDocsFoldersItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var oListItemResponseDocFolder = listItemEnumerator.get_current();\r\n\r\n    var itemName = oListItemResponseDocFolder.get_displayName();\r\n\r\n    var test = itemName.replace(oldRrequestNumber, \"\"); //cant do an index test because there could be hyphens in the request number\r\n    if (test.charAt(0) == \"-\") {\r\n      var newTitle = itemName.replace(oldRrequestNumber, newRequestNumber);\r\n      oListItemResponseDocFolder.set_item(\"FileLeafRef\", newTitle);\r\n      oListItemResponseDocFolder.set_item(\"Title\", newTitle);\r\n      oListItemResponseDocFolder.update();\r\n\r\n      currCtx.executeQueryAsync(\r\n        function () {},\r\n        function (sender, args) {}\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction m_fnRenameEmailFolder(\r\n  emailListFolderItems,\r\n  oldRrequestNumber,\r\n  newRequestNumber\r\n) {\r\n  //rename the EMail Folder\r\n  var listItemEnumerator = emailListFolderItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var oListItemEmailFolder = listItemEnumerator.get_current();\r\n\r\n    var itemName = oListItemEmailFolder.get_displayName();\r\n    if (oldRrequestNumber == itemName) {\r\n      var newTitle = itemName.replace(oldRrequestNumber, newRequestNumber);\r\n      oListItemEmailFolder.set_item(\"FileLeafRef\", newTitle);\r\n      oListItemEmailFolder.set_item(\"Title\", newTitle);\r\n      oListItemEmailFolder.update();\r\n\r\n      currCtx.executeQueryAsync(\r\n        function () {},\r\n        function (sender, args) {}\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n//rename the External Auditor response folder\r\nfunction m_fnRenameEAFolder(\r\n  eaListFolderItems,\r\n  oldRrequestNumber,\r\n  newRequestNumber\r\n) {\r\n  //rename the EA folder\r\n  var listItemEnumerator = eaListFolderItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var oListItemEAFolder = listItemEnumerator.get_current();\r\n\r\n    var itemName = oListItemEAFolder.get_displayName();\r\n    if (oldRrequestNumber == itemName) {\r\n      var newTitle = itemName.replace(oldRrequestNumber, newRequestNumber);\r\n      oListItemEAFolder.set_item(\"FileLeafRef\", newTitle);\r\n      oListItemEAFolder.set_item(\"Title\", newTitle);\r\n      oListItemEAFolder.update();\r\n\r\n      currCtx.executeQueryAsync(\r\n        function () {},\r\n        function (sender, args) {}\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nasync function OnCallbackFormEditRequest(result, value) {\r\n  if (result !== SP.UI.DialogResult.OK) {\r\n    m_bIsTransactionExecuting = false;\r\n    return;\r\n  }\r\n  m_bIsTransactionExecuting = true;\r\n  const oRequest = _myViewModel.currentRequest();\r\n\r\n  const notifyId = SP.UI.Notify.addNotification(\"Please wait...\", false);\r\n  document.body.style.cursor = \"wait\";\r\n\r\n  //alert( \"must grant the new updated action offices permissions to this request\");\r\n\r\n  var currCtx = new SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n\r\n  var requestList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleRequests());\r\n  var requestQuery = new SP.CamlQuery();\r\n  requestQuery.set_viewXml(\r\n    '<View><Query><Where><Eq><FieldRef Name=\"ID\"/><Value Type=\"Text\">' +\r\n      m_itemID +\r\n      \"</Value></Eq></Where></Query></View>\"\r\n  );\r\n  const requestItems = requestList.getItems(requestQuery);\r\n  //request status has internal name as response status in the request list\r\n  currCtx.load(\r\n    requestItems,\r\n    \"Include(ID, Title, ReqType, ActionOffice, ReqStatus, Sensitivity, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n  );\r\n\r\n  var responseDocsLibFolderslist = currCtx\r\n    .get_web()\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n  var responseDocsLibFolderslistQuery = new SP.CamlQuery();\r\n  //include the dash\r\n  responseDocsLibFolderslistQuery.set_viewXml(\r\n    '<View><Query><Where><And><BeginsWith><FieldRef Name=\"Title\"/><Value Type=\"Text\">' +\r\n      oRequest.number +\r\n      '-</Value></BeginsWith><Eq><FieldRef Name=\"ContentType\" /><Value Type=\"Text\">Folder</Value></Eq></And></Where></Query></View>'\r\n  );\r\n  const m_ResponseDocsFoldersItems = responseDocsLibFolderslist.getItems(\r\n    responseDocsLibFolderslistQuery\r\n  );\r\n  if (m_bIsSiteOwner)\r\n    currCtx.load(\r\n      m_ResponseDocsFoldersItems,\r\n      \"Include( DisplayName, Title, Id, EncodedAbsUrl, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n  else\r\n    currCtx.load(\r\n      m_ResponseDocsFoldersItems,\r\n      \"Include( DisplayName, Title, Id, EncodedAbsUrl)\"\r\n    );\r\n\r\n  var emailList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n  var emailListQuery = new SP.CamlQuery();\r\n  emailListQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"ID\"/></OrderBy><Where><And>' +\r\n      '<Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">1</Value></Eq>' +\r\n      '<Eq><FieldRef Name=\"Title\"/><Value Type=\"Text\">' +\r\n      oRequest.number +\r\n      \"</Value></Eq>\" +\r\n      \"</And></Where></Query></View>\"\r\n  );\r\n  const emailListFolderItems = emailList.getItems(emailListQuery);\r\n  currCtx.load(emailListFolderItems, \"Include(ID, Title, DisplayName)\");\r\n\r\n  var eaList = web\r\n    .get_lists()\r\n    .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocsEA());\r\n  var eaListQuery = new SP.CamlQuery();\r\n  eaListQuery.set_viewXml(\r\n    '<View><Query><OrderBy><FieldRef Name=\"ID\"/></OrderBy><Where><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">1</Value></Eq></Where></Query></View>'\r\n  );\r\n  const eaListFolderItems = eaList.getItems(eaListQuery);\r\n  currCtx.load(eaListFolderItems, \"Include(ID, Title, DisplayName)\");\r\n\r\n  await new Promise((resolve, reject) => {\r\n    currCtx.executeQueryAsync(resolve, reject);\r\n  }).catch((e) => {\r\n    m_fnRefresh();\r\n    return;\r\n  });\r\n\r\n  const requestItemId = m_itemID;\r\n\r\n  var listItemEnumerator = requestItems.getEnumerator();\r\n  while (listItemEnumerator.moveNext()) {\r\n    //reset action offices if they were changes in the request form\r\n    var oListItem = listItemEnumerator.get_current();\r\n\r\n    var curSensitivity = oListItem.get_item(\"Sensitivity\");\r\n    var bChangeSensitivity = false;\r\n    if (m_bigMap[\"request-\" + m_requestNum].sensitivity != curSensitivity) {\r\n      bChangeSensitivity = true;\r\n    }\r\n\r\n    if (m_requestNum == oListItem.get_item(\"Title\")) {\r\n      //if request number hasn't changed\r\n      // const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n      //   \"Information\",\r\n      //   \"Please wait... Updating Request and Response permissions <div id='divMsgEditRequest'></div>\",\r\n      //   200,\r\n      //   400\r\n      // );\r\n\r\n      var bDoneBreakingReqPermisions = false;\r\n      await m_fnBreakRequestPermissions(oListItem, false, null);\r\n\r\n      //should always be true even if an error occurred\r\n      // $(\"#divMsgEditRequest\").text(\"Updated Request permissions\");\r\n\r\n      var doneUpdatingResponses = false;\r\n      await m_fnUpdateAllResponsePermissions(\r\n        oListItem.get_item(\"ReqStatus\"),\r\n        m_requestNum,\r\n        true\r\n      );\r\n\r\n      if (bChangeSensitivity) {\r\n        // $(\"#divMsgEditRequest\").text(\"Updating Response document names\");\r\n        var oldSensitivity = m_bigMap[\"request-\" + m_requestNum].sensitivity;\r\n        const doneUpdatingSensitivity = await m_fnUpdateSensitivityOnRequest(\r\n          m_requestNum,\r\n          curSensitivity,\r\n          oldSensitivity\r\n        );\r\n      }\r\n\r\n      var listItemEnumerator1 = emailListFolderItems.getEnumerator();\r\n      while (listItemEnumerator1.moveNext()) {\r\n        //reset action offices if they were changes in the request form\r\n        var oEmailFolderItem = listItemEnumerator1.get_current();\r\n\r\n        if (oEmailFolderItem.get_displayName() == m_requestNum) {\r\n          await m_fnBreakEmailFolderPermissions(\r\n            oEmailFolderItem,\r\n            oListItem,\r\n            false\r\n          );\r\n          break;\r\n        }\r\n      }\r\n      // m_waitDialog.close();\r\n    } //if request number changed, update responses; otherwise it will refresh and not hit this\r\n    else {\r\n      const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n        \"Renaming Responses\",\r\n        \"Please wait... Renaming Responses\",\r\n        200,\r\n        400\r\n      );\r\n\r\n      var bDoneBreakingReqPermisions = false;\r\n      await m_fnBreakRequestPermissions(oListItem, false, null);\r\n\r\n      //should always be true even if an error occurred\r\n      var oRequest2 = m_fnGetRequestByNumber(m_requestNum);\r\n\r\n      var newRequestNumber = oListItem.get_item(\"Title\");\r\n      //TODO: break these up - may cause errors\r\n      m_fnRenameResponses(oRequest2, m_requestNum, newRequestNumber);\r\n      m_fnRenameResponseFolders(\r\n        m_ResponseDocsFoldersItems,\r\n        m_requestNum,\r\n        newRequestNumber\r\n      );\r\n      m_fnRenameEmailFolder(\r\n        emailListFolderItems,\r\n        m_requestNum,\r\n        newRequestNumber\r\n      );\r\n      m_fnRenameEAFolder(eaListFolderItems, m_requestNum, newRequestNumber);\r\n\r\n      setTimeout(function () {\r\n        m_fnRefresh(newRequestNumber);\r\n      }, 20000);\r\n    }\r\n  }\r\n\r\n  m_fnRefreshData();\r\n}\r\n\r\nfunction OnCallbackFormCoverSheet(result, value) {\r\n  if (result === SP.UI.DialogResult.OK) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var coversheetList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetLibTitleCoverSheets());\r\n    var coversheetQuery = new SP.CamlQuery();\r\n    coversheetQuery.set_viewXml(\r\n      '<View><Query><OrderBy><FieldRef Name=\"Modified\" Ascending=\"FALSE\"/></OrderBy></Query><RowLimit>1</RowLimit></View>'\r\n    );\r\n    const coversheetItems = coversheetList.getItems(coversheetQuery);\r\n    currCtx.load(\r\n      coversheetItems,\r\n      \"Include(ID, Title, ActionOffice, FileLeafRef, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n\r\n    var requestSensitivity = m_bigMap[\"request-\" + m_requestNum].sensitivity;\r\n\r\n    currCtx.executeQueryAsync(\r\n      async function () {\r\n        var listItemEnumerator = coversheetItems.getEnumerator();\r\n        var oListItem = null;\r\n        while (listItemEnumerator.moveNext()) {\r\n          oListItem = listItemEnumerator.get_current();\r\n          break;\r\n        }\r\n\r\n        if (oListItem) {\r\n          const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n            \"Information\",\r\n            \"Please wait... Updating permissions on Coversheet\",\r\n            200,\r\n            600\r\n          );\r\n\r\n          await m_fnBreakCoversheetPermissions(oListItem, false);\r\n          if (requestSensitivity && requestSensitivity != \"None\") {\r\n            var doneBreakingCS = false;\r\n            await m_fnBreakCoversheetPermissions(oListItem, false);\r\n\r\n            var newFileName = m_fnGetNewFileNameForSensitivity(\r\n              oListItem,\r\n              null,\r\n              requestSensitivity\r\n            );\r\n            if (newFileName != \"\") {\r\n              oListItem.set_item(\"FileLeafRef\", newFileName);\r\n              oListItem.update();\r\n            }\r\n\r\n            var data = { newFileName: newFileName };\r\n            await new Promise((resolve, reject) => {\r\n              currCtx.executeQueryAsync(resolve, reject);\r\n            }).catch((e) => {\r\n              alert(\"Error updating coversheet name with sensitivity\");\r\n              m_fnRefresh();\r\n              return;\r\n            });\r\n          }\r\n          m_waitDialog.close();\r\n          m_fnRefreshData();\r\n        }\r\n      },\r\n      function (sender, args) {\r\n        //alert( \"Request failed: \"  + args.get_message() + \"\\n\" + args.get_stackTrace() );\r\n        m_fnRefresh();\r\n      }\r\n    );\r\n  } else m_bIsTransactionExecuting = false;\r\n}\r\n\r\nfunction OnCallbackFormBulkAddResponse(result, value) {\r\n  //this is a field on this page that gets updated by the bulkupdate page if a bulk update operation has run\r\n  if ($(\"#divRanBulkUpdate\").text() == 1) m_fnRefreshData();\r\n}\r\n\r\nfunction OnCallbackFormBulkEditResponse(result, value) {\r\n  //this is a field on this page that gets updated by the bulkupdate page if a bulk update operation has run\r\n  if ($(\"#divRanBulkUpdate\").text() == 1) m_fnRefreshData();\r\n}\r\n\r\nfunction OnCallbackFormNewResponse(result, value) {\r\n  if (result === SP.UI.DialogResult.OK) {\r\n    //get last item inserted\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var responseList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n    var responseQuery = new SP.CamlQuery();\r\n    responseQuery.set_viewXml(\r\n      '<View><Query><OrderBy><FieldRef Name=\"ID\" Ascending=\"FALSE\"/></OrderBy></Query><RowLimit>1</RowLimit></View>'\r\n    );\r\n    const responseItems = responseList.getItems(responseQuery);\r\n    currCtx.load(\r\n      responseItems,\r\n      \"Include(ID, Title, ActionOffice, ReqNum, ResStatus, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n\r\n    currCtx.executeQueryAsync(\r\n      async function () {\r\n        var oListItem = null;\r\n\r\n        var listItemEnumerator = responseItems.getEnumerator();\r\n        while (listItemEnumerator.moveNext()) {\r\n          oListItem = listItemEnumerator.get_current();\r\n          if (oListItem && !oListItem.get_hasUniqueRoleAssignments())\r\n            await m_fnBreakResponsePermissions(oListItem, false, true);\r\n\r\n          break;\r\n        }\r\n\r\n        if (oListItem == null) return;\r\n\r\n        var responseTitle = oListItem.get_item(\"Title\");\r\n        var requestNum = oListItem.get_item(\"ReqNum\").get_lookupValue();\r\n\r\n        const currentUser = currCtx.get_web().get_currentUser();\r\n        const ownerGroup = currCtx.get_web().get_associatedOwnerGroup();\r\n        const memberGroup = currCtx.get_web().get_associatedMemberGroup();\r\n        const visitorGroup = currCtx.get_web().get_associatedVisitorGroup();\r\n\r\n        var responseDocLib = currCtx\r\n          .get_web()\r\n          .get_lists()\r\n          .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n        var itemCreateInfo = new SP.ListItemCreationInformation();\r\n        itemCreateInfo.set_underlyingObjectType(SP.FileSystemObjectType.folder);\r\n        itemCreateInfo.set_leafName(responseTitle);\r\n        const oListFolderItem = responseDocLib.addItem(itemCreateInfo);\r\n        oListFolderItem.set_item(\"Title\", responseTitle);\r\n        oListFolderItem.update();\r\n\r\n        oListFolderItem.breakRoleInheritance(false, false);\r\n\r\n        //add owner group\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          currCtx\r\n            .get_web()\r\n            .get_roleDefinitions()\r\n            .getByType(SP.RoleType.administrator)\r\n        );\r\n        oListFolderItem\r\n          .get_roleAssignments()\r\n          .add(ownerGroup, roleDefBindingColl);\r\n\r\n        //add member group\r\n        var roleDefBindingColl2 =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl2.add(\r\n          currCtx\r\n            .get_web()\r\n            .get_roleDefinitions()\r\n            .getByType(SP.RoleType.contributor)\r\n        );\r\n        oListFolderItem\r\n          .get_roleAssignments()\r\n          .add(memberGroup, roleDefBindingColl2);\r\n\r\n        //add visitor group\r\n        var roleDefBindingColl3 =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl3.add(\r\n          currCtx.get_web().get_roleDefinitions().getByName(\"Restricted Read\")\r\n        );\r\n        oListFolderItem\r\n          .get_roleAssignments()\r\n          .add(visitorGroup, roleDefBindingColl3);\r\n\r\n        //add action office\r\n        var actionOfficeGroupName = Audit.Common.Utilities.GetAOSPGroupName(\r\n          oListItem.get_item(\"ActionOffice\").get_lookupValue()\r\n        );\r\n        var actionOfficeGroupObj = Audit.Common.Utilities.GetSPSiteGroup(\r\n          actionOfficeGroupName\r\n        );\r\n        if (actionOfficeGroupObj != null) {\r\n          var roleDefBindingColl4 =\r\n            SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n          roleDefBindingColl4.add(\r\n            currCtx\r\n              .get_web()\r\n              .get_roleDefinitions()\r\n              .getByName(\"Restricted Contribute\")\r\n          );\r\n          oListFolderItem\r\n            .get_roleAssignments()\r\n            .add(actionOfficeGroupObj, roleDefBindingColl4);\r\n        }\r\n\r\n        //delete current logged in user from permissions because it gets added by default\r\n        oListFolderItem\r\n          .get_roleAssignments()\r\n          .getByPrincipal(currentUser)\r\n          .deleteObject();\r\n\r\n        currCtx.executeQueryAsync(\r\n          function () {\r\n            m_fnRefreshData();\r\n          },\r\n          function (sender, args) {\r\n            //alert( \"Request failed: \"  + args.get_message() + \"\\n\" + args.get_stackTrace() );\r\n            m_fnRefresh();\r\n          }\r\n        );\r\n      },\r\n      function (sender, args) {\r\n        //alert( \"Request failed: \"  + args.get_message() + \"\\n\" + args.get_stackTrace() );\r\n        m_fnRefresh();\r\n      }\r\n    );\r\n  } else m_bIsTransactionExecuting = false;\r\n}\r\n\r\nvar m_countCSToUpdateOnEditResponse = 0;\r\nvar m_countCSUpdatedOnEditResponse = 0;\r\n\r\nfunction OnCallbackFormEditResponse(result, value) {\r\n  m_countCSToUpdateOnEditResponse = 0;\r\n  m_countCSUpdatedOnEditResponse = 0;\r\n\r\n  if (result === SP.UI.DialogResult.OK) {\r\n    document.body.style.cursor = \"wait\";\r\n    notifyId = SP.UI.Notify.addNotification(\"Please wait... \", false);\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    //get the response that was edited\r\n    var responseList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n    var responseQuery = new SP.CamlQuery();\r\n    responseQuery.set_viewXml(\r\n      \"<View><Query><FieldRef Name=\\\"Modified\\\" Ascending=\\\"FALSE\\\"/><Where><Eq><FieldRef Name='ID'/><Value Type='Text'>\" +\r\n        m_itemID +\r\n        \"</Value></Eq></Where></Query><RowLimit>1</RowLimit></View>\"\r\n    );\r\n    const responseItems = responseList.getItems(responseQuery);\r\n    currCtx.load(\r\n      responseItems,\r\n      \"Include(ID, Title, ActionOffice, POC, POCCC, ReturnReason, ResStatus, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n\r\n    //get the response folder of the response that was edited\r\n    var responseDocLib = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n    var responseDocQuery = new SP.CamlQuery();\r\n    responseDocQuery.set_viewXml(\r\n      \"<View><Query><Where><Eq><FieldRef Name='FileLeafRef'/><Value Type='Text'>\" +\r\n        m_responseTitle +\r\n        \"</Value></Eq></Where></Query><RowLimit>1</RowLimit></View>\"\r\n    );\r\n    const responseFolderItems = responseDocLib.getItems(responseDocQuery);\r\n    currCtx.load(\r\n      responseFolderItems,\r\n      \"Include( Title, DisplayName, Id, EncodedAbsUrl, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n    );\r\n\r\n    var folderPath =\r\n      Audit.Common.Utilities.GetSiteUrl() +\r\n      \"/\" +\r\n      Audit.Common.Utilities.GetLibNameResponseDocs() +\r\n      \"/\" +\r\n      m_responseTitle;\r\n    var responseDocQuery2 = new SP.CamlQuery();\r\n    responseDocQuery2.set_viewXml(\r\n      \"<View Scope=\\\"RecursiveAll\\\"><Query><Where><And><Eq><FieldRef Name='FileDirRef'/><Value Type='Text'>\" +\r\n        folderPath +\r\n        \"</Value></Eq><Eq><FieldRef Name='DocumentStatus'/><Value Type='Text'>Submitted</Value></Eq></And></Where></Query></View>\"\r\n    );\r\n    const responseDocSubmittedItems =\r\n      responseDocLib.getItems(responseDocQuery2);\r\n    currCtx.load(\r\n      responseDocSubmittedItems,\r\n      \"Include(ID, DocumentStatus, FileDirRef, Created, FileLeafRef)\"\r\n    );\r\n\r\n    var responseDocQuery6 = new SP.CamlQuery();\r\n    responseDocQuery6.set_viewXml(\r\n      \"<View Scope=\\\"RecursiveAll\\\"><Query><Where><And><Eq><FieldRef Name='FileDirRef'/><Value Type='Text'>\" +\r\n        folderPath +\r\n        \"</Value></Eq><Eq><FieldRef Name='DocumentStatus'/><Value Type='Text'>Open</Value></Eq></And></Where></Query></View>\"\r\n    );\r\n    const responseDocOpenItems = responseDocLib.getItems(responseDocQuery6);\r\n    currCtx.load(\r\n      responseDocOpenItems,\r\n      \"Include(ID, DocumentStatus, FileDirRef, Created, FileLeafRef)\"\r\n    );\r\n\r\n    var responseDocQuery3 = new SP.CamlQuery();\r\n    responseDocQuery3.set_viewXml(\r\n      \"<View Scope=\\\"RecursiveAll\\\"><Query><Where><And><Eq><FieldRef Name='FileDirRef'/><Value Type='Text'>\" +\r\n        folderPath +\r\n        \"</Value></Eq><Eq><FieldRef Name='DocumentStatus'/><Value Type='Text'>Marked for Deletion</Value></Eq></And></Where></Query></View>\"\r\n    );\r\n    const responseDocMarkedForDeletionItems =\r\n      responseDocLib.getItems(responseDocQuery3);\r\n    currCtx.load(\r\n      responseDocMarkedForDeletionItems,\r\n      \"Include(ID, DocumentStatus, FileDirRef, Created, FileLeafRef)\"\r\n    );\r\n\r\n    var responseDocQuery4 = new SP.CamlQuery();\r\n    responseDocQuery4.set_viewXml(\r\n      \"<View Scope=\\\"RecursiveAll\\\"><Query><Where><And><Eq><FieldRef Name='FileDirRef'/><Value Type='Text'>\" +\r\n        folderPath +\r\n        \"</Value></Eq><Eq><FieldRef Name='DocumentStatus'/><Value Type='Text'>Rejected</Value></Eq></And></Where></Query></View>\"\r\n    );\r\n    const responseDocRejectedItems = responseDocLib.getItems(responseDocQuery4);\r\n    currCtx.load(\r\n      responseDocRejectedItems,\r\n      \"Include(ID, DocumentStatus, FileDirRef, Created, FileLeafRef)\"\r\n    );\r\n\r\n    var responseDocQuery8 = new SP.CamlQuery();\r\n    responseDocQuery8.set_viewXml(\r\n      \"<View Scope=\\\"RecursiveAll\\\"><Query><Where><And><Eq><FieldRef Name='FileDirRef'/><Value Type='Text'>\" +\r\n        folderPath +\r\n        \"</Value></Eq><Eq><FieldRef Name='DocumentStatus'/><Value Type='Text'>Sent to QA</Value></Eq></And></Where></Query></View>\"\r\n    );\r\n    const responseDocSentToQAItems = responseDocLib.getItems(responseDocQuery8);\r\n    currCtx.load(\r\n      responseDocSentToQAItems,\r\n      \"Include(ID, DocumentStatus, FileDirRef, Created, FileLeafRef)\"\r\n    );\r\n\r\n    var emailList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n    var emailListQuery = new SP.CamlQuery();\r\n    emailListQuery.set_viewXml(\r\n      '<View><Query><OrderBy><FieldRef Name=\"ID\"/></OrderBy><Where><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">1</Value></Eq></Where></Query></View>'\r\n    );\r\n    const emailListFolderItems = emailList.getItems(emailListQuery);\r\n    currCtx.load(emailListFolderItems, \"Include(ID, Title, DisplayName)\");\r\n\r\n    currCtx.executeQueryAsync(\r\n      async function () {\r\n        var oListItem = null;\r\n        var newResponseFolderTitle = null;\r\n        var listItemEnumerator = responseItems.getEnumerator();\r\n        while (listItemEnumerator.moveNext()) {\r\n          oListItem = listItemEnumerator.get_current();\r\n          newResponseFolderTitle = oListItem.get_item(\"Title\");\r\n          await m_fnBreakResponsePermissions(oListItem, false, true);\r\n          break;\r\n        }\r\n\r\n        if (oListItem == null) {\r\n          alert(\"Error\");\r\n          return;\r\n        }\r\n\r\n        var responseFolder = null;\r\n        var listItemEnumerator = responseFolderItems.getEnumerator();\r\n        while (listItemEnumerator.moveNext()) {\r\n          responseFolder = listItemEnumerator.get_current();\r\n          await m_fnBreakResponseFolderPermissions(\r\n            responseFolder,\r\n            oListItem,\r\n            false,\r\n            true\r\n          );\r\n          break;\r\n        }\r\n\r\n        if (m_responseTitle != newResponseFolderTitle) {\r\n          responseFolder.set_item(\"FileLeafRef\", newResponseFolderTitle);\r\n          responseFolder.set_item(\"Title\", newResponseFolderTitle);\r\n          responseFolder.update();\r\n        }\r\n\r\n        async function onUpdated1Succeeded() {\r\n          var currCtx2 = new SP.ClientContext.get_current();\r\n          var web2 = currCtx2.get_web();\r\n\r\n          if (\r\n            this.oListItem.get_item(\"ResStatus\") ==\r\n              \"3-Returned to Action Office\" &&\r\n            m_responseStatus != this.oListItem.get_item(\"ResStatus\")\r\n          ) {\r\n            //status changed\r\n            var oRequest = m_fnGetRequestByNumber(m_requestNum);\r\n\r\n            var emailSubject =\r\n              \"Please Update your Response for Request Number: \" + m_requestNum;\r\n            var emailText = \"\";\r\n\r\n            if (\r\n              this.oListItem.get_item(\"ResStatus\") ==\r\n              \"3-Returned to Action Office\"\r\n            ) {\r\n              emailText =\r\n                \"<div>Audit Request Reference: <b>{REQUEST_NUMBER}</b></div>\" +\r\n                \"<div>Audit Request Subject: <b>{REQUEST_SUBJECT}</b></div>\" +\r\n                \"<div>Audit Request Due Date: <b>{REQUEST_DUEDATE}</b></div>\" +\r\n                \"{POC}\" +\r\n                \"<div>{RETURN_REASON}</div><br/>\" +\r\n                \"<div>Please provide responses for the following Sample(s): </div><br/>\" +\r\n                \"<div>{RESPONSE_TITLES}</div>\";\r\n\r\n              var returnReason = this.oListItem.get_item(\"ReturnReason\");\r\n              if (returnReason == null) returnReason = \"\";\r\n              else returnReason = \"Return Reason: \" + returnReason;\r\n\r\n              emailText = emailText.replace(\"{RETURN_REASON}\", returnReason);\r\n            } else {\r\n              emailText =\r\n                \"<div>Audit Request Reference: <b>{REQUEST_NUMBER}</b></div>\" +\r\n                \"<div>Audit Request Subject: <b>{REQUEST_SUBJECT}</b></div>\" +\r\n                \"<div>Audit Request Due Date: <b>{REQUEST_DUEDATE}</b></div>\" +\r\n                \"{POC}\" +\r\n                \"{REQUEST_RELATEDAUDIT}<br/>\" +\r\n                \"<div>Below are the listed action items that have been requested for the Audit: </div>\" +\r\n                \"<div>{REQUEST_ACTIONITEMS}<br/></div>\" +\r\n                \"<div>Please provide responses for the following Sample(s): </div><br/>\" +\r\n                \"<div>{RESPONSE_TITLES}</div>\";\r\n\r\n              emailText = emailText.replace(\r\n                \"{REQUEST_ACTIONITEMS}\",\r\n                oRequest.actionItems\r\n              );\r\n\r\n              if (oRequest.relatedAudit == null || oRequest.relatedAudit == \"\")\r\n                emailText = emailText.replace(\r\n                  \"{REQUEST_RELATEDAUDIT}\",\r\n                  \"<div>This is a new request, not similar to previous audit cycles.</div>\"\r\n                );\r\n              else\r\n                emailText = emailText.replace(\r\n                  \"{REQUEST_RELATEDAUDIT}\",\r\n                  \"<div>This request is similar to this previous cycle audit: \" +\r\n                    oRequest.relatedAudit +\r\n                    \"</div>\"\r\n                );\r\n            }\r\n\r\n            emailText = emailText.replace(\"{REQUEST_NUMBER}\", m_requestNum);\r\n            emailText = emailText.replace(\r\n              \"{REQUEST_SUBJECT}\",\r\n              oRequest.subject\r\n            );\r\n            emailText = emailText.replace(\r\n              \"{REQUEST_DUEDATE}\",\r\n              oRequest.internalDueDate\r\n            );\r\n\r\n            emailText = emailText.replace(\r\n              \"{RESPONSE_TITLES}\",\r\n              this.newResponseFolderTitle\r\n            );\r\n\r\n            var ao = this.oListItem.get_item(\"ActionOffice\");\r\n            if (ao != null) ao = ao.get_lookupValue();\r\n            else ao = \"\";\r\n            var emailTo = ao;\r\n            // Audit.Common.Utilities.GetAOSPGroupName(ao);\r\n\r\n            //if it has a poc, update the TO field and the poc in the email text\r\n            var poc = this.oListItem.get_item(\"POC\");\r\n            if (poc != null) {\r\n              poc = poc.get_email();\r\n              emailTo = poc;\r\n              var pocCC = this.oListItem.get_item(\"POCCC\");\r\n              if (pocCC != null) {\r\n                emailTo += \";\" + pocCC.get_email();\r\n              }\r\n\r\n              emailText = emailText.replace(\r\n                \"{POC}\",\r\n                \"<div><b>POC: \" + poc + \"</b></div><br/>\"\r\n              );\r\n            } else {\r\n              emailText = emailText.replace(\"{POC}\", \"<br/>\");\r\n            }\r\n\r\n            var itemCreateInfo = new SP.ListItemCreationInformation();\r\n            itemCreateInfo.set_folderUrl(\r\n              location.protocol +\r\n                \"//\" +\r\n                location.host +\r\n                Audit.Common.Utilities.GetSiteUrl() +\r\n                \"/Lists/\" +\r\n                Audit.Common.Utilities.GetListNameEmailHistory() +\r\n                \"/\" +\r\n                m_requestNum\r\n            );\r\n            const oListItemEmail = emailList.addItem(itemCreateInfo);\r\n            oListItemEmail.set_item(\"Title\", emailSubject);\r\n            oListItemEmail.set_item(\"Body\", emailText);\r\n            oListItemEmail.set_item(\"To\", emailTo);\r\n            oListItemEmail.set_item(\r\n              \"NotificationType\",\r\n              \"AO Returned Notification\"\r\n            );\r\n            oListItemEmail.set_item(\"ReqNum\", m_requestNum);\r\n            oListItemEmail.set_item(\"ResID\", this.newResponseFolderTitle);\r\n            oListItemEmail.update();\r\n\r\n            currCtx2.executeQueryAsync(\r\n              function () {\r\n                document.body.style.cursor = \"default\";\r\n                setTimeout(function () {\r\n                  m_fnRefreshData();\r\n                }, 1000);\r\n              },\r\n              function (sender, args) {\r\n                alert(\r\n                  \"Request failed: \" +\r\n                    args.get_message() +\r\n                    \"\\n\" +\r\n                    args.get_stackTrace()\r\n                );\r\n                setTimeout(function () {\r\n                  m_fnRefresh();\r\n                }, 200);\r\n              }\r\n            );\r\n          } else if (\r\n            (this.oListItem.get_item(\"ResStatus\") == \"4-Approved for QA\" ||\r\n              this.oListItem.get_item(\"ResStatus\") ==\r\n                \"6-Reposted After Rejection\") &&\r\n            m_responseStatus != this.oListItem.get_item(\"ResStatus\")\r\n          ) {\r\n            //status changed\r\n            var oRequest = m_fnGetRequestByNumber(m_requestNum);\r\n\r\n            var oResponse = oRequest.responses.find(\r\n              (response) => response.ID == this.oListItem.get_item(\"ID\")\r\n            );\r\n\r\n            var bDoneBreakingReqPermisions = false;\r\n            await m_fnBreakRequestPermissions(\r\n              oRequest.item,\r\n              false,\r\n              this.oListItem.get_item(\"ResStatus\")\r\n            );\r\n\r\n            var cntForQA = 0;\r\n            if (responseDocSubmittedItems != null) {\r\n              var listItemEnumerator1 =\r\n                responseDocSubmittedItems.getEnumerator();\r\n              while (listItemEnumerator1.moveNext()) {\r\n                var oListItem1 = listItemEnumerator1.get_current();\r\n\r\n                oListItem1.set_item(\r\n                  \"FileLeafRef\",\r\n                  m_fnGetNewResponseDocTitle(\r\n                    oListItem1,\r\n                    newResponseFolderTitle,\r\n                    oRequest.sensitivity\r\n                  )\r\n                );\r\n                oListItem1.set_item(\"DocumentStatus\", \"Sent to QA\");\r\n                oListItem1.update();\r\n                cntForQA++;\r\n              }\r\n            }\r\n            if (responseDocOpenItems != null) {\r\n              var listItemEnumerator1 = responseDocOpenItems.getEnumerator();\r\n              while (listItemEnumerator1.moveNext()) {\r\n                var oListItem1 = listItemEnumerator1.get_current();\r\n\r\n                oListItem1.set_item(\r\n                  \"FileLeafRef\",\r\n                  m_fnGetNewResponseDocTitle(\r\n                    oListItem1,\r\n                    newResponseFolderTitle,\r\n                    oRequest.sensitivity\r\n                  )\r\n                );\r\n                oListItem1.set_item(\"DocumentStatus\", \"Sent to QA\");\r\n                oListItem1.update();\r\n                cntForQA++;\r\n              }\r\n            }\r\n            if (responseDocSentToQAItems != null) {\r\n              var listItemEnumerator1 =\r\n                responseDocSentToQAItems.getEnumerator();\r\n              while (listItemEnumerator1.moveNext()) {\r\n                var oListItem1 = listItemEnumerator1.get_current();\r\n                cntForQA++;\r\n              }\r\n            }\r\n\r\n            //these are the documents that are marked for deletion by the AO\r\n            if (responseDocMarkedForDeletionItems != null) {\r\n              const arrItemsToRecyle = new Array();\r\n\r\n              var listItemEnumerator1 =\r\n                responseDocMarkedForDeletionItems.getEnumerator();\r\n              while (listItemEnumerator1.moveNext()) {\r\n                var oListItem1 = listItemEnumerator1.get_current();\r\n                arrItemsToRecyle.push(oListItem1);\r\n              }\r\n\r\n              for (var x = 0; x < arrItemsToRecyle.length; x++) {\r\n                arrItemsToRecyle[x].deleteObject(); //change this to delete to remove from recycle bin\r\n              }\r\n            }\r\n\r\n            var cntRejected = 0;\r\n            if (responseDocRejectedItems != null) {\r\n              var listItemEnumerator1 =\r\n                responseDocRejectedItems.getEnumerator();\r\n              while (listItemEnumerator1.moveNext()) {\r\n                var oListItem1 = listItemEnumerator1.get_current();\r\n                oListItem1.set_item(\"DocumentStatus\", \"Archived\");\r\n                oListItem1.update();\r\n                cntRejected++;\r\n              }\r\n            }\r\n\r\n            const oResponseDocsForQA = oResponse.responseDocs.filter(\r\n              (responseDoc) => {\r\n                return [\"Sent to QA\", \"Submitted\", \"Open\"].includes(\r\n                  responseDoc.documentStatus\r\n                );\r\n              }\r\n            );\r\n\r\n            await m_fnNotifyQAApprovalPending(oRequest, oResponseDocsForQA);\r\n            currCtx2.executeQueryAsync(\r\n              async function () {\r\n                // Break Coversheet permissions\r\n                if (oRequest.coversheets?.length) {\r\n                  await Promise.all(\r\n                    oRequest.coversheets.map((coversheet) =>\r\n                      m_fnBreakCoversheetPermissions(coversheet.item, true)\r\n                    )\r\n                  );\r\n                }\r\n                setTimeout(function () {\r\n                  m_fnRefreshData();\r\n                }, 200);\r\n              },\r\n              function (sender, args) {\r\n                alert(\r\n                  \"Request failed: \" +\r\n                    args.get_message() +\r\n                    \"\\n\" +\r\n                    args.get_stackTrace()\r\n                );\r\n                setTimeout(function () {\r\n                  m_fnRefresh();\r\n                }, 200);\r\n              }\r\n            );\r\n          } else {\r\n            document.body.style.cursor = \"default\";\r\n            setTimeout(function () {\r\n              m_fnRefreshData();\r\n            }, 1000);\r\n          }\r\n        }\r\n        function onUpdated1Failed(sender, args) {\r\n          alert(\r\n            \"Request failed: \" +\r\n              args.get_message() +\r\n              \"\\n\" +\r\n              args.get_stackTrace()\r\n          );\r\n          setTimeout(function () {\r\n            m_fnRefresh();\r\n          }, 200);\r\n        }\r\n\r\n        var data = {\r\n          newResponseFolderTitle: newResponseFolderTitle,\r\n          oListItem: oListItem,\r\n        };\r\n        currCtx.executeQueryAsync(\r\n          Function.createDelegate(data, onUpdated1Succeeded),\r\n          Function.createDelegate(data, onUpdated1Failed)\r\n        );\r\n      },\r\n      function (sender, args) {\r\n        alert(\r\n          \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n        );\r\n        setTimeout(function () {\r\n          m_fnRefresh();\r\n        }, 200);\r\n      }\r\n    );\r\n  } else {\r\n    m_bIsTransactionExecuting = false;\r\n  }\r\n}\r\n\r\nfunction m_fnGoToRequest(requestNumber, responseTitle) {\r\n  const notifyId = SP.UI.Notify.addNotification(\r\n    \"Displaying Request (\" + requestNumber + \")\",\r\n    false\r\n  );\r\n\r\n  m_sGoToResponseTitle = null;\r\n  if (responseTitle != null && responseTitle != \"\")\r\n    m_sGoToResponseTitle = responseTitle;\r\n\r\n  _myViewModel.tabs.selectTab(_myViewModel.tabOpts.RequestDetail);\r\n\r\n  if ($(\"#ddlReqNum\").val() != requestNumber) {\r\n    _myViewModel.filterRequestInfoTabRequestName(requestNumber);\r\n  } else if (m_sGoToResponseTitle != null) {\r\n    //need to navigate to tab 2 for this to work\r\n    m_fnHighlightResponse();\r\n  }\r\n}\r\n\r\nif (document.readyState === \"ready\" || document.readyState === \"complete\") {\r\n  InitReport();\r\n} else {\r\n  document.onreadystatechange = () => {\r\n    if (document.readyState === \"complete\" || document.readyState === \"ready\") {\r\n      ExecuteOrDelayUntilScriptLoaded(function () {\r\n        SP.SOD.executeFunc(\"sp.js\", \"SP.ClientContext\", InitReport);\r\n      }, \"sp.js\");\r\n    }\r\n  };\r\n}\r\n", "const state = {};\r\n\r\nwindow.history.replaceState({}, \"\", document.location.href);\r\nexport function setUrlParam(param, newVal) {\r\n  // No need to reset the param if it hasn't changed\r\n  if (getUrlParam(param) == newVal) return;\r\n\r\n  const search = window.location.search;\r\n  //var urlParams = new URLSearchParams(queryString);\r\n\r\n  const regex = new RegExp(\"([?;&])\" + param + \"[^&;]*[;&]?\");\r\n  const query = search.replace(regex, \"$1\").replace(/&$/, \"\");\r\n\r\n  const urlParams =\r\n    (query.length > 2 ? query + \"&\" : \"?\") +\r\n    (newVal ? param + \"=\" + newVal : \"\");\r\n\r\n  state[param] = newVal;\r\n  window.history.pushState(state, \"\", urlParams.toString());\r\n}\r\n\r\nexport function getUrlParam(param) {\r\n  const results = new RegExp(\"[?&]\" + param + \"=([^&#]*)\").exec(\r\n    window.location.href\r\n  );\r\n  if (results == null) {\r\n    return null;\r\n  } else {\r\n    return decodeURI(results[1]) || 0;\r\n  }\r\n}\r\n", "import { setUrlParam } from \"../../common/router.js\";\r\n\r\n// const urlParam = \"Tab\";\r\n\r\nexport class TabsModule {\r\n  constructor(tabOpts, urlParam = \"Tab\") {\r\n    this.urlParam = urlParam;\r\n    ko.utils.arrayPushAll(this.tabOpts, tabOpts);\r\n    this.selectedTab.subscribe(this.tabChangeHandler);\r\n    window.addEventListener(\"popstate\", this.popStateHandler);\r\n  }\r\n\r\n  tabOpts = ko.observableArray();\r\n  selectedTab = ko.observable();\r\n\r\n  isSelected = (tab) => {\r\n    return tab.id == this.selectedTab()?.id;\r\n  };\r\n\r\n  clickTabLink = (tab) => {\r\n    this.selectedTab(tab);\r\n    console.log(\"selected: \" + tab.id);\r\n  };\r\n\r\n  selectTab = (tab) => this.selectById(tab.id);\r\n\r\n  selectById = (tabId) => {\r\n    const tabById =\r\n      this.tabOpts().find((tab) => tab.id == tabId) ?? this.getDefaultTab();\r\n    this.selectedTab(tabById);\r\n  };\r\n\r\n  getDefaultTab = () => this.tabOpts()[0];\r\n\r\n  tabChangeHandler = (newTab) => {\r\n    if (newTab) setUrlParam(this.urlParam, newTab.id);\r\n    // window.history.pushState({ tab: { id: newTab.id } }, \"\", newTab.id);\r\n  };\r\n\r\n  popStateHandler = (event) => {\r\n    if (event.state) {\r\n      if (event.state[this.urlParam])\r\n        this.selectById(event.state[this.urlParam]);\r\n    }\r\n  };\r\n}\r\n\r\nexport class Tab {\r\n  constructor(id, linkText, template) {\r\n    this.id = id;\r\n    this.linkText = linkText;\r\n    this.template = template;\r\n  }\r\n}\r\n", "import { directRegisterComponent } from \"../../infrastructure/index.js\";\r\nimport { modalDialogTemplate } from \"./ModalDialogTemplate.js\";\r\n\r\nconst componentName = \"modal-dialog-component\";\r\n\r\nexport const currentDialogs = ko.observableArray();\r\n\r\nexport let toggle;\r\n\r\nexport function showModalDialog(dialogOptions) {\r\n  currentDialogs.push(dialogOptions);\r\n}\r\n\r\nclass ModalDialogModule {\r\n  constructor(dialogOpts) {\r\n    this.dialogOpts = dialogOpts;\r\n    this.title = dialogOpts.title;\r\n    this.dialogReturnValueCallback = dialogOpts.dialogReturnValueCallback;\r\n\r\n    this.form = dialogOpts.form;\r\n\r\n    if (this.form?.onComplete) {\r\n      alert(\"Pass the form onComplete to the modal dialog!\");\r\n      return;\r\n    }\r\n    this.form.onComplete = this.close.bind(this);\r\n\r\n    toggle = this.toggle;\r\n  }\r\n\r\n  toggle = (show = null) => {\r\n    if (show == null) show = !this.dlgElement.hasAttribute(\"open\");\r\n\r\n    show ? this.showModal() : this.hide();\r\n  };\r\n\r\n  showModal = () => {\r\n    this.dlgElement.showModal();\r\n    this.dlgElement.classList.add(\"active\");\r\n  };\r\n\r\n  clickClose = () => {\r\n    this.close(false);\r\n  };\r\n\r\n  hide = () => {\r\n    this.dlgElement.close();\r\n    this.dlgElement.classList.remove(\"active\");\r\n  };\r\n\r\n  close(result) {\r\n    this.dlgElement.close();\r\n    this.dlgElement.classList.remove(\"active\");\r\n    if (this.dialogReturnValueCallback) this.dialogReturnValueCallback(result);\r\n    currentDialogs.remove(this.dialogOpts);\r\n  }\r\n\r\n  _id;\r\n  getUniqueId = () => {\r\n    if (!this._id) {\r\n      this._id = \"field-\" + Math.floor(Math.random() * 10000);\r\n    }\r\n    return this._id;\r\n  };\r\n\r\n  koDescendantsComplete = function (node) {\r\n    this.dlgElement = node.querySelector(\"dialog\");\r\n    dragElement(this.dlgElement);\r\n    resizeDialog(this.dlgElement);\r\n    this.showModal();\r\n  };\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: modalDialogTemplate,\r\n  viewModel: ModalDialogModule,\r\n});\r\n\r\nfunction resizeDialog(elmnt) {\r\n  elmnt.style.width = \"550px\";\r\n  elmnt.style.height = \"\";\r\n  elmnt.style.top = \"125px\";\r\n  elmnt.style.left = (window.GetViewportWidth() - 550) / 2 + \"px\";\r\n}\r\n\r\n// TODO: this should be in a utility class or something\r\nfunction dragElement(elmnt) {\r\n  var pos1 = 0,\r\n    pos2 = 0,\r\n    pos3 = 0,\r\n    pos4 = 0;\r\n\r\n  // elmnt.style.top = elmnt.style.top\r\n\r\n  const dragger = elmnt.querySelector(\".grabber\");\r\n  if (dragger) {\r\n    // if present, the header is where you move the DIV from:\r\n    dragger.onmousedown = dragMouseDown;\r\n  } else {\r\n    // otherwise, move the DIV from anywhere inside the DIV:\r\n    elmnt.onmousedown = dragMouseDown;\r\n  }\r\n\r\n  function dragMouseDown(e) {\r\n    e = e || window.event;\r\n    e.preventDefault();\r\n    // get the mouse cursor position at startup:\r\n    pos3 = e.clientX;\r\n    pos4 = e.clientY;\r\n    document.onmouseup = closeDragElement;\r\n    // call a function whenever the cursor moves:\r\n    document.onmousemove = elementDrag;\r\n  }\r\n\r\n  function elementDrag(e) {\r\n    e = e || window.event;\r\n    e.preventDefault();\r\n    // calculate the new cursor position:\r\n    pos1 = pos3 - e.clientX;\r\n    pos2 = pos4 - e.clientY;\r\n    pos3 = e.clientX;\r\n    pos4 = e.clientY;\r\n    // set the element's new position:\r\n    elmnt.style.top = elmnt.offsetTop - pos2 + \"px\";\r\n    elmnt.style.left = elmnt.offsetLeft - pos1 + \"px\";\r\n  }\r\n\r\n  function closeDragElement() {\r\n    // stop moving when mouse button is released:\r\n    document.onmouseup = null;\r\n    document.onmousemove = null;\r\n  }\r\n}\r\n", "import { html } from \"../../infrastructure/index.js\";\r\n\r\nexport const modalDialogTemplate = html`\r\n  <dialog\r\n    id=\"\"\r\n    class=\"card bg-dark draggable modal-dialog\"\r\n    data-bind=\"attr: {id: getUniqueId() }\"\r\n  >\r\n    <!-- Can't use 'with: currentDialog' since we need to register our \r\n      javascript event listeners for grabbing and resizing -->\r\n    <div class=\"card-header bg-dark grabber\">\r\n      <h2 class=\"card-title\" data-bind=\"text: title\"></h2>\r\n      <h2 class=\"card-title\">\r\n        <i class=\"fa-solid fa-xmark pointer\" data-bind=\"click: clickClose\"></i>\r\n      </h2>\r\n    </div>\r\n    <div class=\"dimmer\" data-bind=\"css: {'active': form.saving }\">\r\n      <span class=\"loader\"></span>\r\n      <ul class=\"\" data-bind=\"foreach: $root.blockingTasks\">\r\n        <li data-bind=\"text: msg + '...'\"></li>\r\n      </ul>\r\n    </div>\r\n    <div\r\n      class=\"card-body\"\r\n      data-bind=\"component: { name: form.componentName, params: form.params }\"\r\n    ></div>\r\n    <div class=\"card-actions\">\r\n      <button\r\n        style\r\n        type=\"button\"\r\n        class=\"btn btn-danger\"\r\n        data-bind=\"click: clickClose\"\r\n      >\r\n        Cancel\r\n      </button>\r\n    </div>\r\n  </dialog>\r\n`;\r\n", "export const html = String.raw;\r\n\r\nexport class BaseForm {\r\n  constructor({ entity = null, view = null }) {\r\n    this.entity = entity;\r\n    this.view = view ?? entity.constructor.Views.All;\r\n  }\r\n\r\n  saving = ko.observable(false);\r\n\r\n  FormFields = ko.pureComputed(() => {\r\n    const entity = ko.utils.unwrapObservable(this.entity);\r\n    return Object.entries(entity.FieldMap)\r\n      .filter(([key, field]) => this.view.includes(key) && field?.Visible())\r\n      .map(([key, field]) => field);\r\n  });\r\n\r\n  // Validate just the fields on this form\r\n  validate = (showErrors = true) => {\r\n    Object.values(this.FormFields()).map(\r\n      (field) => field?.validate && field.validate(showErrors)\r\n    );\r\n    this.ShowErrors(showErrors);\r\n    return this.Errors();\r\n  };\r\n\r\n  ShowErrors = ko.observable(false);\r\n\r\n  Errors = ko.pureComputed(() => {\r\n    return Object.values(this.FormFields())\r\n      .filter((field) => field?.Errors && field.Errors())\r\n      .flatMap((field) => field.Errors());\r\n  });\r\n\r\n  IsValid = ko.pureComputed(() => !this.Errors().length);\r\n\r\n  params = this;\r\n}\r\n", "import { BaseForm, html } from \"../index.js\";\r\n\r\nconst componentName = \"default-constrained-entity-form\";\r\n\r\n/**\r\n * Combines functionality for View, Edit, Disp in one component.\r\n */\r\nexport class DefaultForm extends BaseForm {\r\n  constructor({ entity, view, displayMode }) {\r\n    super({ entity, view });\r\n    // this.entityView = new ConstrainedEntityView({ entity, view });\r\n    this.displayMode(displayMode);\r\n  }\r\n\r\n  displayMode = ko.observable();\r\n\r\n  clickSubmit() {}\r\n\r\n  clickCancel() {}\r\n\r\n  clickClear() {}\r\n\r\n  params = this;\r\n  componentName = componentName;\r\n}\r\n\r\nconst template = html`\r\n  <div class=\"audit-form bg-dark\">\r\n    <div class=\"form-fields vertical\" data-bind=\"foreach: FormFields\">\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n            name: components[$parent.displayMode()], params: $data}, \r\n            class: classList\"\r\n      ></div>\r\n    </div>\r\n  </div>\r\n`;\r\n\r\nko.components.register(componentName, {\r\n  template,\r\n});\r\n", "export const FormDisplayModes = {\r\n  new: \"new\",\r\n  edit: \"edit\",\r\n  view: \"view\",\r\n};\r\n\r\nexport const FieldDisplayModes = {\r\n  new: \"new\",\r\n  edit: \"edit\",\r\n  view: \"view\",\r\n};\r\n", "import { DefaultForm } from \"../components/forms/index.js\";\r\nimport { FieldDisplayModes } from \"../enums/display_modes.js\";\r\n\r\nexport function NewForm(entity, view = null) {\r\n  return new DefaultForm({ entity, view, displayMode: FieldDisplayModes.new });\r\n}\r\n\r\nexport function EditForm(entity, view = null) {\r\n  return new DefaultForm({ entity, view, displayMode: FieldDisplayModes.edit });\r\n}\r\n\r\nexport function DispForm(entity, view = null) {\r\n  return new DefaultForm({ entity, view, displayMode: FieldDisplayModes.view });\r\n}\r\n", "import {\r\n  AUDITREQUESTSTATES,\r\n  AuditRequest,\r\n} from \"../../../../entities/index.js\";\r\n\r\nimport { addNewRequest } from \"../../../../services/index.js\";\r\n\r\nimport { configurationsStore } from \"../../../../infrastructure/store.js\";\r\nimport { BaseForm } from \"../../../../sal/components/forms/index.js\";\r\nimport { directRegisterComponent } from \"../../../../sal/infrastructure/index.js\";\r\nimport { newRequestFormTemplate } from \"./NewRequestFormTemplate.js\";\r\n\r\nexport const newRequestFormComponentName = \"newRequestForm\";\r\n\r\nexport class NewRequestFormComponent {\r\n  constructor(params) {\r\n    this.onComplete = params?.onComplete;\r\n  }\r\n\r\n  onComplete;\r\n\r\n  newRequest = ko.observable(new AuditRequest());\r\n\r\n  params = ko.pureComputed(() => {\r\n    return {\r\n      newRequest: this.newRequest,\r\n      reset: this.reset,\r\n      onComplete: this.onComplete,\r\n    };\r\n  });\r\n\r\n  componentName = newRequestFormComponentName;\r\n}\r\n\r\nexport default class NewRequestFormModule extends BaseForm {\r\n  constructor({ newRequest, onComplete }) {\r\n    super({ entity: newRequest, view: AuditRequest.Views.New });\r\n\r\n    this.onComplete = onComplete;\r\n    this.prepopulateRequestFields();\r\n  }\r\n\r\n  saving = ko.observable(false);\r\n\r\n  prepopulateRequestFields() {\r\n    const request = ko.unwrap(this.entity);\r\n\r\n    if (!request) return;\r\n\r\n    const fy = configurationsStore[\"current-fy\"];\r\n    request.FiscalYear.Value(fy);\r\n\r\n    const reqType = configurationsStore[\"default-req-type\"];\r\n    request.ReqType.Value(reqType);\r\n\r\n    request.Reminders.Value(request.Reminders.Options());\r\n    request.ReqStatus.Value(AUDITREQUESTSTATES.OPEN);\r\n  }\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    const errors = this.validate();\r\n    if (errors.length) return;\r\n\r\n    const request = this.entity();\r\n\r\n    try {\r\n      await addNewRequest(request);\r\n      this.onComplete(SP.UI.DialogResult.OK);\r\n    } catch (e) {\r\n      alert(e);\r\n    }\r\n  }\r\n\r\n  clearForm() {\r\n    this.entity(new AuditRequest());\r\n    this.prepopulateRequestFields();\r\n  }\r\n}\r\n\r\ndirectRegisterComponent(newRequestFormComponentName, {\r\n  template: newRequestFormTemplate,\r\n  viewModel: NewRequestFormModule,\r\n});\r\n", "import {\r\n  breakRequestPermissions,\r\n  getRequestById,\r\n  getRequestResponseDocs,\r\n  getRequestResponses,\r\n  breakRequestCoversheetPerms,\r\n  getNewResponseDocTitle,\r\n  ensureRequestAuditResponseDocsROFolder,\r\n  ensureRequestROEmailLogItem,\r\n} from \"./index.js\";\r\n\r\nimport {\r\n  AuditResponseDoc,\r\n  AuditResponseStates,\r\n  AuditResponseDocStates,\r\n  AuditResponseDocRO,\r\n} from \"../entities/index.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport async function approveResponseDocsForQA(\r\n  requestId,\r\n  responseId = null,\r\n  responseDocsToApproveIds\r\n) {\r\n  const request = await getRequestById(requestId);\r\n\r\n  const allRequestResponseDocs = await getRequestResponseDocs(request);\r\n\r\n  const allRequestResponses = await getRequestResponses(request);\r\n\r\n  const updatedResponses = allRequestResponseDocs\r\n    .filter((responseDoc) => responseDocsToApproveIds.includes(responseDoc.ID))\r\n    .map((responseDoc) => responseDoc.ResID.Value())\r\n    .reduce((accumulator, responseDocResponse) => {\r\n      if (\r\n        !accumulator.find((response) => response?.ID == responseDocResponse.ID)\r\n      )\r\n        accumulator.push(responseDocResponse);\r\n      return accumulator;\r\n    }, []);\r\n\r\n  await Promise.all(\r\n    responseDocsToApproveIds.map(async (responseDocId) => {\r\n      const responseDoc = allRequestResponseDocs.find(\r\n        (responseDoc) => responseDoc.ID == responseDocId\r\n      );\r\n\r\n      // TODO: this should just be an ensure on our AppDbContext\r\n      const response = allRequestResponses.find(\r\n        (response) => response.ID == responseDoc.ResID.Value().ID\r\n      );\r\n\r\n      if (\r\n        responseDoc.DocumentStatus.Value() != AuditResponseDocStates.Submitted\r\n      ) {\r\n        console.error(\"Document status is not valid for approval\");\r\n        return;\r\n      }\r\n\r\n      responseDoc.DocumentStatus.Value(AuditResponseDocStates.SentToQA);\r\n\r\n      // TODO: Fix naming conflicting with drag and drop upload\r\n\r\n      const newReponseDocName = getNewResponseDocTitle(\r\n        request,\r\n        response,\r\n        responseDoc\r\n      );\r\n\r\n      responseDoc.FileName.Value(newReponseDocName);\r\n\r\n      await appContext.AuditResponseDocs.UpdateEntity(\r\n        responseDoc,\r\n        AuditResponseDoc.Views.UpdateDocStatus\r\n      );\r\n    })\r\n  );\r\n\r\n  // Now see if we can approve any responses for QA\r\n  const responsesToSubmitToQA = updatedResponses.filter((response) => {\r\n    return response.ResStatus.Value() == AuditResponseStates.Submitted;\r\n  });\r\n\r\n  if (responsesToSubmitToQA.length) {\r\n    await Promise.all(\r\n      responsesToSubmitToQA.map(async (response) => {\r\n        response.ResStatus.Value(AuditResponseStates.ApprovedForQA);\r\n        await appContext.AuditResponses.UpdateEntity(response, [\"ResStatus\"]);\r\n      })\r\n    );\r\n\r\n    // Break the request permissions\r\n    await breakRequestPermissions(request, AuditResponseStates.ApprovedForQA);\r\n    await breakRequestCoversheetPerms(request, true);\r\n  }\r\n}\r\n\r\nexport async function approveResponseDocsForRO(\r\n  requestId,\r\n  responseDocsToApproveIds\r\n) {\r\n  const request = await getRequestById(requestId);\r\n\r\n  const requestingOffice = request.RequestingOffice.Value();\r\n\r\n  if (!requestingOffice) return;\r\n\r\n  const allRequestResponseDocs = await getRequestResponseDocs(request);\r\n\r\n  const allRequestResponses = await getRequestResponses(request);\r\n\r\n  const updatedResponses = allRequestResponseDocs\r\n    .filter((responseDoc) => responseDocsToApproveIds.includes(responseDoc.ID))\r\n    .map((responseDoc) => responseDoc.ResID.Value())\r\n    .reduce((accumulator, responseDocResponse) => {\r\n      if (\r\n        !accumulator.find((response) => response?.ID == responseDocResponse.ID)\r\n      )\r\n        accumulator.push(responseDocResponse);\r\n      return accumulator;\r\n    }, []);\r\n\r\n  if (!updatedResponses.length) return;\r\n\r\n  const roResponseDocROFolderPath =\r\n    await ensureRequestAuditResponseDocsROFolder(\r\n      request.Title,\r\n      requestingOffice.ID\r\n    );\r\n\r\n  const roEmailLogItem = await ensureRequestROEmailLogItem(requestingOffice);\r\n\r\n  let cntApprovedResponseDocs = parseInt(roEmailLogItem.ResponseCount);\r\n  if (!cntApprovedResponseDocs) cntApprovedResponseDocs = 0;\r\n  let responseLogBody = \"\";\r\n\r\n  // For each response doc to approve\r\n  await Promise.all(\r\n    responseDocsToApproveIds.map(async (responseDocId) => {\r\n      const responseDoc = allRequestResponseDocs.find(\r\n        (responseDoc) => responseDoc.ID == responseDocId\r\n      );\r\n\r\n      // 1. Check that the status isn't already approved\r\n      if (responseDoc.DocumentStatus.Value() == AuditResponseDocStates.SentToQA)\r\n        return;\r\n\r\n      cntApprovedResponseDocs++;\r\n\r\n      const response = allRequestResponses.find(\r\n        (response) => response.ID == responseDoc.ResID.Value().ID\r\n      );\r\n\r\n      // 2. Get New ResponseDoc title\r\n      const newResponseDocFileName = getNewResponseDocTitle(\r\n        request,\r\n        response,\r\n        responseDoc\r\n      );\r\n\r\n      // 3. Copy File to RO\r\n      const source = responseDoc.FileRef.Value();\r\n      const dest = roResponseDocROFolderPath + \"/\" + newResponseDocFileName;\r\n\r\n      await appContext.utilities.copyFileAsync(source, dest);\r\n\r\n      const newRoFileResults =\r\n        await appContext.AuditResponseDocsRO.FindByColumnValue(\r\n          [{ column: \"FileRef\", value: dest }],\r\n          {},\r\n          { count: 1 }\r\n        );\r\n      const newRoFile = newRoFileResults.results[0] ?? null;\r\n\r\n      if (!newRoFile) return;\r\n\r\n      // 4. Update ResponseDocRo\r\n      newRoFile.markApprovedForRO(request, response);\r\n      await appContext.AuditResponseDocsRO.UpdateEntity(\r\n        newRoFile,\r\n        AuditResponseDocRO.Views.ApprovedForROUpdate\r\n      );\r\n\r\n      // 4. Update ResponseDoc Status\r\n      responseDoc.markApprovedForRO(newResponseDocFileName);\r\n      await appContext.AuditResponseDocs.UpdateEntity(responseDoc, [\r\n        \"DocumentStatus\",\r\n        \"RejectReason\",\r\n        \"FileLeafRef\",\r\n      ]);\r\n\r\n      responseLogBody += `<li><a href=\"${\r\n        window.location.origin + newRoFile.FileRef\r\n      }\" target=\"_blank\">${newResponseDocFileName}</a></li>`;\r\n    })\r\n  );\r\n\r\n  roEmailLogItem.ResponseCount = cntApprovedResponseDocs;\r\n  roEmailLogItem.Responses += responseLogBody;\r\n\r\n  await appContext.AuditROEmailsLog.UpdateEntity(roEmailLogItem, [\r\n    \"Responses\",\r\n    \"ResponseCount\",\r\n  ]);\r\n\r\n  return true;\r\n}\r\n", "import { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport { roleNames } from \"./permission_manager.js\";\r\nimport { getQAGroup, getSiteGroups } from \"./people_manager.js\";\r\nimport { ItemPermissions } from \"../sal/infrastructure/index.js\";\r\nimport { AuditROEmailLog } from \"../entities/audit_ro_email_log.js\";\r\n\r\nexport async function ensureROEmailFolder() {\r\n  const folderResults = await appContext.AuditEmails.FindByColumnValue(\r\n    [{ column: \"Title\", value: \"RONotifications\" }],\r\n    {},\r\n    { count: 1, includeFolders: true },\r\n    [\"ID\", \"Title\"]\r\n  );\r\n\r\n  const folder = folderResults.results[0] ?? null;\r\n\r\n  if (folder) return;\r\n\r\n  const newFolderId = await appContext.AuditEmails.UpsertFolderPath(\r\n    \"RONotifications\"\r\n  );\r\n\r\n  const { owners, members, visitors } = getSiteGroups();\r\n  let qaGroup = await getQAGroup();\r\n\r\n  const newPermissions = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  newPermissions.addPrincipalRole(owners, roleNames.FullControl);\r\n  newPermissions.addPrincipalRole(members, roleNames.Contribute);\r\n  newPermissions.addPrincipalRole(visitors, roleNames.RestrictedRead);\r\n  newPermissions.addPrincipalRole(qaGroup, roleNames.RestrictedContribute);\r\n\r\n  await appContext.AuditEmails.SetItemPermissions(\r\n    { ID: newFolderId },\r\n    newPermissions,\r\n    true\r\n  );\r\n}\r\n\r\nexport async function ensureRequestROEmailLogItem(requestingOffice) {\r\n  if (!requestingOffice?.ID) return;\r\n  // const roGroupName = requestingOffice?.UserGroup?.Title;\r\n  // if (!roGroupName) return;\r\n\r\n  const logItemTitle = new Date().format(\"MM/dd/yyyy\");\r\n\r\n  const emailLogResult = await appContext.AuditROEmailsLog.FindByColumnValue(\r\n    [\r\n      { column: \"Title\", value: logItemTitle },\r\n      { column: \"RequestingOfficeId\", value: requestingOffice.ID },\r\n    ],\r\n    {},\r\n    { count: 1, includeFolders: true }\r\n  );\r\n\r\n  const auditRoEmailLogItem = emailLogResult?.results[0] ?? null;\r\n  if (auditRoEmailLogItem) return auditRoEmailLogItem;\r\n\r\n  const newLogItem = new AuditROEmailLog();\r\n\r\n  newLogItem.Title = logItemTitle;\r\n  newLogItem.RequestingOffice = requestingOffice;\r\n\r\n  await appContext.AuditROEmailsLog.AddEntity(newLogItem);\r\n\r\n  return newLogItem;\r\n}\r\n", "import { ORGROLES } from \"../entities/index.js\";\r\nimport { People } from \"../sal/entities/index.js\";\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport { auditOrganizationStore } from \"../infrastructure/store.js\";\r\nimport { ItemPermissions, Role, RoleDef } from \"../sal/infrastructure/index.js\";\r\nimport { getSiteGroups } from \"./people_manager.js\";\r\nimport { addTask, finishTask, taskDefs } from \"./tasks.js\";\r\n\r\nexport const roleNames = {\r\n  FullControl: \"Full Control\",\r\n  Design: \"Design\",\r\n  Edit: \"Edit\",\r\n  Contribute: \"Contribute\",\r\n  Read: \"Read\",\r\n  LimitedAccess: \"Limited Access\",\r\n  RestrictedRead: \"Restricted Read\",\r\n  RestrictedContribute: \"Restricted Contribute\",\r\n  InitialCreate: \"Initial Create\",\r\n};\r\n\r\nexport function ensureAllAppPerms() {\r\n  ensureAllPagePerms();\r\n  ensureAllListPermissions();\r\n}\r\n\r\nfunction ensureAllPagePerms() {\r\n  ensureDBPermissions();\r\n\r\n  // Reset Other Pages\r\n  [\r\n    \"AuditBulkAddResponse.aspx\",\r\n    \"AuditBulkEditResponse.aspx\",\r\n    \"AuditPermissions.aspx\",\r\n    \"AuditReport_RequestsStatus.aspx\",\r\n    \"AuditReturnedResponses.aspx\",\r\n    \"AuditUnSubmittedResponseDocuments.aspx\",\r\n    \"AuditUpdateSiteGroups.aspx\",\r\n  ].map((page) => ensurePagePerms(page, []));\r\n}\r\n\r\nexport function ensureDBPermissions() {\r\n  const aos = auditOrganizationStore().filter(\r\n    (ao) => ao.Role != ORGROLES.REQUESTINGOFFICE\r\n  );\r\n  ensurePagePerms(\"AO_DB.aspx\", aos);\r\n\r\n  const ros = auditOrganizationStore().filter(\r\n    (ao) => ao.Role == ORGROLES.REQUESTINGOFFICE\r\n  );\r\n  ensurePagePerms(\"RO_DB.aspx\", ros);\r\n\r\n  const qas = auditOrganizationStore().filter(\r\n    (ao) => ao.Role == ORGROLES.QUALITYASSURANCE\r\n  );\r\n  ensurePagePerms(\"QA_DB.aspx\", qas);\r\n\r\n  const sps = auditOrganizationStore().filter(\r\n    (ao) => ao.Role == ORGROLES.SPECIALPERMISSIONS\r\n  );\r\n  ensurePagePerms(\"SP_DB.aspx\", sps);\r\n}\r\n\r\nasync function ensurePagePerms(pageTitle, orgs) {\r\n  const ensurePageTask = addTask(taskDefs.ensurePagePermissions(pageTitle));\r\n  const pageResults = await appContext.Pages.FindByColumnValue(\r\n    [{ column: \"FileLeafRef\", value: pageTitle }],\r\n    {},\r\n    { count: 1, includePermissions: true }\r\n  );\r\n\r\n  const page = pageResults.results[0] ?? null;\r\n\r\n  if (!page) {\r\n    console.warn(\r\n      \"Unable to ensure page permissions. Page not found: \" + pageTitle,\r\n      orgs\r\n    );\r\n    finishTask(ensurePageTask);\r\n    return;\r\n  }\r\n\r\n  let reset = false;\r\n  if (!page.HasUniqueRoleAssignments) {\r\n    reset = true;\r\n  }\r\n\r\n  if (!reset) {\r\n    const principalIds = page.RoleAssignments.results.map(\r\n      (role) => role.PrincipalId\r\n    );\r\n\r\n    reset = orgs.find((org) => {\r\n      const orgId = org.UserGroup?.ID;\r\n      return !principalIds.includes(orgId);\r\n    })\r\n      ? true\r\n      : false;\r\n  }\r\n\r\n  if (reset) {\r\n    const resetPageTask = addTask(taskDefs.resetPagePermissions(pageTitle));\r\n    const { owners, members, visitors } = getSiteGroups();\r\n\r\n    const baseRoles = [\r\n      new Role({\r\n        principal: owners,\r\n        roleDefs: [new RoleDef({ name: roleNames.FullControl })],\r\n      }),\r\n      new Role({\r\n        principal: members,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n      }),\r\n      new Role({\r\n        principal: visitors,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n      }),\r\n    ];\r\n\r\n    const newRoles = orgs.map((org) => {\r\n      return new Role({\r\n        principal: org.UserGroup,\r\n        roleDefs: [{ name: roleNames.RestrictedRead }],\r\n      });\r\n    });\r\n\r\n    const newPerms = new ItemPermissions({\r\n      hasUniqueRoleAssignments: true,\r\n      roles: [...newRoles, ...baseRoles],\r\n    });\r\n\r\n    console.warn(\"Resetting Page Perms: \", pageTitle);\r\n    await appContext.Pages.SetItemPermissions(page, newPerms, true);\r\n    finishTask(resetPageTask);\r\n  }\r\n\r\n  finishTask(ensurePageTask);\r\n}\r\n\r\nfunction getPeopleByOrgRole(orgType) {\r\n  return auditOrganizationStore()\r\n    .filter((ao) => ao.Role == orgType && ao.UserGroup)\r\n    .map((ao) => new People(ao.UserGroup));\r\n}\r\n\r\nfunction ensureAllListPermissions() {\r\n  const { owners, members, visitors } = getSiteGroups();\r\n\r\n  const baseRoles = [\r\n    new Role({\r\n      principal: owners,\r\n      roleDefs: [new RoleDef({ name: roleNames.FullControl })],\r\n    }),\r\n    new Role({\r\n      principal: members,\r\n      roleDefs: [new RoleDef({ name: roleNames.Contribute })],\r\n    }),\r\n    new Role({\r\n      principal: visitors,\r\n      roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n    }),\r\n  ];\r\n\r\n  const qaRestrictedContributeRoles = getPeopleByOrgRole(\r\n    ORGROLES.QUALITYASSURANCE\r\n  ).map(\r\n    (principal) =>\r\n      new Role({\r\n        principal,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedContribute })],\r\n      })\r\n  );\r\n\r\n  const qaRestrictedReadRoles = getPeopleByOrgRole(\r\n    ORGROLES.QUALITYASSURANCE\r\n  ).map(\r\n    (principal) =>\r\n      new Role({\r\n        principal,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n      })\r\n  );\r\n\r\n  const roRestrictedReadRoles = getPeopleByOrgRole(\r\n    ORGROLES.REQUESTINGOFFICE\r\n  ).map(\r\n    (principal) =>\r\n      new Role({\r\n        principal,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n      })\r\n  );\r\n\r\n  const setPerms = [\r\n    {\r\n      entitySet: appContext.AuditBulkRequests,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: baseRoles,\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditBulkResponses,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: baseRoles,\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditResponseDocsRO,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: [...baseRoles, ...qaRestrictedContributeRoles],\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditRequests,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: baseRoles,\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditRequestsInternals,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: [...baseRoles, ...qaRestrictedReadRoles],\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditROEmailsLog,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: [...baseRoles, ...qaRestrictedContributeRoles],\r\n      }),\r\n    },\r\n  ];\r\n\r\n  setPerms.map(async (setPerm) => {\r\n    const ensureListTask = addTask(\r\n      taskDefs.ensureListPermissions(setPerm.entitySet)\r\n    );\r\n    await ensureEntitySetPerms(setPerm);\r\n    finishTask(ensureListTask);\r\n  });\r\n}\r\n\r\nasync function ensureEntitySetPerms({ entitySet, permissions }) {\r\n  const curPerms = await entitySet.GetRootPermissions();\r\n\r\n  if (!curPerms.hasUniqueRoleAssignments) {\r\n    await resetEntitySetPerms(\r\n      entitySet,\r\n      permissions,\r\n      true,\r\n      \"List Inherits Permissions\"\r\n    );\r\n\r\n    return;\r\n  }\r\n\r\n  // Otherwise, verify that all roles match\r\n  const missingPermission = permissions.roles.find((newRole) => {\r\n    const existingRole = curPerms.roles.find(\r\n      (curRole) => curRole.principal.ID == newRole.principal.ID\r\n    );\r\n    // If the principal doesn't have a role assignment\r\n    if (!existingRole) return true;\r\n\r\n    const curRoleDefNames = existingRole.roleDefs.map(\r\n      (roleDef) => roleDef.name\r\n    );\r\n\r\n    // Else, if we find a roleDef that isn't already set\r\n    return newRole.roleDefs.find(\r\n      (roleDef) => !curRoleDefNames.includes(roleDef.name)\r\n    );\r\n  });\r\n\r\n  if (!missingPermission) return;\r\n\r\n  await resetEntitySetPerms(entitySet, permissions, false, {\r\n    \"Missing Permissions\": missingPermission,\r\n  });\r\n}\r\n\r\nasync function resetEntitySetPerms(entitySet, permissions, reset, reason) {\r\n  const resetEntitySetPermsTask = addTask(\r\n    taskDefs.resetListPermissions(entitySet)\r\n  );\r\n  console.warn(\"Resetting EntitySet Permissions: \" + entitySet.ListDef.title, {\r\n    entitySet,\r\n    permissions,\r\n    reason,\r\n  });\r\n  await entitySet.SetRootPermissions(permissions, reset);\r\n  finishTask(resetEntitySetPermsTask);\r\n}\r\n", "const taskStates = {\r\n  pending: \"Pending\",\r\n  aging: \"Aging\",\r\n  completed: \"Completed\",\r\n};\r\n\r\nexport class Task {\r\n  constructor({ msg, blocking }) {\r\n    this.msg = msg;\r\n    this.blocking = blocking;\r\n    this.Status(taskStates.pending);\r\n  }\r\n\r\n  msg;\r\n  blocking;\r\n  Status = ko.observable();\r\n\r\n  timeout = window.setTimeout(() => {\r\n    console.warn(\"this task is aging:\", this);\r\n    this.Status(taskStates.aging);\r\n  }, 5000);\r\n\r\n  markComplete = () => {\r\n    window.clearTimeout(this.timeout);\r\n    this.Status(taskStates.completed);\r\n  };\r\n\r\n  // Should this task block user input?\r\n  IsBlocking = ko.pureComputed(\r\n    () => this.blocking && this.Status() != taskStates.completed\r\n  );\r\n}\r\n\r\nexport class ProgressTask {\r\n  constructor({ msg, blocking }) {\r\n    this.msg = msg;\r\n    this.blocking = blocking;\r\n    this.Status(taskStates.pending);\r\n  }\r\n\r\n  msg;\r\n  blocking;\r\n  Status = ko.observable();\r\n\r\n  updateProgress = ({ percentDone }) => {\r\n    this.Status(`${parseInt(percentDone * 100)}%`);\r\n  };\r\n\r\n  setTimeout = () =>\r\n    window.setTimeout(() => {\r\n      console.warn(\"this task is aging:\", this);\r\n      this.Status(`${this.Status()} (${taskStates.aging})`);\r\n    }, 50000);\r\n\r\n  resetTimeout = () => {\r\n    window.clearTimeout(this.timeout);\r\n    this.timeout = this.setTimeout();\r\n  };\r\n\r\n  timeout = this.setTimeout();\r\n\r\n  markComplete = () => {\r\n    window.clearTimeout(this.timeout);\r\n    this.Status(taskStates.completed);\r\n  };\r\n\r\n  // Should this task block user input?\r\n  IsBlocking = ko.pureComputed(\r\n    () => this.blocking && this.Status() != taskStates.completed\r\n  );\r\n\r\n  static Create(params) {\r\n    return new ProgressTask(params);\r\n  }\r\n}\r\n", "import { ProgressTask, Task } from \"../value_objects/task.js\";\r\nexport const runningTasks = ko.observableArray();\r\n\r\nexport const blockingTasks = ko.pureComputed(() => {\r\n  return runningTasks().filter((task) => task.IsBlocking()) ?? [];\r\n});\r\n\r\nexport class TaskDef {\r\n  constructor(msg, blocking = false, type = null) {\r\n    this.msg = msg;\r\n    this.blocking = blocking;\r\n    this.type = type;\r\n  }\r\n  msg;\r\n  blocking;\r\n  type;\r\n}\r\n\r\nexport const taskDefs = {\r\n  init: { msg: \"Initializing the Application\", blocking: true },\r\n  save: { msg: \"Saving Request\", blocking: true },\r\n  newRequest: { msg: \"Processing New Request\", blocking: true },\r\n  cancelAction: { msg: \"Cancelling Action\", blocking: true },\r\n  view: { msg: \"Viewing Request\", blocking: false },\r\n  refresh: { msg: \"Refreshing Request\", blocking: false },\r\n  permissionsRequest: {\r\n    msg: \"Updating Request Item Permissions\",\r\n    blocking: true,\r\n  },\r\n  permissionsResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Updating Response Item Permissions: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  permissionsResponseFolder: (responseTitle) => {\r\n    return {\r\n      msg: \"Updating Response Folder Item Permissions: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  permissionsResponseAndFolder: (responseTitle) => {\r\n    return {\r\n      msg: \"Updating Response and Folder Item Permissions: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  permissionsEmailFolder: {\r\n    msg: \"Updating Email Folder Permissions\",\r\n    blocking: true,\r\n  },\r\n  permissionsCoversheet: (coversheetName) => {\r\n    return {\r\n      msg: \"Updating Coversheet Permissions: \" + coversheetName,\r\n      blocking: true,\r\n    };\r\n  },\r\n  ensurePagePermissions: (page) =>\r\n    new TaskDef(\"Ensuring Page Permissions: \" + page),\r\n  resetPagePermissions: (page) =>\r\n    new TaskDef(\"Resetting Page Permissions: \" + page, true),\r\n  ensureListPermissions: (entitySet) =>\r\n    new TaskDef(\"Ensuring List Permissions: \" + entitySet.ListDef.title),\r\n  resetListPermissions: (entitySet) =>\r\n    new TaskDef(\"Resetting List Permissions: \" + entitySet.ListDef.title, true),\r\n  deleteEmailFolder: { msg: \"Deleting Email Folder\", blocking: true },\r\n  newResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Submitting new Response: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  updateResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Updating Response: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  deleteResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Deleting Response: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  closeResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Closing Response: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  uploadResponseDoc: (responseDocTitle) => {\r\n    return {\r\n      msg: \"Uploading Response Document: \" + responseDocTitle,\r\n      blocking: true,\r\n      type: ProgressTask,\r\n    };\r\n  },\r\n  updateResponseDoc: (responseDocTitle) => {\r\n    return {\r\n      msg: \"Updating Response Document: \" + responseDocTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  approveResponseDoc: (responseDocTitle) => {\r\n    return {\r\n      msg: \"Approving Response Document: \" + responseDocTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  deleteResponseDocFolder: (responseTitle) => {\r\n    return {\r\n      msg: \"Deleting Response Document Folder: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  uploadCoversheet: (coversheetName) => {\r\n    return {\r\n      msg: \"Uploading Coversheet: \" + coversheetName,\r\n      blocking: true,\r\n      type: ProgressTask,\r\n    };\r\n  },\r\n  updateCoversheet: (coversheetName) => {\r\n    return {\r\n      msg: \"Updating Coversheet: \" + coversheetName,\r\n      blocking: true,\r\n    };\r\n  },\r\n  deleteCoversheet: (coversheetName) => {\r\n    return {\r\n      msg: \"Deleting Coversheet: \" + coversheetName,\r\n      blocking: true,\r\n    };\r\n  },\r\n  deleteRequestInternalItem: {\r\n    msg: \"Deleting Request Internal Item\",\r\n    blocking: true,\r\n  },\r\n  newComment: { msg: \"Submitting Comment\", blocking: false },\r\n  refreshComments: { msg: \"Refreshing Comments\", blocking: false },\r\n  notifyComment: { msg: \"Sending Comment Email\", blocking: false },\r\n  removeComment: { msg: \"Removing Comment\", blocking: false },\r\n  newAction: { msg: \"Submitting Action\", blocking: false },\r\n  refreshActions: { msg: \"Refreshing Actions\", blocking: false },\r\n  newAttachment: { msg: \"Submitting Attachment\", blocking: false },\r\n  refreshAttachments: { msg: \"Refreshing Attachments\", blocking: false },\r\n  approve: { msg: \"Approving Request\", blocking: true },\r\n  lock: { msg: \"Locking Request\", blocking: true },\r\n  closing: { msg: \"Closing Request\", blocking: true },\r\n};\r\n\r\nexport const addTask = (taskDef) => {\r\n  let newTask;\r\n\r\n  if (taskDef.type) {\r\n    newTask = taskDef.type.Create(taskDef);\r\n  } else {\r\n    newTask = new Task(taskDef);\r\n  }\r\n\r\n  runningTasks.push(newTask);\r\n  return newTask;\r\n};\r\n\r\nexport const finishTask = function (activeTask) {\r\n  if (activeTask) {\r\n    activeTask.markComplete();\r\n    window.setTimeout(() => removeTask(activeTask), 3000);\r\n    // runningTasks.remove(activeTask);\r\n  }\r\n};\r\n\r\nconst removeTask = function (taskToRemove) {\r\n  runningTasks.remove(taskToRemove);\r\n};\r\n", "import { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport {\r\n  getPeopleByUsername,\r\n  getQAGroup,\r\n  getSiteGroups,\r\n} from \"./people_manager.js\";\r\nimport { roleNames } from \"./permission_manager.js\";\r\nimport { ItemPermissions } from \"../sal/infrastructure/index.js\";\r\nimport {\r\n  AuditResponseStates,\r\n  AuditRequest,\r\n  AuditRequestsInternal,\r\n} from \"../entities/index.js\";\r\nimport { People } from \"../sal/entities/index.js\";\r\nimport { addTask, finishTask, taskDefs } from \"./tasks.js\";\r\nimport { deleteRequestCoversheet } from \"./coversheet_manager.js\";\r\nimport { auditOrganizationStore } from \"../infrastructure/store.js\";\r\n\r\nexport async function getRequestById(id) {\r\n  return await appContext.AuditRequests.FindById(id);\r\n}\r\n\r\nexport async function getRequestByTitle(title) {\r\n  const requestResults = await appContext.AuditRequests.FindByColumnValue(\r\n    [{ column: \"Title\", value: title }],\r\n    {},\r\n    { count: 1 }\r\n  );\r\n\r\n  return requestResults.results[0] ?? null;\r\n}\r\n\r\nexport async function addNewRequest(request) {\r\n  const fields = request.FieldMap;\r\n\r\n  // See if we have a request with this title already\r\n  const existingRequests = await appContext.AuditRequests.FindByColumnValue(\r\n    [{ column: \"Title\", value: fields.Title.Value() }],\r\n    {},\r\n    { count: 1 }\r\n  );\r\n\r\n  // TODO: use addFieldRequirement?\r\n  if (existingRequests.results.length) {\r\n    throw new Error(\"Request with this name already exists!\");\r\n  }\r\n\r\n  request.FieldMap.EmailActionOffice.Value(\r\n    request.FieldMap.ActionOffice.Value()\r\n  );\r\n\r\n  await appContext.AuditRequests.AddEntity(request);\r\n\r\n  // This is handled by the IA_DB callback\r\n  // await onAddNewRequest(request);\r\n}\r\n\r\nexport async function updateRequest(request) {\r\n  await appContext.AuditRequests.UpdateEntity(\r\n    request,\r\n    AuditRequest.Views.IACanUpdate\r\n  );\r\n}\r\n\r\nexport async function deleteRequest(requestId) {\r\n  // Also delete related items:\r\n  // xCoversheets, Emails (Folder), xRequestInternal, xResponseDocs (Folder), xResponses\r\n  const request = await appContext.AuditRequests.FindById(requestId);\r\n  if (!request) {\r\n    alert(\"Could not find request: \", requestId);\r\n  }\r\n  const requestTitle = request.ReqNum.Value();\r\n  const promises = [];\r\n  // Delete Coversheets\r\n  const coversheets = await getRequestCoversheets(request);\r\n\r\n  coversheets.map((coversheet) => {\r\n    promises.push(deleteRequestCoversheet(coversheet));\r\n  });\r\n\r\n  // Delete email folder\r\n  promises.push(\r\n    new Promise(async (resolve) => {\r\n      const deleteItemTask = addTask(taskDefs.deleteEmailFolder);\r\n      await appContext.AuditEmails.RemoveFolderByPath(requestTitle);\r\n      finishTask(deleteItemTask);\r\n      resolve();\r\n    })\r\n  );\r\n\r\n  // Delete responses and responsedocs\r\n  const responses = await getRequestResponses(request);\r\n  responses.map((response) => {\r\n    promises.push(deleteResponseAndFolder(response));\r\n  });\r\n\r\n  // Delete the internal item\r\n  const requestInternalItem = await getRequestInternalItem(requestId);\r\n  if (requestInternalItem) {\r\n    promises.push(\r\n      new Promise(async (resolve) => {\r\n        const deleteItemTask = addTask(taskDefs.deleteRequestInternalItem);\r\n        await appContext.AuditRequestsInternals.RemoveEntityById(\r\n          requestInternalItem.ID\r\n        );\r\n        finishTask(deleteItemTask);\r\n        resolve();\r\n      })\r\n    );\r\n  }\r\n\r\n  await Promise.all(promises);\r\n  // Finally, delete the request\r\n  await appContext.AuditRequests.RemoveEntityById(requestId);\r\n  return true;\r\n}\r\n\r\nexport async function ensureRequestAuditResponseDocsROFolder(\r\n  reqNum,\r\n  requestingOfficeId\r\n) {\r\n  const roFolderResults =\r\n    await appContext.AuditResponseDocsRO.FindByColumnValue(\r\n      [{ column: \"FileLeafRef\", value: reqNum }],\r\n      {},\r\n      { count: 1, includeFolders: true }\r\n    );\r\n\r\n  const roFolder = roFolderResults.results[0] ?? null;\r\n\r\n  if (roFolder) return roFolder.FileRef;\r\n\r\n  const requestingOffice = auditOrganizationStore().find(\r\n    (ao) => ao.ID == requestingOfficeId\r\n  );\r\n\r\n  const newRoFolderId = await appContext.AuditResponseDocsRO.UpsertFolderPath(\r\n    reqNum\r\n  );\r\n  const { owners, members, visitors } = getSiteGroups();\r\n  const qaGroup = await getQAGroup();\r\n  const newPermissions = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  newPermissions.addPrincipalRole(owners, roleNames.FullControl);\r\n  newPermissions.addPrincipalRole(members, roleNames.Contribute);\r\n  newPermissions.addPrincipalRole(visitors, roleNames.RestrictedRead);\r\n  newPermissions.addPrincipalRole(qaGroup, roleNames.RestrictedContribute);\r\n  newPermissions.addPrincipalRole(\r\n    requestingOffice.UserGroup,\r\n    roleNames.RestrictedRead\r\n  );\r\n\r\n  await appContext.AuditResponseDocsRO.SetItemPermissions(\r\n    { ID: newRoFolderId },\r\n    newPermissions,\r\n    true\r\n  );\r\n\r\n  const newFolderEntity = await appContext.AuditResponseDocsRO.FindById(\r\n    newRoFolderId\r\n  );\r\n\r\n  return newFolderEntity.FileRef;\r\n}\r\n\r\n/* Begin Unreferenced Service Rewrites */\r\nexport async function onAddNewRequest(request) {\r\n  await Promise.all([\r\n    ensureRequestPermissions(request),\r\n    ensureAuditEmailFolder(request),\r\n    ensureRequestInternalItem(request),\r\n  ]);\r\n}\r\n\r\nasync function ensureAuditEmailFolder(request) {\r\n  const newFolderId = await appContext.AuditEmails.UpsertFolderPath(\r\n    request.ReqNum.Value()\r\n  );\r\n\r\n  const newItemPermissions = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  const { owners, members, visitors } = await getSiteGroups();\r\n  const qaGroup = await getPeopleByUsername(\r\n    Audit.Common.Utilities.GetGroupNameQA()\r\n  );\r\n\r\n  newItemPermissions.addPrincipalRole(owners, roleNames.FullControl);\r\n  newItemPermissions.addPrincipalRole(members, roleNames.RestrictedContribute);\r\n  newItemPermissions.addPrincipalRole(visitors, roleNames.RestrictedRead);\r\n\r\n  newItemPermissions.addPrincipalRole(qaGroup, roleNames.RestrictedContribute);\r\n\r\n  const actionOffices = request.FieldMap.ActionOffice.Value();\r\n\r\n  actionOffices.map((ao) => {\r\n    newItemPermissions.addPrincipalRole(\r\n      ao.UserGroup,\r\n      roleNames.RestrictedContribute\r\n    );\r\n  });\r\n\r\n  const result = await appContext.AuditEmails.SetItemPermissions(\r\n    { ID: newFolderId },\r\n    newItemPermissions,\r\n    true\r\n  );\r\n}\r\n\r\nasync function ensureRequestPermissions(request) {\r\n  const perms = await appContext.AuditRequests.GetItemPermissions(request);\r\n  if (!perms.hasUniqueRoleAssignments) {\r\n    if (window.DEBUG) console.log(\"Request does not have unique permissions\");\r\n    await breakRequestPermissions(request);\r\n  }\r\n}\r\n\r\nasync function ensureRequestInternalItem(request) {\r\n  const requestInternalResult = getRequestInternalItem(request);\r\n  if (requestInternalResult) return requestInternalResult;\r\n\r\n  const requestInternal = new AuditRequestsInternal();\r\n  requestInternal.ReqNum.Value(request);\r\n  await appContext.AuditRequestsInternals.AddEntity(requestInternal);\r\n  return requestInternal;\r\n}\r\n\r\nexport async function breakRequestPermissions(request, responseStatus) {\r\n  const curPerms = await appContext.AuditRequests.GetItemPermissions(request);\r\n\r\n  const defaultGroups = await getSiteGroups();\r\n\r\n  const qaGroup = await getPeopleByUsername(\r\n    Audit.Common.Utilities.GetGroupNameQA()\r\n  );\r\n\r\n  const qaHasRead = curPerms.principalHasPermissionKind(\r\n    qaGroup,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  const special1Group = await getPeopleByUsername(\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n  );\r\n  const special2Group = await getPeopleByUsername(\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n  );\r\n\r\n  const special1HasRead = curPerms.principalHasPermissionKind(\r\n    special1Group,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  const special2HasRead = curPerms.principalHasPermissionKind(\r\n    special2Group,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  const newRequestPermissions = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  newRequestPermissions.addPrincipalRole(\r\n    defaultGroups.owners,\r\n    roleNames.FullControl\r\n  );\r\n  newRequestPermissions.addPrincipalRole(\r\n    defaultGroups.members,\r\n    roleNames.Contribute\r\n  );\r\n  newRequestPermissions.addPrincipalRole(\r\n    defaultGroups.visitors,\r\n    roleNames.RestrictedRead\r\n  );\r\n\r\n  if (qaHasRead || responseStatus == AuditResponseStates.ApprovedForQA) {\r\n    newRequestPermissions.addPrincipalRole(qaGroup, roleNames.RestrictedRead);\r\n  }\r\n\r\n  if (special1HasRead) {\r\n    newRequestPermissions.addPrincipalRole(\r\n      special1Group,\r\n      roleNames.RestrictedRead\r\n    );\r\n  }\r\n\r\n  if (special2HasRead) {\r\n    newRequestPermissions.addPrincipalRole(\r\n      special2Group,\r\n      roleNames.RestrictedRead\r\n    );\r\n  }\r\n\r\n  const actionOffices = request.FieldMap.ActionOffice.Value();\r\n\r\n  actionOffices.map((ao) =>\r\n    newRequestPermissions.addPrincipalRole(\r\n      new People(ao.UserGroup),\r\n      roleNames.RestrictedRead\r\n    )\r\n  );\r\n\r\n  await appContext.AuditRequests.SetItemPermissions(\r\n    request,\r\n    newRequestPermissions,\r\n    true\r\n  );\r\n}\r\n\r\nexport async function getRequestInternalItem(request) {\r\n  const requestInternalResult =\r\n    await appContext.AuditRequestsInternals.FindByColumnValue(\r\n      [{ column: \"ReqNum\", op: \"eq\", value: request.ID }],\r\n      {},\r\n      {}\r\n    );\r\n\r\n  if (requestInternalResult.results.length) {\r\n    if (requestInternalResult.results.length > 1) {\r\n      //TODO: attempt to purge extra items\r\n      console.error(\r\n        requestInternalResult.results.length + \" internal items!\",\r\n        request\r\n      );\r\n    }\r\n    return requestInternalResult.results[0];\r\n  }\r\n  return;\r\n}\r\n\r\nexport async function getRequestCoversheets(request) {\r\n  const coversheetsResult = await appContext.AuditCoversheets.FindByColumnValue(\r\n    [{ column: \"ReqNum\", value: request.ID }],\r\n    {},\r\n    {}\r\n  );\r\n\r\n  return coversheetsResult.results;\r\n}\r\n\r\nexport async function getRequestResponses(request) {\r\n  const responsesResult = await appContext.AuditResponses.FindByColumnValue(\r\n    [{ column: \"ReqNum\", value: request.ID }],\r\n    {},\r\n    { includePermissions: true }\r\n  );\r\n\r\n  return responsesResult.results;\r\n}\r\n\r\nexport async function getRequestResponseDocs(request) {\r\n  const responsesResult = await appContext.AuditResponseDocs.FindByColumnValue(\r\n    [{ column: \"ReqNum\", value: request.ID }],\r\n    {},\r\n    { includePermissions: true }\r\n  );\r\n\r\n  return responsesResult.results;\r\n}\r\n\r\nexport async function getRequestResponseDocsFolders(responseTitle) {\r\n  const responsesResult = await appContext.AuditResponseDocs.FindByColumnValue(\r\n    [{ column: \"Title\", value: responseTitle }],\r\n    {},\r\n    { includeFolders: true },\r\n    [\"ID\", \"Title\"]\r\n  );\r\n\r\n  return responsesResult.results;\r\n}\r\n\r\n/* TO BE UPDATED */\r\n", "import { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport {\r\n  getSpecialPermGroups,\r\n  getSiteGroups,\r\n  getQAGroup,\r\n  getPeopleByUsername,\r\n} from \"./people_manager.js\";\r\nimport { ItemPermissions } from \"../sal/infrastructure/index.js\";\r\nimport { roleNames } from \"./permission_manager.js\";\r\nimport { People } from \"../sal/entities/index.js\";\r\nimport { AuditCoversheet } from \"../entities/index.js\";\r\nimport { getRequestCoversheets } from \"./audit_request_service.js\";\r\nimport { addTask, finishTask, taskDefs } from \"./tasks.js\";\r\n\r\nexport async function uploadRequestCoversheetFile(\r\n  file,\r\n  request,\r\n  actionOffices = []\r\n) {\r\n  let fileName = file.name;\r\n  const reqNum = request.ReqNum.Value();\r\n  if (!fileName.includes(reqNum)) fileName = reqNum + \"_\" + fileName;\r\n\r\n  const newFileName = getNewFileNameForSensitivity(\r\n    fileName,\r\n    null,\r\n    request.Sensitivity.Value()\r\n  );\r\n\r\n  const uploadCoversheetTask = addTask(taskDefs.uploadCoversheet(newFileName));\r\n  const title = newFileName.substring(0, newFileName.lastIndexOf(\".\"));\r\n\r\n  const fileMetadata = {\r\n    Title: title,\r\n    ReqNumId: request.ID,\r\n    ActionOfficeId: actionOffices.map((ao) => ao.ID),\r\n  };\r\n\r\n  const newCoversheet =\r\n    await appContext.AuditCoversheets.UploadFileToFolderAndUpdateMetadata(\r\n      file,\r\n      newFileName,\r\n      \"\",\r\n      fileMetadata,\r\n      ({ currentBlock, totalBlocks }) =>\r\n        uploadCoversheetTask.updateProgress({\r\n          percentDone: currentBlock / totalBlocks,\r\n        })\r\n    );\r\n\r\n  await breakCoversheetPermissions(newCoversheet);\r\n  finishTask(uploadCoversheetTask);\r\n  return newCoversheet;\r\n}\r\nexport async function deleteRequestCoversheetById(coversheetId) {\r\n  const coversheet = await appContext.AuditCoversheets.FindById(coversheetId);\r\n\r\n  return deleteRequestCoversheet(coversheet);\r\n}\r\nexport async function deleteRequestCoversheet(coversheet) {\r\n  const deleteItemTask = addTask(\r\n    taskDefs.deleteCoversheet(coversheet.FileName.toString())\r\n  );\r\n  await appContext.AuditCoversheets.RemoveEntityById(coversheet.ID);\r\n  finishTask(deleteItemTask);\r\n}\r\n\r\nexport async function updateRequestCoverSheet(coverSheet) {\r\n  const request = coverSheet.ReqNum.Value();\r\n\r\n  if (!request) throw new Error(\"ReqNum not set!\");\r\n  const updateCoversheetTask = addTask(\r\n    taskDefs.updateCoversheet(coverSheet.FileName.Value())\r\n  );\r\n  let fileName = coverSheet.FileName.Value();\r\n\r\n  if (!fileName.includes(request.ReqNum.Value())) {\r\n    fileName = request.ReqNum.Value() + \"_\" + fileName;\r\n    coverSheet.FileName.Value(fileName);\r\n  }\r\n\r\n  await appContext.AuditCoversheets.UpdateEntity(\r\n    coverSheet,\r\n    AuditCoversheet.Views.AOCanUpdate\r\n  );\r\n\r\n  finishTask(updateCoversheetTask);\r\n}\r\n\r\nexport async function breakRequestCoversheetPerms(request, grantQARead) {\r\n  const coversheets = await getRequestCoversheets(request);\r\n\r\n  await Promise.all(\r\n    coversheets.map((coversheet) =>\r\n      breakCoversheetPermissions(coversheet, grantQARead)\r\n    )\r\n  );\r\n}\r\n\r\nfunction getNewFileNameForSensitivity(\r\n  fileName,\r\n  oldSensitivity,\r\n  requestSensitivity\r\n) {\r\n  let newFileName = \"\";\r\n  var curDocFileNameAndExt = fileName;\r\n  var curDocFileName = curDocFileNameAndExt.substring(\r\n    0,\r\n    curDocFileNameAndExt.lastIndexOf(\".\")\r\n  );\r\n  var curDocExt = curDocFileNameAndExt.replace(curDocFileName, \"\");\r\n\r\n  newFileName = curDocFileName;\r\n  if (oldSensitivity != null && oldSensitivity != \"\") {\r\n    if (curDocFileName.endsWith(\"_\" + oldSensitivity)) {\r\n      newFileName = newFileName.replace(\"_\" + oldSensitivity, \"\");\r\n    }\r\n  }\r\n  if (\r\n    requestSensitivity != null &&\r\n    requestSensitivity != \"\" &&\r\n    requestSensitivity != \"None\"\r\n  ) {\r\n    if (!curDocFileName.endsWith(\"_\" + requestSensitivity))\r\n      newFileName = newFileName + \"_\" + requestSensitivity;\r\n  }\r\n\r\n  return newFileName + curDocExt;\r\n}\r\n\r\nasync function breakCoversheetPermissions(coversheet, grantQARead) {\r\n  const breakCoversheetPermsTask = addTask(\r\n    taskDefs.permissionsCoversheet(coversheet.FileName.Value())\r\n  );\r\n  const curPerms = await appContext.AuditCoversheets.GetItemPermissions(\r\n    coversheet\r\n  );\r\n\r\n  const defaultGroups = await getSiteGroups();\r\n\r\n  const qaGroup = await getQAGroup();\r\n\r\n  let qaHasRead = curPerms.principalHasPermissionKind(\r\n    qaGroup,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  const { specialPermGroup1, specialPermGroup2 } = await getSpecialPermGroups();\r\n\r\n  let special1HasRead = curPerms.principalHasPermissionKind(\r\n    specialPermGroup1,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  let special2HasRead = curPerms.principalHasPermissionKind(\r\n    specialPermGroup2,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  if (!curPerms.hasUniqueRoleAssignments) {\r\n    special1HasRead = false;\r\n    special2HasRead = false;\r\n    qaHasRead = false;\r\n  }\r\n\r\n  const newPerms = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  newPerms.addPrincipalRole(defaultGroups.owners, roleNames.FullControl);\r\n  newPerms.addPrincipalRole(defaultGroups.members, roleNames.Contribute);\r\n  newPerms.addPrincipalRole(defaultGroups.visitors, roleNames.RestrictedRead);\r\n\r\n  if (qaHasRead || grantQARead) {\r\n    newPerms.addPrincipalRole(qaGroup, roleNames.RestrictedRead);\r\n  }\r\n\r\n  if (special1HasRead) {\r\n    newPerms.addPrincipalRole(specialPermGroup1, roleNames.RestrictedRead);\r\n  }\r\n\r\n  if (special2HasRead) {\r\n    newPerms.addPrincipalRole(specialPermGroup2, roleNames.RestrictedRead);\r\n  }\r\n\r\n  const actionOffices = coversheet.ActionOffice.Value();\r\n\r\n  actionOffices.map((ao) =>\r\n    newPerms.addPrincipalRole(\r\n      new People(ao.UserGroup),\r\n      roleNames.RestrictedRead\r\n    )\r\n  );\r\n\r\n  await appContext.AuditCoversheets.SetItemPermissions(\r\n    coversheet,\r\n    newPerms,\r\n    true\r\n  );\r\n  finishTask(breakCoversheetPermsTask);\r\n}\r\n", "import {\r\n  AuditResponse,\r\n  AuditResponseStates,\r\n  AuditResponseDoc,\r\n  AuditResponseDocStates,\r\n} from \"../entities/index.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport { showModal } from \"../sal/components/modal/index.js\";\r\n\r\nimport {\r\n  breakRequestPermissions,\r\n  getRequestById,\r\n  getRequestResponseDocs,\r\n  getRequestResponses,\r\n} from \"./audit_request_service.js\";\r\nimport { breakRequestCoversheetPerms } from \"./coversheet_manager.js\";\r\nimport { addTask, finishTask, taskDefs } from \"./tasks.js\";\r\n\r\nexport async function showBulkAddResponseModal(request) {\r\n  const options = {\r\n    title: \"Bulk Add Responses (\" + request.ReqNum.Value() + \")\",\r\n    height: 800,\r\n    url:\r\n      Audit.Common.Utilities.GetSiteUrl() +\r\n      \"/pages/AuditBulkAddResponse.aspx?ReqNum=\" +\r\n      request.ReqNum.Value(),\r\n  };\r\n\r\n  await showModal(options);\r\n}\r\n\r\nexport async function addResponse(request, response) {\r\n  const responseTitle = getResponseTitle(request, response);\r\n  const newResponseTask = addTask(taskDefs.newResponse(responseTitle));\r\n  // Update title\r\n\r\n  response.Title.Value(responseTitle);\r\n\r\n  response.ResStatus.Value(AuditResponseStates.Open);\r\n\r\n  try {\r\n    // Validate title is unique\r\n    const responseResult = await appContext.AuditResponses.FindByColumnValue(\r\n      [\r\n        {\r\n          column: \"Title\",\r\n          value: responseTitle,\r\n        },\r\n      ],\r\n      {},\r\n      { count: 1 }\r\n    );\r\n\r\n    if (responseResult.results.length) {\r\n      throw new Error(`Response with title ${responseTitle} already exists!`);\r\n    }\r\n\r\n    await appContext.AuditResponses.AddEntity(response);\r\n  } catch (e) {\r\n    console.error(\"Error adding Response: \", e);\r\n    alert(e.message);\r\n  } finally {\r\n    finishTask(newResponseTask);\r\n  }\r\n}\r\n\r\nexport async function updateResponse(request, response) {\r\n  const updateResponseTask = addTask(\r\n    taskDefs.updateResponse(response.Title.Value())\r\n  );\r\n\r\n  try {\r\n    // FPRA Check\r\n    const actionOfficeTitle =\r\n      response.ActionOffice.Value()?.Title?.toLowerCase();\r\n    if (!actionOfficeTitle.includes(\"fpra\")) {\r\n      if (response.POC.toString() || response.POCCC.toString()) {\r\n        throw new Error(\r\n          \"Only FPRA Responses can have designated POC and POC CC fields.\"\r\n        );\r\n      }\r\n    }\r\n\r\n    // Sensitivity Check\r\n    const currentResponseSensitivity = request.Sensitivity.Value();\r\n    const selectedResponseStatus = response.ResStatus.Value();\r\n\r\n    if (\r\n      selectedResponseStatus == AuditResponseStates.ApprovedForQA &&\r\n      currentResponseSensitivity == \"None\"\r\n    ) {\r\n      throw new Error(\"Request Sensitivity not set; cannot submit to QA.\");\r\n    }\r\n\r\n    const responseTitle = getResponseTitle(request, response);\r\n\r\n    if (response.Title.Value() != responseTitle)\r\n      response.Title.Value(responseTitle);\r\n\r\n    await appContext.AuditResponses.UpdateEntity(\r\n      response,\r\n      AuditResponse.Views.IACanUpdate\r\n    );\r\n  } catch (e) {\r\n    console.error(\"Error Updating Response: \", e);\r\n    alert(e.message);\r\n  } finally {\r\n    finishTask(updateResponseTask);\r\n  }\r\n}\r\n\r\nexport async function deleteResponseAndFolder(response) {\r\n  // Find the Response Folder\r\n  const responseTitle = response.Title.Value();\r\n\r\n  const deleteFolderTask = addTask(\r\n    taskDefs.deleteResponseDocFolder(responseTitle)\r\n  );\r\n  await appContext.AuditResponseDocs.RemoveFolderByPath(responseTitle);\r\n  finishTask(deleteFolderTask);\r\n\r\n  const deleteItemTask = addTask(taskDefs.deleteResponse(responseTitle));\r\n  await appContext.AuditResponses.RemoveEntityById(response.ID);\r\n  finishTask(deleteItemTask);\r\n  return;\r\n}\r\n\r\nexport async function updateResponseDoc(request, response, responseDoc) {\r\n  const updateResponseDocTask = addTask(\r\n    taskDefs.updateResponseDoc(responseDoc.Title.Value())\r\n  );\r\n\r\n  await appContext.AuditResponseDocs.UpdateEntity(\r\n    responseDoc,\r\n    AuditResponseDoc.Views.AOCanUpdate\r\n  );\r\n\r\n  finishTask(updateResponseDocTask);\r\n}\r\n\r\nexport async function getResponsesReadyToClose(requestId) {\r\n  const allRequestResponseDocs = await getRequestResponseDocs(request);\r\n\r\n  const allRequestResponses = await getRequestResponses(request);\r\n\r\n  return allRequestResponses.filter((response) =>\r\n    isResponseReadyToClose(response, allRequestResponseDocs)\r\n  );\r\n}\r\n\r\nasync function isResponseReadyToClose(response, responseDocs) {\r\n  const openResponseDocs = responseDocs.filter(\r\n    (responseDoc) =>\r\n      responseDoc.ResID.ID == response.ID &&\r\n      [AuditResponseDocStates.Open, AuditResponseDocStates.Submitted].includes(\r\n        responseDoc.DocumentStatus.Value()\r\n      )\r\n  );\r\n\r\n  return openResponseDocs.length;\r\n}\r\n\r\nexport async function closeResponseById(responseId) {\r\n  const response = await appContext.AuditResponses.FindById(responseId);\r\n  // TODO: Use Result\r\n  if (!response) return;\r\n  return closeResponse(response);\r\n}\r\n\r\nasync function closeResponse(response) {\r\n  const closeResponseTask = addTask(\r\n    taskDefs.closeResponse(response.Title.Value())\r\n  );\r\n\r\n  response.markClosed();\r\n  await appContext.AuditResponses.UpdateEntity(\r\n    response,\r\n    AuditResponse.Views.IAUpdateClosed\r\n  );\r\n\r\n  finishTask(closeResponseTask);\r\n}\r\n\r\nexport async function uploadResponseDocFile(response, file) {\r\n  const uploadResponseDocTask = addTask(taskDefs.uploadResponseDoc(file.name));\r\n  const fileMetadata = {\r\n    Title: file.name,\r\n    ReqNumId: response.ReqNum.Value().ID,\r\n    ResIDId: response.ID,\r\n  };\r\n\r\n  await appContext.AuditResponseDocs.UploadFileToFolderAndUpdateMetadata(\r\n    file,\r\n    file.name,\r\n    response.Title.Value(),\r\n    fileMetadata,\r\n    ({ currentBlock, totalBlocks }) =>\r\n      uploadResponseDocTask.updateProgress({\r\n        percentDone: currentBlock / totalBlocks,\r\n      })\r\n  );\r\n  finishTask(uploadResponseDocTask);\r\n}\r\n\r\nfunction getResponseTitle(request, response) {\r\n  return `${request.ReqNum.Value()}-${\r\n    response.ActionOffice.Value()?.Title\r\n  }-${response.SampleNumber.Value()}`;\r\n}\r\n\r\n/* Begin Unreferenced Service Rewrites */\r\n\r\nexport function getNewResponseDocTitle(request, response, responseDoc) {\r\n  const oldResponseDocTitle = responseDoc.FileName.Value();\r\n\r\n  const createdDate = responseDoc.Created.Value().format(\"yyyyMMddTHHmmss\");\r\n  const responseName = response.Title.Value();\r\n  const sensitivity = request.Sensitivity.Value();\r\n\r\n  let newResponseDocTitle =\r\n    responseName + \"_\" + createdDate + \"_\" + Math.ceil(Math.random() * 10000);\r\n\r\n  if (sensitivity && sensitivity != \"None\")\r\n    newResponseDocTitle += \"_\" + sensitivity;\r\n\r\n  var docName = oldResponseDocTitle.substring(\r\n    0,\r\n    oldResponseDocTitle.lastIndexOf(\".\")\r\n  );\r\n  var docExt = oldResponseDocTitle.replace(docName, \"\");\r\n  newResponseDocTitle += docExt;\r\n\r\n  // Only use the new filename if it's not already encoded\r\n  if (\r\n    !oldResponseDocTitle.includes(responseName) ||\r\n    !oldResponseDocTitle.includes(createdDate) ||\r\n    (sensitivity && !oldResponseDocTitle.includes(sensitivity))\r\n  )\r\n    return newResponseDocTitle;\r\n\r\n  return oldResponseDocTitle;\r\n}\r\n", "export * from \"./approvals_service.js\";\r\nexport * from \"./audit_email_service.js\";\r\nexport * from \"./audit_request_service.js\";\r\nexport * from \"./audit_response_service.js\";\r\nexport * from \"./coversheet_manager.js\";\r\nexport * from \"./people_manager.js\";\r\nexport * from \"./permission_manager.js\";\r\nexport * from \"./tasks.js\";\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const newRequestFormTemplate = html`\r\n  <div class=\"audit-form bg-dark new-request-form\">\r\n    <div class=\"form-fields\" data-bind=\"foreach: FormFields\">\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: \r\n        {name: components.edit, params: $data}, \r\n        class: classList\"\r\n      ></div>\r\n    </div>\r\n    <div class=\"form-actions\">\r\n      <button type=\"button\" class=\"btn btn-warn\" data-bind=\"click: clearForm\">\r\n        Clear Form\r\n      </button>\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-success\"\r\n        data-bind=\"click: clickSubmit\"\r\n      >\r\n        Create Request\r\n      </button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { appContext } from \"../../infrastructure/application_db_context.js\";\r\nimport {\r\n  directRegisterComponent,\r\n  registerComponent,\r\n} from \"../../sal/infrastructure/index.js\";\r\n\r\nimport * as ModalDialog from \"../../sal/components/modal/index.js\";\r\n\r\nimport {\r\n  deleteRequestCoversheetById,\r\n  uploadRequestCoversheetFile,\r\n} from \"../../services/coversheet_manager.js\";\r\nimport {\r\n  getRequestById,\r\n  getRequestByTitle,\r\n} from \"../../services/audit_request_service.js\";\r\nimport {\r\n  closeResponseById,\r\n  deleteResponseAndFolder,\r\n  uploadResponseDocFile,\r\n} from \"../../services/audit_response_service.js\";\r\nimport { Tab, TabsModule } from \"../tabs/tabs_module.js\";\r\nimport { getUrlParam } from \"../../common/router.js\";\r\n\r\nimport {\r\n  AUDITREQUESTSTATES,\r\n  AuditResponseStates,\r\n  AuditResponseDocStates,\r\n  AUDITREQUESTTYPES,\r\n} from \"../../entities/index.js\";\r\n\r\nimport { m_fnRefreshData } from \"../../pages/ia_db/ia_db.js\";\r\nimport { ConfirmApproveResponseDocForm } from \"../forms/response_doc/confirm_approve/confirm_approve_response_doc_form.js\";\r\nimport { ConfirmRejectResponseDocForm } from \"../forms/response_doc/confirm_reject/confirm_reject_response_doc_form.js\";\r\nimport { ConfirmDeleteRequestForm } from \"../forms/request/confirm_delete/confirm_delete_request_form.js\";\r\n\r\nimport { requestDetailViewTemplate } from \"./RequestDetailViewTemplate.js\";\r\nimport { requestDetailCoversheetsTabTemplate } from \"./RequestDetailCoversheetsTabTemplate.js\";\r\nimport { requestDetailResponsesTabTemplate } from \"./RequestDetailResponsesTabTemplate.js\";\r\nimport { requestDetailResponseDocsTabTemplate } from \"./RequestDetailResponseDocsTabTemplate.js\";\r\n\r\nconst componentName = \"component-request-detail-view\";\r\n\r\nconst requestDetailUrlParamKey = \"request-detail-tab\";\r\n\r\nexport class RequestDetailView {\r\n  constructor({\r\n    bDisplayClose,\r\n    currentRequest,\r\n    arrCurrentRequestCoverSheets,\r\n    // arrCurrentRequestResponses,\r\n    // cntResponseDocs,\r\n    // arrCurrentRequestResponseDocs,\r\n    ModalDialog,\r\n    ClickEditCoversheet,\r\n  }) {\r\n    // this.report = args;\r\n    this.bDisplayClose = bDisplayClose; // This can be converted to an observable\r\n    this.currentRequest = currentRequest;\r\n    this.arrCurrentRequestCoverSheets = arrCurrentRequestCoverSheets;\r\n    // this.arrCurrentRequestResponses = arrCurrentRequestResponses;\r\n    // this.cntResponseDocs = cntResponseDocs;\r\n    // this.arrCurrentRequestResponseDocs = arrCurrentRequestResponseDocs;\r\n\r\n    this.editCoversheet = ClickEditCoversheet;\r\n\r\n    this.ModalDialog = ModalDialog;\r\n\r\n    this.showCollapsed.subscribe(this.showCollapseToggledHandler);\r\n    this.coverSheetFiles.subscribeAdded(this.onCoverSheetFileAttachedHandler);\r\n\r\n    this.tabs = new TabsModule(\r\n      Object.values(this.tabOpts),\r\n      requestDetailUrlParamKey\r\n    );\r\n\r\n    this.setInitialTab();\r\n    this.currentRequest.subscribe(this.onRequestChangeHandler);\r\n  }\r\n\r\n  request = ko.observable();\r\n\r\n  onRequestChangeHandler = async (newRequest) => {\r\n    if (!newRequest || !newRequest.ID) return;\r\n    if (newRequest.ID == ko.unwrap(this.request)?.ID) return;\r\n\r\n    const request = await getRequestById(newRequest.ID);\r\n    this.request(request);\r\n  };\r\n\r\n  // Fields\r\n  componentName = componentName;\r\n  params = this;\r\n  tabOpts = {\r\n    Coversheets: new Tab(\"coversheets\", \"Coversheets\", {\r\n      id: \"requestDetailCoversheetsTabTemplate\",\r\n      data: this,\r\n    }),\r\n    Responses: new Tab(\"responses\", \"Responses\", {\r\n      id: \"requestDetailResponsesTabTemplate\",\r\n      data: this,\r\n    }),\r\n    ResponseDocs: new Tab(\"response-docs\", \"Response Docs\", {\r\n      id: \"requestDetailResponseDocsTabTemplate\",\r\n      data: this,\r\n    }),\r\n  };\r\n  checkResponseDoc = true;\r\n\r\n  // Observables\r\n  coverSheetFiles = ko.observableArray();\r\n  showCollapsed = ko.observable(false);\r\n\r\n  // Computed Observables\r\n  currentRequestResponseItems = ko.pureComputed(() => {\r\n    const request = ko.unwrap(this.currentRequest);\r\n    return (\r\n      request?.responses.map(\r\n        (response) => new ResponseItem(request, response, this)\r\n      ) ?? []\r\n    );\r\n  });\r\n\r\n  currentRequestResponsesReadyToClose = ko.pureComputed(() => {\r\n    if (this.currentRequest()?.reqType != AUDITREQUESTTYPES.TASKER) return [];\r\n    return this.currentRequestResponseItems().filter((response) =>\r\n      response.isReadyToClose()\r\n    );\r\n  });\r\n\r\n  currentRequestResponseDocs = ko.pureComputed(() => {\r\n    const request = ko.unwrap(this.currentRequest);\r\n    const responseSummaries =\r\n      request?.responses.map(\r\n        (response) => new ResponseDocSummary(request, response)\r\n      ) ?? [];\r\n    return responseSummaries;\r\n  });\r\n\r\n  cntResponseDocs = ko.pureComputed(() => {\r\n    const cnt = this.currentRequestResponseDocs().reduce(\r\n      (cnt, responseSummary) => cnt + responseSummary.responseDocs.length,\r\n      0\r\n    );\r\n    return cnt;\r\n  });\r\n\r\n  showResponseActions = ko.pureComputed(() => {\r\n    return [AUDITREQUESTSTATES.OPEN, AUDITREQUESTSTATES.REOPENED].includes(\r\n      this.currentRequest()?.status\r\n    );\r\n  });\r\n\r\n  // Subscriptions\r\n  showCollapseToggledHandler = (collapse) => {\r\n    this.currentRequestResponseDocs().map((responseDocSummary) =>\r\n      responseDocSummary.collapsed(collapse)\r\n    );\r\n  };\r\n\r\n  // Behaviors\r\n  setInitialTab() {\r\n    if (getUrlParam(requestDetailUrlParamKey)) {\r\n      this.tabs.selectById(getUrlParam(requestDetailUrlParamKey));\r\n      return;\r\n    }\r\n\r\n    const defaultTab = this.currentRequest()?.EmailSent.Value()\r\n      ? this.tabOpts.Responses\r\n      : this.tabOpts.Coversheets;\r\n\r\n    this.tabs.selectTab(defaultTab);\r\n  }\r\n\r\n  ClickViewRequestHistory = () => {\r\n    appContext.AuditRequests.ListRef.showVersionHistoryModal(\r\n      this.currentRequest()?.ID\r\n    );\r\n  };\r\n\r\n  ClickDeleteRequest = async () => {\r\n    const request = this.currentRequest();\r\n\r\n    if (request.emailSent) {\r\n      alert(\"Email has been sent, cannot delete request.\");\r\n      return;\r\n    }\r\n\r\n    const newConfirmDeleteForm = new ConfirmDeleteRequestForm(request);\r\n\r\n    const options = {\r\n      form: newConfirmDeleteForm,\r\n      dialogReturnValueCallback: this.OnCallBackDeleteRequest.bind(this),\r\n      title: \"Delete Request?\",\r\n    };\r\n\r\n    ModalDialog.showModalDialog(options);\r\n  };\r\n\r\n  // collapseResponseDocs = (collapse) =>\r\n\r\n  // Need to wrap this this m_fnRefreshData optionally takes a requestId param\r\n  refreshRequest = async () => {\r\n    m_fnRefreshData();\r\n    const reqId = ko.unwrap(this.request)?.ID;\r\n    if (!reqId) return;\r\n    const request = await getRequestById(reqId);\r\n    this.request(request);\r\n  };\r\n\r\n  // Coversheets\r\n  onCoverSheetFileAttachedHandler = async (newFiles) => {\r\n    if (!newFiles.length) return;\r\n    const request = await appContext.AuditRequests.FindById(\r\n      this.currentRequest().ID\r\n    );\r\n\r\n    // Only allow 1 coversheet at a time\r\n    const file = newFiles[0];\r\n    const coversheet = await uploadRequestCoversheetFile(file, request);\r\n    this.coverSheetFiles([]);\r\n    this.editCoversheet({ ID: coversheet.ID });\r\n  };\r\n\r\n  ClickDeleteCoversheet = async (coversheet) => {\r\n    if (confirm(\"Delete coversheet: \" + coversheet.title)) {\r\n      await deleteRequestCoversheetById(coversheet.ID);\r\n      this.refreshRequest();\r\n    }\r\n  };\r\n  // Responses\r\n  clickCloseReadyResponses = async () => {\r\n    await Promise.all(\r\n      this.currentRequestResponsesReadyToClose().map((response) =>\r\n        response.closeResponse()\r\n      )\r\n    );\r\n\r\n    this.refreshRequest();\r\n  };\r\n\r\n  viewResponseDocs = (response) => {\r\n    this.tabs.selectTab(this.tabOpts.ResponseDocs);\r\n    // Manually invoke the handler so we don't have to wait for the sub\r\n    this.showCollapsed(true);\r\n    this.showCollapsed.valueHasMutated();\r\n\r\n    // this.showCollapseToggledHandler(true);\r\n    const responseDocsSummary = this.currentRequestResponseDocs().find(\r\n      (responseDocsSummary) =>\r\n        responseDocsSummary.responseTitle == response.title\r\n    );\r\n\r\n    if (!responseDocsSummary) return;\r\n    responseDocsSummary.collapsed(false);\r\n    responseDocsSummary.highlightResponse();\r\n  };\r\n\r\n  highlightResponse = (responseTitle) => {\r\n    this.tabs.selectTab(this.tabOpts.Responses);\r\n    this.currentRequestResponseItems()\r\n      .find((response) => response.title == responseTitle)\r\n      ?.highlightResponse();\r\n  };\r\n\r\n  // ResponseDocs\r\n  clickHelpResponseDocs = () => {\r\n    var helpDlg =\r\n      \"<div id='helpDlg' style='padding:20px; height:100px; width:700px'>\" +\r\n      \"<div style='padding:20px;'><fieldset><legend>Response Document Status</legend> <ul style='padding-top:10px;'>\" +\r\n      \"<li style='padding-top:5px;'><b>Open</b> - Uploaded by the Action Office but not yet submitted to the Internal Auditor</li>\" +\r\n      \"<li style='padding-top:5px;'><b>Submitted</b> - Submitted to the Internal Auditor by the Action Office</li>\" +\r\n      \"<li style='padding-top:5px;'><b>Sent to QA</b> - Submitted to the Quality Assurance team by the Internal Auditor</li>\" +\r\n      \"<li style='padding-top:5px;'><b>Approved</b> - Approved by the Quality Assurance team and submitted to the External Auditor</li>\" +\r\n      \"<li style='padding-top:5px;'><b>Rejected</b> - Rejected by the Quality Assurance team and returned to the Internal Auditor</li>\" +\r\n      \"<li style='padding-top:5px;'><b>Archived</b> - Previously Rejected by the Quality Assurance team and is now read-only for record keeping</li>\" +\r\n      \"</ul></fieldset></div>\" +\r\n      \"<table style='padding-top:10px; width:200px; float:right;'>\" +\r\n      \"<tr><td class='ms-separator'>&#160;</td><td><input id='btnCancel' type='button' class='ms-ButtonHeightWidth' value='Close' title='Close Help' onclick='SP.UI.ModalDialog.commonModalDialogClose(SP.UI.DialogResult.cancel)'/></td></tr>\" +\r\n      \"</table></div>\";\r\n\r\n    $(\"body\").append(helpDlg);\r\n\r\n    var options = SP.UI.$create_DialogOptions();\r\n    options.title = \"Response Documents Help\";\r\n    options.height = 300;\r\n    // options.dialogReturnValueCallback = OnCallbackForm;\r\n    options.html = document.getElementById(\"helpDlg\");\r\n    SP.UI.ModalDialog.showModalDialog(options);\r\n  };\r\n\r\n  ClickBulkApprove = (responseDocSummary) => {\r\n    const oResponseDocsForApproval = responseDocSummary.responseDocs.filter(\r\n      (responseDoc) =>\r\n        this.responseDocCanBeApproved(responseDocSummary, responseDoc)\r\n    );\r\n    const request = this.currentRequest();\r\n\r\n    const newResponseDocForm = new ConfirmApproveResponseDocForm(\r\n      request,\r\n      null,\r\n      oResponseDocsForApproval\r\n    );\r\n\r\n    const options = {\r\n      form: newResponseDocForm,\r\n      dialogReturnValueCallback: this.OnCallBackApproveResponseDoc.bind(this),\r\n      title: \"Approve Response Docs?\",\r\n    };\r\n\r\n    ModalDialog.showModalDialog(options);\r\n  };\r\n\r\n  ClickApproveResponseDoc = (oResponseDoc) => {\r\n    const request = this.currentRequest();\r\n\r\n    const newResponseDocForm = new ConfirmApproveResponseDocForm(\r\n      request,\r\n      null,\r\n      [oResponseDoc]\r\n    );\r\n\r\n    const options = {\r\n      form: newResponseDocForm,\r\n      dialogReturnValueCallback: this.OnCallBackApproveResponseDoc.bind(this),\r\n      title: \"Approve Response Doc?\",\r\n    };\r\n\r\n    ModalDialog.showModalDialog(options);\r\n  };\r\n\r\n  CheckResponseDocs = () => {\r\n    const allDocs = this.currentRequestResponseDocs()\r\n      .filter(\r\n        (responseDocSummary) =>\r\n          responseDocSummary.responseStatus == \"2-Submitted\"\r\n      )\r\n      .flatMap((responseDocSummary) => {\r\n        return responseDocSummary.responseDocs;\r\n      })\r\n      .filter((responseDoc) => responseDoc.documentStatus == \"Submitted\")\r\n      .map((responseDoc) =>\r\n        responseDoc.chkApproveResDoc(this.checkResponseDoc)\r\n      );\r\n\r\n    this.checkResponseDoc = !this.checkResponseDoc;\r\n  };\r\n\r\n  ApproveCheckedResponseDocs = () => {\r\n    const allDocs = this.currentRequestResponseDocs()\r\n      .flatMap((responseDocSummary) => {\r\n        return responseDocSummary.responseDocs;\r\n      })\r\n      .filter((responseDoc) => responseDoc.chkApproveResDoc());\r\n\r\n    const request = this.currentRequest();\r\n\r\n    const newResponseDocForm = new ConfirmApproveResponseDocForm(\r\n      request,\r\n      null,\r\n      allDocs\r\n    );\r\n\r\n    const options = {\r\n      form: newResponseDocForm,\r\n      dialogReturnValueCallback: this.OnCallBackApproveResponseDoc.bind(this),\r\n      title: \"Approve Response Docs?\",\r\n    };\r\n\r\n    ModalDialog.showModalDialog(options);\r\n  };\r\n\r\n  responseDocCanBeApproved = (responseDocSummary, responseDoc) => {\r\n    return (\r\n      responseDoc.documentStatus == AuditResponseDocStates.Submitted &&\r\n      (responseDocSummary.responseStatus == AuditResponseStates.Submitted ||\r\n        responseDocSummary.responseStatus ==\r\n          AuditResponseStates.ApprovedForQA) &&\r\n      (responseDocSummary.requestStatus == AUDITREQUESTSTATES.OPEN ||\r\n        responseDocSummary.requestStatus == AUDITREQUESTSTATES.REOPENED)\r\n    );\r\n  };\r\n\r\n  async OnCallBackApproveResponseDoc(result) {\r\n    if (result) {\r\n      // Update is handled in the form, just need to refresh page/data\r\n      await this.refreshRequest();\r\n    }\r\n  }\r\n\r\n  async OnCallBackDeleteRequest(result) {\r\n    if (result) {\r\n      alert(\"request deleted!\");\r\n      // Todo: Hard reload, clear window params\r\n      Audit.Common.Utilities.Refresh(true);\r\n    }\r\n  }\r\n\r\n  ClickRejectResponseDoc = (oResponseDoc) => {\r\n    const request = this.currentRequest();\r\n\r\n    const newResponseDocForm = new ConfirmRejectResponseDocForm(request, null, [\r\n      oResponseDoc,\r\n    ]);\r\n\r\n    const options = {\r\n      form: newResponseDocForm,\r\n      dialogReturnValueCallback: this.OnCallbackRejectResponseDoc.bind(this),\r\n      title: \"Reject Response Doc?\",\r\n    };\r\n\r\n    ModalDialog.showModalDialog(options);\r\n  };\r\n\r\n  async OnCallbackRejectResponseDoc(result) {\r\n    if (!result) return;\r\n    this.refreshRequest();\r\n  }\r\n\r\n  ClickViewResponse = (responseDocSummary) => {\r\n    this.highlightResponse(responseDocSummary.responseTitle);\r\n  };\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: requestDetailViewTemplate,\r\n});\r\n\r\ndirectRegisterComponent(\"requestDetailCoversheetsTabTemplate\", {\r\n  template: requestDetailCoversheetsTabTemplate,\r\n});\r\n\r\ndirectRegisterComponent(\"requestDetailResponsesTabTemplate\", {\r\n  template: requestDetailResponsesTabTemplate,\r\n});\r\n\r\ndirectRegisterComponent(\"requestDetailResponseDocsTabTemplate\", {\r\n  template: requestDetailResponseDocsTabTemplate,\r\n});\r\n\r\n// registerComponentByPath({\r\n//   name: componentName,\r\n//   folder: \"request_detail_view\",\r\n//   template: \"RequestDetailViewTemplate\",\r\n// });\r\n\r\nclass ResponseItem {\r\n  constructor(request, response, report) {\r\n    Object.assign(this, response);\r\n    this.request = request;\r\n\r\n    this.refreshData = report.refreshRequest;\r\n\r\n    this.responseCoversheetFiles.subscribeAdded(\r\n      this.onCoversheetFilesAttachedHandler\r\n    );\r\n\r\n    this.responseDocFiles.subscribeAdded(\r\n      this.onResponseDocFilesAttachedHandler\r\n    );\r\n  }\r\n\r\n  highlight = ko.observable(false);\r\n\r\n  responseCoversheetFiles = ko.observableArray();\r\n  responseDocFiles = ko.observableArray();\r\n\r\n  isReadyToClose = () =>\r\n    this.request.reqType == AUDITREQUESTTYPES.TASKER &&\r\n    this.resStatus != AuditResponseStates.Closed &&\r\n    this.responseDocs.length &&\r\n    !this.responseDocs.find((responseDoc) =>\r\n      [AuditResponseDocStates.Open, AuditResponseDocStates.Submitted].includes(\r\n        responseDoc.documentStatus\r\n      )\r\n    );\r\n\r\n  clickCloseResponse = async () => {\r\n    await this.closeResponse();\r\n    this.refreshData();\r\n  };\r\n\r\n  closeResponse = () => {\r\n    return closeResponseById(this.ID);\r\n  };\r\n\r\n  ClickViewResponseHistory = () => {\r\n    appContext.AuditResponses.ListRef.showVersionHistoryModal(this.ID);\r\n  };\r\n\r\n  ClickDeleteResponse = async () => {\r\n    if (confirm(\"Delete Response: \" + this.title)) {\r\n      const response = await appContext.AuditResponses.FindById(this.ID);\r\n      await deleteResponseAndFolder(response);\r\n      this.refreshData();\r\n    }\r\n  };\r\n\r\n  onCoversheetFilesAttachedHandler = async (files) => {\r\n    if (!files.length) return;\r\n    const request = await getRequestByTitle(this.number);\r\n    // const response = await appContext.AuditResponses.FindById(this.ID);\r\n    const actionOfficeId = this.item.get_item(\"ActionOffice\")?.get_lookupId();\r\n    const actionOfficeIds = [];\r\n    if (actionOfficeId) {\r\n      actionOfficeIds.push({ ID: actionOfficeId });\r\n    }\r\n    const promises = [];\r\n\r\n    for (let file of files) {\r\n      promises.push(\r\n        new Promise(async (resolve) => {\r\n          const newSheet = await uploadRequestCoversheetFile(\r\n            file,\r\n            request,\r\n            actionOfficeIds\r\n          );\r\n          //   this.requestCoversheets.push(new RequestDetailCoversheet(newSheet));\r\n          resolve();\r\n        })\r\n      );\r\n    }\r\n\r\n    await Promise.all(promises);\r\n    // TODO: need to requery coversheets\r\n    this.responseCoversheetFiles.removeAll();\r\n    this.refreshData();\r\n  };\r\n\r\n  onResponseDocFilesAttachedHandler = async (files) => {\r\n    if (!files.length) return;\r\n    // const request = await getRequestByTitle(this.number);\r\n    const response = await appContext.AuditResponses.FindById(this.ID);\r\n\r\n    const promises = [];\r\n\r\n    for (let file of files) {\r\n      promises.push(\r\n        new Promise(async (resolve) => {\r\n          const newSheet = await uploadResponseDocFile(response, file);\r\n          resolve();\r\n        })\r\n      );\r\n    }\r\n\r\n    await Promise.all(promises);\r\n    // TODO: need to requery responsedocs\r\n    this.responseDocFiles.removeAll();\r\n    this.refreshData();\r\n  };\r\n\r\n  highlightResponse = () => {\r\n    document\r\n      .getElementById(`response-item-title-${this.title}`)\r\n      ?.scrollIntoView({ block: \"center\", behavior: \"smooth\" });\r\n\r\n    this.highlight(true);\r\n    setTimeout(() => this.highlight(false), 2000);\r\n  };\r\n}\r\n\r\nconst onc =\r\n  \"onclick=\\\"return DispEx(this,event,'TRUE','FALSE','FALSE','SharePoint.OpenDocuments.3','1','SharePoint.OpenDocuments','','','','2','0','0','0x7fffffffffffffff','','')\\\"\";\r\n\r\nclass ResponseDocSummary {\r\n  constructor(oRequest, oResponse) {\r\n    var showBulkApprove = false;\r\n\r\n    var arrResponseDocs = new Array();\r\n    for (var z = 0; z < oResponse.responseDocs.length; z++) {\r\n      var oResponseDoc = oResponse.responseDocs[z];\r\n\r\n      oResponseDoc.chkApproveResDoc = ko.observable(false);\r\n\r\n      if (oResponseDoc.documentStatus == \"Marked for Deletion\") continue;\r\n\r\n      oResponseDoc.docIcon = oResponseDoc.docIcon.get_value();\r\n      oResponseDoc.styleTag = Audit.Common.Utilities.GetResponseDocStyleTag2(\r\n        oResponseDoc.documentStatus\r\n      );\r\n      oResponseDoc.requestID = oRequest.ID; //needed for view document\r\n      oResponseDoc.responseID = oResponse.ID;\r\n      oResponseDoc.responseTitle = oResponse.title; //needed for view document\r\n\r\n      oResponseDoc.responseDocOpenInIELink =\r\n        \"<a class='btn btn-link' target='_blank' title='Click to Open the document' onmousedown=\\\"return VerifyHref(this,event,'1','SharePoint.OpenDocuments','')\\\" \" +\r\n        onc +\r\n        ' href=\"' +\r\n        oResponseDoc.folder +\r\n        \"/\" +\r\n        oResponseDoc.fileName +\r\n        '\">' +\r\n        oResponseDoc.fileName +\r\n        \"</a>\";\r\n\r\n      // oResponseDoc.responseDocCanBeApproved = (oResponseDoc) => {\r\n      //   if (oResponseDoc.documentStatus != AuditResponseDocStates.Submitted)\r\n      //     return false;\r\n      //   return (\r\n      //     (this.responseStatus == AuditResponseStates.Submitted ||\r\n      //       this.responseStatus == AuditResponseStates.ApprovedForQA) &&\r\n      //     (this.requestStatus == AUDITREQUESTSTATES.OPEN ||\r\n      //       this.requestStatus == AUDITREQUESTSTATES.REOPENED)\r\n      //   );\r\n      // };\r\n      arrResponseDocs.push(oResponseDoc);\r\n      // cnt++;\r\n\r\n      if (\r\n        [\r\n          AuditResponseStates.Submitted,\r\n          AuditResponseStates.ApprovedForQA,\r\n        ].includes(oResponse.resStatus) &&\r\n        oResponseDoc.documentStatus == AuditResponseDocStates.Submitted\r\n      ) {\r\n        showBulkApprove = true;\r\n      }\r\n    }\r\n    this.responseId = oResponse.ID;\r\n    this.responseTitle = oResponse.title;\r\n    this.responseDocs = arrResponseDocs;\r\n    this.responseStatus = oResponse.resStatus;\r\n    this.requestStatus = oRequest.status;\r\n    this.showBulkApprove = showBulkApprove;\r\n  }\r\n  responseTitle;\r\n\r\n  collapsed = ko.observable(false);\r\n  highlight = ko.observable(false);\r\n\r\n  titleRowElementId = () => \"response-doc-summary-\" + this.responseTitle;\r\n\r\n  highlightResponse = () => {\r\n    document\r\n      .getElementById(this.titleRowElementId())\r\n      .scrollIntoView({ behavior: \"smooth\", block: \"center\" });\r\n    this.highlight(true);\r\n    setTimeout(() => this.highlight(false), 2000);\r\n  };\r\n\r\n  ClickViewResponseDocHistory = (responseDoc) => {\r\n    appContext.AuditResponseDocs.ListRef.showVersionHistoryModal(\r\n      responseDoc.ID\r\n    );\r\n  };\r\n\r\n  responseDocCanBeApproved = (oResponseDoc) => {\r\n    if (oResponseDoc.documentStatus != AuditResponseDocStates.Submitted)\r\n      return false;\r\n    return (\r\n      (this.responseStatus == AuditResponseStates.Submitted ||\r\n        this.responseStatus == AuditResponseStates.ApprovedForQA) &&\r\n      (this.requestStatus == AUDITREQUESTSTATES.OPEN ||\r\n        this.requestStatus == AUDITREQUESTSTATES.REOPENED)\r\n    );\r\n  };\r\n}\r\n", "import { directRegisterComponent } from \"../../../../sal/infrastructure/index.js\";\r\nimport { m_fnApproveResponseDocsForQA } from \"../../../../pages/ia_db/ia_db.js\";\r\nimport { approveResponseDocsForRO } from \"../../../../services/index.js\";\r\nimport { AUDITREQUESTTYPES } from \"../../../../entities/index.js\";\r\nimport { confirmApproveResponseDocFormTemplate } from \"./ConfirmApproveResponseDocFormTemplate.js\";\r\n\r\nconst componentName = \"confirm-approve-response-doc\";\r\n\r\nexport class ConfirmApproveResponseDocForm {\r\n  constructor(request, response, responseDocs) {\r\n    this.request = request;\r\n    this.response = response;\r\n    this.responseDocs(responseDocs);\r\n\r\n    switch (request.reqType) {\r\n      case AUDITREQUESTTYPES.TASKER:\r\n        this.sendToText(\"Send to \" + request.requestingOffice);\r\n        break;\r\n      case AUDITREQUESTTYPES.REQUEST:\r\n        this.sendToText(\"Send to QA\");\r\n        break;\r\n      default:\r\n        this.sendToText(\"Uh Oh\");\r\n    }\r\n  }\r\n\r\n  sendToText = ko.observable();\r\n\r\n  responseDocs = ko.observableArray();\r\n  saving = ko.observable(false);\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    const responseDocIds = this.responseDocs().map((doc) => doc.ID);\r\n    let result;\r\n    switch (this.request.reqType) {\r\n      case AUDITREQUESTTYPES.TASKER:\r\n        result = await approveResponseDocsForRO(\r\n          this.request.ID,\r\n          responseDocIds\r\n        );\r\n        break;\r\n      case AUDITREQUESTTYPES.REQUEST:\r\n        result = await m_fnApproveResponseDocsForQA(\r\n          this.request,\r\n          this.responseDocs()\r\n        );\r\n        break;\r\n      default:\r\n        this.sendToText(\"Uh Oh\");\r\n    }\r\n\r\n    // const result = await m_fnApproveResponseDocsForQA(\r\n    //   this.request,\r\n    //   this.responseDocs()\r\n    // );\r\n    if (result) {\r\n      this.onComplete(true);\r\n    }\r\n  }\r\n\r\n  componentName = componentName;\r\n  params = this;\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: confirmApproveResponseDocFormTemplate,\r\n});\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const confirmApproveResponseDocFormTemplate = html`\r\n  <div id=\"approveResponseDocDlg\" class=\"audit-form bg-dark\">\r\n    <div>\r\n      Are you sure you would like to\r\n      <span class=\"fw-bold success\">Approve</span> the Response Document(s)?\r\n      <ul>\r\n        <!-- ko foreach: responseDocs -->\r\n        <li class=\"fw-bold success\" data-bind=\"text: fileName\"></li>\r\n        <!-- /ko -->\r\n      </ul>\r\n    </div>\r\n    <div class=\"form-actions\">\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-success\"\r\n        data-bind=\"click: clickSubmit, text: sendToText, \r\n      attr: {title: sendToText}\"\r\n      ></button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { directRegisterComponent } from \"../../../../sal/infrastructure/index.js\";\r\nimport { m_fnRejectResponseDoc } from \"../../../../pages/ia_db/ia_db.js\";\r\nimport { confirmRejectResponseDocFormTemplate } from \"./ConfirmRejectResponseDocFormTemplate.js\";\r\n\r\nconst componentName = \"confirm-reject-response-doc\";\r\n\r\nexport class ConfirmRejectResponseDocForm {\r\n  constructor(request, response, responseDocs) {\r\n    this.request = request;\r\n    this.response = response;\r\n    this.responseDocs(responseDocs);\r\n  }\r\n\r\n  rejectReason = ko.observable();\r\n  responseDocs = ko.observableArray();\r\n  saving = ko.observable(false);\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    await Promise.all(\r\n      this.responseDocs().map((responseDoc) => {\r\n        return m_fnRejectResponseDoc(\r\n          this.request,\r\n          responseDoc,\r\n          this.rejectReason()\r\n        );\r\n      })\r\n    );\r\n    this.onComplete(true);\r\n  }\r\n\r\n  componentName = componentName;\r\n  params = this;\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: confirmRejectResponseDocFormTemplate,\r\n});\r\n// registerComponent({\r\n//   name: componentName,\r\n//   folder: \"forms/response_doc/confirm_reject\",\r\n//   template: \"ConfirmRejectResponseDocFormTemplate\",\r\n// });\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const confirmRejectResponseDocFormTemplate = html`\r\n  <div id=\"rejectResponseDocDlg\" class=\"audit-form bg-dark\">\r\n    <div>\r\n      Are you sure you would like to\r\n      <span class=\"text-danger fw-bold\">Reject</span> the Response Document(s)?\r\n      <ul>\r\n        <!-- ko foreach: responseDocs -->\r\n        <li class=\"text-danger fw-bold\" data-bind=\"text: fileName\"></li>\r\n        <!-- /ko -->\r\n      </ul>\r\n    </div>\r\n    <div class=\"component field\">\r\n      <label class=\"fw-semibold\"\r\n        >If so, please specify the reason<span class=\"fw-bold text-danger\"\r\n          >*</span\r\n        >:\r\n        <textarea\r\n          class=\"form-control w-full\"\r\n          rows=\"3\"\r\n          data-bind=\"textInput: rejectReason\"\r\n        ></textarea>\r\n      </label>\r\n    </div>\r\n    <br />\r\n    <div class=\"form-actions\">\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-danger\"\r\n        value=\"Reject Documents\"\r\n        data-bind=\"click: clickSubmit, \r\n      enable: rejectReason\"\r\n      >\r\n        Yes, Reject Document\r\n      </button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import {\r\n  directRegisterComponent,\r\n  registerComponent,\r\n} from \"../../../../sal/infrastructure/index.js\";\r\nimport { deleteRequest } from \"../../../../services/index.js\";\r\nimport { confirmDeleteRequestFormTemplate } from \"./ConfirmDeleteRequestFormTemplate.js\";\r\n\r\nconst componentName = \"confirm-delete-request\";\r\nexport class ConfirmDeleteRequestForm {\r\n  constructor(request) {\r\n    this.request = request;\r\n  }\r\n\r\n  saving = ko.observable();\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    const result = await deleteRequest(this.request.ID);\r\n    if (result) {\r\n      this.onComplete(true);\r\n    }\r\n  }\r\n\r\n  componentName = componentName;\r\n  params = this;\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: confirmDeleteRequestFormTemplate,\r\n});\r\n\r\nregisterComponent({\r\n  name: componentName,\r\n  folder: \"forms/request/confirm_delete\",\r\n  template: \"ConfirmDeleteRequestFormTemplate\",\r\n});\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const confirmDeleteRequestFormTemplate = html`\r\n  <div id=\"deleteRequestDlg\" class=\"audit-form bg-dark\">\r\n    <div>\r\n      Are you sure you would like to\r\n      <span class=\"text-danger fw-bold\">Delete</span> the Request and associated\r\n      files?\r\n      <ul>\r\n        <li class=\"text-danger fw-bold\" data-bind=\"text: request.number\"></li>\r\n      </ul>\r\n    </div>\r\n\r\n    <div class=\"form-actions\">\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-danger\"\r\n        value=\"Delete Request\"\r\n        data-bind=\"click: clickSubmit, enable: !saving()\"\r\n      >\r\n        Yes, Delete Request\r\n      </button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { html } from \"../../sal/infrastructure/index.js\";\r\n\r\nexport const requestDetailViewTemplate = html`\r\n  <div class=\"request-detail-view\" data-bind=\"visible: currentRequest\">\r\n    <div id=\"divRequestInfoContainer\">\r\n      <div\r\n        id=\"divRequestClose\"\r\n        style=\"width: 300px\"\r\n        data-bind=\"visible: bDisplayClose\"\r\n      >\r\n        <fieldset style=\"border-color: GreenYellow\">\r\n          <legend style=\"font-weight: bold; font-size: 12pt\">Action</legend>\r\n          <span class=\"fa-solid fa-lock\"></span\r\n          ><button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n            id=\"btnCloseRequest\"\r\n            title=\"Close this Request\"\r\n            data-bind=\"click: $root.ClickCloseRequest\"\r\n          >\r\n            Close this Request\r\n          </button>\r\n        </fieldset>\r\n      </div>\r\n\r\n      <div data-bind=\"if: currentRequestResponsesReadyToClose().length\">\r\n        <fieldset class=\"emphasized-section\">\r\n          <legend>Responses Ready to Close</legend>\r\n          <table class=\"tablesorter\">\r\n            <thead>\r\n              <tr>\r\n                <th>Response</th>\r\n                <th>Action</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody data-bind=\"foreach: currentRequestResponsesReadyToClose\">\r\n              <tr>\r\n                <td\r\n                  class=\"response-title\"\r\n                  data-bind=\"attr: {'id': 'response-item-title-' + title}\"\r\n                >\r\n                  <span\r\n                    title=\"View Response Docs\"\r\n                    class=\"btn btn-link\"\r\n                    data-bind=\"text: title, click: $parent.viewResponseDocs\"\r\n                  ></span>\r\n                </td>\r\n                <td>\r\n                  <button\r\n                    type=\"button\"\r\n                    class=\"btn btn-link\"\r\n                    title=\"Close Response\"\r\n                    data-bind=\"click: clickCloseResponse\"\r\n                  >\r\n                    <span class=\"fa-solid fa-circle-check\"></span>\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n            title=\"Close all Responses\"\r\n            data-bind=\"click: clickCloseReadyResponses\"\r\n          >\r\n            <span class=\"fa-solid fa-check-double\"></span> Close All Responses\r\n          </button>\r\n        </fieldset>\r\n      </div>\r\n\r\n      <div\r\n        id=\"divRequestInfo\"\r\n        class=\"audit-form request-info-form\"\r\n        data-bind=\"with: currentRequest\"\r\n      >\r\n        <div class=\"form-header\">\r\n          <h3 class=\"uppercase form-title\">\r\n            AUDIT REQUEST DETAILS\r\n            <span class=\"fw-semibold\" data-bind=\"text: number\"></span> |\r\n            <span class=\"text-primary\"\r\n              >FY-<span data-bind=\"text: fiscalYear\"></span\r\n            ></span>\r\n          </h3>\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-link form-title\"\r\n            data-bind=\"click: $parent.refreshRequest\"\r\n          >\r\n            <i title=\"Refresh Request\" class=\"fa-solid fa-arrows-rotate\"></i>\r\n          </button>\r\n        </div>\r\n        <!-- ko if: typeof(activeViewers) != 'undefined' -->\r\n        <div\r\n          id=\"divRequestActiveViewers\"\r\n          data-bind=\"visible: activeViewers.viewers().length, with: activeViewers\"\r\n        >\r\n          <fieldset>\r\n            <legend>\r\n              <span class=\"fa-solid fa-triangle-exclamation\"></span\r\n              ><span data-bind=\"text: viewers().length\"></span> Active Viewers\r\n            </legend>\r\n            <ul data-bind=\"foreach: viewers\">\r\n              <li>\r\n                <div class=\"active-viewer\">\r\n                  <div\r\n                    data-bind=\"text: viewer + ' @ ' + timestamp.toLocaleString()\"\r\n                  ></div>\r\n                  <div\r\n                    style=\"cursor: pointer\"\r\n                    data-bind=\"click: $parent.onRemove\"\r\n                    class=\"fa-solid fa-xmark\"\r\n                  ></div>\r\n                </div>\r\n              </li>\r\n            </ul>\r\n          </fieldset>\r\n        </div>\r\n        <!-- /ko -->\r\n        <div class=\"form-row uppercase\">\r\n          <dl class=\"\">\r\n            <dt>Request #</dt>\r\n            <dd data-bind=\"text: number\"></dd>\r\n            <dt>Subject</dt>\r\n            <dd data-bind=\"text: subject\"></dd>\r\n            <dt>Requesting Office</dt>\r\n            <dd data-bind=\"text: requestingOffice\"></dd>\r\n            <dt>Sensitivity</dt>\r\n            <dd data-bind=\"text: sensitivity\"></dd>\r\n            <dt>Internal Due Date</dt>\r\n            <dd data-bind=\"text: internalDueDate\"></dd>\r\n            <dt>Due Date</dt>\r\n            <dd data-bind=\"text: dueDate\"></dd>\r\n          </dl>\r\n          <dl>\r\n            <dt>Type</dt>\r\n            <dd data-bind=\"text: reqType\"></dd>\r\n            <dt>Status</dt>\r\n            <dd>\r\n              <span\r\n                id=\"requestInfoStatus\"\r\n                class=\"uppercase\"\r\n                data-bind=\"text: status, class: status == 'Closed' ? 'danger' : 'success' \"\r\n              ></span>\r\n              <span class=\"danger\" data-bind=\"visible: status == 'Closed'\"\r\n                >on\r\n                <span data-bind=\"text: closedDate\"></span>\r\n              </span>\r\n            </dd>\r\n            <dt>Sample?</dt>\r\n            <dd>\r\n              <span id=\"requestInfoSample\">\r\n                <span data-bind=\"if: sample\"\r\n                  ><span class=\"fa-solid fa-check\"></span> Yes</span\r\n                >\r\n                <span data-bind=\"if: !sample\"\r\n                  ><span class=\"fa-solid fa-xmark\"></span> No</span\r\n                >\r\n              </span>\r\n            </dd>\r\n            <dt>Receipt Date</dt>\r\n            <dd data-bind=\"text: receiptDate\"></dd>\r\n            <dt>Related Audit</dt>\r\n            <dd data-bind=\"text: relatedAudit\"></dd>\r\n          </dl>\r\n        </div>\r\n        <div class=\"form-row\">\r\n          <dl>\r\n            <dt>Action Items</dt>\r\n            <dd data-bind=\"html: actionItems\"></dd>\r\n            <dt>Comments</dt>\r\n            <dd data-bind=\"html: comments\"></dd>\r\n          </dl>\r\n        </div>\r\n\r\n        <div class=\"form-row\">\r\n          <div class=\"emphasized-section\">\r\n            <div class=\"fw-semibold\">Internal Status Comments</div>\r\n            <!-- ko if: typeof(internalStatus) != 'undefined' -->\r\n            <div class=\"commentChain\" data-bind=\"with: internalStatus\">\r\n              <div data-bind=\"if: comments().length\">\r\n                <!-- ko if: showHistoryBool -->\r\n                <!-- ko foreach: comments -->\r\n                <div class=\"comment card\">\r\n                  <div class=\"card-body\">\r\n                    <div class=\"text\" data-bind=\"text: text\"></div>\r\n                    <div>\r\n                      <span\r\n                        class=\"info\"\r\n                        data-bind=\"text: author + ' @ ' + timestamp.toLocaleString()\"\r\n                      ></span>\r\n                      <button\r\n                        type=\"button\"\r\n                        title=\"Delete Comment\"\r\n                        class=\"remove btn btn-link danger\"\r\n                        data-bind=\"click: $parent.onRemove\"\r\n                      >\r\n                        <i class=\"fa-solid fa-trash\"></i>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: showHistoryBool -->\r\n                <div\r\n                  class=\"comment card\"\r\n                  data-bind=\"with: comments()[comments().length - 1]\"\r\n                >\r\n                  <div class=\"card-body\">\r\n                    <div class=\"text\" data-bind=\"text: text\"></div>\r\n                    <div>\r\n                      <span\r\n                        class=\"info\"\r\n                        data-bind=\"text: author + ' @ ' + timestamp.toLocaleString()\"\r\n                      ></span>\r\n                      <button\r\n                        type=\"button\"\r\n                        title=\"Delete Comment\"\r\n                        class=\"remove btn btn-link danger\"\r\n                        data-bind=\"click: $parent.onRemove\"\r\n                      >\r\n                        <i class=\"fa-solid fa-trash\"></i>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <!-- /ko -->\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"Show hidden comments\"\r\n                data-bind=\"click: toggleShowHistory\"\r\n              >\r\n                <span class=\"fa-solid fa-comments\"></span>\r\n                Toggle Comment History (<span\r\n                  data-bind=\"text: comments().length\"\r\n                ></span>\r\n                Total)\r\n              </button>\r\n              <div class=\"new-comment\">\r\n                <textarea\r\n                  class=\"form-control w-full\"\r\n                  cols=\"50\"\r\n                  data-bind=\"textInput: newCommentText\"\r\n                  placeholder=\"Leave a new comment...\"\r\n                ></textarea>\r\n                <button\r\n                  type=\"button\"\r\n                  class=\"btn btn-primary\"\r\n                  data-bind=\"click: onSubmit, enable: newCommentText\"\r\n                >\r\n                  Submit\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <!-- /ko -->\r\n          </div>\r\n        </div>\r\n        <div class=\"form-row\">\r\n          <dl>\r\n            <dt>Action Office(s)</dt>\r\n            <dd>\r\n              <!-- ko ifnot: actionOffices.length -->\r\n              0 Action Offices\r\n              <!-- /ko -->\r\n              <span\r\n                id=\"requestInfoActionOffice\"\r\n                data-bind=\"if: actionOffices.length\"\r\n              >\r\n                <div\r\n                  style=\"cursor: pointer; white-space: nowrap\"\r\n                  title=\"Click to view\"\r\n                >\r\n                  <span\r\n                    class=\"actionOfficeContainerRequestInfo\"\r\n                    data-bind=\"toggleClick: $data, toggleClass: 'collapsed', classContainer: '.sr1-request-actionOfficeContainerRequestInfo-item'\"\r\n                  >\r\n                    <span class=\"fa-solid fa-magnifying-glass\"></span\r\n                    ><button type=\"button\" class=\"btn btn-link\">\r\n                      View\r\n                      <span data-bind=\"text: actionOffices.length\"></span>\r\n                      Action Offices\r\n                    </button>\r\n                    <!-- ko foreach: actionOffices -->\r\n                    <div\r\n                      class=\"sr1-request-actionOfficeContainerRequestInfo-item collapsed\"\r\n                      data-bind=\"text: ao\"\r\n                    ></div>\r\n                    <!-- /ko -->\r\n                  </span>\r\n                </div>\r\n              </span>\r\n            </dd>\r\n          </dl>\r\n          <dl>\r\n            <dt>Email Action Office(s)</dt>\r\n            <dd>\r\n              <!-- ko ifnot: emailActionOffices.length -->\r\n              0 Email Action Offices\r\n              <!-- /ko -->\r\n              <span\r\n                id=\"requestInfoActionOffice\"\r\n                data-bind=\"if: emailActionOffices.length\"\r\n              >\r\n                <div\r\n                  style=\"cursor: pointer; white-space: nowrap\"\r\n                  title=\"Click to view\"\r\n                >\r\n                  <span\r\n                    class=\"actionOfficeContainerRequestInfo\"\r\n                    data-bind=\"toggleClick: $data, toggleClass: 'collapsed', classContainer: '.sr1-request-actionOfficeContainerRequestInfo-item'\"\r\n                  >\r\n                    <span class=\"fa-solid fa-magnifying-glass\"></span\r\n                    ><button type=\"button\" class=\"btn btn-link\">\r\n                      View\r\n                      <span data-bind=\"text: emailActionOffices.length\"></span>\r\n                      Email Action Offices\r\n                    </button>\r\n                    <!-- ko foreach: emailActionOffices -->\r\n                    <div\r\n                      class=\"sr1-request-actionOfficeContainerRequestInfo-item collapsed\"\r\n                      data-bind=\"text: ao\"\r\n                    ></div>\r\n                    <!-- /ko -->\r\n                  </span>\r\n                </div>\r\n              </span>\r\n            </dd>\r\n          </dl>\r\n        </div>\r\n        <div class=\"form-row\">\r\n          <dl>\r\n            <dt>Email Sent?</dt>\r\n            <dd>\r\n              <span data-bind=\"if: emailSent\"\r\n                ><span class=\"fa-solid fa-check\"></span> Yes</span\r\n              >\r\n              <span data-bind=\"if: !emailSent\"\r\n                ><span class=\"fa-solid fa-xmark\"></span> No</span\r\n              >\r\n            </dd>\r\n          </dl>\r\n          <fieldset\r\n            class=\"emphasized-section\"\r\n            style=\"\r\n            width: 225px;\r\n            margin-top: 5px;\r\n            margin-left: 10px;\r\n            padding-left: 10px;\r\n          \"\r\n          >\r\n            <legend>Email Actions</legend>\r\n            <div\r\n              id=\"divSendEmailAction\"\r\n              style=\"padding-top: 5px\"\r\n              data-bind=\"visible: status == 'Open' || status == 'ReOpened'\"\r\n            >\r\n              <span class=\"fa-solid fa-paper-plane\"></span>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                data-bind=\"visible: !emailSent, click: $root.ClickSendEmail, enable: emailActionOffices.length\"\r\n                title=\"Send Email to Action Offices\"\r\n              >\r\n                Send Email to Action Offices\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                data-bind=\"visible: emailSent, click: $root.ClickSendEmail, enable: emailActionOffices.length\"\r\n                title=\"ReSend Email to Action Offices\"\r\n              >\r\n                Re-Send Email to Action Offices\r\n              </button>\r\n            </div>\r\n            <div id=\"divEmailHistory\" style=\"padding-top: 5px\">\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"View Email History\"\r\n                data-bind=\"click: $root.ClickViewEmailHistoryFolder\"\r\n              >\r\n                <span class=\"fa-solid fa-magnifying-glass\"></span> View Email\r\n                History\r\n              </button>\r\n            </div>\r\n            <div id=\"divSyncEmailActionOffices\" style=\"padding-top: 5px\">\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"Synchronize Email Action Offices\"\r\n                data-bind=\"click: $root.ClickSyncEmailActionOffices\"\r\n              >\r\n                <span class=\"fa-solid fa-right-left\"></span> Synchronize Email\r\n                Action Offices\r\n              </button>\r\n            </div>\r\n          </fieldset>\r\n        </div>\r\n        <div class=\"form-row\">\r\n          <dl>\r\n            <dt>Special Permissions?</dt>\r\n            <dd>\r\n              <span data-bind=\"if: specialPerms == true\"\r\n                ><span class=\"fa-solid fa-check\"></span> Yes</span\r\n              >\r\n              <span data-bind=\"if: specialPerms == false\"\r\n                ><span class=\"fa-solid fa-xmark\"></span> No</span\r\n              >\r\n            </dd>\r\n          </dl>\r\n          <fieldset\r\n            class=\"emphasized-section\"\r\n            style=\"\r\n            width: 200px;\r\n            margin-top: 5px;\r\n            margin-left: 10px;\r\n            padding-left: 10px;\r\n          \"\r\n          >\r\n            <legend>Special Permission Actions</legend>\r\n            <div\r\n              id=\"divResponsesGrantSpecialPermissions\"\r\n              style=\"padding-top: 5px\"\r\n            >\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"Grant Special Permissions\"\r\n                data-bind=\"click: $root.ClickGrantSpecialPermissions\"\r\n              >\r\n                <span class=\"fa-solid fa-unlock\"></span> Grant Special\r\n                Permissions\r\n              </button>\r\n            </div>\r\n            <div\r\n              id=\"divResponsesRemoveSpecialPermissions\"\r\n              style=\"padding-top: 5px\"\r\n            >\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"Remove Special Permissions\"\r\n                data-bind=\"click: $root.ClickRemoveSpecialPermissions\"\r\n              >\r\n                <span class=\"fa-solid fa-lock\"></span> Remove Special\r\n                Permissions\r\n              </button>\r\n            </div>\r\n          </fieldset>\r\n        </div>\r\n        <tr></tr>\r\n\r\n        <div id=\"divRequestInfoActions\" class=\"form-row\">\r\n          <fieldset class=\"form-actions emphasized-section\">\r\n            <legend>Request Actions</legend>\r\n            <div>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-primary\"\r\n                title=\"View Version History\"\r\n                data-bind=\"click: $parent.ClickViewRequestHistory\"\r\n              >\r\n                <span class=\"fa-solid fa-clock-rotate-left\"></span> View Version\r\n                History\r\n              </button>\r\n            </div>\r\n            <div>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-primary\"\r\n                title=\"View Request\"\r\n                data-bind=\"click: $root.ClickViewRequest\"\r\n              >\r\n                <span class=\"fa-solid fa-magnifying-glass\"></span> View Request\r\n              </button>\r\n            </div>\r\n            <div>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-success\"\r\n                title=\"Edit Request\"\r\n                data-bind=\"click: $root.ClickEditRequest\"\r\n              >\r\n                <span class=\"fa-solid fa-pencil\"></span> Edit Request\r\n              </button>\r\n            </div>\r\n            <!-- ko ifnot: emailSent  -->\r\n            <div>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-danger\"\r\n                title=\"Delete Request\"\r\n                data-bind=\"click: $parent.ClickDeleteRequest\"\r\n              >\r\n                <span class=\"fa-solid fa-trash\"></span> Delete Request\r\n              </button>\r\n            </div>\r\n            <!-- /ko -->\r\n          </fieldset>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ui-tabs-secondary request-detail-documents\">\r\n      <!-- ko using: tabs -->\r\n      <ul class=\"ui-tabs-nav\" data-bind=\"foreach: tabOpts\">\r\n        <li\r\n          data-bind=\"text: linkText, \r\n          click: $parent.clickTabLink, \r\n          css: {active: $parent.isSelected($data)}\"\r\n        ></li>\r\n      </ul>\r\n      <!-- ko foreach: tabOpts -->\r\n      <div\r\n        data-bind=\"component: {\r\n            name: template.id,\r\n            params: template.data\r\n          },\r\n          visible: $parent.isSelected($data)\"\r\n      ></div>\r\n      <!-- /ko -->\r\n      <!-- /ko -->\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { html } from \"../../sal/infrastructure/index.js\";\r\n\r\nexport const requestDetailCoversheetsTabTemplate = html`\r\n  <div id=\"divCoverSheets\" data-bind=\"visible: currentRequest\">\r\n    <div id=\"divCoverSheetActions\" class=\"w-fit\">\r\n      <div data-bind=\"visible: coverSheetFiles().length\">\r\n        Uploading Coversheet!\r\n        <progress></progress>\r\n      </div>\r\n      <div class=\"quick-links secondary\">\r\n        <label data-bind=\"visible: !coverSheetFiles().length\">\r\n          <div\r\n            class=\"btn btn-link\"\r\n            title=\"Upload Cover Sheet or Supplemental Document\"\r\n            data-bind=\"\"\r\n          >\r\n            <span class=\"fa-solid fa-upload\"></span> Upload Cover Sheet or\r\n            Supplemental Document\r\n          </div>\r\n          <input\r\n            style=\"display: none\"\r\n            type=\"file\"\r\n            data-bind=\"files: coverSheetFiles\"\r\n          />\r\n        </label>\r\n      </div>\r\n    </div>\r\n    <div\r\n      id=\"divEmptyCoversheetsMsg\"\r\n      style=\"border: 0px !important; font-style: italic\"\r\n      data-bind=\"visible: arrCurrentRequestCoverSheets().length <= 0\"\r\n    >\r\n      There are 0 coversheets\r\n    </div>\r\n    <table\r\n      id=\"tblCoverSheets\"\r\n      class=\"tablesorter report\"\r\n      data-bind=\"visible: arrCurrentRequestCoverSheets().length > 0\"\r\n    >\r\n      <thead>\r\n        <tr valign=\"top\">\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Name</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Action Office</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Action</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody data-bind=\"foreach: arrCurrentRequestCoverSheets\">\r\n        <tr class=\"coversheet-item\">\r\n          <td class=\"coversheet-title\" title=\"Click to Download\">\r\n            <a\r\n              class=\"btn btn-link\"\r\n              data-bind=\"downloadLink: '../_layouts/download.aspx?SourceUrl=:folder/:title'\"\r\n              ><span data-bind=\"text: title\"></span\r\n            ></a>\r\n          </td>\r\n          <td class=\"coversheet-ao\">\r\n            <div\r\n              style=\"cursor: pointer\"\r\n              title=\"Click to view\"\r\n              data-bind=\"visible: $data.actionOffices.length > 0, toggleClick: $data, toggleClass: 'collapsed', classContainer: '.sr1-request-actionOfficeContainerRequestInfo-item'\"\r\n            >\r\n              <span class=\"fa-solid fa-magnifying-glass\"></span\r\n              ><span class=\"actionOfficeContainerRequestInfo\"\r\n                ><button type=\"button\" class=\"btn btn-link\">\r\n                  View Action Offices\r\n                </button></span\r\n              >\r\n              <!-- ko foreach: actionOffices -->\r\n              <div\r\n                class=\"sr1-request-actionOfficeContainerRequestInfo-item collapsed\"\r\n              >\r\n                <span data-bind=\"text: actionOffice\"></span>\r\n              </div>\r\n              <!-- /ko -->\r\n            </div>\r\n          </td>\r\n          <td class=\"coversheet-action\">\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"View Coversheet\"\r\n              data-bind=\"click: $root.ClickViewCoversheet\"\r\n            >\r\n              <span\r\n                title=\"View Coversheet\"\r\n                class=\"fa-solid fa-magnifying-glass\"\r\n              ></span>\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"Edit Coversheet\"\r\n              data-bind=\"visible: requestStatus != 'Closed' && requestStatus != 'Canceled', click: $root.ClickEditCoversheet\"\r\n            >\r\n              <span title=\"Edit Coversheet\" class=\"fa-solid fa-pencil\"></span>\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"Delete Coversheet\"\r\n              data-bind=\"visible: requestStatus != 'Closed' && requestStatus != 'Canceled',\r\n                click: $parent.ClickDeleteCoversheet\"\r\n            >\r\n              <i class=\"fa-solid fa-trash\"></i>\r\n            </button>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n      <tfoot>\r\n        <tr valign=\"top\">\r\n          <th nowrap=\"nowrap\" colspan=\"3\">\r\n            Total:\r\n            <span\r\n              id=\"tblCoverSheetsTotal\"\r\n              data-bind=\"text: arrCurrentRequestCoverSheets().length\"\r\n              >0</span\r\n            >\r\n          </th>\r\n        </tr>\r\n      </tfoot>\r\n    </table>\r\n  </div>\r\n`;\r\n", "import { html } from \"../../sal/infrastructure/index.js\";\r\n\r\nexport const requestDetailResponsesTabTemplate = html`\r\n  <div id=\"divResponses\" data-bind=\"visible: currentRequest\">\r\n    <div data-bind=\"\">\r\n      <div id=\"divResponsesActions\" class=\"quick-links secondary\">\r\n        <!-- ko if:  showResponseActions-->\r\n        <div>\r\n          <button\r\n          type=\"button\"\r\n          class=\"btn btn-link\"\r\n            title=\"Add Response\"\r\n            data-bind=\"click: $root.ClickAddResponse\"\r\n            ><span class=\"fa-solid fa-plus\"></span>Add Response</button\r\n          >\r\n        </div>\r\n        <div>\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n            title=\"Bulk Add Responses\"\r\n\r\n            data-bind=\"click: $root.ClickBulkAddResponse\"\r\n            ><span class=\"fa-solid fa-circle-plus\"></span>Bulk Add Responses</a\r\n          >\r\n        </div>\r\n        <div data-bind=\"visible: currentRequestResponseItems().length > 0\">\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n            title=\"Bulk Edit Responses\"\r\n\r\n            data-bind=\"click: $root.ClickBulkEditResponse\"\r\n            ><span class=\"fa-solid fa-pencil\"></span>Bulk Edit Responses</a\r\n          >\r\n        </div>\r\n        <!-- /ko -->\r\n        <div\r\n          id=\"divResponsesShowHideFolderPerms\"\r\n          data-bind=\"visible: currentRequestResponseItems().length > 0\"\r\n        >\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n            title=\"Show/Hide Response Folder Permissions\"\r\n            data-bind=\"toggleClick: $data, toggleClass: 'response-permissions', containerType: 'any'\"\r\n            ><i class=\"fa-solid fa-gear\"></i>Show/Hide Response Folder\r\n            Permissions</a\r\n          >\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <table\r\n      id=\"tblResponses\"\r\n      class=\"tablesorter report\"\r\n      data-bind=\"visible: currentRequestResponseItems().length > 0 \"\r\n    >\r\n      <thead>\r\n        <tr valign=\"top\">\r\n          <th class=\"sorter-true\" nowrap=\"nowrap\">Sample #</th>\r\n          <th class=\"sorter-true\" nowrap=\"nowrap\" style=\"text-align: left\">\r\n            Name\r\n          </th>\r\n          <th class=\"sorter-true\" nowrap=\"nowrap\">Action Office</th>\r\n          <th class=\"sorter-true\" nowrap=\"nowrap\"># Docs</th>\r\n          <th class=\"sorter-true\" nowrap=\"nowrap\">Status</th>\r\n          <th class=\"sorter-true\" nowrap=\"nowrap\">Return Reason</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Special Permission?</th>\r\n          <th class=\"sorter-false response-permissions\" nowrap=\"nowrap\">\r\n            Response Folder Permissions\r\n          </th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Active Viewers</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Action</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Documents</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody data-bind=\"foreach: currentRequestResponseItems\">\r\n        <tr class=\"response-item\" data-bind=\"css: {'highlighted': highlight}\">\r\n          <td class=\"response-sample\">\r\n            <span data-bind=\"text: sample\"></span>\r\n          </td>\r\n          <td\r\n            class=\"response-title\"\r\n            data-bind=\"attr: {'id': 'response-item-title-' + title}, click: highlightResponse\"\r\n          >\r\n            <span title=\"View Response Docs\" class=\"btn btn-link\" data-bind=\"text: title, click: $parent.viewResponseDocs\"></span>\r\n          </td>\r\n          <td\r\n            class=\"response-actionOffice\"\r\n            data-bind=\"attr: {'title': toolTip}, style: styleTag\"\r\n          >\r\n            <span data-bind=\"text: actionOffice\"></span\r\n            ><span data-bind=\"visible: poc\" style=\"color: green\"\r\n              >&nbsp;POC: </span\r\n            ><span data-bind=\"text: poc\" style=\"color: green\"></span>\r\n          </td>\r\n          <td class=\"response-document-cnt\" >\r\n            <span title=\"View Response Docs\"\r\n              class=\"btn btn-link\"\r\n              data-bind=\"text: responseDocs.length, click: $parent.viewResponseDocs\"></span>\r\n          </td>\r\n          <td class=\"response-resStatus\">\r\n            <span\r\n              data-bind=\"visible: resStatus != '7-Closed'\"\r\n              style=\"color: green\"\r\n              ><span data-bind=\"text: resStatus\"></span>\r\n            </span>\r\n            <span\r\n              data-bind=\"visible: resStatus == '7-Closed'\"\r\n              style=\"color: red\"\r\n              ><span data-bind=\"text: resStatus\"></span>&nbsp;on&nbsp;<span\r\n                data-bind=\"text: closedDate\"\r\n              ></span\r\n              >&nbsp;by&nbsp;<span data-bind=\"text: closedBy\"></span\r\n            ></span>\r\n              <!-- ko if: isReadyToClose($data) -->\r\n              <button type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"All response docs sent to RO. Click to Close.\"\r\n                data-bind=\"click: clickCloseResponse\">\r\n                Ready to Close <span class=\"fa-solid fa-circle-check\"></span>\r\n              </button>\r\n              <!-- /ko -->\r\n            <div\r\n              style=\"padding-top: 5px; padding-left: 20px\"\r\n              data-bind=\"visible: resStatus == '7-Closed'\"\r\n            >\r\n              <i class=\"fa-solid fa-gear\"></i\r\n              ><button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n                title=\"Click to Open Response\"\r\n\r\n                data-bind=\"click: $root.ClickReOpenResponse\"\r\n                >Open Response?</a\r\n              >\r\n            </div>\r\n          </td>\r\n          <td class=\"response-returnReason\" style=\"white-space: pre-line\">\r\n            <span data-bind=\"text: returnReason\"></span>\r\n          </td>\r\n          <td class=\"response-specialPermissions\">\r\n            <span\r\n              data-bind=\"css: (specialPerms ? 'fa-solid fa-check' : '')\"\r\n            ></span>\r\n          </td>\r\n          <td class=\"response-permissions\">\r\n            <span data-bind=\"html: groupPerms\"></span>\r\n          </td>\r\n          <td class=\"response-viewers\">\r\n            <div\r\n              data-bind=\"visible: activeViewers.viewers().length, with: activeViewers\"\r\n            >\r\n              <fieldset>\r\n                <legend>\r\n                  <i class=\"fa-solid fa-triangle-exclamation\"></i\r\n                  ><span data-bind=\"text: viewers().length\"></span>\r\n                  Active Viewers\r\n                </legend>\r\n                <ul data-bind=\"foreach: viewers\">\r\n                  <li>\r\n                    <div class=\"active-viewer\">\r\n                      <div\r\n                        data-bind=\"text: viewer + ' @ ' + timestamp.toLocaleString()\"\r\n                      ></div>\r\n                      <div\r\n                        style=\"cursor: pointer\"\r\n                        data-bind=\"click: $parent.onRemove\"\r\n                      >\r\n                        <i class=\"fa-solid fa-xmark\"></i>\r\n                      </div>\r\n                    </div>\r\n                  </li>\r\n                </ul>\r\n              </fieldset>\r\n            </div>\r\n          </td>\r\n          <td class=\"response-action\">\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"View Response\"\r\n              data-bind=\"click: $root.ClickViewResponse\"\r\n            >\r\n              <i class=\"fa-solid fa-magnifying-glass\"></i>\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"Edit Response\"\r\n              data-bind=\"visible: resStatus != '7-Closed' && $parent.status != 'Closed' && $parent.status != 'Canceled', click: $root.ClickEditResponse\"\r\n            >\r\n              <i class=\"fa-solid fa-pen\"></i>\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"View Version History\"\r\n              data-bind=\"click: ClickViewResponseHistory\"\r\n            >\r\n              <span class=\"fa-solid fa-clock-rotate-left\"></span>\r\n            </button>\r\n            <label\r\n              title=\"Upload Coversheets for Action Office\"\r\n              class=\"btn btn-link\"\r\n              data-bind=\"visible: $parent.status != 'Closed' && $parent.status != 'Canceled' && ( resStatus == '1-Open' || resStatus == '2-Submitted' || resStatus == '3-Returned to Action Office' ||resStatus == '5-Returned to GFS' )\"\r\n            >\r\n              <i\r\n                title=\"Upload Coversheets\"\r\n                class=\"fa-solid fa-upload\"\r\n              ></i>\r\n              <input\r\n                type=\"file\"\r\n                multiple\r\n                style=\"display: none\"\r\n                data-bind=\"files: responseCoversheetFiles\"\r\n              />\r\n            </label>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"Flag Response as Under Review\"\r\n              data-bind=\"visible: resStatus != '7-Closed' && $parent.status != 'Closed' && $parent.status != 'Canceled', click: $root.ClickReviewingResponse\"\r\n            >\r\n              <i class=\"fa-solid fa-flag\"></i>\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"Delete Response\"\r\n              data-bind=\"visible: $parent.status != 'Closed' && $parent.status != 'Canceled' && ( resStatus == '1-Open' || resStatus == '2-Submitted' || resStatus == '3-Returned to Action Office' || resStatus == '5-Returned to GFS' ),\r\n                click: ClickDeleteResponse\"\r\n            >\r\n              <i class=\"fa-solid fa-trash\"></i>\r\n            </button>\r\n          </td>\r\n          <td class=\"response-responseDocs\">\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"View Response Documents\"\r\n              data-bind=\"visible: resStatus != '7-Closed' && $parent.status != 'Closed' && $parent.status != 'Canceled', click: $root.ClickViewResponseDocFolder\"\r\n            >\r\n              <i class=\"fa-solid fa-folder-open\"></i>\r\n            </button>\r\n            <label\r\n              class=\"btn btn-link\"\r\n              title=\"Upload Response Documents\"\r\n              data-bind=\"visible: $parent.status != 'Closed' && $parent.status != 'Canceled' && ( resStatus == '1-Open' || resStatus == '2-Submitted' || resStatus == '3-Returned to Action Office' ||resStatus == '5-Returned to GFS' )\"\r\n              ><i class=\"fa-solid fa-file-arrow-up\"></i>\r\n              <input\r\n                type=\"file\"\r\n                multiple\r\n                style=\"display: none\"\r\n                data-bind=\"files: responseDocFiles\"\r\n              />\r\n            </label>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n      <tfoot>\r\n        <tr valign=\"top\">\r\n          <th colspan=\"10\" nowrap=\"nowrap\">\r\n            Total:\r\n            <span\r\n              id=\"tblResponsesTotal\"\r\n              data-bind=\"text: currentRequestResponseItems().length\"\r\n              >0</span\r\n            >\r\n          </th>\r\n        </tr>\r\n      </tfoot>\r\n    </table>\r\n  </div>\r\n`;\r\n", "import { html } from \"../../sal/infrastructure/index.js\";\r\n\r\nexport const requestDetailResponseDocsTabTemplate = html`\r\n  <div id=\"divResponseDocs\" data-bind=\"visible: currentRequest\">\r\n    <div\r\n      id=\"divEmptyResponseDocsMsg\"\r\n      style=\"border: 0px !important; font-style: italic\"\r\n      data-bind=\"visible: cntResponseDocs() == 0\"\r\n    >\r\n      There are 0 response documents\r\n    </div>\r\n\r\n    <div\r\n      class=\"quick-links secondary\"\r\n      data-bind=\"visible: cntResponseDocs() > 0\"\r\n    >\r\n      <div>\r\n        <button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n          class=\"btnApprovedCheckedResponseDocs\"\r\n\r\n          title=\"Approve Checked Response Documents\"\r\n          data-bind=\"click: ApproveCheckedResponseDocs, visible: currentRequest() && (currentRequest().status == 'Open' || currentRequest().status == 'ReOpened')\"\r\n        >\r\n          <span class=\"fa-solid fa-circle-check\"></span>\r\n          Approve Checked Response Documents\r\n        </button>\r\n      </div>\r\n      <div>\r\n        <button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n          class=\"btnCheckResponseDocs\"\r\n\r\n          title=\"Check/Un-Check Response Documents\"\r\n          data-bind=\"click: CheckResponseDocs, visible: currentRequest() && (currentRequest().status == 'Open' || currentRequest().status == 'ReOpened')\"\r\n        >\r\n          <span class=\"fa-solid fa-check-double\"></span>\r\n          Check Response Documents\r\n        </button>\r\n      </div>\r\n      <div>\r\n        <button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n          class=\"btnToggleExpand\"\r\n\r\n          title=\"Click to Expand/Collapse\"\r\n          data-bind=\"toggles: showCollapsed\"\r\n        >\r\n          <span\r\n            class=\"fa-solid\"\r\n            data-bind=\"class: showCollapsed() ? 'fa-expand' : 'fa-compress'\"\r\n          ></span>\r\n          <span\r\n            data-bind=\"text: showCollapsed() ? 'Expand Documents' : 'Collapse Documents'\"\r\n          ></span>\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <table\r\n      id=\"tblResponseDocs\"\r\n      class=\"tablesorter report\"\r\n      data-bind=\"visible: cntResponseDocs() > 0\"\r\n    >\r\n      <thead>\r\n        <tr valign=\"top\">\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Type</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Name</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Title</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Receipt Date</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">File Size</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Checked Out</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">\r\n            Status\r\n            <span class=\"linkHelpResponseDocs\"\r\n              ><button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n                title=\"View Help\"\r\n                data-bind=\"click: clickHelpResponseDocs\"\r\n                style=\"color: #0072bc\"\r\n                ><i class=\"fa-solid fa-question\"></i></a\r\n            ></span>\r\n          </th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Reason</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Modified</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Modified By</th>\r\n          <th class=\"sorter-false\" nowrap=\"nowrap\">Actions</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody\r\n        data-bind=\"foreach: { data: currentRequestResponseDocs, as: 'responseDocSummary'} \"\r\n      >\r\n        <tr\r\n          class=\"requestInfo-response-doc\"\r\n          data-bind=\"visible: responseDocSummary.responseDocs.length > 0,\r\n            attr: {id: responseDocSummary.titleRowElementId() }\"\r\n        >\r\n          <td colspan=\"11\">\r\n            <img\r\n              style=\"background-color: transparent\"\r\n              title=\"Expand/Collapse\"\r\n              data-bind=\"\r\n              attr: { src: (responseDocSummary.collapsed() ? '/_layouts/images/plus.gif' : '/_layouts/images/minus.gif') },\r\n              toggles: responseDocSummary.collapsed\"\r\n            /><span>\r\n              <button type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"View Response\"\r\n                data-bind=\"text: responseDocSummary.responseTitle,\r\n                  click: $parent.ClickViewResponse\">\r\n              </button>\r\n              </span>\r\n              (<span data-bind=\"text: responseStatus\"></span>)\r\n          </td>\r\n        </tr>\r\n\r\n        <tr\r\n          class=\"requestInfo-response-doc-item\"\r\n          data-bind=\"visible: responseDocSummary.showBulkApprove,\r\n            css: (responseDocSummary.collapsed() ? 'collapsed' : '')\"\r\n        >\r\n          <td colspan=\"11\">\r\n            <span class=\"divBulkApprove\">\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                class=\"btnApproveAll\"\r\n\r\n                title=\"Click to Approve Remaining Documents\"\r\n                data-bind=\"click: $parent.ClickBulkApprove\"\r\n              >\r\n                <span class=\"fa-solid fa-circle-check\"></span>\r\n                Approve 'Submitted' Documents for this Response below\r\n              </button>\r\n            </span>\r\n          </td>\r\n        </tr>\r\n\r\n        <!-- ko foreach: responseDocSummary.responseDocs-->\r\n\r\n        <tr\r\n          class=\"requestInfo-response-doc-item\"\r\n          data-bind=\"style: styleTag,\r\n          css: {'collapsed': responseDocSummary.collapsed(), 'highlighted': responseDocSummary.highlight}\"\r\n        >\r\n          <td>\r\n            <img\r\n              data-bind=\"attr:{ src: $parent.siteUrl + '/_layouts/images/' + docIcon}\"\r\n            />\r\n          </td>\r\n          <td class=\"requestInfo-response-doc-title\">\r\n            <input\r\n              type=\"checkbox\"\r\n              data-bind=\"attr: { id: ID }, visible: $parent.responseDocCanBeApproved($data), checked: chkApproveResDoc\"\r\n            />\r\n\r\n            <a\r\n              title=\"Click to Download\"\r\n              data-bind=\"visible: $parent.responseStatus == '7-Closed' || $parent.requestStatus == 'Closed' || $parent.requestStatus == 'Canceled', downloadLink: '../_layouts/download.aspx?SourceUrl=:folder/:fileName'\"\r\n              ><span data-bind=\"text: fileName\"></span\r\n            ></a>\r\n            <span\r\n              title=\"Click to Open\"\r\n              data-bind=\"visible: $parent.responseStatus != '7-Closed' && $parent.requestStatus != 'Closed' && $parent.requestStatus != 'Canceled', html: responseDocOpenInIELink \"\r\n            ></span>\r\n            <span\r\n              style=\"float: right\"\r\n              data-bind=\"visible: ( documentStatus == 'Open' || documentStatus == 'Marked for Deletion') && ($parent.requestStatus == 'Open' || $parent.requestStatus == 'ReOpened') \"\r\n              ><button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n                title=\"Delete Response Document\"\r\n\r\n                data-bind=\"click: $root.ClickDeleteResponseDoc\"\r\n                ><i class=\"fa-solid fa-trash\"></i></a\r\n            ></span>\r\n          </td>\r\n          <td nowrap data-bind=\"text: title\"></td>\r\n          <td nowrap data-bind=\"text: receiptDate\"></td>\r\n          <td nowrap data-bind=\"text: fileSize\"></td>\r\n          <td nowrap>\r\n            <span data-bind=\"visible: checkedOutBy != ''\"\r\n              ><span data-bind=\"text: checkedOutBy\"></span>&nbsp;<img\r\n                style=\"background-color: transparent\"\r\n                src=\"/_layouts/images/checkin.gif\"\r\n                title=\"Check In Document\"\r\n              /><button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n\r\n                title=\"Check In Document\"\r\n                data-bind=\"click: $root.ClickCheckInResponseDocument\"\r\n                >Check In Document</a\r\n              ></span\r\n            >\r\n          </td>\r\n          <td nowrap>\r\n            <span data-bind=\"text: documentStatus\"></span>\r\n            <span\r\n              data-bind=\"visible: documentStatus == 'Rejected' && ( $parent.requestStatus == 'Open' || $parent.requestStatus == 'ReOpened' ) \"\r\n              ><button\r\n            type=\"button\"\r\n            class=\"btn btn-link\"\r\n                title=\"Clear Rejected Status\"\r\n\r\n                data-bind=\"click: $root.ClickResendRejectedResponseDocToQA\"\r\n                ><i class=\"fa-solid fa-circle-check\"></i></a\r\n            ></span>\r\n          </td>\r\n          <td data-bind=\"html: rejectReason\"></td>\r\n          <td\r\n            class=\"requestInfo-response-doc-modified\"\r\n            data-bind=\"text: modifiedDate\"\r\n          ></td>\r\n          <td\r\n            class=\"requestInfo-response-doc-modifiedBy\"\r\n            data-bind=\"text: modifiedBy\"\r\n          ></td>\r\n          <td nowrap>\r\n            <span\r\n              data-bind=\"visible: $parent.responseDocCanBeApproved($data)\"\r\n            >\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"Approve this Document\"\r\n\r\n                data-bind=\"click: $parents[1].ClickApproveResponseDoc\"\r\n              >\r\n                <span class=\"fa-solid fa-circle-check\"\r\n                  ></span\r\n                >\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-link\"\r\n                title=\"Reject this Document\"\r\n\r\n                data-bind=\"click: $parents[1].ClickRejectResponseDoc\"\r\n              >\r\n                <span class=\"fa-solid fa-circle-xmark\"\r\n                  ></span\r\n                >\r\n              </button>\r\n            </span>\r\n\r\n            <a\r\n              title=\"Click to Download\"\r\n              data-bind=\"downloadLink: '../_layouts/download.aspx?SourceUrl=:folder/:fileName'\"\r\n              ><i class=\"fa-solid fa-download\"></i\r\n            ></a>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"View Response Document Properties\"\r\n\r\n              data-bind=\"click: $root.ClickViewResponseDoc\"\r\n              ><span class=\"fa-solid fa-magnifying-glass\"\r\n                ></span\r\n              ></a\r\n            >\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"Edit Response Document Properties\"\r\n\r\n              data-bind=\"visible: $parent.responseStatus != '7-Closed' && $parent.requestStatus != 'Closed' && $parent.requestStatus != 'Canceled' && ( documentStatus == 'Sent to QA' || documentStatus == 'Open' || documentStatus == 'Submitted' ), click: $root.ClickEditResponseDoc\"\r\n              ><span class=\"fa-solid fa-pencil\"></span></a\r\n            >\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-link\"\r\n              title=\"View Version History\"\r\n              data-bind=\"click: $parent.ClickViewResponseDocHistory\"\r\n            >\r\n              <span class=\"fa-solid fa-clock-rotate-left\"></span>\r\n            </button>\r\n          </td>\r\n        </tr>\r\n\r\n        <!-- /ko -->\r\n      </tbody>\r\n      <tfoot>\r\n        <tr valign=\"top\">\r\n          <th colspan=\"11\" nowrap=\"nowrap\">\r\n            Total:\r\n            <span id=\"tblResponseDocsTotal\" data-bind=\"text: cntResponseDocs()\"\r\n              >0</span\r\n            >\r\n          </th>\r\n        </tr>\r\n      </tfoot>\r\n    </table>\r\n  </div>\r\n`;\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const editRequestFormTemplate = html`\r\n  <div class=\"audit-form bg-dark\">\r\n    <div class=\"form-fields\" data-bind=\"foreach: FormFields\">\r\n      <!-- ko if: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n              name: components.edit, params: $data}, \r\n              class: classList\"\r\n      ></div>\r\n      <!-- /ko -->\r\n      <!-- ko ifnot: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n                name: components.view, params: $data}, \r\n                class: classList\"\r\n      ></div>\r\n      <!-- /ko -->\r\n    </div>\r\n    <div class=\"form-actions\">\r\n      <!-- <button type=\"button\" class=\"btn btn-warn\" data-bind=\"click: clearForm\">\r\n      Clear Form\r\n    </button> -->\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-success\"\r\n        data-bind=\"click: clickSubmit\"\r\n      >\r\n        Submit\r\n      </button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { updateRequest } from \"../../../../services/index.js\";\r\nimport { BaseForm } from \"../../../../sal/components/forms/index.js\";\r\nimport { editRequestFormTemplate } from \"./EditRequestFormTemplate.js\";\r\nimport { directRegisterComponent } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nconst componentName = \"custom-edit-request-form\";\r\n\r\nexport class EditRequestForm extends BaseForm {\r\n  constructor({ entity }) {\r\n    super({ entity });\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {}\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    const errors = this.validate();\r\n    if (errors.length) return;\r\n\r\n    const request = this.entity;\r\n\r\n    try {\r\n      await updateRequest(request);\r\n      this.onComplete(SP.UI.DialogResult.OK);\r\n    } catch (e) {\r\n      alert(e);\r\n    }\r\n  }\r\n\r\n  fieldIsEditable(field) {\r\n    const request = this.entity;\r\n\r\n    const nonEditableFields = [request.ReqNum, request.EmailSent];\r\n\r\n    return !nonEditableFields.includes(field);\r\n  }\r\n\r\n  params = this;\r\n  componentName = componentName;\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: editRequestFormTemplate,\r\n});\r\n", "import { BaseForm } from \"../../../../sal/components/forms/index.js\";\r\nimport { directRegisterComponent } from \"../../../../sal/infrastructure/index.js\";\r\nimport { updateRequestCoverSheet } from \"../../../../services/index.js\";\r\nimport { editCoverSheetFormTemplate } from \"./EditCoverSheetFormTemplate.js\";\r\n\r\nconst componentName = \"custom-edit-coversheet-form\";\r\n\r\nexport class EditCoverSheetForm extends BaseForm {\r\n  constructor({ entity }) {\r\n    super({ entity });\r\n  }\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    const errors = this.validate();\r\n    if (errors.length) return;\r\n\r\n    const coverSheet = this.entity;\r\n\r\n    try {\r\n      await updateRequestCoverSheet(coverSheet);\r\n      this.onComplete(SP.UI.DialogResult.OK);\r\n    } catch (e) {\r\n      alert(e);\r\n    }\r\n  }\r\n\r\n  fieldIsEditable(field) {\r\n    const entity = this.entity;\r\n\r\n    const nonEditableFields = [entity.ReqNum, entity.FileRef];\r\n\r\n    return !nonEditableFields.includes(field);\r\n  }\r\n\r\n  params = this;\r\n  componentName = componentName;\r\n}\r\ndirectRegisterComponent(componentName, {\r\n  template: editCoverSheetFormTemplate,\r\n});\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const editCoverSheetFormTemplate = html`\r\n  <div class=\"audit-form bg-dark\">\r\n    <div class=\"form-fields\" data-bind=\"foreach: FormFields\">\r\n      <!-- ko if: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n                name: components.edit, params: $data}, \r\n                class: width\"\r\n      ></div>\r\n      <!-- /ko -->\r\n      <!-- ko ifnot: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n                  name: components.view, params: $data}, \r\n                  class: width\"\r\n      ></div>\r\n      <!-- /ko -->\r\n    </div>\r\n    <div class=\"form-actions\">\r\n      <!-- <button type=\"button\" class=\"btn btn-warn\" data-bind=\"click: clearForm\">\r\n        Clear Form\r\n      </button> -->\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-success\"\r\n        data-bind=\"click: clickSubmit\"\r\n      >\r\n        Submit\r\n      </button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { addResponse } from \"../../../../services/index.js\";\r\nimport { AuditResponse } from \"../../../../entities/index.js\";\r\n\r\nimport { BaseForm } from \"../../../../sal/components/forms/index.js\";\r\nimport { directRegisterComponent } from \"../../../../sal/infrastructure/index.js\";\r\nimport { newResponseFormTemplate } from \"./NewResponseFormTemplate.js\";\r\n\r\nconst componentName = \"custome-new-response-form\";\r\n\r\nexport class NewResponseForm extends BaseForm {\r\n  constructor({ entity }) {\r\n    super({ entity, view: AuditResponse.Views.NewForm });\r\n  }\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    const errors = this.validate();\r\n    if (errors.length) return;\r\n\r\n    const response = ko.unwrap(this.entity);\r\n\r\n    try {\r\n      await addResponse(response.ReqNum.Value(), response);\r\n      this.onComplete(SP.UI.DialogResult.OK);\r\n    } catch (e) {\r\n      alert(e);\r\n    }\r\n  }\r\n\r\n  clearForm() {}\r\n\r\n  fieldIsEditable(field) {\r\n    const entity = ko.unwrap(this.entity);\r\n\r\n    const nonEditableFields = [entity.ReqNum];\r\n\r\n    return !nonEditableFields.includes(field);\r\n  }\r\n\r\n  componentName = componentName;\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: newResponseFormTemplate,\r\n});\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const newResponseFormTemplate = html`\r\n  <div class=\"audit-form bg-dark new-request-form\">\r\n    <div class=\"form-fields\" data-bind=\"foreach: FormFields\">\r\n      <!-- ko if: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n              name: components.edit, params: $data}, \r\n              class: classList\"\r\n      ></div>\r\n      <!-- /ko -->\r\n      <!-- ko ifnot: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n                name: components.view, params: $data}, \r\n                class: classList\"\r\n      ></div>\r\n      <!-- /ko -->\r\n    </div>\r\n    <div class=\"form-actions\">\r\n      <button type=\"button\" class=\"btn btn-warn\" data-bind=\"click: clearForm\">\r\n        Clear Form\r\n      </button>\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-success\"\r\n        data-bind=\"click: clickSubmit\"\r\n      >\r\n        Create Response\r\n      </button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { updateResponse, currentUser } from \"../../../../services/index.js\";\r\nimport {\r\n  AuditResponse,\r\n  AuditResponseStates,\r\n} from \"../../../../entities/index.js\";\r\n\r\nimport { BaseForm } from \"../../../../sal/components/forms/index.js\";\r\nimport { directRegisterComponent } from \"../../../../sal/infrastructure/index.js\";\r\nimport { editResponseFormTemplate } from \"./EditResponseFormTemplate.js\";\r\n\r\nconst componentName = \"custome-edit-response-form\";\r\n\r\nexport class EditResponseForm extends BaseForm {\r\n  constructor({ entity }) {\r\n    super({ entity, view: AuditResponse.Views.EditForm });\r\n    this.currentResponseStatus = entity.ResStatus.Value();\r\n    entity.ResStatus.Value.subscribe(this.onStatusChangedHandler, this);\r\n  }\r\n\r\n  onStatusChangedHandler = async (newValue) => {\r\n    if (\r\n      newValue != this.currentResponseStatus &&\r\n      newValue == AuditResponseStates.Closed\r\n    ) {\r\n      const response = ko.unwrap(this.entity);\r\n      const curUser = await currentUser();\r\n      response.ClosedBy.Value(curUser);\r\n      response.ClosedDate.Value(new Date());\r\n    }\r\n  };\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    const errors = this.validate();\r\n    if (errors.length) return;\r\n\r\n    const response = ko.unwrap(this.entity);\r\n\r\n    try {\r\n      await updateResponse(response.ReqNum.Value(), response);\r\n      this.onComplete(SP.UI.DialogResult.OK);\r\n    } catch (e) {\r\n      alert(e);\r\n    }\r\n  }\r\n\r\n  fieldIsEditable(field) {\r\n    const entity = ko.unwrap(this.entity);\r\n\r\n    const nonEditableFields = [\r\n      entity.ReqNum,\r\n      entity.Title,\r\n      entity.SampleNumber,\r\n    ];\r\n\r\n    return !nonEditableFields.includes(field);\r\n  }\r\n\r\n  componentName = componentName;\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: editResponseFormTemplate,\r\n});\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const editResponseFormTemplate = html`\r\n  <div class=\"audit-form bg-dark\">\r\n    <div class=\"form-fields\" data-bind=\"foreach: FormFields\">\r\n      <!-- ko if: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n                name: components.edit, params: $data}, \r\n                class: classList\"\r\n      ></div>\r\n      <!-- /ko -->\r\n      <!-- ko ifnot: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n                  name: components.view, params: $data}, \r\n                  class: classList\"\r\n      ></div>\r\n      <!-- /ko -->\r\n    </div>\r\n    <div class=\"form-actions\">\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-success\"\r\n        data-bind=\"click: clickSubmit\"\r\n      >\r\n        Submit\r\n      </button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { BaseForm } from \"../../../../sal/components/forms/index.js\";\r\nimport { directRegisterComponent } from \"../../../../sal/infrastructure/index.js\";\r\nimport { updateResponseDoc } from \"../../../../services/index.js\";\r\n\r\nimport {\r\n  AUDITREQUESTSTATES,\r\n  AuditResponseStates,\r\n  AuditResponseDoc,\r\n} from \"../../../../entities/index.js\";\r\n\r\nimport { editResponseDocFormTemplate } from \"./EditResponseDocFormTemplate.js\";\r\n\r\nconst componentName = \"custome-edit-responsedoc-form\";\r\n\r\nexport class EditResponseDocForm extends BaseForm {\r\n  constructor({ entity }) {\r\n    super({ entity, view: AuditResponseDoc.Views.EditForm });\r\n    this.currentResponseDocStatus = entity.DocumentStatus.Value();\r\n    entity.DocumentStatus.Value.subscribe(this.onStatusChangedHandler, this);\r\n  }\r\n\r\n  onStatusChangedHandler = (newValue) => {\r\n    if (newValue != this.currentResponseDocStatus) {\r\n    }\r\n  };\r\n\r\n  async clickSubmit() {\r\n    this.saving(true);\r\n    await this.submit();\r\n    this.saving(false);\r\n  }\r\n\r\n  async submit() {\r\n    const errors = this.validate();\r\n    if (errors.length) return;\r\n\r\n    const responseDoc = ko.unwrap(this.entity);\r\n    const request = responseDoc.ReqNum.Value();\r\n    const response = responseDoc.ResID.Value();\r\n\r\n    try {\r\n      await updateResponseDoc(request, response, responseDoc);\r\n      this.onComplete(SP.UI.DialogResult.OK);\r\n    } catch (e) {\r\n      alert(e);\r\n    }\r\n  }\r\n\r\n  fieldIsEditable(field) {\r\n    const entity = ko.unwrap(this.entity);\r\n\r\n    const nonEditableFields = [entity.ReqNum, entity.ResID, entity.FileName];\r\n\r\n    return !nonEditableFields.includes(field);\r\n  }\r\n\r\n  StatusErrors = ko.pureComputed(() => {\r\n    const errors = [];\r\n    const responseDoc = ko.unwrap(this.entity);\r\n    if (!responseDoc) return errors;\r\n    const requestStatus = responseDoc.ReqNum.Value()?.ReqStatus.Value();\r\n    const responseStatus = responseDoc.ResID.Value()?.ResStatus.Value();\r\n\r\n    if (\r\n      requestStatus != AUDITREQUESTSTATES.OPEN &&\r\n      requestStatus != AUDITREQUESTSTATES.REOPENED\r\n    ) {\r\n      errors.push(\r\n        \"The Request associated to this Document is not Open. It can only be re-opened from the IA Dashboard\"\r\n      );\r\n    }\r\n\r\n    if (responseStatus == AuditResponseStates.Closed) {\r\n      errors.push(\r\n        \"The Response associated to this Document is Closed. It can only be re-opened from the IA Dashboard\"\r\n      );\r\n    }\r\n\r\n    return errors;\r\n  });\r\n\r\n  componentName = componentName;\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: editResponseDocFormTemplate,\r\n});\r\n", "import { html } from \"../../../../sal/infrastructure/index.js\";\r\n\r\nexport const editResponseDocFormTemplate = html`\r\n  <div class=\"audit-form bg-dark\">\r\n    <!-- ko foreach: StatusErrors -->\r\n    <div class=\"alert alert-warning\" data-bind=\"text: $data\"></div>\r\n    <!-- /ko -->\r\n    <div class=\"form-fields\" data-bind=\"foreach: FormFields\">\r\n      <!-- ko if: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n                name: components.edit, params: $data}, \r\n                class: width\"\r\n      ></div>\r\n      <!-- /ko -->\r\n      <!-- ko ifnot: $parent.fieldIsEditable($data) -->\r\n      <div\r\n        class=\"form-field-component\"\r\n        data-bind=\"component: {\r\n                  name: components.view, params: $data}, \r\n                  class: width\"\r\n      ></div>\r\n      <!-- /ko -->\r\n    </div>\r\n    <div class=\"form-actions\">\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn btn-success\"\r\n        data-bind=\"click: clickSubmit, disable: StatusErrors().length\"\r\n      >\r\n        Submit\r\n      </button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { appContext } from \"../../infrastructure/application_db_context.js\";\r\nimport { onAddNewRequest, addNewRequest } from \"../../services/index.js\";\r\nimport { toggle } from \"../../sal/components/modal/modalDialog.js\";\r\n\r\nimport { directRegisterComponent } from \"../../sal/infrastructure/index.js\";\r\nimport { bulkAddRequestTemplate } from \"./BulkAddRequestTemplate.js\";\r\n\r\nconst componentName = \"bulk-add-request-form\";\r\nexport class BulkAddRequestForm {\r\n  constructor() {}\r\n\r\n  bulkRequestItems = ko.observableArray();\r\n  working = ko.observable(false);\r\n\r\n  async Init() {\r\n    // TODO: need to initialize audit organizations store\r\n    // await appContext.AuditOrganizations.ToList();\r\n    // await LoadInfo();\r\n    this.fetchBulkRequests();\r\n  }\r\n\r\n  async clickUploadResponses() {\r\n    toggle(false);\r\n    await appContext.AuditBulkRequests.ShowForm(\r\n      \"BulkAddRequest.aspx\",\r\n      \"Bulk Add Requests\",\r\n      {}\r\n    );\r\n\r\n    toggle(true);\r\n\r\n    this.fetchBulkRequests();\r\n  }\r\n\r\n  async fetchBulkRequests() {\r\n    console.log(\"Request added callback\");\r\n    const bulkRequests = await appContext.AuditBulkRequests.ToList(true);\r\n\r\n    // Decorate our bulk requests with an object to keep track of view specific stuff\r\n    this.bulkRequestItems(\r\n      bulkRequests.map((bulkRequest) => {\r\n        return {\r\n          bulkRequest,\r\n          status: ko.observable(\"\"),\r\n          message: ko.observable(\"\"),\r\n        };\r\n      })\r\n    );\r\n  }\r\n\r\n  async clickSubmitRequests() {\r\n    this.working(true);\r\n    // 1. Query all AuditBulkRequests\r\n    const bulkRequestItems = this.bulkRequestItems();\r\n\r\n    const failedInserts = [];\r\n    // 2. Create new AuditRequests\r\n    const insertPromises = bulkRequestItems.map(async (bulkRequestItem) => {\r\n      bulkRequestItem.status(\"pending\");\r\n      // Map the bulk request to a an AuditRequest\r\n      const bulkRequest = bulkRequestItem.bulkRequest;\r\n\r\n      const newRequest = bulkRequest.toRequest();\r\n      newRequest.Reminders.Value(newRequest.Reminders.Options());\r\n\r\n      // a. Insert new Request\r\n      try {\r\n        await addNewRequest(newRequest);\r\n        await onAddNewRequest(newRequest);\r\n      } catch (e) {\r\n        failedInserts.push([e, bulkRequest]);\r\n        bulkRequestItem.status(\"failed\");\r\n        bulkRequestItem.message(e.message);\r\n        return;\r\n      }\r\n      //  a. Update bulkRequests view\r\n      bulkRequestItem.status(\"succeeded\");\r\n\r\n      //  b. Delete successfully created AuditBulkRequests\r\n      await appContext.AuditBulkRequests.RemoveEntity(bulkRequest);\r\n    });\r\n    // Reload Page\r\n    const insertResults = await Promise.all(insertPromises);\r\n    // If any failed, need to alert user!\r\n    this.working(false);\r\n  }\r\n\r\n  componentName = componentName;\r\n  params = this;\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: bulkAddRequestTemplate,\r\n});\r\n", "import { html } from \"../../sal/infrastructure/index.js\";\r\n\r\nexport const bulkAddRequestTemplate = html`\r\n  <div id=\"bulkAddRequest\" class=\"audit\">\r\n    <button\r\n      class=\"btn btn-warn\"\r\n      type=\"button\"\r\n      data-bind=\"click: clickUploadResponses\"\r\n    >\r\n      Add/Modify Requests\r\n    </button>\r\n    <div id=\"divBulkRequests\" data-bind=\"if: bulkRequestItems\">\r\n      <table id=\"tblBulkRequests\" class=\"tablesorter report\">\r\n        <thead>\r\n          <tr>\r\n            <th>Request Number</th>\r\n            <th>Request Subject</th>\r\n            <th>Message</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody data-bind=\"foreach: bulkRequestItems\">\r\n          <tr class=\"bulk-request-item\" data-bind=\"class: status\">\r\n            <td data-bind=\"text: bulkRequest.Title\"></td>\r\n            <td data-bind=\"text: bulkRequest.FieldMap.ReqSubject.toString\"></td>\r\n            <td data-bind=\"text: message\"></td>\r\n          </tr>\r\n        </tbody>\r\n        <tfoot class=\"footer\">\r\n          <tr>\r\n            <th colspan=\"3\">\r\n              Total: <span data-bind=\"text: bulkRequestItems().length\"></span>\r\n            </th>\r\n          </tr>\r\n        </tfoot>\r\n      </table>\r\n    </div>\r\n    <div class=\"\">\r\n      <button\r\n        class=\"btn btn-success\"\r\n        type=\"button\"\r\n        data-bind=\"click: clickSubmitRequests, enable: bulkRequestItems().length\"\r\n        title=\"Click here to Create the Responses\"\r\n      >\r\n        Create Requests\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n  <style>\r\n    #bulkAddRequest button {\r\n      margin-bottom: 10px;\r\n    }\r\n    div#divBulkRequests {\r\n      margin: 10px;\r\n    }\r\n\r\n    tr.bulk-request-item {\r\n    }\r\n\r\n    tr.bulk-request-item.pending td {\r\n      color: white !important;\r\n    }\r\n    tr.bulk-request-item.pending {\r\n      color: white !important;\r\n      background-color: var(--warn-color);\r\n    }\r\n\r\n    tr.bulk-request-item.succeeded td {\r\n      color: white !important;\r\n    }\r\n    tr.bulk-request-item.succeeded {\r\n      color: white !important;\r\n      background-color: var(--success-color);\r\n    }\r\n\r\n    tr.bulk-request-item.failed td {\r\n      color: white !important;\r\n    }\r\n    tr.bulk-request-item.failed {\r\n      color: white !important;\r\n      background-color: var(--danger-color);\r\n    }\r\n  </style>\r\n`;\r\n"],
  "mappings": "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eACb,aAAc,gDACd,WAAY,GACZ,gBAAiB,GACjB,UAAW,CAAC,YAAY,CAC1B,CAAC,EAED,SAAW,IAAIA,GAAc,CAC3B,YAAa,WACb,WAAY,GACZ,gBAAiB,GACjB,UAAW,CAAC,YAAY,CAC1B,CAAC,EAED,UAAY,IAAIV,GAAY,CAC1B,YAAa,YACb,QAAS,CACP,oBACA,mBACA,iBACA,kBACA,iBACF,EACA,SAAU,EACZ,CAAC,EAED,UAAY,IAAIS,GAAc,CAC5B,YAAa,qBACf,CAAC,EAED,YAAc,IAAIT,GAAY,CAC5B,YAAa,cACb,QAAS,CAAC,OAAQ,WAAY,MAAO,SAAS,CAChD,CAAC,EAED,aAAe,IAAIE,GAAY,CAC7B,YAAa,iBACb,KAAMC,GACN,QAASC,GACT,cAAeO,GACf,UAAW,QACX,SAAU,GACV,UAAWL,EAAW,kBACxB,CAAC,EAED,kBAAoB,IAAIJ,GAAY,CAClC,YAAa,uBACb,KAAMC,GACN,QAASC,GACT,cAAeO,GACf,UAAW,QACX,SAAU,GACV,UAAWL,EAAW,kBACxB,CAAC,EAED,WAAa,IAAIC,GAAU,CACzB,YAAa,cACb,WAAY,EACd,CAAC,EAED,SAAW,IAAIK,GAAY,CACzB,YAAa,YACb,WAAY,EACd,CAAC,EAED,OAAO,MAAQ,CACb,IAAK,CACH,KACA,QACA,UACA,aACA,aACA,kBACA,aACA,YACA,WACA,cACA,eACA,cACA,WACA,YACA,YACA,cACA,eACA,oBACA,mBACA,aACA,UACF,EACA,IAAK,CACH,QACA,UACA,aACA,mBACA,aACA,kBACA,aACA,YACA,WACA,cACA,eACA,cACA,WACA,YACA,cACA,cACF,EACA,YAAa,CACX,UACA,aACA,aACA,mBACA,kBACA,aACA,YACA,WACA,cACA,eACA,cACA,WACA,YACA,cACA,eACA,oBACA,WACA,YACF,CACF,EAEA,OAAO,QAAU,CACf,KAAM,gBACN,MAAO,eACT,CACF,ICtQA,IAGaC,GAHbC,GAAAC,GAAA,KAAAC,KAGaH,GAAN,cAA+BI,EAAa,CACjD,YAAYC,EAAQ,CAClB,MAAMA,CAAM,CACd,CAEA,W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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECFzCC,KAEO,IAAMC,GAAsCC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECFnDC,KAEO,IAAMC,GAAoCC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECFjDC,KAEO,IAAMC,GAAuCC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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",
  "names": ["sortByTitle", "init_entity_utilities", "__esmMin", "a", "b", "People", "init_People", "__esmMin", "_People", "ID", "Title", "LoginName", "IsGroup", "IsEnsured", "props", "ValidationError", "init_validation_error", "__esmMin", "source", "type", "description", "Entity", "init_entity", "__esmMin", "params", "val", "isRequiredValidationRequirement", "field", "value", "ValidationError", "BaseField", "init_BaseField", "__esmMin", "init_validation_error", "displayName", "systemName", "instructions", "isRequired", "width", "classList", "Visible", "val", "showErrors", "req", "requirement", "registerFieldComponents", "constructor", "html", "BaseFieldModule", "init_BaseFieldModule", "__esmMin", "params", "editTemplate", "viewTemplate", "BlobModule", "init_BlobModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "editTemplate", "viewTemplate", "CheckboxModule", "init_CheckboxModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "editTemplate", "DateModule", "init_DateModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "editTemplate", "LookupModule", "init_LookupModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "field", "registerFieldComponents", "editTemplate", "viewTemplate", "PeopleModule", "init_PeopleModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "opt", "registerFieldComponents", "editTemplate", "SearchSelectModule", "init_SearchSelectModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "field", "val", "option", "e", "data", "registerFieldComponents", "editTemplate", "SelectModule", "init_SelectModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "editTemplate", "viewTemplate", "TextAreaModule", "init_TextAreaModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "nodes", "toolbarOptions", "editor", "Value", "val", "delta", "oldDelta", "source", "registerFieldComponents", "editTemplate", "TextModule", "init_TextModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "init_fields", "__esmMin", "init_BaseFieldModule", "init_BlobModule", "init_CheckboxModule", "init_DateModule", "init_LookupModule", "init_PeopleModule", "init_SearchSelectModule", "init_SelectModule", "init_TextAreaModule", "init_TextModule", "BlobField", "init_BlobField", "__esmMin", "init_fields", "_BlobField", "BaseField", "params", "value", "input", "obj", "newEntity", "val", "item", "newType", "BlobModule", "CheckboxField", "init_CheckboxField", "__esmMin", "init_fields", "BaseField", "params", "CheckboxModule", "dateFieldTypes", "DateField", "init_DateField", "__esmMin", "init_fields", "BaseField", "params", "d", "newDate", "val", "DateModule", "getEntityPropertyAsString", "entity", "column", "field", "LookupField", "init_LookupField", "__esmMin", "init_fields", "BaseField", "displayName", "entityType", "isRequired", "Visible", "entitySet", "options", "optionsFilter", "optionsText", "multiple", "lookupCol", "instructions", "item", "SearchSelectModule", "LookupModule", "val", "optsFilter", "resolve", "reject", "isLoadingSubscription", "isLoading", "valArr", "value", "foundEntity", "optionEntity", "newEntity", "executeQuery", "currCtx", "resolve", "reject", "sender", "args", "principalToPeople", "oPrincipal", "isGroup", "getDefaultGroups", "defaultGroups", "sal", "result", "key", "getGroupUsers", "groupName", "siteGroups", "url", "group", "fetchSharePointData", "InitSal", "web", "user", "siteGroupCollection", "oRoleDefinitions", "listItemEnumerator", "oListItem", "oEnumerator", "oRoleDefinition", "getUserPropsAsync", "userId", "userPropsUrl", "userInfoUrl", "userInfo", "userProps", "findPropValue", "props", "prop", "copyFileAsync", "sourceFilePath", "destFilePath", "uri", "ensureUserByKeyAsync", "userName", "context", "oUser", "onEnsureUserSucceeded", "onEnsureUserFailed", "data", "getSPSiteGroupByName", "userGroup", "SPList", "listDef", "self", "init", "listEndpoint", "list", "setListPermissionsAsync", "itemPermissions", "reset", "oList", "setResourcePermissionsAsync", "setListPermissions", "valuePairs", "callback", "users", "resolvedGroups", "vp", "resolvedGroup", "onFindItemSucceeded", "groupPairs", "roleDefBindingColl", "userPairs", "onSetListPermissionsSuccess", "onSetListPermissionsFailure", "onFindItemFailed", "mapObjectToListItem", "val", "item", "mapItemToListItem", "createListItemAsync", "entity", "folderPath", "itemCreateInfo", "folderUrl", "restrictedFields", "onCreateListItemSucceeded", "onCreateListItemFailed", "mapListItemToObject", "out", "getListItems", "caml", "fields", "camlQuery", "collListItem", "onGetListItemsSucceeded", "foundObjects", "listObj", "field", "colVal", "onGetListItemsFailed", "getListItemsAsync", "findByIdAsync", "id", "findById", "e", "getById", "queryFields", "expandFields", "getQueryFields", "apiEndpoint", "getListFields", "listFields", "f", "fieldSchema", "lf", "idString", "titleString", "findByColumnValueAsync", "columnFilters", "orderByColumn", "sortAsc", "count", "includePermissions", "includeFolders", "orderBy", "colFilterArr", "colFilter", "filter", "include", "expand", "page", "loadNextPage", "cursor", "onGetListItemSucceeded", "onGetListItemFailed", "updateListItemAsync", "onUpdateListItemsSucceeded", "onUpdateListItemFailed", "deleteListItem", "onDeleteListItemsSucceeded", "onDeleteListItemsFailed", "deleteListItemAsync", "setItemPermissionsAsync", "getoListItemByIdAsync", "role", "ensuredPrincipalResult", "currCtx2", "roleDef", "getItemPermissionsAsync", "oListItems", "onQuerySuccess", "ItemPermissions", "roleEnumerator", "roleColl", "Role", "onQueryFailed", "getListPermissions", "getServerRelativeFolderPath", "relFolderPath", "builtPath", "upsertFolderPathAsync", "upsertLibFolderByPath", "upsertListFolderByPath", "setFolderReadonlyAsync", "targetPerms", "getFolderPermissionsAsync", "setFolderPermissionsAsync", "ensureFolderPermissionsAsync", "serverRelFolderPath", "response", "permissionResults", "missingPerms", "targetPermPair", "targetLoginName", "targetPerm", "curPerm", "curUser", "curBinding", "getFolderContentsAsync", "allItems", "getFolderItemByPath", "roles", "principals", "bindings", "principal", "logins", "principalRoles", "bindingEnumerator", "binding", "camlq", "allFolders", "folderArr", "idx", "upsertListFolderInner", "parentPath", "success", "folderName", "curPath", "ensureListFolder", "iFolder", "folderId", "path", "newItem", "onCreateFolderSucceeded", "onCreateFolderFailed", "onExists", "onNonExists", "ctx", "folder", "onQueryFolderSucceeded", "onQueryFolderItemSuccess", "folderItem", "onQueryFolderItemFailure", "onQueryFolderFailed", "createFolderInternal", "parentFolder", "folderNames", "curFolder", "subFolderUrl", "setFolderPermissions", "onFindFolderSuccess", "onSetFolderPermissionsSuccess", "onSetFolderPermissionsFailure", "onFindFolderFailure", "showModal", "formName", "title", "options", "listPath", "rootFolder", "formsPath", "showCheckinModal", "fileRef", "checkinWithComment", "comment", "showVersionHistoryModal", "itemId", "getVersionHistoryUrl", "uploadNewDocumentAsync", "siteString", "UPLOADCHUNKSIZE", "uploadchunkActionTypes", "uploadFileRestChunking", "file", "fileName", "progress", "blob", "chunkSize", "fileSize", "totalBlocks", "jobGuid", "getGUID", "currentPointer", "startUpload", "continueUpload", "finishUpload", "uploadId", "chunk", "fileOffset", "uploadFileRest", "uploadFileToFolderAndUpdateMetadata", "payload", "job", "uploadQueue", "updateUploadedFileMetadata", "itemUri", "fileResult", "copyFiles", "sourceFolderPath", "destFolderPath", "onError", "sourcePath", "destPath", "folderSrc", "files", "dest", "destLibUrl", "copyFilesAsync", "sourceFolder", "destFolder", "ensureList", "listInfo", "method", "headers", "opts", "siteEndpoint", "d", "c", "r", "serverRelativeUrl", "webRoot", "RoleDef", "JobProcessor", "init_sal", "__esmMin", "siteRoles", "inputRole", "targetRole", "roleName", "publicMembers", "createSiteGroup", "permissions", "groupCreationInfo", "collRoleDefinitionBinding", "perm", "collRollAssignment", "onCreateGroupSucceeded", "roleInfo", "rd", "onCreateGroupFailed", "getUserGroups", "everyone", "oGroups", "onQueryGroupsSucceeded", "groups", "groupsInfo", "groupsEnumerator", "oGroup", "onQueryGroupsFailed", "getUsersWithGroup", "oUsers", "onGetUserSuccess", "userObjs", "userEnumerator", "userObj", "onGetUserFailed", "sourceLib", "destLib", "_ItemPermissions", "hasUniqueRoleAssignments", "newRoleDef", "principalRole", "newRole", "permission", "_Role", "roleDefs", "roleDefsEnumerator", "_RoleDef", "name", "basePermissions", "maxConcurrency", "asyncFunction", "error", "PeopleField", "init_PeopleField", "__esmMin", "init_infrastructure", "init_PeopleModule", "init_People", "init_sal", "init_fields", "BaseField", "params", "groupName", "group", "ensureUserByKeyAsync", "users", "getUsersByGroupName", "sortByTitle", "groupId", "opts", "user", "val", "People", "vals", "u", "PeopleModule", "SelectField", "init_SelectField", "__esmMin", "init_fields", "BaseField", "displayName", "isRequired", "Visible", "options", "multiple", "optionsText", "instructions", "SearchSelectModule", "SelectModule", "val", "TextAreaField", "init_TextAreaField", "__esmMin", "init_fields", "BaseField", "params", "TextAreaModule", "TextField", "init_TextField", "__esmMin", "init_fields", "BaseField", "params", "TextModule", "init_fields", "__esmMin", "init_BaseField", "init_BlobField", "init_CheckboxField", "init_DateField", "init_LookupField", "init_PeopleField", "init_SelectField", "init_TextAreaField", "init_TextField", "ConstrainedEntity", "init_constrained_entity", "__esmMin", "init_primitives", "init_fields", "Entity", "params", "out", "key", "inputObj", "fieldMap", "val", "BaseField", "showErrors", "field", "init_primitives", "__esmMin", "init_validation_error", "init_entity", "init_constrained_entity", "Page", "init_Page", "__esmMin", "init_primitives", "Entity", "params", "init_entities", "__esmMin", "init_People", "init_Page", "assetsPath", "init_env", "__esmMin", "fromPathTemplateLoader", "fromPathViewModelLoader", "init_knockout_extensions", "__esmMin", "init_entities", "init_infrastructure", "init_env", "callback", "oldValue", "_oldValue", "newValue", "arrayChanges", "addedValues", "value", "element", "valueAccessor", "allBindingsAccessor", "options", "selectedOptions", "optionsText", "onSearchInput", "populateOpts", "optionElements", "option", "optionElement", "selectedOption", "e", "opt", "allBindings", "viewModel", "bindingContext", "selectedUnwrapped", "i", "o", "schema", "elemId", "userKeys", "pickerControl", "observable", "userJSObject", "user", "ensureUserByKeyAsync", "person", "People", "userValue", "pickerUser", "path", "replaced", "_", "token", "addFiles", "fileList", "existingFiles", "newFileList", "file", "exFile", "label", "event", "files", "classToToggle", "classContainer", "containerType", "curIcon", "name", "templateConfig", "assetsPath", "response", "error", "text", "viewModelConfig", "module", "viewModelConstructor", "registerComponent", "name", "folder", "module", "moduleFilename", "templateFilename", "directRegisterComponent", "template", "viewModel", "html", "init_register_components", "__esmMin", "getUsersByGroupName", "groupName", "users", "getGroupUsers", "userProps", "init_authorization", "__esmMin", "init_sal", "init_infrastructure", "__esmMin", "init_entity_utilities", "init_knockout_extensions", "init_register_components", "init_sal", "init_authorization", "configurationsStore", "auditOrganizationStore", "allActionOfficesFilter", "allRequestingOfficesFilter", "init_store", "__esmMin", "init_entities", "org", "ORGROLES", "AuditCoversheet", "init_audit_coversheet", "__esmMin", "init_entities", "init_store", "init_constrained_entity", "init_fields", "init_application_db_context", "ConstrainedEntity", "params", "TextField", "LookupField", "AuditRequest", "appContext", "AuditOrganization", "auditOrganizationStore", "request", "val", "requestActionOffices", "opt", "AuditEmail", "init_audit_email", "__esmMin", "init_constrained_entity", "ConstrainedEntity", "params", "ORGROLES", "AuditOrganization", "init_audit_organization", "__esmMin", "init_constrained_entity", "ConstrainedEntity", "params", "AUDITREQUESTSTATES", "AUDITREQUESTTYPES", "AuditRequest", "init_audit_request", "__esmMin", "init_audit_organization", "init_fields", "init_primitives", "init_validation_error", "init_store", "init_application_db_context", "ConstrainedEntity", "params", "ValidationError", "SelectField", "TextField", "LookupField", "AuditOrganization", "auditOrganizationStore", "allRequestingOfficesFilter", "appContext", "DateField", "dateFieldTypes", "CheckboxField", "TextAreaField", "allActionOfficesFilter", "PeopleField", "AuditBulkRequest", "init_audit_bulk_request", "__esmMin", "init_audit_request", "AuditRequest", "params", "newReq", "Comment", "init_comment", "__esmMin", "init_primitives", "init_fields", "_Comment", "ConstrainedEntity", "params", "TextField", "id", "text", "author", "timestamp", "newComment", "ActiveViewer", "init_active_viewer", "__esmMin", "init_primitives", "init_fields", "ConstrainedEntity", "TextField", "DateField", "dateFieldTypes", "ActiveViewersModuleLegacy", "requestId", "props", "requestListTitle", "columnName", "initialValue", "arrInitialViewers", "viewer", "viewers", "pushCurrentUser", "pushUser", "loginName", "filteredViewers", "commitChanges", "removeCurrentuser", "removeUserByLogin", "viewerToRemove", "removeUser", "onRemove", "viewerIndex", "currCtx", "web", "requestList", "oListItem", "args", "sender", "publicMembers", "ActiveViewersComponent", "init_active_viewers_module", "__esmMin", "init_active_viewer", "init_application_db_context", "entity", "fieldName", "ActiveViewer", "set", "appContext", "commentChainTemplate", "init_CommentChainTemplate", "__esmMin", "init_infrastructure", "html", "commentChainComponentName", "CommentChainComponent", "CommentChainModule", "CommentChainModuleLegacy", "init_comment_chain_module", "__esmMin", "init_application_db_context", "init_infrastructure", "init_comment", "init_CommentChainTemplate", "entity", "fieldName", "blobField", "comment", "Comment", "commentToRemove", "set", "appContext", "directRegisterComponent", "commentChainTemplate", "requestId", "props", "initialValue", "arrInitialComments", "currCtx", "oListItem", "args", "sender", "AuditRequestsInternal", "init_audit_request_internal", "__esmMin", "init_fields", "init_constrained_entity", "init_audit_request", "init_comment", "init_active_viewer", "init_active_viewers_module", "init_comment_chain_module", "init_application_db_context", "ConstrainedEntity", "params", "BlobField", "ActiveViewer", "Comment", "LookupField", "AuditRequest", "appContext", "CommentChainComponent", "ActiveViewersComponent", "getSiteGroups", "groups", "getDefaultGroups", "mappedGroups", "key", "group", "People", "getPeopleByUsername", "userName", "user", "ensureUserByKeyAsync", "getSpecialPermGroups", "specialGroups", "specialGroupsLoading", "resolve", "subscriber", "specialPermGroup1", "groupNameSpecialPermName1", "specialPermGroup2", "groupNameSpecialPermName2", "getQAGroup", "qaGroup", "qaGroupLoading", "groupNameQA", "User", "currentUser", "init_people_manager", "__esmMin", "init_entities", "init_infrastructure", "_User", "ID", "Title", "LoginName", "LookupValue", "WorkPhone", "EMail", "IsGroup", "IsEnsured", "Groups", "systemRole", "userIsOwner", "userProps", "getUserPropsAsync", "AuditResponseStates", "AuditResponse", "init_audit_response", "__esmMin", "init_primitives", "init_fields", "init_entities", "init_application_db_context", "init_active_viewer", "init_active_viewers_module", "init_store", "init_people_manager", "ConstrainedEntity", "params", "TextField", "LookupField", "AuditRequest", "appContext", "SelectField", "TextAreaField", "DateField", "dateFieldTypes", "PeopleField", "AuditOrganization", "auditOrganizationStore", "request", "val", "requestActionOffices", "opt", "BlobField", "ActiveViewer", "ActiveViewersComponent", "file", "fileMetadata", "currentUser", "AuditBulkResponse", "init_audit_bulk_response", "__esmMin", "init_entities", "AuditResponse", "params", "AuditResponseDocStates", "AuditResponseDoc", "init_audit_response_doc", "__esmMin", "init_primitives", "init_fields", "init_audit_response", "init_audit_request", "init_application_db_context", "ConstrainedEntity", "params", "TextField", "DateField", "dateFieldTypes", "SelectField", "TextAreaField", "LookupField", "AuditRequest", "appContext", "AuditResponse", "PeopleField", "newFileName", "AuditResponseDocRO", "init_audit_response_doc_ro", "__esmMin", "init_primitives", "ConstrainedEntity", "params", "request", "response", "AuditROEmailLog", "init_audit_ro_email_log", "__esmMin", "init_primitives", "_AuditROEmailLog", "ConstrainedEntity", "params", "AuditConfiguration", "init_config", "__esmMin", "init_primitives", "ConstrainedEntity", "params", "val", "init_entities", "__esmMin", "init_audit_coversheet", "init_audit_email", "init_audit_organization", "init_audit_request", "init_audit_bulk_request", "init_audit_request_internal", "init_audit_response", "init_audit_bulk_response", "init_audit_response_doc", "init_audit_response_doc_ro", "init_audit_ro_email_log", "init_config", "mapObjectToEntity", "inputObject", "targetEntity", "DEBUG", "key", "mapValueToEntityProperty", "propertyName", "inputValue", "mapObjectToViewField", "inVal", "fieldMapping", "outVal", "item", "generateObject", "fieldMap", "mapEntityToObject", "input", "selectedFields", "entity", "allWriteableFieldsSet", "field", "allWriteableFields", "storedFieldKey", "mapViewFieldToValue", "DbContext", "EntitySet", "init_orm", "__esmMin", "init_entities", "init_infrastructure", "Page", "copyFileAsync", "entityType", "set", "val", "newSet", "allFieldsSet", "e", "SPList", "id", "fields", "result", "newEntity", "columnFilters", "orderByColumn", "sortAsc", "count", "includePermissions", "includeFolders", "returnCursor", "results", "cursor", "resultObj", "refresh", "entityToLoad", "folderPath", "writeableEntity", "newId", "entityId", "valuePairs", "reset", "itemPermissions", "relFolderPath", "entities", "salValuePairs", "vp", "file", "filename", "updates", "progress", "itemId", "args", "sourceFolder", "targetFolder", "name", "title", "resolve", "reject", "fileRef", "init_sal", "__esmMin", "init_orm", "application_db_context_exports", "__export", "ApplicationDbContext", "appContext", "init_application_db_context", "__esmMin", "init_entities", "init_sal", "DbContext", "EntitySet", "AuditBulkRequest", "AuditBulkResponse", "AuditConfiguration", "AuditCoversheet", "AuditEmail", "AuditOrganization", "AuditResponse", "AuditResponseDoc", "AuditResponseDocRO", "AuditRequest", "AuditRequestsInternal", "AuditROEmailLog", "html", "_a", "iaDbTemplate", "__template", "InitReport", "m_siteUrl", "m_listTitleRequests", "m_listNameRequests", "m_listTitleRequestsInternal", "m_listNameRequestsInternal", "m_listTitleResponses", "m_listNameResponses", "m_libTitleRequestDocs", "m_libNameRequestDocs", "m_libTitleCoverSheet", "m_libNameCoverSheet", "m_libTitleResponseDocs", "m_libNameResponseDocs", "m_libTitleResponseDocsEA", "m_libNameResponseDocsEA", "m_listTitleActionOffices", "m_listNameActionOffices", "m_listTitleEmailHistory", "m_listNameEmailHistory", "m_listTitleBulkResponses", "m_listNameBulkResponses", "m_listTitleBulkPermissions", "m_listNameBulkPermissions", "m_groupNameSpecialPermName1", "m_groupNameSpecialPermName2", "m_groupNameQA", "m_groupNameEA", "m_libResponseDocsLibraryGUID", "m_arrSiteGroups", "m_arrAOs", "m_fnRefresh", "hard", "curPath", "tabIndex", "responseNumOpen", "responseNumProcessed", "m_fnOnLoadDisplayTimeStamp", "curDate", "m_fnOnLoadDisplayTabAndResponse", "paramTabIndex", "bFiltered", "paramResponseNum", "m_fnOnLoadFilterResponses", "responseStatus1", "responseStatus2", "count", "cntOpen", "cntReOpened", "resStatus1", "resStatus2", "eacher", "reqStatus", "resStatus", "m_fnLoadSiteGroups", "itemColl", "listItemEnumerator", "oListItem", "id", "loginName", "title", "groupObject", "m_fnGetSPSiteGroup", "groupName", "userGroup", "x", "m_fnLoadActionOffices", "aoObject", "m_fnGetAOSPGroupName", "oGroup", "m_fnCheckSPItemHasGroupPermission", "item", "permissionLevel", "match", "roleAssignments", "rolesEnumerator", "role", "roleMember", "memberTitleName", "roleDefs", "roleDefsEnumerator", "rd", "rdName", "m_fnGoToResponse", "responseTitle", "isIA", "bFound", "m_fnGetResponseDocStyleTag2", "documentStatus", "styleTag", "m_fnGetResponseDocStyleTag", "m_fnCheckIfEmailFolderExists", "items", "requestNumber", "bFolderExists", "folderItem", "itemName", "m_cntAddToEmailFolder", "m_cntAddedToEmailFolder", "m_fnCreateEmailFolder", "list", "requestItem", "OnComplete", "currCtx", "web", "itemCreateInfo", "roleDefBindingCollAdmin", "roleDefBindingCollContribute", "roleDefBindingCollRestrictedRead", "roleDefBindingCollRestrictedContribute", "spGroupQA", "onUpdatePermsSucceeded", "arrActionOffice", "actionOfficeName", "actionOfficeGroupName", "actionOfficeGroup", "onUpdateAOPermsSucceeded", "onUpdateAOPermsFailed", "sender", "args", "currCtx2", "web2", "data", "onUpdatePermsFailed", "m_fnSortResponseTitleNoCase", "a", "b", "aTitle", "bTitle", "newA", "newB", "aIndex", "subA", "lastA", "intA", "newIntA", "bIndex", "subB", "lastB", "intB", "newIntB", "m_fnSortResponseObjectNoCase", "m_fnSortNoCase", "m_fnSortDate", "m_fnAddOptions", "arr", "ddlID", "dateSort", "responseSort", "rOptions", "j", "arrLength", "option", "thisDDL", "m_fnExistsInArr", "val", "m_fnGetTrueFalseIcon", "m_fnGetFriendlyDisplayName", "fieldName", "user", "m_fnPadDigits", "n", "totalDigits", "pd", "i", "m_fnPreciseRound", "num", "decimals", "sign", "m_fnGetFriendlyFileSize", "fileSize", "m_fnISODateString", "d", "pad", "m_fnBindHandlerResponseDoc", "event", "curIcon", "m_fnGetLookupFormField", "fieldTitle", "m_fnGetLookupDisplayText", "m_fnSetLookupFromFieldNameByText", "text", "theSelect", "m_fnGetTagFromIdentifierAndTitle", "theInput", "opt", "m_fnSetSelectedOptionByText", "select", "opts", "optLength", "tagName", "identifier", "idLength", "tags", "tagID", "m_fnViewUserManuals", "docType", "options", "m_fnPrintPage", "pageTitle", "divTbl", "siteUrl", "cssLink1", "cssLink2", "divOutput", "updatedDivOutput", "printDateString", "cssFile1", "cssFile2", "def1", "def2", "cssFileText", "html", "printWP", "m_fnExportToCsv", "fileName", "tableName", "removeHeader", "m_fnGetCellValues", "csv", "m_fnConvertToCsv", "uri", "downloadLink", "table", "deets", "tableArray", "r", "c", "m", "objArray", "array", "str", "line", "index", "value", "array1", "publicMembers", "libGUID", "html", "searchSelectTemplate", "searchSelectTemplate", "opt", "index", "li", "searchText", "optContainsText", "shouldBeShown", "div", "count", "keyDirection", "activeItemIndex", "item", "activeItem", "initial", "closeCopy", "selectedItemDivs", "itemGroup", "itemText", "close", "svg", "mutationCallback", "mutationList", "observer", "mutation", "attributeChangeMutationCallback", "e", "self", "row", "cell", "headerCells", "sortOrder", "sortIndex", "th", "cellIndex", "classList", "i", "collator", "rowsArr", "tr1", "tr2", "tr1Text", "tr2Text", "e", "otherTh", "event", "filterTypes", "checkboxElement", "dateRangeElement", "multiselectElement", "searchElement", "filters", "filterCell", "index", "filterType", "filter", "col", "value", "div", "printButton", "PrintPage", "exportButton", "fileName", "exportTableToCsv", "tr", "tfoot", "itemCount", "tableSearchEventListener", "tableFilterEventListener", "sortEventListener", "MAX_TIMESTAMP", "tbl", "colIndex", "text", "datesChangeHandler", "dateStartElement", "dateEndElement", "labelFrom", "labelTo", "clearButton", "clearDateInputs", "inputsContainer", "filtersContainer", "presetsSelect", "ds", "de", "dmonth", "cells", "dateStart", "dateEnd", "val", "cellDate", "searchTerm", "searchCells", "rows", "inputElem", "search", "filterTerm", "filterCells", "isChecked", "filterCheckBoxCells", "selectElem", "selectVals", "populateOptions", "opts", "opt", "tblRowsUpdate", "setFilter", "selectedVals", "isClear", "filterArr", "filterTerms", "filterCellsArr", "searchTermsArr", "term", "divTbl", "pageTitle", "curDate", "siteUrl", "cssLink1", "cssLink2", "divOutput", "updatedDivOutput", "printDateString", "cssFile1", "cssFile2", "def1", "def2", "cssFileText", "html", "printWP", "table", "removeHeader", "data", "getCellValues", "csv", "ConvertToCsv", "uri", "downloadLink", "deets", "curText", "tableArray", "r", "n", "c", "m", "objArray", "array", "str", "line", "array1", "init_infrastructure", "init_application_db_context", "state", "setUrlParam", "param", "newVal", "getUrlParam", "search", "regex", "query", "urlParams", "results", "TabsModule", "tabOpts", "urlParam", "tab", "tabId", "tabById", "newTab", "setUrlParam", "event", "Tab", "id", "linkText", "template", "init_comment_chain_module", "init_active_viewers_module", "init_infrastructure", "init_infrastructure", "modalDialogTemplate", "html", "componentName", "currentDialogs", "toggle", "showModalDialog", "dialogOptions", "ModalDialogModule", "dialogOpts", "show", "result", "node", "dragElement", "resizeDialog", "directRegisterComponent", "modalDialogTemplate", "elmnt", "pos1", "pos2", "pos3", "pos4", "dragger", "dragMouseDown", "e", "closeDragElement", "elementDrag", "html", "BaseForm", "entity", "view", "key", "field", "showErrors", "componentName", "DefaultForm", "BaseForm", "entity", "view", "displayMode", "template", "html", "FieldDisplayModes", "DispForm", "entity", "view", "DefaultForm", "FieldDisplayModes", "init_entities", "init_entities", "init_application_db_context", "approveResponseDocsForRO", "requestId", "responseDocsToApproveIds", "request", "getRequestById", "requestingOffice", "allRequestResponseDocs", "getRequestResponseDocs", "allRequestResponses", "getRequestResponses", "responseDoc", "accumulator", "responseDocResponse", "response", "roResponseDocROFolderPath", "ensureRequestAuditResponseDocsROFolder", "roEmailLogItem", "ensureRequestROEmailLogItem", "cntApprovedResponseDocs", "responseLogBody", "responseDocId", "AuditResponseDocStates", "newResponseDocFileName", "getNewResponseDocTitle", "source", "dest", "appContext", "newRoFile", "AuditResponseDocRO", "init_application_db_context", "init_entities", "init_application_db_context", "init_store", "init_infrastructure", "init_people_manager", "taskStates", "Task", "msg", "blocking", "ProgressTask", "_ProgressTask", "percentDone", "params", "runningTasks", "blockingTasks", "task", "TaskDef", "msg", "blocking", "type", "taskDefs", "responseTitle", "coversheetName", "page", "entitySet", "responseDocTitle", "ProgressTask", "addTask", "taskDef", "newTask", "Task", "finishTask", "activeTask", "removeTask", "taskToRemove", "roleNames", "ensureAllAppPerms", "ensureAllPagePerms", "ensureAllListPermissions", "ensureDBPermissions", "page", "ensurePagePerms", "aos", "auditOrganizationStore", "ao", "ORGROLES", "ros", "qas", "sps", "pageTitle", "orgs", "ensurePageTask", "addTask", "taskDefs", "appContext", "finishTask", "reset", "principalIds", "role", "org", "orgId", "resetPageTask", "owners", "members", "visitors", "getSiteGroups", "baseRoles", "Role", "RoleDef", "newRoles", "newPerms", "ItemPermissions", "getPeopleByOrgRole", "orgType", "People", "qaRestrictedContributeRoles", "principal", "qaRestrictedReadRoles", "roRestrictedReadRoles", "setPerm", "ensureListTask", "ensureEntitySetPerms", "entitySet", "permissions", "curPerms", "resetEntitySetPerms", "missingPermission", "newRole", "existingRole", "curRole", "curRoleDefNames", "roleDef", "reason", "resetEntitySetPermsTask", "init_people_manager", "init_infrastructure", "init_audit_ro_email_log", "ensureROEmailFolder", "appContext", "newFolderId", "owners", "members", "visitors", "getSiteGroups", "qaGroup", "getQAGroup", "newPermissions", "ItemPermissions", "roleNames", "ensureRequestROEmailLogItem", "requestingOffice", "logItemTitle", "auditRoEmailLogItem", "newLogItem", "AuditROEmailLog", "init_application_db_context", "init_people_manager", "init_infrastructure", "init_entities", "init_application_db_context", "init_people_manager", "init_infrastructure", "init_entities", "uploadRequestCoversheetFile", "file", "request", "actionOffices", "fileName", "reqNum", "newFileName", "getNewFileNameForSensitivity", "uploadCoversheetTask", "addTask", "taskDefs", "fileMetadata", "ao", "newCoversheet", "appContext", "currentBlock", "totalBlocks", "breakCoversheetPermissions", "finishTask", "deleteRequestCoversheetById", "coversheetId", "coversheet", "deleteRequestCoversheet", "deleteItemTask", "updateRequestCoverSheet", "coverSheet", "updateCoversheetTask", "AuditCoversheet", "getNewFileNameForSensitivity", "fileName", "oldSensitivity", "requestSensitivity", "newFileName", "curDocFileNameAndExt", "curDocFileName", "curDocExt", "breakCoversheetPermissions", "coversheet", "grantQARead", "breakCoversheetPermsTask", "addTask", "taskDefs", "curPerms", "appContext", "defaultGroups", "getSiteGroups", "qaGroup", "getQAGroup", "qaHasRead", "specialPermGroup1", "specialPermGroup2", "getSpecialPermGroups", "special1HasRead", "special2HasRead", "newPerms", "ItemPermissions", "roleNames", "ao", "People", "finishTask", "init_store", "getRequestById", "id", "appContext", "getRequestByTitle", "title", "addNewRequest", "request", "fields", "updateRequest", "AuditRequest", "deleteRequest", "requestId", "requestTitle", "promises", "getRequestCoversheets", "coversheet", "deleteRequestCoversheet", "resolve", "deleteItemTask", "addTask", "taskDefs", "finishTask", "getRequestResponses", "response", "requestInternalItem", "getRequestInternalItem", "ensureRequestAuditResponseDocsROFolder", "reqNum", "requestingOfficeId", "roFolder", "requestingOffice", "auditOrganizationStore", "ao", "newRoFolderId", "owners", "members", "visitors", "getSiteGroups", "qaGroup", "getQAGroup", "newPermissions", "ItemPermissions", "roleNames", "onAddNewRequest", "ensureRequestPermissions", "ensureAuditEmailFolder", "ensureRequestInternalItem", "newFolderId", "newItemPermissions", "getPeopleByUsername", "result", "breakRequestPermissions", "requestInternalResult", "requestInternal", "AuditRequestsInternal", "responseStatus", "curPerms", "defaultGroups", "qaHasRead", "special1Group", "special2Group", "special1HasRead", "special2HasRead", "newRequestPermissions", "AuditResponseStates", "People", "getRequestResponseDocs", "init_entities", "init_application_db_context", "addResponse", "request", "response", "responseTitle", "getResponseTitle", "newResponseTask", "addTask", "taskDefs", "AuditResponseStates", "appContext", "e", "finishTask", "updateResponse", "updateResponseTask", "currentResponseSensitivity", "AuditResponse", "deleteResponseAndFolder", "deleteFolderTask", "deleteItemTask", "updateResponseDoc", "responseDoc", "updateResponseDocTask", "AuditResponseDoc", "closeResponseById", "responseId", "response", "appContext", "closeResponse", "closeResponseTask", "addTask", "taskDefs", "AuditResponse", "finishTask", "uploadResponseDocFile", "file", "uploadResponseDocTask", "fileMetadata", "currentBlock", "totalBlocks", "getResponseTitle", "request", "getNewResponseDocTitle", "responseDoc", "oldResponseDocTitle", "createdDate", "responseName", "sensitivity", "newResponseDocTitle", "docName", "docExt", "init_people_manager", "init_store", "init_infrastructure", "init_infrastructure", "newRequestFormTemplate", "html", "newRequestFormComponentName", "NewRequestFormComponent", "params", "AuditRequest", "NewRequestFormModule", "BaseForm", "newRequest", "onComplete", "request", "fy", "configurationsStore", "reqType", "AUDITREQUESTSTATES", "addNewRequest", "e", "directRegisterComponent", "newRequestFormTemplate", "init_application_db_context", "init_infrastructure", "init_entities", "init_infrastructure", "init_entities", "init_infrastructure", "confirmApproveResponseDocFormTemplate", "html", "componentName", "ConfirmApproveResponseDocForm", "request", "response", "responseDocs", "AUDITREQUESTTYPES", "responseDocIds", "doc", "result", "approveResponseDocsForRO", "m_fnApproveResponseDocsForQA", "directRegisterComponent", "confirmApproveResponseDocFormTemplate", "init_infrastructure", "init_infrastructure", "confirmRejectResponseDocFormTemplate", "html", "componentName", "ConfirmRejectResponseDocForm", "request", "response", "responseDocs", "responseDoc", "m_fnRejectResponseDoc", "directRegisterComponent", "confirmRejectResponseDocFormTemplate", "init_infrastructure", "init_infrastructure", "confirmDeleteRequestFormTemplate", "html", "componentName", "ConfirmDeleteRequestForm", "request", "deleteRequest", "directRegisterComponent", "confirmDeleteRequestFormTemplate", "registerComponent", "init_infrastructure", "requestDetailViewTemplate", "html", "init_infrastructure", "requestDetailCoversheetsTabTemplate", "html", "init_infrastructure", "requestDetailResponsesTabTemplate", "html", "init_infrastructure", "requestDetailResponseDocsTabTemplate", "html", "componentName", "requestDetailUrlParamKey", "RequestDetailView", "bDisplayClose", "currentRequest", "arrCurrentRequestCoverSheets", "ModalDialog", "ClickEditCoversheet", "TabsModule", "newRequest", "request", "getRequestById", "Tab", "response", "ResponseItem", "AUDITREQUESTTYPES", "ResponseDocSummary", "cnt", "responseSummary", "AUDITREQUESTSTATES", "collapse", "responseDocSummary", "getUrlParam", "defaultTab", "appContext", "options", "ConfirmDeleteRequestForm", "showModalDialog", "m_fnRefreshData", "reqId", "newFiles", "file", "coversheet", "uploadRequestCoversheetFile", "deleteRequestCoversheetById", "responseDocsSummary", "responseTitle", "helpDlg", "oResponseDocsForApproval", "responseDoc", "ConfirmApproveResponseDocForm", "oResponseDoc", "allDocs", "AuditResponseDocStates", "AuditResponseStates", "result", "ConfirmRejectResponseDocForm", "directRegisterComponent", "requestDetailViewTemplate", "requestDetailCoversheetsTabTemplate", "requestDetailResponsesTabTemplate", "requestDetailResponseDocsTabTemplate", "report", "closeResponseById", "deleteResponseAndFolder", "files", "getRequestByTitle", "actionOfficeId", "actionOfficeIds", "promises", "resolve", "newSheet", "uploadResponseDocFile", "onc", "oRequest", "oResponse", "showBulkApprove", "arrResponseDocs", "z", "init_infrastructure", "editRequestFormTemplate", "html", "init_infrastructure", "componentName", "EditRequestForm", "BaseForm", "entity", "request", "updateRequest", "e", "field", "directRegisterComponent", "editRequestFormTemplate", "init_infrastructure", "init_infrastructure", "editCoverSheetFormTemplate", "html", "componentName", "EditCoverSheetForm", "BaseForm", "entity", "coverSheet", "updateRequestCoverSheet", "e", "field", "directRegisterComponent", "editCoverSheetFormTemplate", "init_audit_response", "init_entities", "init_infrastructure", "init_infrastructure", "newResponseFormTemplate", "html", "componentName", "NewResponseForm", "BaseForm", "entity", "AuditResponse", "response", "addResponse", "e", "field", "directRegisterComponent", "newResponseFormTemplate", "init_entities", "init_infrastructure", "init_infrastructure", "editResponseFormTemplate", "html", "componentName", "EditResponseForm", "BaseForm", "entity", "AuditResponse", "newValue", "AuditResponseStates", "response", "curUser", "currentUser", "updateResponse", "e", "field", "directRegisterComponent", "editResponseFormTemplate", "init_infrastructure", "init_entities", "init_infrastructure", "editResponseDocFormTemplate", "html", "componentName", "EditResponseDocForm", "BaseForm", "entity", "AuditResponseDoc", "newValue", "responseDoc", "request", "response", "updateResponseDoc", "e", "field", "errors", "requestStatus", "responseStatus", "AUDITREQUESTSTATES", "AuditResponseStates", "directRegisterComponent", "editResponseDocFormTemplate", "init_store", "init_entities", "init_infrastructure", "init_application_db_context", "init_infrastructure", "init_infrastructure", "bulkAddRequestTemplate", "html", "componentName", "BulkAddRequestForm", "toggle", "appContext", "bulkRequests", "bulkRequest", "bulkRequestItems", "failedInserts", "insertPromises", "bulkRequestItem", "newRequest", "addNewRequest", "onAddNewRequest", "e", "insertResults", "directRegisterComponent", "bulkAddRequestTemplate", "iaDbTemplate", "requestParam", "InitReport", "InitSal", "configurationsPromise", "appContext", "configurations", "config", "configurationsStore", "auditOrganizationsPromise", "organizations", "auditOrganizationStore", "sortByTitle", "ensureDBPermissions", "SetTimer", "intervalRefreshID", "divVal", "count", "_myViewModel", "ViewModel", "LoadInfo", "publicMembers", "m_fnLoadData", "m_fnViewPermissions", "m_fnViewLateRequests", "m_fnViewResponseDocsToday", "m_fnViewReturnedDocs", "requestNum", "responseTitle", "m_fnGoToRequest", "m_bIsTransactionExecuting", "m_fnRefresh", "m_fnCreateRequestInternalItem", "m_libCoverSheetLibraryGUID", "m_libRequestDocsLibraryGUID", "m_libResponseDocsLibraryGUID", "m_coversheetDocsLibrary", "m_requestDocsLibrary", "m_responseDocsLibrary", "m_bigMap", "m_getArrRequests", "key", "value", "m_arrRequestsToClose", "m_arrPermissionsResponseFolders", "m_userPermissionAccess", "m_PageItems", "m_itemID", "m_requestNum", "m_responseTitle", "m_responseStatus", "notifyId", "m_bIsSiteOwner", "m_sGoToResponseTitle", "m_oRequestTitleAndDocCount", "m_oResponseTitleAndDocCount", "m_sResponseStatusToFilterOn", "_myViewModel", "ViewModel", "self", "item", "e", "req", "currentDialogs", "Tab", "TabsModule", "runningTasks", "blockingTasks", "m_fnCreateRequest", "ensureAllAppPerms", "m_fnBulkAddRequest", "oRequest", "m_fnGoToRequest", "m_fnViewRequest", "m_fnEditRequest", "oRD", "oCS", "m_fnViewCoverSheet", "m_fnEditCoverSheet", "m_fnCloseRequest", "m_fnGrantSpecialPermissions", "m_fnRemoveSpecialPermissions", "m_fnSendEmail", "m_fnViewEmailHistoryFolder", "m_fnSyncEmailActionOffices", "oResponse", "m_fnViewResponse", "m_fnEditResponse", "m_fnReviewingResponse", "m_fnReOpenResponse", "m_fnAddResponse", "m_fnBulkAddResponse", "m_fnBulkEditResponse", "oResponseDoc", "m_fnCheckInResponseDoc", "m_fnViewResponseDocFolder", "m_fnViewResponseDoc", "m_fnEditResponseDoc", "m_fnDeleteResponseDoc", "m_fnResendRejectedResponseDocToQA", "RequestDetailView", "prop", "value", "arrayChanges", "newValue", "paramTabIndex", "paramRequestNum", "paramResNum", "m_sResponseStatusToFilterOn", "requestUnloadEventHandler", "event", "currentRequestUnloadEventHandler", "oldValue", "m_bigMap", "m_fnRequeryRequest", "requestParam", "request", "setUrlParam", "LoadInfo", "currCtx", "web", "requestList", "requestQuery", "m_requestItems", "requestInternalList", "requestInternalQuery", "m_requestInternalItems", "responseList", "responseQuery", "m_responseItems", "responseDocsLib", "responseDocsQuery", "m_ResponseDocsItems", "m_groupColl", "aoList", "aoQuery", "m_aoItems", "ob", "m_userPermissionAccess", "OnSuccess", "OnFailure", "sender", "args", "m_bIsSiteOwner", "OnSuccessLoadPages", "m_fnLoadInitialData", "ensureROEmailFolder", "OnFailureLoadPages", "pagesLib", "pagesQuery", "m_PageItems", "emailList", "emailListQuery", "emailListFolderItemsEA", "m_fnLoadRemainder", "statusId", "m_fnRefresh", "requestNumber", "m_fnLoadData", "LoadRequests", "LoadRequestsInternal", "LoadResponses", "LoadResponseDocs", "LoadResponseCounts", "DisplayRequestsThatShouldClose", "LoadTabStatusReport1", "LoadTabStatusReport2", "m_fnRefreshData", "requestId", "refreshTask", "addTask", "taskDefs", "m_aRequestItem", "resolve", "reject", "m_fnGetRequestByID", "listItemEnumerator", "oListItem", "bUpdateRequestPermissions", "x", "sActionOfficeGroupNameTitle", "sActionOfficeGroupName", "bAOHasAccess", "m_waitDialog", "m_fnBreakRequestPermissions", "match1", "match2", "permissionsToCheck", "m_arrRequestsToClose", "oIt", "LoadTabRequestInfoCoverSheets", "LoadTabRequestInfoResponses", "LoadTabRequestInfoResponseDocs", "finishTask", "RequestFinishedLoading", "paramSection", "m_coversheetDocsLibrary", "m_requestDocsLibrary", "m_responseDocsLibrary", "m_libResponseDocsLibraryGUID", "m_libCoverSheetLibraryGUID", "m_libRequestDocsLibraryGUID", "m_fnCheckIfResponsePermissionsNeedUpdating", "requestStatus", "title", "OnCompletedChecking", "oResponse", "m_bigMap", "m_fnBreakResponseAndFolderPermissions", "LoadRequests", "m_requestItems", "arrRequests", "listItemEnumerator", "oListItem", "id", "number", "status", "reqType", "subject", "sensitivity", "requestingOffice", "fiscalYear", "sample", "dueDate", "internalDueDate", "receiptDate", "closedDate", "arrAOs", "arrActionOffice", "tempAOs", "x", "arrEmailAOs", "arrEmailActionOffice", "comments", "emailSent", "reviewer", "owner", "relatedAudit", "actionItems", "closedBy", "requestObject", "err", "LoadRequestsInternal", "m_requestInternalItems", "reqNum", "m_fnGetRequestByNumber", "CommentChainModuleLegacy", "ActiveViewersModuleLegacy", "LoadResponses", "responseItemsColl", "oRequestBigMap", "returnReason", "responseObject", "modified", "LoadResponseDocs", "m_ResponseDocsItems", "_myViewModel", "arrResponseDocsCheckedOut", "m_fnMapResponseDocs", "checkedOutBy", "requestNumber", "oResponseDocCheckedOut", "responseDocItemsColl", "responseDocID", "responseID", "oRequest", "response", "responseDocObject", "fileSize", "modifiedDate", "LoadResponseCounts", "m_arrRequests", "m_getArrRequests", "m_oRequestTitleAndDocCount", "m_oResponseTitleAndDocCount", "requestLength", "responseLength", "y", "responseCount", "curCount", "LoadResponseDocFolders", "m_ResponseDocsFoldersItems", "m_arrPermissionsResponseFolders", "cntToBreak", "cntBroken", "itemName", "itemId", "itemUrl", "OnSuccessUpdateTitle", "sender", "args", "OnFailureUpdateTitle", "currCtx", "web", "objFold", "m_bIsSiteOwner", "roleAssignments", "rolesEnumerator", "role", "roleMember", "memeberLoginName", "memberTitleName", "permissionType", "principalType", "roleDefs", "roleDefsEnumerator", "rd", "rdName", "LoadTabRequestInfoCoverSheets", "oRequest", "_myViewModel", "arrCS", "currCtx", "web", "coverSheetLib", "coverSheetQuery", "m_CoverSheetItems", "m_bIsSiteOwner", "resolve", "reject", "e", "listItemEnumerator", "oListItem", "number", "coversheetObject", "arrActionOffice", "actionOffices", "y", "m_fnLoadResponseDocFolder", "responseTitle", "OnComplete", "responseList", "responseQuery", "m_aResponseItem", "responseDocsLibFolderslist", "responseDocsLibFolderslistQuery", "m_ResponseDocsFoldersItems", "sender", "args", "oResponseItem", "oResponse", "m_bigMap", "LoadResponseDocFolders", "LoadTabRequestInfoResponses", "m_sGoToResponseTitle", "doneCheckingResponseFolder", "m_fnCheckIfResponsePermissionsNeedUpdating", "m_notifyIDLoadingResponses", "m_subsetResponseItems", "statusId", "LoadResponses", "m_fnBreakResponsePermissions", "sResponses", "responseCount", "a", "b", "notifyId", "arrResponses", "groupPerms", "x", "m_arrPermissionsResponseFolders", "grouppermissionsArr", "z", "specialPerms", "arrRequestActionOffices", "responseActionOfficeIsInRequest", "styleTag", "toolTip", "ActiveViewersModuleLegacy", "m_fnHighlightResponse", "resetColor", "index", "LoadTabRequestInfoResponseDocs", "responseDocsLib", "responseDocsQuery", "requestResponseDocsItems", "response", "m_fnMapResponseDocs", "bHasResponseDoc", "oResponseDoc", "RequestFinishedLoading", "executeQuery", "DisplayRequestsThatShouldClose", "m_arrRequests", "m_getArrRequests", "m_arrRequestsToClose", "countClosed", "lastClosedDate", "lastClosedBy", "lastResponseId", "sLastClosedDate", "closedDate", "LoadTabStatusReport1", "arr", "requestArr", "arrInternalAlmostDue", "arrInternalPastDue", "arrAlmostDue", "arrPastDue", "arrRequestsWithNoResponses", "arrRequestsWithNoEmailSent", "arrLength", "internalDueDateStyle", "dueDateStyle", "m_fnIsRequestPastDue", "m_fnIsRequestAlmostDue", "resCount", "m_oRequestTitleAndDocCount", "aRequest", "LoadTabStatusReport2", "arrSubmittedResponsesByAO", "arrUnsubmittedResponseDocs", "arrResponsesReadyToClose", "responseArr", "requestLength", "responseReadyToClose", "AuditResponseStates", "responseDoc", "AuditResponseDocStates", "responseLength", "responseStatus", "m_oResponseTitleAndDocCount", "responseUnsubmittedDocs", "aResponse", "AUDITREQUESTTYPES", "m_fnViewLateRequests", "m_fnViewPermissions", "m_fnViewResponseDocsToday", "m_fnViewReturnedDocs", "dueDate", "todayDate", "one_day", "difference", "dueDateD", "m_fnCreateRequest", "options", "NewRequestFormComponent", "OnCallbackFormNewRequest", "showModalDialog", "m_fnBulkAddRequest", "BulkAddRequestForm", "OnCallbackFormReload", "m_fnViewRequest", "id", "m_bIsTransactionExecuting", "request", "appContext", "requestViewForm", "DispForm", "OnCallbackForm", "m_fnEditRequest", "requestNum", "m_itemID", "m_requestNum", "form", "EditRequestForm", "OnCallbackFormEditRequest", "m_fnViewCoverSheet", "coverSheet", "coverSheetViewForm", "m_fnEditCoverSheet", "EditCoverSheetForm", "OnCallbackFormCoverSheet", "m_fnBulkAddResponse", "OnCallbackFormBulkAddResponse", "GetSourceUrlForForms", "m_fnBulkEditResponse", "OnCallbackFormBulkEditResponse", "m_fnBreakCoversheetPermissions", "m_fnBreakResponseFolderPermissions", "m_fnGetNextSampleNumber", "requestNumber", "sampleNumber", "m_fnGetRequestByNumber", "m_fnAddResponse", "reqNum", "newResponse", "AuditResponse", "NewResponseForm", "OnCallbackFormNewResponse", "m_fnViewResponse", "m_fnEditResponse", "m_responseTitle", "m_responseStatus", "EditResponseForm", "OnCallbackFormEditResponse", "m_fnReviewingResponse", "activeViewers", "m_fnViewResponseDoc", "requestID", "responseID", "m_fnEditResponseDoc", "EditResponseDocForm", "m_fnApproveResponseDocsForQA", "oResponseDocs", "responseApprovedResponseDocs", "ctx2", "oList", "newResponseDocFileName", "m_fnGetNewResponseDocTitle", "approveResponseDocTask", "addTask", "taskDefs", "finishTask", "ctx", "m_fnBreakResponseAndFolderPermissions", "m_fnBreakRequestPermissions", "coversheet", "m_fnNotifyQAApprovalPending", "m_fnRejectResponseDoc", "rejectReason", "clientContext", "sensitivity", "siteUrl", "filePath", "lastInd", "urlpath", "folderPath", "aresponseDocList", "aresponseDocQuery", "aresponseDocItems", "aresponseList", "aresponseQuery", "aresponseItems", "emailList", "emailListQuery", "emailListFolderItems", "m_fnCheckInResponseDoc", "folder", "fileName", "m_libResponseDocsLibraryGUID", "m_fnViewResponseDocFolder", "title", "m_fnViewEmailHistoryFolder", "m_fnDeleteResponseDoc", "itemID", "OnSuccess", "m_fnRefresh", "OnFailure", "m_fnResendRejectedResponseDocToQA", "m_fnRefreshData", "m_fnReOpenResponse", "currCtx2", "oRequestBigMap", "curRequestStatus", "m_fnCloseRequest", "requestNumberToClose", "oIt", "closedBy", "m_waitDialog", "doneUpdatingResponses", "m_fnUpdateAllResponsePermissions", "m_fnGetRequestByID", "key", "value", "m_fnFormatEmailBodyToAO", "oRequest", "responseTitles", "poc", "emailText", "sortNumber", "a", "b", "responseTitleBody", "x", "m_fnSyncEmailActionOffices", "requestID", "m_bIsSiteOwner", "m_bIsTransactionExecuting", "currCtx", "web", "m_fnGetRequestByID", "emailActionOffices", "requestList", "oListItem", "m_fnRefreshData", "sender", "args", "m_fnRefresh", "m_fnSendEmail", "responseCount", "arrEmailActionOffice", "actionOffice", "arrEmails", "y", "oResponse", "actionOfficeGroupName", "actionOfficeGroup", "ao", "emailTo", "bFound", "oResSample", "emailObject", "m_waitDialog", "emailList", "emailListQuery", "emailListFolderItems", "OnSuccess", "m_emailCount", "cnt", "emailSubject", "itemCreateInfo", "OnFailure", "m_fnNotifyQAApprovalPending", "oResponseDocs", "reqNum", "responseApprovedResponseDocs", "responseDoc", "oListItemEmail", "resolve", "reject", "m_fnUpdateSensitivityOnRequest", "requestNumber", "requestSensitivity", "oldSensitivity", "OnComplete", "m_cntResponseDocsSensToUpdate", "responseDocsLib", "responseDocsQuery", "responseDocsItems", "earesponseDocsLib", "earesponseDocsQuery", "earesponseDocsItems", "requestDocLib", "requestDocQuery", "requestDocItems", "coverSheetLib", "coverSheetQuery", "coverSheetItems", "statusId", "listItemEnumerator", "docStatus", "updateDocPromises", "responseTitle", "curFileName", "newFileName", "m_fnGetNewResponseDocTitle", "listItemEnumerator2", "curDocFileNameAndExt", "curDocFileName", "curDocExt", "curDocResponseTitle", "dateStamp", "listItemEnumerator3", "m_fnGetNewFileNameForSensitivity", "listItemEnumerator4", "responseDocItem", "responseName", "sensitivity", "createdDate", "newResponseDocTitle", "oldResponseDocTitle", "docName", "docExt", "m_fnBreakRequestPermissions", "refreshPageOnUpdate", "responseStatus", "breakRequestPermissionsTask", "addTask", "taskDefs", "currentUser", "ownerGroup", "memberGroup", "visitorGroup", "qaHasRead", "special1HasRead", "special2HasRead", "roleDefBindingCollAdmin", "roleDefBindingCollContribute", "roleDefBindingCollRestrictedRead", "roleDefBindingCollRestrictedContribute", "spGroupQA", "group1SpecialPerm", "group2SpecialPerm", "onUpdateReqPermsSucceeed", "m_CntRequestAOsToAdd", "m_CntRequestAOsAdded", "arrActionOffice", "actionOfficeName", "onUpdatedReqAOSucceeded", "onUpdatedReqAOFailed", "currCtx2", "web2", "data", "onUpdateReqPermsFailed", "finishTask", "m_cntAOToAddToEmailFolder", "m_cntAOAddedToEmailFolder", "m_fnBreakEmailFolderPermissions", "oRequestItem", "breakEmailFolderPermissionsTask", "onUpdateEmailFolderPermsSucceeed", "onAOAddedToEmailFolderSucceeded", "onAOAddedToEmailFolderFailed", "onUpdateEmailFolderPermsFailed", "m_countCSToAdd", "m_countCSAdded", "oCntCSAOAdd", "m_fnBreakCoversheetPermissions", "grantQARead", "breakCoversheetPermissionsTask", "onUpdatedCSSucceeded", "oActionOffice", "resolve2", "reject2", "onUpdatedCSFailed", "m_fnBreakCoversheetPermissionsOnSpecialPerms", "addSpecialPerms", "e", "csID", "m_fnBreakResponseAndFolderPermissions", "requestStatus", "checkStatus", "bForceGrantSP", "bForceRemoveSP", "breakResponsePermissionsTask", "m_fnBreakResponsePermissions", "permissionsToCheck", "m_fnBreakResponseFolderPermissions", "oListItemFolder", "oListItemResponse", "bCheckStatus", "executeQuery", "m_countAOSPToAdd", "m_countAOSPAdded", "m_fnGrantAOSpecialPermsOnRequest", "onGrantAOSpecialPermsSucceeded", "onGrantAOSpecialPermsFailed", "m_fnGrantSpecialPermsOnCS", "coversheetItem", "bDoneBreakingCSPermsOnSpecialPerms", "m_countSPResFolderToAdd", "m_countSPResFolderAdded", "m_fnGrantSpecialPermsOnResponseAndFolder", "bBrokeResponseAndFolderPermissions", "bForceAdd", "bForceRemove", "m_fnGrantSpecialPermissions", "m_fnGetRequestByNumber", "cntGranted", "cntToGrant", "onUpdated1", "bDoneGrantingAOSpecialPerms", "bDoneGrantingCSSpecialPerms", "notifyId", "bDoneGrantingSpecialPermsOnResponsesAndFolders", "onFailed1", "m_fnRemoveSpecialPermissions", "id", "cntRemoved", "cntToRemove", "GetSourceUrlForForms", "curPath", "requestNum", "source", "OnCallbackForm", "result", "value", "OnCallbackFormReload", "OnCallbackFormNewRequest", "newRequestTask", "requestQuery", "requestItems", "m_fnCreateRequestInternalItem", "bDoneCreatingEmailFolder", "_myViewModel", "bDoneBreakingReqPermisions", "requestInternalList", "newRequestInternalItem", "m_fnUpdateAllResponsePermissions", "OnCompleteUpdateResponsePerms", "cntResponsesBroken", "oRequestBigMap", "m_bigMap", "cntResponsesToBreak", "response", "m_fnRenameResponses", "oldRrequestNumber", "newRequestNumber", "title", "newTitle", "m_fnRenameResponseFolders", "responseDocsFoldersItems", "oListItemResponseDocFolder", "itemName", "test", "m_fnRenameEmailFolder", "oListItemEmailFolder", "m_fnRenameEAFolder", "eaListFolderItems", "oListItemEAFolder", "OnCallbackFormEditRequest", "m_itemID", "responseDocsLibFolderslist", "responseDocsLibFolderslistQuery", "m_ResponseDocsFoldersItems", "eaList", "eaListQuery", "requestItemId", "curSensitivity", "bChangeSensitivity", "m_requestNum", "doneUpdatingResponses", "doneUpdatingSensitivity", "listItemEnumerator1", "oEmailFolderItem", "oRequest2", "OnCallbackFormCoverSheet", "coversheetList", "coversheetQuery", "coversheetItems", "doneBreakingCS", "OnCallbackFormBulkAddResponse", "OnCallbackFormBulkEditResponse", "OnCallbackFormNewResponse", "responseList", "responseQuery", "responseItems", "responseDocLib", "oListFolderItem", "roleDefBindingColl", "roleDefBindingColl2", "roleDefBindingColl3", "actionOfficeGroupObj", "roleDefBindingColl4", "m_countCSToUpdateOnEditResponse", "m_countCSUpdatedOnEditResponse", "OnCallbackFormEditResponse", "responseDocQuery", "m_responseTitle", "responseFolderItems", "folderPath", "responseDocQuery2", "responseDocSubmittedItems", "responseDocQuery6", "responseDocOpenItems", "responseDocQuery3", "responseDocMarkedForDeletionItems", "responseDocQuery4", "responseDocRejectedItems", "responseDocQuery8", "responseDocSentToQAItems", "newResponseFolderTitle", "responseFolder", "onUpdated1Succeeded", "m_responseStatus", "returnReason", "pocCC", "cntForQA", "oListItem1", "arrItemsToRecyle", "cntRejected", "oResponseDocsForQA", "coversheet", "onUpdated1Failed", "m_fnGoToRequest", "m_sGoToResponseTitle", "m_fnHighlightResponse", "InitReport"]
}
