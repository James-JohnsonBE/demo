{
  "version": 3,
  "sources": ["../../../src/infrastructure/store.js", "../../../src/sal/primitives/validation_error.js", "../../../src/sal/primitives/entity.js", "../../../src/sal/primitives/index.js", "../../../src/sal/fields/BaseField.js", "../../../src/sal/components/fields/BaseFieldModule.js", "../../../src/sal/components/fields/BlobModule.js", "../../../src/sal/components/fields/CheckboxModule.js", "../../../src/sal/components/fields/DateModule.js", "../../../src/sal/components/fields/LookupModule.js", "../../../src/sal/components/fields/PeopleModule.js", "../../../src/sal/components/fields/SearchSelectModule.js", "../../../src/sal/components/fields/SelectModule.js", "../../../src/sal/components/fields/TextAreaModule.js", "../../../src/sal/components/fields/TextModule.js", "../../../src/sal/components/fields/index.js", "../../../src/sal/fields/BlobField.js", "../../../src/sal/fields/CheckboxField.js", "../../../src/sal/fields/DateField.js", "../../../src/sal/fields/LookupField.js", "../../../src/sal/infrastructure/entity_utilities.js", "../../../src/sal/entities/People.js", "../../../src/sal/entities/Page.js", "../../../src/sal/entities/index.js", "../../../src/env.js", "../../../src/sal/infrastructure/knockout_extensions.js", "../../../src/sal/infrastructure/register_components.js", "../../../src/sal/infrastructure/sal.js", "../../../src/sal/infrastructure/authorization.js", "../../../src/sal/infrastructure/index.js", "../../../src/sal/fields/PeopleField.js", "../../../src/sal/fields/SelectField.js", "../../../src/sal/fields/TextAreaField.js", "../../../src/sal/fields/TextField.js", "../../../src/sal/fields/index.js", "../../../src/sal/primitives/constrained_entity.js", "../../../src/entities/audit_coversheet.js", "../../../src/entities/audit_email.js", "../../../src/entities/audit_organization.js", "../../../src/entities/audit_request.js", "../../../src/entities/audit_bulk_request.js", "../../../src/value_objects/comment.js", "../../../src/value_objects/active_viewer.js", "../../../src/components/active_viewers/active_viewers_module.js", "../../../src/components/comment_chain/CommentChainTemplate.js", "../../../src/components/comment_chain/comment_chain_module.js", "../../../src/entities/audit_request_internal.js", "../../../src/services/people_manager.js", "../../../src/entities/audit_response.js", "../../../src/entities/audit_bulk_response.js", "../../../src/entities/audit_response_doc.js", "../../../src/entities/audit_response_doc_ro.js", "../../../src/entities/audit_ro_email_log.js", "../../../src/entities/config.js", "../../../src/entities/index.js", "../../../src/sal/orm.js", "../../../src/sal/index.js", "../../../src/infrastructure/application_db_context.js", "../../../src/common/utilities.js", "../../../src/pages/ao_db/AO_DB_Template.js", "../../../src/common/router.js", "../../../src/components/tabs/tabs_module.js", "../../../src/pages/ao_db/ao_db.js", "../../../src/services/approvals_service.js", "../../../src/services/audit_email_service.js", "../../../src/services/permission_manager.js", "../../../src/value_objects/task.js", "../../../src/services/tasks.js", "../../../src/services/audit_request_service.js", "../../../src/services/coversheet_manager.js", "../../../src/services/audit_response_service.js", "../../../src/sal/components/modal/modalDialog.js", "../../../src/sal/components/modal/ModalDialogTemplate.js", "../../../src/services/index.js"],
  "sourcesContent": ["import { ORGROLES, ORGTYPES } from \"../entities/index.js\";\r\nexport const configurationsStore = {};\r\n\r\nexport const auditOrganizationStore = ko.observableArray();\r\n\r\nexport const allActionOfficesFilter = (org) =>\r\n  ORGROLES.ACTIONOFFICE == org.Role;\r\n\r\nexport const allRequestingOfficesFilter = (org) =>\r\n  ORGROLES.REQUESTINGOFFICE == org.Role;\r\n", "export class ValidationError {\r\n  constructor(source, type, description) {\r\n    this.source = source;\r\n    this.type = type;\r\n    this.description = description;\r\n  }\r\n}\r\n", "export class Entity {\r\n  constructor(params) {\r\n    if (params?.ID) this.ID = params.ID;\r\n    if (params?.Title) this.Title = params.Title;\r\n  }\r\n\r\n  ObservableID = ko.observable();\r\n  ObservableTitle = ko.observable();\r\n\r\n  get id() {\r\n    return this.ObservableID();\r\n  }\r\n\r\n  set id(val) {\r\n    this.ObservableID(val);\r\n  }\r\n\r\n  get Title() {\r\n    return this.ObservableTitle();\r\n  }\r\n\r\n  set Title(val) {\r\n    this.ObservableTitle(val);\r\n  }\r\n}\r\n", "export * from \"./validation_error.js\";\r\nexport * from \"./entity.js\";\r\nexport * from \"./constrained_entity.js\";\r\n", "import { ValidationError } from \"../primitives/validation_error.js\";\r\n\r\nexport class BaseField {\r\n  constructor({\r\n    displayName,\r\n    systemName,\r\n    instructions = null,\r\n    isRequired = false,\r\n    width,\r\n    classList = [],\r\n    Visible = ko.pureComputed(() => true),\r\n  }) {\r\n    this.displayName = displayName;\r\n    this.systemName = systemName;\r\n    this.instructions = instructions;\r\n    this.isRequired = isRequired;\r\n    this.Visible = Visible;\r\n    this.width = width ? \"col-md-\" + width : \"col-md-6\";\r\n    this.classList = classList;\r\n\r\n    this.addFieldRequirement(isRequiredValidationRequirement(this));\r\n  }\r\n\r\n  Value = ko.observable();\r\n\r\n  get = () => this.Value();\r\n  set = (val) => this.Value(val);\r\n  clear = () => {\r\n    if (ko.isObservableArray(this.Value)) this.Value([]);\r\n    else this.Value(null);\r\n  };\r\n\r\n  toString = ko.pureComputed(() => this.Value());\r\n\r\n  toJSON = () => this.Value();\r\n  fromJSON = (val) => this.Value(val);\r\n\r\n  validate = (showErrors = true) => {\r\n    this.ShowErrors(showErrors);\r\n    return this.Errors();\r\n  };\r\n\r\n  _fieldValidationRequirements = ko.observableArray();\r\n\r\n  Errors = ko.pureComputed(() => {\r\n    if (!this.Visible()) return [];\r\n    const errors = this._fieldValidationRequirements()\r\n      .filter((req) => req.requirement())\r\n      .map((req) => req.error);\r\n\r\n    return errors;\r\n  });\r\n\r\n  addFieldRequirement = (requirement) =>\r\n    this._fieldValidationRequirements.push(requirement);\r\n\r\n  IsValid = ko.pureComputed(() => !this.Errors().length);\r\n\r\n  ShowErrors = ko.observable(false);\r\n\r\n  ValidationClass = ko.pureComputed(() => {\r\n    if (!this.ShowErrors()) return;\r\n    return this.Errors().length ? \"is-invalid\" : \"is-valid\";\r\n  });\r\n}\r\n\r\nfunction isRequiredValidationRequirement(field) {\r\n  return {\r\n    requirement: ko.pureComputed(() => {\r\n      // Return true if field fails validation\r\n      const isRequired = ko.unwrap(field.isRequired);\r\n      if (!isRequired) return false;\r\n\r\n      const value = ko.unwrap(field.Value);\r\n      if (value?.constructor == Array) return !value.length;\r\n      return value === null || value === undefined;\r\n    }),\r\n    error: new ValidationError(\r\n      \"text-field\",\r\n      \"required-field\",\r\n      `${ko.utils.unwrapObservable(field.displayName)} is required!`\r\n    ),\r\n  };\r\n}\r\n", "// Hint: use the es6-string-html VS Code module to make template literals easier to read\r\nexport const html = String.raw;\r\n\r\nexport function registerFieldComponents(constructor) {\r\n  ko.components.register(constructor.edit, {\r\n    template: constructor.editTemplate,\r\n    viewModel: constructor,\r\n  });\r\n\r\n  ko.components.register(constructor.view, {\r\n    template: constructor.viewTemplate,\r\n    viewModel: constructor,\r\n  });\r\n}\r\n\r\nexport class BaseFieldModule {\r\n  constructor(params) {\r\n    Object.assign(this, params);\r\n  }\r\n\r\n  _id;\r\n  getUniqueId = () => {\r\n    if (!this._id) {\r\n      this._id = \"field-\" + Math.floor(Math.random() * 10000);\r\n    }\r\n    return this._id;\r\n  };\r\n\r\n  Errors = ko.pureComputed(() => {\r\n    if (!this.ShowErrors()) return [];\r\n    if (!this.isRequired) return [];\r\n    return this.Value()\r\n      ? []\r\n      : [\r\n          new ValidationError(\r\n            \"text-field\",\r\n            \"required-field\",\r\n            this.displayName + ` is required!`\r\n          ),\r\n        ];\r\n  });\r\n\r\n  ShowErrors = ko.observable(false);\r\n\r\n  ValidationClass = ko.pureComputed(() => {\r\n    if (!this.ShowErrors()) return;\r\n    return this.Errors().length ? \"is-invalid\" : \"is-valid\";\r\n  });\r\n\r\n  static viewTemplate = html`\r\n    <div class=\"fw-semibold\" data-bind=\"text: displayName\"></div>\r\n    <div data-bind=\"text: toString()\"></div>\r\n  `;\r\n\r\n  static editTemplate = html`<div>Uh oh!</div>`;\r\n}\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <h5>\r\n    <span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n  </h5>\r\n  <!-- ko ifnot: entityType -->\r\n  <div class=\"alert alert-danger\">Missing entity type</div>\r\n  <!-- /ko -->\r\n  <!-- ko if: entityType -->\r\n  <!-- ko ifnot: multiple -->\r\n  <div\r\n    data-bind=\"component: {name: Value()?.components.edit, params: {Entity: Value()}}\"\r\n  ></div>\r\n  <!-- /ko -->\r\n  <!-- ko if: multiple -->\r\n  <table class=\"table\">\r\n    <thead>\r\n      <tr data-bind=\"\">\r\n        <!-- ko foreach: Cols -->\r\n        <th data-bind=\"text: displayName\"></th>\r\n        <!-- /ko -->\r\n        <th>Actions</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody data-bind=\"\">\r\n      <!-- ko foreach: {data: Value, as: 'row'} -->\r\n      <tr data-bind=\"\">\r\n        <!-- ko foreach: {data: row.FormFields, as: 'col'} -->\r\n        <td data-bind=\"text: col.toString\"></td>\r\n        <!-- /ko -->\r\n        <td>\r\n          <i\r\n            title=\"remove item\"\r\n            class=\"fa-solid fa-trash pointer\"\r\n            data-bind=\"click: $parent.remove.bind(row)\"\r\n          ></i>\r\n        </td>\r\n      </tr>\r\n      <!-- /ko -->\r\n      <tr>\r\n        <!-- ko foreach: NewItem()?.FormFields -->\r\n        <td>\r\n          <div\r\n            data-bind=\"component: {name: components.edit, params: $data}\"\r\n          ></div>\r\n        </td>\r\n        <!-- /ko -->\r\n        <td class=\"align-bottom\">\r\n          <button\r\n            title=\"add and new\"\r\n            type=\"button\"\r\n            data-bind=\"click: submit\"\r\n            class=\"btn btn-success\"\r\n          >\r\n            Add +\r\n          </button>\r\n        </td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nconst viewTemplate = html`\r\n  <h5>\r\n    <span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n  </h5>\r\n  <!-- ko ifnot: entityType -->\r\n  <div class=\"alert alert-danger\">Missing entity type</div>\r\n  <!-- /ko -->\r\n  <!-- ko if: entityType -->\r\n  <!-- ko ifnot: multiple -->\r\n  <!-- ko if: Value -->\r\n  <div\r\n    data-bind=\"component: {name: Value().components.view, params: {Entity: Value()}}\"\r\n  ></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n  <!-- ko if: multiple -->\r\n  <table class=\"table\">\r\n    <thead>\r\n      <tr data-bind=\"\">\r\n        <!-- ko foreach: Cols -->\r\n        <th data-bind=\"text: displayName\"></th>\r\n        <!-- /ko -->\r\n      </tr>\r\n    </thead>\r\n    <tbody data-bind=\"\">\r\n      <!-- ko foreach: {data: Value, as: 'row'} -->\r\n      <tr data-bind=\"\">\r\n        <!-- ko foreach: {data: row.FormFields, as: 'col'} -->\r\n        <td data-bind=\"text: col.toString()\"></td>\r\n        <!-- /ko -->\r\n      </tr>\r\n      <!-- /ko -->\r\n    </tbody>\r\n  </table>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class BlobModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static viewTemplate = viewTemplate;\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"blob-view\";\r\n  static edit = \"blob-edit\";\r\n  static new = \"blob-edit\";\r\n}\r\n\r\nregisterFieldComponents(BlobModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <div class=\"form-check form-switch\">\r\n    <label class=\"form-check-label\"\r\n      ><span class=\"fw-semibold\" data-bind=\"text: displayName\"></span>\r\n      <input\r\n        class=\"form-check-input\"\r\n        type=\"checkbox\"\r\n        role=\"switch\"\r\n        data-bind=\"checked: Value\"\r\n      />\r\n      <!-- ko if: instructions -->\r\n      <div\r\n        class=\"fw-lighter fst-italic text-secondary\"\r\n        data-bind=\"html: instructions\"\r\n      ></div>\r\n      <!-- /ko -->\r\n    </label>\r\n  </div>\r\n`;\r\n\r\nconst viewTemplate = html`\r\n  <div class=\"form-check form-switch\">\r\n    <label class=\"form-check-label\"\r\n      ><span class=\"fw-semibold\" data-bind=\"text: displayName\"></span>\r\n      <input\r\n        class=\"form-check-input\"\r\n        type=\"checkbox\"\r\n        role=\"switch\"\r\n        data-bind=\"checked: Value\"\r\n        disabled\r\n      />\r\n    </label>\r\n  </div>\r\n`;\r\n\r\nexport class CheckboxModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static viewTemplate = viewTemplate;\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"checkbox-view\";\r\n  static edit = \"checkbox-edit\";\r\n  static new = \"checkbox-edit\";\r\n}\r\n\r\nregisterFieldComponents(CheckboxModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <input\r\n      class=\"form-control\"\r\n      data-bind=\"value: inputBinding, class: ValidationClass, attr: {'type': type}\"\r\n    />\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class DateModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"date-view\";\r\n  static edit = \"date-edit\";\r\n  static new = \"date-edit\";\r\n}\r\n\r\nregisterFieldComponents(DateModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <!-- ko if: isSearch -->\r\n    <div data-bind=\"text: toString()\"></div>\r\n    <input class=\"form-control\" data-bind=\"\" />\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: isSearch -->\r\n    <!-- ko if: Options().length -->\r\n    <!-- ko if: multiple -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      multiple=\"true\"\r\n      data-bind=\"options: Options, \r\n  selectedOptions: Value,\r\n  optionsText: optionsText,\r\n  class: ValidationClass\"\r\n    ></select>\r\n    <div class=\"fw-light flex justify-between\">\r\n      <p class=\"fst-italic\">Hold ctrl to select multiple</p>\r\n      <button type=\"button\" class=\"btn btn-link h-1\" data-bind=\"click: clear\">\r\n        CLEAR\r\n      </button>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: multiple -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      data-bind=\"options: Options, \r\n    optionsCaption: 'Select...', \r\n    value: Value,\r\n    optionsText: optionsText,\r\n    class: ValidationClass\"\r\n    ></select>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class LookupModule extends BaseFieldModule {\r\n  constructor(field) {\r\n    super(field);\r\n    this.onSearchInput = field.onSearchInput;\r\n    this.multiple = field.multiple ?? false;\r\n  }\r\n\r\n  // selectedOptions = ko.pureComputed({\r\n  //   read: () => {\r\n  //     if (this.multiple) return this.Value();\r\n  //     return ko.unwrap(this.Value) ? [ko.unwrap(this.Value)] : [];\r\n  //   },\r\n  //   write: (val) => {\r\n  //     if (this.multiple) {\r\n  //       this.Value(val);\r\n  //       return;\r\n  //     }\r\n\r\n  //     if (val.length) {\r\n  //       this.Value(val[0]);\r\n  //       return;\r\n  //     }\r\n  //     this.Value(null);\r\n  //   },\r\n  // });\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"lookup-view\";\r\n  static edit = \"lookup-edit\";\r\n  static new = \"lookup-edit\";\r\n}\r\n\r\nregisterFieldComponents(LookupModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold w-100\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <!-- ko ifnot: spGroupId -->\r\n    <div\r\n      data-bind=\"attr: {id: getUniqueId()}, \r\n      people: Value, \r\n      pickerOptions: pickerOptions,\r\n      class: ValidationClass\"\r\n    ></div>\r\n    <!-- /ko -->\r\n    <!-- ko if: ShowUserSelect -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      data-bind=\"options: userOpts, \r\n        optionsCaption: 'Select...', \r\n        optionsText: 'Title',\r\n        value: ValueFunc,\r\n        class: ValidationClass\"\r\n    ></select>\r\n    <!-- /ko -->\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nconst viewTemplate = html`\r\n  <div class=\"fw-semibold\" data-bind=\"text: displayName\"></div>\r\n  <!-- ko if: toString -->\r\n  <!-- ko ifnot: multiple -->\r\n  <div\r\n    data-bind=\"text: toString, \r\n      attr: {title: Value()?.LoginName}\"\r\n  ></div>\r\n  <!-- /ko -->\r\n  <!-- ko if: multiple -->\r\n  <ul data-bind=\"foreach: Value\">\r\n    <li data-bind=\"attr: {title: LoginName}, text: Title\"></li>\r\n  </ul>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n  <!-- ko ifnot: toString -->\r\n  <div class=\"fst-italic\">Not provided.</div>\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class PeopleModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  ValueFunc = ko.pureComputed({\r\n    read: () => {\r\n      if (!this.Value()) return;\r\n      const userOpts = ko.unwrap(this.userOpts);\r\n      return userOpts.find((opt) => opt.ID == this.Value().ID);\r\n    },\r\n    write: (opt) => {\r\n      const userOpts = ko.unwrap(this.userOpts);\r\n      if (!userOpts) return;\r\n      this.Value(opt);\r\n    },\r\n  });\r\n\r\n  ShowUserSelect = ko.pureComputed(() => {\r\n    // We don't care to unwrap this, since we want to know if it's set or an observable.\r\n    const groupName = this.spGroupName;\r\n    if (!groupName) return false;\r\n    const options = ko.unwrap(this.userOpts);\r\n    return options.length;\r\n  });\r\n\r\n  static viewTemplate = viewTemplate;\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"people-view\";\r\n  static edit = \"people-edit\";\r\n  static new = \"people-edit\";\r\n}\r\n\r\nregisterFieldComponents(PeopleModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n  </label>\r\n  <search-select\r\n    class=\"form-select\"\r\n    data-bind=\"searchSelect: { \r\n      options: Options, \r\n      selectedOptions: Value,\r\n      optionsText: optionsText,\r\n      onSearchInput: onSearchInput\r\n    }\"\r\n  >\r\n  </search-select>\r\n  <div class=\"fw-light flex justify-between\">\r\n    <p class=\"fst-italic\"></p>\r\n    <button type=\"button\" class=\"btn btn-link h-1\" data-bind=\"click: clear\">\r\n      CLEAR\r\n    </button>\r\n  </div>\r\n  <!-- ko if: instructions -->\r\n  <div\r\n    class=\"fw-lighter fst-italic text-secondary\"\r\n    data-bind=\"html: instructions\"\r\n  ></div>\r\n  <!-- /ko -->\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class SearchSelectModule extends BaseFieldModule {\r\n  constructor(field) {\r\n    super(field);\r\n    this.Options = field.Options;\r\n    this.Value = field.Value;\r\n    this.optionsText =\r\n      field.optionsText ??\r\n      ((val) => {\r\n        return val;\r\n      });\r\n    this.multiple = field.multiple;\r\n    this.OptionsCaption = field.OptionsCaption ?? \"Select...\";\r\n    this.onSearchInput = field.onSearchInput;\r\n  }\r\n\r\n  GetSelectedOptions = ko.pureComputed(() => {\r\n    if (this.multiple) return this.Value();\r\n\r\n    return this.Value() ? [this.Value()] : [];\r\n  });\r\n\r\n  InputGroupFocused = ko.observable();\r\n  setFocus = () => this.InputGroupFocused(true);\r\n\r\n  FilterText = ko.observable();\r\n  FilteredOptions = ko.pureComputed(() =>\r\n    this.Options().filter((option) => {\r\n      if (this.GetSelectedOptions().indexOf(option) >= 0) return false;\r\n      if (this.FilterText())\r\n        return this.optionsText(option)\r\n          .toLowerCase()\r\n          .includes(this.FilterText().toLowerCase());\r\n      return true;\r\n    })\r\n  );\r\n\r\n  addSelection = (option, e) => {\r\n    console.log(\"selected\", option);\r\n    if (e.target.nextElementSibling) {\r\n      //e.stopPropagation();\r\n      e.target.nextElementSibling.focus();\r\n    }\r\n    if (this.multiple) {\r\n      this.Value.push(option);\r\n    } else {\r\n      this.Value(option);\r\n    }\r\n  };\r\n\r\n  removeSelection = (option) =>\r\n    this.multiple ? this.Value.remove(option) : this.Value(null);\r\n\r\n  setInputGroupFocus = () => {\r\n    this.InputGroupFocused(true);\r\n    clearTimeout(this.focusOutTimeout);\r\n  };\r\n\r\n  removeInputGroupFocus = (data, e) => {\r\n    this.focusOutTimeout = window.setTimeout(() => {\r\n      this.InputGroupFocused(false);\r\n    }, 0);\r\n  };\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"search-select-view\";\r\n  static edit = \"search-select-edit\";\r\n  static new = \"search-select-new\";\r\n}\r\n\r\nregisterFieldComponents(SearchSelectModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <!-- ko if: multiple -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      multiple=\"true\"\r\n      data-bind=\"options: Options, \r\n        optionsCaption: 'Select...', \r\n        optionsText: optionsText,\r\n        selectedOptions: Value,\r\n        class: ValidationClass\"\r\n    ></select>\r\n    <div class=\"fst-italic fw-light\">Hold ctrl to select multiple.</div>\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: multiple -->\r\n    <select\r\n      class=\"form-select\"\r\n      name=\"\"\r\n      id=\"\"\r\n      data-bind=\"options: Options, \r\n        optionsCaption: 'Select...', \r\n        optionsText: optionsText,\r\n        value: Value,\r\n        class: ValidationClass\"\r\n    ></select>\r\n    <!-- /ko -->\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class SelectModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"select-view\";\r\n  static edit = \"select-edit\";\r\n  static new = \"select-edit\";\r\n}\r\n\r\nregisterFieldComponents(SelectModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <div class=\"component field\">\r\n    <!-- ko if: isRichText -->\r\n    <label class=\"fw-semibold\"\r\n      ><span data-bind=\"text: displayName\"></span\r\n      ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span\r\n      >:</label\r\n    >\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n    <div\r\n      class=\"richtext-field\"\r\n      data-bind=\"childrenComplete: childrenHaveLoaded\"\r\n    >\r\n      <!-- Create the editor container -->\r\n      <div\r\n        class=\"form-control\"\r\n        data-bind=\"attr: {'id': getUniqueId()}, class: ValidationClass\"\r\n        style=\"height: 150px\"\r\n      >\r\n        <div data-bind=\"html: Value\"></div>\r\n      </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: isRichText -->\r\n    <label class=\"fw-semibold\"\r\n      ><span data-bind=\"text: displayName\"></span\r\n      ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n      <!-- ko if: instructions -->\r\n      <div\r\n        class=\"fw-lighter fst-italic text-secondary\"\r\n        data-bind=\"html: instructions\"\r\n      ></div>\r\n      <!-- /ko -->\r\n      <textarea\r\n        name=\"\"\r\n        id=\"\"\r\n        cols=\"30\"\r\n        rows=\"10\"\r\n        class=\"form-control\"\r\n        data-bind=\"textInput: Value, class: ValidationClass, attr: attr\"\r\n      ></textarea>\r\n    </label>\r\n    <!-- /ko -->\r\n    <!-- ko if: ShowErrors -->\r\n    <!-- ko foreach: Errors -->\r\n    <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n  </div>\r\n`;\r\n\r\nconst viewTemplate = html`\r\n  <div class=\"fw-semibold\" data-bind=\"text: displayName\"></div>\r\n  <!-- ko if: Value -->\r\n  <!-- ko if: isRichText -->\r\n  <div data-bind=\"html: Value\"></div>\r\n  <!-- /ko -->\r\n  <!-- ko ifnot: isRichText -->\r\n  <div data-bind=\"text: Value\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n  <!-- ko ifnot: Value -->\r\n  <div class=\"fst-italic\">Not provided.</div>\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class TextAreaModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  childrenHaveLoaded = (nodes) => {\r\n    this.initializeEditor();\r\n  };\r\n\r\n  getToolbarId = () => \"toolbar-\" + this.getUniqueId();\r\n\r\n  initializeEditor() {\r\n    const toolbarOptions = [\r\n      [\"bold\", \"italic\", \"underline\", \"strike\"], // toggled buttons\r\n      [\"link\"],\r\n      [\"blockquote\", \"code-block\"],\r\n\r\n      [{ header: 1 }, { header: 2 }], // custom button values\r\n      [{ list: \"ordered\" }, { list: \"bullet\" }],\r\n      [{ script: \"sub\" }, { script: \"super\" }], // superscript/subscript\r\n      [{ indent: \"-1\" }, { indent: \"+1\" }], // outdent/indent\r\n      [{ direction: \"rtl\" }], // text direction\r\n\r\n      [{ size: [\"small\", false, \"large\", \"huge\"] }], // custom dropdown\r\n      [{ header: [1, 2, 3, 4, 5, 6, false] }],\r\n\r\n      [{ color: [] }, { background: [] }], // dropdown with defaults from theme\r\n      [{ font: [] }],\r\n      [{ align: [] }],\r\n\r\n      [\"clean\"], // remove formatting button\r\n    ];\r\n\r\n    // debugger;\r\n    var editor = new Quill(\"#\" + this.getUniqueId(), {\r\n      modules: { toolbar: toolbarOptions },\r\n      theme: \"snow\",\r\n    });\r\n\r\n    const Value = this.Value;\r\n\r\n    Value.subscribe((val) => {\r\n      if (val == \"\") {\r\n        editor.setText(\"\");\r\n      }\r\n    });\r\n\r\n    editor.on(\"text-change\", function (delta, oldDelta, source) {\r\n      Value(editor.root.textContent ? editor.root.innerHTML : \"\");\r\n    });\r\n  }\r\n\r\n  static viewTemplate = viewTemplate;\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"text-area-view\";\r\n  static edit = \"text-area-edit\";\r\n  static new = \"text-area-edit\";\r\n}\r\n\r\nregisterFieldComponents(TextAreaModule);\r\n", "import {\r\n  html,\r\n  BaseFieldModule,\r\n  registerFieldComponents,\r\n} from \"./BaseFieldModule.js\";\r\n\r\nconst editTemplate = html`\r\n  <label class=\"fw-semibold\"\r\n    ><span data-bind=\"text: displayName\"></span\r\n    ><span data-bind=\"if: isRequired\" class=\"fw-bold text-danger\">*</span>:\r\n    <input\r\n      class=\"form-control\"\r\n      data-bind=\"textInput: Value, class: ValidationClass, attr: attr\"\r\n    />\r\n    <!-- ko if: instructions -->\r\n    <div\r\n      class=\"fw-lighter fst-italic text-secondary\"\r\n      data-bind=\"html: instructions\"\r\n    ></div>\r\n    <!-- /ko -->\r\n  </label>\r\n  <!-- ko if: ShowErrors -->\r\n  <!-- ko foreach: Errors -->\r\n  <div class=\"fw-semibold text-danger\" data-bind=\"text: description\"></div>\r\n  <!-- /ko -->\r\n  <!-- /ko -->\r\n`;\r\n\r\nexport class TextModule extends BaseFieldModule {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static editTemplate = editTemplate;\r\n\r\n  static view = \"text-view\";\r\n  static edit = \"text-edit\";\r\n  static new = \"text-edit\";\r\n}\r\n\r\nregisterFieldComponents(TextModule);\r\n", "export * from \"./BaseFieldModule.js\";\r\nexport * from \"./BlobModule.js\";\r\nexport * from \"./CheckboxModule.js\";\r\nexport * from \"./DateModule.js\";\r\nexport * from \"./LookupModule.js\";\r\nexport * from \"./PeopleModule.js\";\r\nexport * from \"./SearchSelectModule.js\";\r\nexport * from \"./SelectModule.js\";\r\nexport * from \"./TextAreaModule.js\";\r\nexport * from \"./TextModule.js\";\r\n", "import { BaseField } from \"./index.js\";\r\nimport { BlobModule } from \"../components/fields/index.js\";\r\n\r\nexport class BlobField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    this.entityType = params.entityType;\r\n    this.multiple = params.multiple;\r\n\r\n    if (this.multiple) {\r\n      this.Value = ko.observableArray();\r\n    }\r\n\r\n    if (ko.isObservable(this.entityType)) {\r\n      this.entityType.subscribe(this.updateEntityTypeHandler);\r\n      // this.Value.subscribe(this.updateEntityTypeHandler);\r\n    }\r\n    this.updateEntityTypeHandler(ko.unwrap(this.entityType));\r\n  }\r\n\r\n  toString = ko.pureComputed(() => `${this.Value()?.length ?? \"0\"} items`);\r\n\r\n  toJSON = ko.pureComputed(() => {\r\n    if (!this.multiple) return this.Value()?.toJSON();\r\n    return this.Value().map((value) => value.toJSON());\r\n  });\r\n\r\n  fromJSON = (input) => {\r\n    if (!input) return;\r\n    if (!this.multiple) {\r\n      this.Value()?.fromJSON(input);\r\n      return;\r\n    }\r\n    this.Value.removeAll();\r\n    input.map((obj) => {\r\n      const newEntity = new this.entityConstructor();\r\n      newEntity.fromJSON(obj);\r\n      this.Value.push(newEntity);\r\n    });\r\n  };\r\n\r\n  // TypedValues = ko.observableArray();\r\n  // TypedValue = ko.observable();\r\n\r\n  // Value = ko.pureComputed(() =>\r\n  //   this.multiple ? this.TypedValues() : this.TypedValue()\r\n  // );\r\n\r\n  get = () => {\r\n    return JSON.stringify(this.toJSON());\r\n  };\r\n\r\n  blob;\r\n  set = (val) => {\r\n    if (window.DEBUG) console.log(val);\r\n    this.blob = val;\r\n    if (val?.constructor == BlobField) {\r\n      // this.fromJSON(val.toJSON());\r\n      return;\r\n    }\r\n    this.fromJSON(JSON.parse(val));\r\n  };\r\n\r\n  get entityConstructor() {\r\n    return ko.utils.unwrapObservable(this.entityType);\r\n  }\r\n\r\n  // use purecomputed for memoization, fields shouldn't change\r\n  Cols = ko.pureComputed(() => {\r\n    const entityType = ko.unwrap(this.entityType);\r\n    if (!entityType) return [];\r\n\r\n    const newEntity = new this.entityConstructor();\r\n\r\n    return newEntity.FormFields();\r\n  });\r\n\r\n  // ColKeys = ko.pureComputed(() =>\r\n  //   new this.entityConstructor()?.FormFieldKeys()\r\n  // );\r\n\r\n  // Support multiple items\r\n  NewItem = ko.observable();\r\n\r\n  submit = () => {\r\n    const errors = this.NewItem()?.validate();\r\n    if (errors.length) return;\r\n\r\n    this.Value.push(this.NewItem());\r\n\r\n    this.NewItem(new this.entityConstructor());\r\n  };\r\n\r\n  add = (item) => this.Value.push(item);\r\n  remove = (item) => this.Value.remove(item);\r\n\r\n  updateEntityTypeHandler = (newType) => {\r\n    if (!newType) return;\r\n\r\n    if (!this.multiple) {\r\n      this.Value(new this.entityConstructor());\r\n    } else {\r\n      this.NewItem(new this.entityConstructor());\r\n    }\r\n    if (this.blob) this.fromJSON(JSON.parse(this.blob));\r\n\r\n    // this.applyValueToTypedValues();\r\n  };\r\n\r\n  applyValueToTypedValues = () => {\r\n    // if (!this.Value() || !this.TypedValue()) return;\r\n    // if (!this.multiple) {\r\n    //   mapObjectToEntity(this.Value(), this.TypedValue());\r\n    //   return;\r\n    // }\r\n    // const typedItems = this.Value()?.map((item) => {\r\n    //   const newEntity = new this.entityConstructor();\r\n    //   mapObjectToEntity(item, newEntity);\r\n    //   return newEntity;\r\n    // });\r\n    // this.TypedValues(typedItems);\r\n  };\r\n\r\n  // Errors = ko.pureComputed(() => {\r\n  //   if (!this.Visible()) return [];\r\n  //   // const isRequired = ko.unwrap(this.isRequired);\r\n  //   const isRequired =\r\n  //     typeof this.isRequired == \"function\"\r\n  //       ? this.isRequired()\r\n  //       : this.isRequired;\r\n  //   if (!isRequired) return [];\r\n  //   const currentValue = this.multiple ? this.TypedValues() : this.TypedValue();\r\n  //   return currentValue\r\n  //     ? []\r\n  //     : [\r\n  //         new ValidationError(\r\n  //           \"text-field\",\r\n  //           \"required-field\",\r\n  //           (typeof this.displayName == \"function\"\r\n  //             ? this.displayName()\r\n  //             : this.displayName) + ` is required!`\r\n  //         ),\r\n  //       ];\r\n  // });\r\n\r\n  components = BlobModule;\r\n}\r\n", "import { BaseField } from \"./index.js\";\r\nimport { CheckboxModule } from \"../components/fields/index.js\";\r\n\r\nexport class CheckboxField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  components = CheckboxModule;\r\n}\r\n", "import { DateModule } from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nexport const dateFieldTypes = {\r\n  date: \"date\",\r\n  datetime: \"datetime-local\",\r\n};\r\n\r\n/**\r\n * This field needs to convert between locale and UTC Dates stored on the server;\r\n */\r\n\r\nexport class DateField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    this.type = params.type ?? dateFieldTypes.date;\r\n  }\r\n\r\n  toString = ko.pureComputed(() => {\r\n    // if this is datetime vs date we expect different things\r\n    switch (this.type) {\r\n      case dateFieldTypes.date:\r\n        return this.toLocaleDateString();\r\n      case dateFieldTypes.datetime:\r\n        return this.toLocaleString();\r\n      default:\r\n        return \"\";\r\n    }\r\n  });\r\n\r\n  toSortableDateString = () => this.Value()?.format(\"yyyy-MM-dd\");\r\n  toLocaleDateString = () => this.Value()?.toLocaleDateString();\r\n  toLocaleString = () => this.Value()?.toLocaleString();\r\n\r\n  toInputDateString = () => {\r\n    const d = this.Value();\r\n    return [\r\n      d.getUTCFullYear().toString().padStart(4, \"0\"),\r\n      (d.getUTCMonth() + 1).toString().padStart(2, \"0\"),\r\n      d.getUTCDate().toString().padStart(2, \"0\"),\r\n    ].join(\"-\");\r\n  };\r\n  toInputDateTimeString = () => this.Value().format(\"yyyy-MM-ddThh:mm\");\r\n\r\n  get = ko.pureComputed(() => {\r\n    if (!this.Value() || isNaN(this.Value().valueOf())) {\r\n      return null;\r\n    }\r\n\r\n    return this.Value().toISOString();\r\n  });\r\n\r\n  set = (newDate) => {\r\n    if (!newDate) return null;\r\n    if (newDate.constructor.getName() != \"Date\") {\r\n      // console.warn(\"Attempting to set date\", newDate);\r\n      newDate = new Date(newDate);\r\n    }\r\n    if (newDate.getTimezoneOffset()) {\r\n    }\r\n    this.Value(newDate);\r\n  };\r\n\r\n  inputBinding = ko.pureComputed({\r\n    read: () => {\r\n      if (!this.Value()) return null;\r\n      switch (this.type) {\r\n        case dateFieldTypes.date:\r\n          return this.toInputDateString();\r\n        case dateFieldTypes.datetime:\r\n          return this.toInputDateTimeString();\r\n        default:\r\n          return null;\r\n      }\r\n    },\r\n    write: (val) => {\r\n      if (!val) return;\r\n      //writes in format\r\n      this.Value(new Date(val));\r\n    },\r\n  });\r\n\r\n  components = DateModule;\r\n}\r\n", "import {\r\n  LookupModule,\r\n  SearchSelectModule,\r\n  SelectModule,\r\n} from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nexport class LookupField extends BaseField {\r\n  constructor({\r\n    displayName,\r\n    type: entityType,\r\n    isRequired = false,\r\n    Visible,\r\n    entitySet,\r\n    options = ko.observableArray(),\r\n    optionsFilter = null,\r\n    optionsText = null,\r\n    multiple = false,\r\n    lookupCol = null,\r\n    instructions,\r\n  }) {\r\n    super({ Visible, displayName, isRequired, instructions });\r\n    // Support passing in options\r\n    // if options are not passed, assume this is a search input\r\n    if (!options) {\r\n      this.isSearch = true;\r\n    } else {\r\n      this.isSearch = false;\r\n      this.allOpts = options;\r\n    }\r\n    this.isSearch = !options;\r\n    this.multiple = multiple;\r\n    this.Value = multiple ? ko.observableArray() : ko.observable();\r\n\r\n    this.entityType = entityType;\r\n    this.entitySet = entitySet;\r\n    this.lookupCol = lookupCol ?? \"Title\";\r\n    this.optionsText = optionsText ?? ((item) => item[this.lookupCol]);\r\n    if (optionsFilter) this.optionsFilter = optionsFilter;\r\n\r\n    this.components = multiple ? SearchSelectModule : LookupModule;\r\n  }\r\n\r\n  isSearch = false;\r\n\r\n  allOpts;\r\n  optionsFilter = (val) => val;\r\n\r\n  Options = ko.pureComputed(() => {\r\n    const optsFilter = ko.unwrap(this.optionsFilter);\r\n    const allOpts = ko.unwrap(this.allOpts);\r\n    return allOpts.filter(optsFilter);\r\n  });\r\n\r\n  IsLoading = ko.observable(false);\r\n  HasLoaded = ko.observable(false);\r\n\r\n  // TODO: Started this, should really go in the entity base class if we're doing active record\r\n  // create = async () => {\r\n  //   const newItems = this.multiple ? this.Value() : [this.Value()]\r\n  //   newItems.map(item => this.entitySet.AddEntity(newItems))\r\n  // }\r\n\r\n  refresh = async () => {\r\n    if (!!!this.Value()) {\r\n      return;\r\n    }\r\n    this.IsLoading(true);\r\n    if (!this.multiple) {\r\n      await this.entitySet.LoadEntity(this.Value());\r\n      this.IsLoading(false);\r\n      this.HasLoaded(true);\r\n      return;\r\n    }\r\n\r\n    await Promise.all(\r\n      this.Value().map(\r\n        async (entity) => await this.entitySet.LoadEntity(entity)\r\n      )\r\n    );\r\n    this.IsLoading(false);\r\n    this.HasLoaded(true);\r\n  };\r\n\r\n  ensure = async () => {\r\n    if (this.HasLoaded()) return;\r\n    if (this.IsLoading()) {\r\n      return new Promise((resolve, reject) => {\r\n        const isLoadingSubscription = this.IsLoading.subscribe((isLoading) => {\r\n          if (!isLoading) {\r\n            isLoadingSubscription.dispose();\r\n            resolve();\r\n          }\r\n        });\r\n      });\r\n    }\r\n    await this.refresh();\r\n  };\r\n\r\n  toString = ko.pureComputed(() => {\r\n    if (!!!this.Value()) {\r\n      return \"\";\r\n    }\r\n    if (this.multiple) {\r\n      return this.Value()\r\n        .map((val) => getEntityPropertyAsString(val, this.lookupCol))\r\n        .join(\", \");\r\n    }\r\n    return getEntityPropertyAsString(this.Value(), this.lookupCol);\r\n  });\r\n\r\n  get = () => {\r\n    if (!this.Value()) return;\r\n    if (this.multiple) {\r\n      return this.Value().map((entity) => {\r\n        return {\r\n          ID: entity.ID,\r\n          LookupValue: entity.LookupValue,\r\n          Title: entity.Title,\r\n        };\r\n      });\r\n    }\r\n    const entity = this.Value();\r\n    return {\r\n      ID: entity.ID,\r\n      LookupValue: entity.LookupValue,\r\n      Title: entity.Title,\r\n    };\r\n  };\r\n\r\n  set = (val) => {\r\n    if (!val) {\r\n      this.Value(val);\r\n      return;\r\n    }\r\n    if (this.multiple) {\r\n      const valArr = Array.isArray(val) ? val : val.results ?? val.split(\"#;\");\r\n\r\n      this.Value(valArr.map((value) => this.findOrCreateNewEntity(value)));\r\n      return;\r\n    }\r\n\r\n    this.Value(this.findOrCreateNewEntity(val));\r\n    if (val && !this.toString()) {\r\n      // this.ensure();\r\n    }\r\n  };\r\n\r\n  findOrCreateNewEntity = (val) => {\r\n    if (this.entityType.FindInStore) {\r\n      const foundEntity = this.entityType.FindInStore(val);\r\n      if (foundEntity) return foundEntity;\r\n      console.warn(\r\n        `Could not find entity in store: ${this.entityType.name}`,\r\n        val\r\n      );\r\n    }\r\n\r\n    const optionEntity = this.allOpts().find((entity) => entity.ID == val.ID);\r\n    if (optionEntity) return optionEntity;\r\n\r\n    if (this.entityType.Create) {\r\n      return this.entityType.Create(val);\r\n    }\r\n\r\n    const newEntity = new this.entityType();\r\n    newEntity.ID = val.ID;\r\n    // Kick off the load process in the background\r\n    this.entitySet.LoadEntity(newEntity);\r\n\r\n    return newEntity;\r\n  };\r\n}\r\n\r\n// Should fully constrain all entities, this is ridiculous\r\nfunction getEntityPropertyAsString(entity, column) {\r\n  if (entity.FieldMap && entity.FieldMap[column]) {\r\n    const field = entity.FieldMap[column];\r\n    if (typeof field == \"function\") {\r\n      return field();\r\n    }\r\n\r\n    if (field.toString && typeof field.toString == \"function\") {\r\n      return field.toString();\r\n    }\r\n\r\n    if (field.get && typeof field.get == \"function\") {\r\n      return field.get();\r\n    }\r\n\r\n    if (field.obs) {\r\n      return field.obs();\r\n    }\r\n\r\n    return field;\r\n  }\r\n  return entity[column] ?? \"\";\r\n}\r\n", "export const sortByTitle = (a, b) => {\r\n  if (a.Title > b.Title) {\r\n    return 1;\r\n  }\r\n  if (a.Title < b.Title) {\r\n    return -1;\r\n  }\r\n  return 0;\r\n};\r\n\r\nexport const sortByField = (field) => (a, b) => {\r\n  if (a[field] > b[field]) {\r\n    return 1;\r\n  }\r\n  if (a[field] < b[field]) {\r\n    return -1;\r\n  }\r\n  return 0;\r\n};\r\n\r\nexport const createNewRequestTitle = () => {\r\n  const ts = new Date();\r\n  return ts.format(\"yyMMdd\") + \"-\" + (ts.getTime() % 100000);\r\n};\r\n", "export class People {\r\n  constructor({\r\n    ID,\r\n    Title,\r\n    LoginName = null,\r\n    IsGroup = null,\r\n    IsEnsured = false,\r\n  }) {\r\n    this.ID = ID;\r\n    this.Title = Title;\r\n    this.LookupValue = Title;\r\n    this.LoginName = LoginName != \"\" ? LoginName : null;\r\n    this.IsGroup = IsGroup;\r\n    // Has the user data been fetched? Used for binding handlers.\r\n    this.IsEnsured = IsEnsured;\r\n  }\r\n\r\n  ID = null;\r\n  Title = null;\r\n  LoginName = null;\r\n  LookupValue = null;\r\n\r\n  getKey = () => this.LoginName ?? this.Title;\r\n\r\n  static Create = function (props) {\r\n    if (!props || (!props.ID && !(props.Title || props.LookupValue)))\r\n      return null;\r\n    return new People({\r\n      ...props,\r\n      Title: props.Title ?? props.LookupValue,\r\n    });\r\n  };\r\n}\r\n", "import { Entity } from \"../primitives/index.js\";\r\n\r\nexport class Page extends Entity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static Views = {\r\n    All: [\"ID\", \"Title\", \"Created\", \"Author\", \"Modified\", \"Editor\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"Pages\",\r\n    title: \"Pages\",\r\n  };\r\n}\r\n", "export * from \"./People.js\";\r\nexport * from \"./Page.js\";\r\n", "export const assetsPath = \"/sites/CGFS/Style Library/apps/audit/src\";\r\n", "import { People } from \"../entities/index.js\";\r\nimport { ensureUserByKeyAsync } from \"./index.js\";\r\nimport { assetsPath } from \"../../env.js\";\r\n\r\nko.subscribable.fn.subscribeChanged = function (callback) {\r\n  var oldValue;\r\n  this.subscribe(\r\n    function (_oldValue) {\r\n      oldValue = _oldValue;\r\n    },\r\n    this,\r\n    \"beforeChange\"\r\n  );\r\n\r\n  this.subscribe(function (newValue) {\r\n    callback(newValue, oldValue);\r\n  });\r\n};\r\n\r\nko.observableArray.fn.subscribeAdded = function (callback) {\r\n  this.subscribe(\r\n    function (arrayChanges) {\r\n      const addedValues = arrayChanges\r\n        .filter((value) => value.status == \"added\")\r\n        .map((value) => value.value);\r\n      callback(addedValues);\r\n    },\r\n    this,\r\n    \"arrayChange\"\r\n  );\r\n};\r\n\r\nko.bindingHandlers.searchSelect = {\r\n  init: function (element, valueAccessor, allBindingsAccessor) {\r\n    const { options, selectedOptions, optionsText, onSearchInput } =\r\n      valueAccessor();\r\n\r\n    function populateOpts() {\r\n      const optionItems = ko.unwrap(options);\r\n\r\n      const optionElements = optionItems.map((option) => {\r\n        const optionElement = document.createElement(\"option\");\r\n        ko.selectExtensions.writeValue(optionElement, ko.unwrap(option));\r\n        // optionElement.value = option;\r\n        optionElement.innerText = optionsText(option);\r\n\r\n        if (\r\n          ko\r\n            .unwrap(selectedOptions)\r\n            ?.find((selectedOption) => selectedOption.ID == option.ID)\r\n        ) {\r\n          optionElement.setAttribute(\"selected\", \"\");\r\n        }\r\n        return optionElement;\r\n      });\r\n\r\n      element.append(...optionElements);\r\n    }\r\n\r\n    populateOpts();\r\n\r\n    if (ko.isObservable(options)) {\r\n      options.subscribe(() => populateOpts(), this);\r\n    }\r\n\r\n    ko.utils.registerEventHandler(element, \"change\", (e) => {\r\n      selectedOptions(\r\n        element.selectedOptions.map((opt) => ko.selectExtensions.readValue(opt))\r\n      );\r\n    });\r\n\r\n    if (onSearchInput) {\r\n      ko.utils.registerEventHandler(element, \"input\", (e) => {\r\n        onSearchInput(e.originalEvent.target.searchInputElement.value);\r\n      });\r\n    }\r\n  },\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {\r\n    const { selectedOptions } = valueAccessor();\r\n    const selectedUnwrapped = ko.unwrap(selectedOptions);\r\n\r\n    for (var i = 0; i < element.options.length; i++) {\r\n      const o = element.options[i];\r\n      o.toggleAttribute(\r\n        \"selected\",\r\n        selectedUnwrapped.includes(ko.selectExtensions.readValue(o))\r\n      );\r\n    }\r\n\r\n    // element.selectedOptions = ko.unwrap(selectedOptions);\r\n  },\r\n};\r\n\r\nko.bindingHandlers.people = {\r\n  init: function (element, valueAccessor, allBindingsAccessor) {\r\n    var schema = {};\r\n    schema[\"PrincipalAccountType\"] = \"User\";\r\n    schema[\"SearchPrincipalSource\"] = 15;\r\n    schema[\"ShowUserPresence\"] = true;\r\n    schema[\"ResolvePrincipalSource\"] = 15;\r\n    schema[\"AllowEmailAddresses\"] = true;\r\n    schema[\"AllowMultipleValues\"] = false;\r\n    schema[\"MaximumEntitySuggestions\"] = 50;\r\n    //schema[\"Width\"] = \"280px\";\r\n    schema[\"OnUserResolvedClientScript\"] = async function (elemId, userKeys) {\r\n      //  get reference of People Picker Control\r\n      var pickerControl = SPClientPeoplePicker.SPClientPeoplePickerDict[elemId];\r\n      var observable = valueAccessor();\r\n      var userJSObject = pickerControl.GetControlValueAsJSObject()[0];\r\n      if (!userJSObject) {\r\n        observable(null);\r\n        return;\r\n      }\r\n\r\n      if (userJSObject.IsResolved) {\r\n        if (userJSObject.Key == observable()?.LoginName) return;\r\n        var user = await ensureUserByKeyAsync(userJSObject.Key);\r\n        var person = new People(user);\r\n        observable(person);\r\n      }\r\n    };\r\n\r\n    // TODO: Minor - accept schema settings as options\r\n    //var mergedOptions = Object.assign(schema, obs.schemaOpts);\r\n\r\n    //  Initialize the Control, MS enforces to pass the Element ID hence we need to provide\r\n    //  ID to our element, no other options\r\n    SPClientPeoplePicker_InitStandaloneControlWrapper(element.id, null, schema);\r\n    // const helpDiv = document.createElement(\"div\");\r\n    // helpDiv.innerHTML = \"Search surname first e.g. Smith, John\";\r\n    // helpDiv.classList.add(\"fst-italic\", \"fw-lighter\");\r\n    // element.appendChild(helpDiv);\r\n  },\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {\r\n    var pickerControl =\r\n      SPClientPeoplePicker.SPClientPeoplePickerDict[element.id + \"_TopSpan\"];\r\n    var userValue = ko.utils.unwrapObservable(valueAccessor());\r\n\r\n    if (!userValue) {\r\n      // Clear the form\r\n      pickerControl?.DeleteProcessedUser();\r\n      return;\r\n    }\r\n\r\n    if (\r\n      userValue &&\r\n      !pickerControl\r\n        .GetAllUserInfo()\r\n        .find((pickerUser) => pickerUser.DisplayText == userValue.LookupValue)\r\n    ) {\r\n      pickerControl.AddUserKeys(\r\n        userValue.LoginName ?? userValue.LookupValue ?? userValue.Title\r\n      );\r\n    }\r\n  },\r\n};\r\n\r\nko.bindingHandlers.dateField = {\r\n  init: function (element, valueAccessor, allBindingsAccessor) {},\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {},\r\n};\r\n\r\nko.bindingHandlers.downloadLink = {\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {\r\n    var path = valueAccessor();\r\n    var replaced = path.replace(/:([A-Za-z_]+)/g, function (_, token) {\r\n      return ko.unwrap(viewModel[token]);\r\n    });\r\n    element.href = replaced;\r\n  },\r\n};\r\n\r\nko.bindingHandlers.files = {\r\n  init: function (element, valueAccessor) {\r\n    function addFiles(fileList) {\r\n      var value = valueAccessor();\r\n      if (!fileList.length) {\r\n        value.removeAll();\r\n        return;\r\n      }\r\n\r\n      const existingFiles = ko.unwrap(value);\r\n      const newFileList = [];\r\n      for (let file of fileList) {\r\n        if (!existingFiles.find((exFile) => exFile.name == file.name))\r\n          newFileList.push(file);\r\n      }\r\n      ko.utils.arrayPushAll(value, newFileList);\r\n      return;\r\n    }\r\n\r\n    ko.utils.registerEventHandler(element, \"change\", function () {\r\n      addFiles(element.files);\r\n    });\r\n\r\n    const label = element.closest(\"label\");\r\n    if (!label) return;\r\n\r\n    ko.utils.registerEventHandler(label, \"dragover\", function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    });\r\n\r\n    ko.utils.registerEventHandler(label, \"dragenter\", function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      label.classList.add(\"dragging\");\r\n    });\r\n\r\n    ko.utils.registerEventHandler(label, \"dragleave\", function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      label.classList.remove(\"dragging\");\r\n    });\r\n\r\n    ko.utils.registerEventHandler(label, \"drop\", function (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      let dt = event.originalEvent.dataTransfer;\r\n      let files = dt.files;\r\n      addFiles(files);\r\n    });\r\n  },\r\n  update: function (\r\n    element,\r\n    valueAccessor,\r\n    allBindings,\r\n    viewModel,\r\n    bindingContext\r\n  ) {\r\n    const value = valueAccessor();\r\n    if (!value().length && element.files.length) {\r\n      // clear all files\r\n      element.value = null;\r\n      return;\r\n    }\r\n\r\n    return;\r\n  },\r\n};\r\n\r\nko.bindingHandlers.toggleClick = {\r\n  init: function (element, valueAccessor, allBindings) {\r\n    var value = valueAccessor();\r\n\r\n    ko.utils.registerEventHandler(element, \"click\", function () {\r\n      var classToToggle = allBindings.get(\"toggleClass\");\r\n      var classContainer = allBindings.get(\"classContainer\");\r\n      var containerType = allBindings.get(\"containerType\");\r\n\r\n      if (containerType && containerType == \"sibling\") {\r\n        $(element)\r\n          .nextUntil(classContainer)\r\n          .each(function () {\r\n            $(this).toggleClass(classToToggle);\r\n          });\r\n      } else if (containerType && containerType == \"doc\") {\r\n        var curIcon = $(element).attr(\"src\");\r\n        if (curIcon == \"/_layouts/images/minus.gif\")\r\n          $(element).attr(\"src\", \"/_layouts/images/plus.gif\");\r\n        else $(element).attr(\"src\", \"/_layouts/images/minus.gif\");\r\n\r\n        if ($(element).parent() && $(element).parent().parent()) {\r\n          $(element)\r\n            .parent()\r\n            .parent()\r\n            .nextUntil(classContainer)\r\n            .each(function () {\r\n              $(this).toggleClass(classToToggle);\r\n            });\r\n        }\r\n      } else if (containerType && containerType == \"any\") {\r\n        if ($(\".\" + classToToggle).is(\":visible\"))\r\n          $(\".\" + classToToggle).hide();\r\n        else $(\".\" + classToToggle).show();\r\n      } else $(element).find(classContainer).toggleClass(classToToggle);\r\n    });\r\n  },\r\n};\r\n\r\nko.bindingHandlers.toggles = {\r\n  init: function (element, valueAccessor) {\r\n    var value = valueAccessor();\r\n\r\n    ko.utils.registerEventHandler(element, \"click\", function () {\r\n      value(!value());\r\n    });\r\n  },\r\n};\r\n\r\nconst fromPathTemplateLoader = {\r\n  loadTemplate: function (name, templateConfig, callback) {\r\n    if (templateConfig.fromPath) {\r\n      // TODO: Minor - fix error catching and fallback flow\r\n      fetch(assetsPath + templateConfig.fromPath)\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(\r\n              `Error Fetching HTML Template - ${response.statusText}`\r\n            );\r\n          }\r\n          return response.text();\r\n        })\r\n        .catch((error) => {\r\n          if (!templateConfig.fallback) return;\r\n          console.warn(\r\n            \"Primary template not found, attempting fallback\",\r\n            templateConfig\r\n          );\r\n          fetch(assetsPath + templateConfig.fallback)\r\n            .then((response) => {\r\n              if (!response.ok) {\r\n                throw new Error(\r\n                  `Error Fetching fallback HTML Template - ${response.statusText}`\r\n                );\r\n              }\r\n              return response.text();\r\n            })\r\n            .then((text) =>\r\n              ko.components.defaultLoader.loadTemplate(name, text, callback)\r\n            );\r\n        })\r\n        .then((text) =>\r\n          text\r\n            ? ko.components.defaultLoader.loadTemplate(name, text, callback)\r\n            : null\r\n        );\r\n    } else {\r\n      callback(null);\r\n    }\r\n  },\r\n};\r\n\r\nko.components.loaders.unshift(fromPathTemplateLoader);\r\n\r\nconst fromPathViewModelLoader = {\r\n  loadViewModel: function (name, viewModelConfig, callback) {\r\n    if (viewModelConfig.viaLoader) {\r\n      // console.log(\"loading module\", name);\r\n      const module = import(assetsPath + viewModelConfig.viaLoader).then(\r\n        (module) => {\r\n          // console.log(\"imported module\", name);\r\n          const viewModelConstructor = module.default;\r\n          // We need a createViewModel function, not a plain constructor.\r\n          // We can use the default loader to convert to the\r\n          // required format.\r\n          ko.components.defaultLoader.loadViewModel(\r\n            name,\r\n            viewModelConstructor,\r\n            callback\r\n          );\r\n        }\r\n      );\r\n    } else {\r\n      // Unrecognized config format. Let another loader handle it.\r\n      callback(null);\r\n    }\r\n  },\r\n};\r\n\r\nko.components.loaders.unshift(fromPathViewModelLoader);\r\n", "export const html = String.raw;\r\n\r\nexport function registerComponent({\r\n  name,\r\n  folder,\r\n  module = null,\r\n  moduleFilename = null,\r\n  template: templateFilename,\r\n}) {\r\n  if (ko.components.isRegistered(name)) {\r\n    return;\r\n  }\r\n  if (moduleFilename || module) {\r\n    ko.components.register(name, {\r\n      template: {\r\n        fromPath: `/components/${folder}/${templateFilename}.html`,\r\n      },\r\n      viewModel: module ?? {\r\n        viaLoader: `/components/${folder}/${moduleFilename}.js`,\r\n      },\r\n    });\r\n  } else {\r\n    ko.components.register(name, {\r\n      template: {\r\n        fromPath: `/components/${folder}/${templateFilename}.html`,\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport function directRegisterComponent(name, { template, viewModel = null }) {\r\n  ko.components.register(name, {\r\n    template,\r\n    viewModel,\r\n  });\r\n}\r\n\r\nexport function registerFieldComponent({\r\n  name,\r\n  components,\r\n  viewModel = null,\r\n  folder = null,\r\n}) {\r\n  // register both our view and edit\r\n  folder = folder ?? name;\r\n\r\n  Object.keys(components).map((view) => {\r\n    const componentName = components[view];\r\n    if (ko.components.isRegistered(componentName)) {\r\n      return;\r\n    }\r\n\r\n    // See if we already have this element in the dom\r\n    const elementName = `field-` + componentName;\r\n    const fieldViewElement = document.getElementById(elementName);\r\n\r\n    if (!viewModel) {\r\n      debugger;\r\n    }\r\n    ko.components.register(componentName, {\r\n      template: fieldViewElement\r\n        ? {\r\n            element: fieldViewElement,\r\n          }\r\n        : {\r\n            fromPath: `/sal/components/fields/${folder}/${name}${view}.html`,\r\n          },\r\n      viewModel: viewModel ?? {\r\n        viaLoader: `/sal/components/fields/${folder}/${name}Module.js`,\r\n      },\r\n    });\r\n  });\r\n}\r\n", "/*\r\n    SharePoint Acces Layer - sal.js\r\n\r\n    Abstract any functions that rely on reading or setting SP items to here.\r\n\r\n    Create a new \"Connection\" object type that will store information for \r\n    interfacing with a specific list.\r\n\r\n    Author: Peter Backlund \r\n    Contact: backlundpf <@> state.gov\r\n    Created: 2019-02-12\r\n*/\r\n\r\n/*\r\n  TODO:\r\n  - migrate to rest api\r\n  - remove new from \"new SP.ClientContext.get_current()\"\r\n  - standardize currctx\r\n  - remove unused functions\r\n  - Combine functions \r\n*/\r\n\r\nwindow.console = window.console || { log: function () {} };\r\n\r\nwindow.sal = window.sal ?? {};\r\nvar sal = window.sal;\r\n\r\nconst serverRelativeUrl =\r\n  _spPageContextInfo.webServerRelativeUrl == \"/\"\r\n    ? \"\"\r\n    : _spPageContextInfo.webServerRelativeUrl;\r\n\r\nsal.globalConfig = sal.globalConfig || {\r\n  siteGroups: [],\r\n  siteUrl: serverRelativeUrl,\r\n  listServices: serverRelativeUrl + \"/_vti_bin/ListData.svc/\",\r\n  defaultGroups: {},\r\n};\r\nsal.site = sal.site || {};\r\n\r\nwindow.DEBUG = true;\r\n\r\nexport function executeQuery(currCtx) {\r\n  return new Promise((resolve, reject) =>\r\n    currCtx.executeQueryAsync(resolve, (sender, args) => {\r\n      reject({ sender, args });\r\n    })\r\n  );\r\n}\r\n\r\nfunction principalToPeople(oPrincipal, isGroup = null) {\r\n  return {\r\n    ID: oPrincipal.get_id(),\r\n    Title: oPrincipal.get_title(),\r\n    LoginName: oPrincipal.get_loginName(),\r\n    IsEnsured: true,\r\n    IsGroup:\r\n      isGroup != null\r\n        ? isGroup\r\n        : oPrincipal.constructor.getName() == \"SP.Group\",\r\n    oPrincipal,\r\n  };\r\n}\r\n\r\n// Used in authorization\r\nexport function getDefaultGroups() {\r\n  const defaultGroups = sal.globalConfig.defaultGroups;\r\n  const result = {};\r\n  Object.keys(defaultGroups).forEach((key) => {\r\n    result[key] = principalToPeople(defaultGroups[key], true);\r\n  });\r\n  return result;\r\n}\r\n\r\nconst siteGroups = {};\r\n\r\nexport async function getGroupUsers(groupName) {\r\n  if (siteGroups[groupName]?.Users?.constructor == Array) {\r\n    return siteGroups[groupName].Users;\r\n  }\r\n  const url = `/web/sitegroups/GetByName('${groupName}')?$expand=Users`;\r\n\r\n  const groupResult = await fetchSharePointData(url);\r\n\r\n  const group = groupResult.d;\r\n  group.Users = group.Users?.results;\r\n\r\n  siteGroups[groupName] = group;\r\n  return group.Users;\r\n}\r\n\r\n// Used in router\r\nexport const webRoot =\r\n  _spPageContextInfo.webAbsoluteUrl == \"/\"\r\n    ? \"\"\r\n    : _spPageContextInfo.webAbsoluteUrl;\r\n\r\nexport async function InitSal() {\r\n  if (sal.utilities) return;\r\n  console.log(\"Init Sal\");\r\n  var currCtx = SP.ClientContext.get_current();\r\n  var web = currCtx.get_web();\r\n  //sal.site = sal.siteConnection;\r\n\r\n  // Get default groups\r\n  sal.globalConfig.defaultGroups = {\r\n    owners: web.get_associatedOwnerGroup(),\r\n    members: web.get_associatedMemberGroup(),\r\n    visitors: web.get_associatedVisitorGroup(),\r\n  };\r\n  currCtx.load(sal.globalConfig.defaultGroups.owners);\r\n  currCtx.load(sal.globalConfig.defaultGroups.members);\r\n  currCtx.load(sal.globalConfig.defaultGroups.visitors);\r\n\r\n  // Get Current User information\r\n  var user = web.get_currentUser(); //must load this to access info.\r\n  currCtx.load(user);\r\n\r\n  // Get the site groups\r\n  var siteGroupCollection = web.get_siteGroups();\r\n  currCtx.load(siteGroupCollection);\r\n\r\n  // Get the roles upfront so we can validate they're present on the site.\r\n  sal.globalConfig.roles = [];\r\n  var oRoleDefinitions = currCtx.get_web().get_roleDefinitions();\r\n  currCtx.load(oRoleDefinitions);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    currCtx.executeQueryAsync(\r\n      function () {\r\n        sal.globalConfig.currentUser = user;\r\n\r\n        var listItemEnumerator = siteGroupCollection.getEnumerator();\r\n        while (listItemEnumerator.moveNext()) {\r\n          var oListItem = listItemEnumerator.get_current();\r\n          sal.globalConfig.siteGroups.push(principalToPeople(oListItem));\r\n        }\r\n\r\n        // Role Definitions\r\n        var oEnumerator = oRoleDefinitions.getEnumerator();\r\n        while (oEnumerator.moveNext()) {\r\n          var oRoleDefinition = oEnumerator.get_current();\r\n          sal.globalConfig.roles.push(oRoleDefinition.get_name());\r\n        }\r\n\r\n        sal.config = new sal.NewAppConfig();\r\n        sal.utilities = new sal.NewUtilities();\r\n        resolve();\r\n      },\r\n      function (sender, args) {\r\n        alert(\"Error initializing SAL\");\r\n        reject();\r\n      }\r\n    );\r\n  });\r\n  // console.log()\r\n}\r\n\r\nsal.NewAppConfig = function () {\r\n  // TODO: We should take in configuration from our current application, roles/groups etc.\r\n  var siteRoles = {};\r\n  siteRoles.roles = {\r\n    FullControl: \"Full Control\",\r\n    Design: \"Design\",\r\n    Edit: \"Edit\",\r\n    Contribute: \"Contribute\",\r\n    RestrictedContribute: \"Restricted Contribute\",\r\n    InitialCreate: \"Initial Create\",\r\n    Read: \"Read\",\r\n    RestrictedRead: \"Restricted Read\",\r\n    LimitedAccess: \"Limited Access\",\r\n  };\r\n  siteRoles.fulfillsRole = function (inputRole, targetRole) {\r\n    // the site roles are already in authoritative order\r\n    const roles = Object.values(siteRoles.roles);\r\n    if (!roles.includes(inputRole) || !roles.includes(targetRole)) return false;\r\n\r\n    return roles.indexOf(inputRole) <= roles.indexOf(targetRole);\r\n  };\r\n\r\n  siteRoles.validate = function () {\r\n    Object.keys(siteRoles.roles).forEach(function (role) {\r\n      var roleName = siteRoles.roles[role];\r\n      if (!sal.globalConfig.roles.includes(roleName)) {\r\n        console.error(roleName + \" is not in the global roles list\");\r\n      } else {\r\n        console.log(roleName);\r\n      }\r\n    });\r\n  };\r\n\r\n  var siteGroups = {\r\n    groups: {\r\n      Owners: \"workorder Owners\",\r\n      Members: \"workorder Members\",\r\n      Visitors: \"workorder Visitors\",\r\n      RestrictedReaders: \"Restricted Readers\",\r\n    },\r\n  };\r\n\r\n  var publicMembers = {\r\n    siteRoles,\r\n    siteGroups,\r\n  };\r\n\r\n  return publicMembers;\r\n};\r\n\r\n// Used in Authorization\r\nexport async function getUserPropsAsync(userId = _spPageContextInfo.userId) {\r\n  // We need to make two api calls, one to user info list, and one to web\r\n  // const userInfoUrl = `/Web/lists/getbytitle('User%20Information%20List')/Items(${userId})`;\r\n  const userPropsUrl = `/sp.userprofiles.peoplemanager/getmyproperties`;\r\n  // const userGroupUrl = `/Web/GetUserById(${userId})/Groups`;\r\n\r\n  // Get more user info:\r\n  const userInfoUrl = `/Web/GetUserById(${userId})/?$expand=Groups`;\r\n\r\n  const userInfo = (await fetchSharePointData(userInfoUrl)).d;\r\n\r\n  // TODO: See if we can just select the properties we need\r\n  // const userPropsUrl = `/sp.userprofiles.peoplemanager/getpropertiesfor(@v)?@v='${encodeURIComponent(\r\n  //   userInfo.LoginName\r\n  // )}'`;\r\n\r\n  const userProps = (await fetchSharePointData(userPropsUrl))?.d\r\n    .UserProfileProperties.results;\r\n\r\n  function findPropValue(props, key) {\r\n    return props.find((prop) => prop.Key == key)?.Value;\r\n  }\r\n\r\n  return {\r\n    ID: userId,\r\n    Title: userInfo.Title,\r\n    LoginName: userInfo.LoginName,\r\n    WorkPhone: findPropValue(userProps, \"WorkPhone\"),\r\n    EMail: findPropValue(userProps, \"WorkEmail\"), // TODO: Do we still need this spelling?\r\n    IsEnsured: true,\r\n    IsGroup: false,\r\n    Groups: userInfo.Groups?.results?.map((group) => {\r\n      return {\r\n        ...group,\r\n        ID: group.Id,\r\n        IsGroup: true,\r\n        IsEnsured: true,\r\n      };\r\n    }),\r\n  };\r\n}\r\n\r\n// TODO: DEPRECATED remove after verification\r\nasync function getUserPropsAsyncDeprecated() {\r\n  // TODO: We aren't getting the phone number, need to query userprofile service\r\n  return new Promise((resolve, reject) => {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var oUser = web.get_currentUser();\r\n    var oGroups = oUser.get_groups();\r\n\r\n    function onQueryGroupsSucceeded() {\r\n      const user = {\r\n        ID: oUser.get_id(),\r\n        Title: oUser.get_title(),\r\n        LoginName: oUser.get_loginName(),\r\n        IsEnsured: true,\r\n        IsGroup: false,\r\n        Groups: [],\r\n      };\r\n\r\n      var groupsEnumerator = oGroups.getEnumerator();\r\n      while (groupsEnumerator.moveNext()) {\r\n        var oGroup = groupsEnumerator.get_current();\r\n        user.Groups.push(principalToPeople(oGroup));\r\n      }\r\n      resolve(user);\r\n    }\r\n\r\n    function onQueryGroupsFailed(sender, args) {\r\n      console.error(\r\n        \" Everyone - Query Everyone group failed. \" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n      reject(args);\r\n    }\r\n    currCtx.load(oUser);\r\n    currCtx.load(oGroups);\r\n    const data = { oUser, oGroups, resolve, reject };\r\n\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onQueryGroupsSucceeded),\r\n      Function.createDelegate(data, onQueryGroupsFailed)\r\n    );\r\n  });\r\n}\r\n\r\nsal.NewUtilities = function () {\r\n  // TODO: Split this up into UserManager, GroupManager, etc\r\n  function createSiteGroup(groupName, permissions, callback) {\r\n    /* groupName: the name of the new SP Group\r\n     *  permissions: an array of permissions to assign to the group\r\n     * groupOwner: the name of the owner group\r\n     */\r\n    callback = callback === undefined ? null : callback;\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var groupCreationInfo = new SP.GroupCreationInformation();\r\n    groupCreationInfo.set_title(groupName);\r\n    this.oGroup = oWebsite.get_siteGroups().add(groupCreationInfo);\r\n    oGroup.set_owner(oWebsite.get_associatedOwnerGroup());\r\n\r\n    oGroup.update();\r\n    var collRoleDefinitionBinding =\r\n      SP.RoleDefinitionBindingCollection.newObject(clientContext);\r\n\r\n    this.oRoleDefinitions = [];\r\n\r\n    permissions.forEach(function (perm) {\r\n      var oRoleDefinition = oWebsite.get_roleDefinitions().getByName(perm);\r\n      this.oRoleDefinitions.push(oRoleDefinition);\r\n      collRoleDefinitionBinding.add(oRoleDefinition);\r\n    });\r\n\r\n    var collRollAssignment = oWebsite.get_roleAssignments();\r\n    collRollAssignment.add(oGroup, collRoleDefinitionBinding);\r\n\r\n    function onCreateGroupSucceeded() {\r\n      var roleInfo =\r\n        oGroup.get_title() +\r\n        \" created and assigned to \" +\r\n        oRoleDefinitions.forEach(function (rd) {\r\n          rd + \", \";\r\n        });\r\n      if (callback) {\r\n        callback(oGroup.get_id());\r\n      }\r\n      console.log(roleInfo);\r\n    }\r\n\r\n    function onCreateGroupFailed(sender, args) {\r\n      alert(\r\n        groupnName +\r\n          \" - Create group failed. \" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    clientContext.load(oGroup, \"Title\");\r\n\r\n    var data = {\r\n      groupName: groupName,\r\n      oGroup: oGroup,\r\n      oRoleDefinition: oRoleDefinition,\r\n      callback: callback,\r\n    };\r\n\r\n    clientContext.executeQueryAsync(\r\n      Function.createDelegate(data, onCreateGroupSucceeded),\r\n      Function.createDelegate(data, onCreateGroupFailed)\r\n    );\r\n  }\r\n\r\n  function getUserGroups(user, callback) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var everyone = web.ensureUser(user);\r\n    var oGroups = everyone.get_groups();\r\n\r\n    function onQueryGroupsSucceeded() {\r\n      var groups = new Array();\r\n      var groupsInfo = new String();\r\n      var groupsEnumerator = oGroups.getEnumerator();\r\n      while (groupsEnumerator.moveNext()) {\r\n        var oGroup = groupsEnumerator.get_current();\r\n        var group = principalToPeople(oGroup);\r\n\r\n        groupsInfo +=\r\n          \"\\n\" +\r\n          \"Group ID: \" +\r\n          oGroup.get_id() +\r\n          \", \" +\r\n          \"Title : \" +\r\n          oGroup.get_title();\r\n        groups.push(group);\r\n      }\r\n      console.log(groupsInfo.toString());\r\n      callback(groups);\r\n    }\r\n\r\n    function onQueryGroupsFailed(sender, args) {\r\n      console.error(\r\n        \" Everyone - Query Everyone group failed. \" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n    currCtx.load(everyone);\r\n    currCtx.load(oGroups);\r\n    data = { everyone: everyone, oGroups: oGroups, callback: callback };\r\n\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onQueryGroupsSucceeded),\r\n      Function.createDelegate(data, onQueryGroupsFailed)\r\n    );\r\n  }\r\n\r\n  function getUsersWithGroup(oGroup, callback) {\r\n    var context = new SP.ClientContext.get_current();\r\n\r\n    var oUsers = oGroup.get_users();\r\n\r\n    function onGetUserSuccess() {\r\n      var userObjs = [];\r\n      var userEnumerator = oUsers.getEnumerator();\r\n      while (userEnumerator.moveNext()) {\r\n        var oUser = userEnumerator.get_current();\r\n        var userObj = principalToPeople(oUser);\r\n        userObjs.push(userObj);\r\n      }\r\n      callback(userObjs);\r\n    }\r\n\r\n    function onGetUserFailed(sender, args) {}\r\n\r\n    var data = { oUsers: oUsers, callback: callback };\r\n    context.load(oUsers);\r\n    context.executeQueryAsync(\r\n      Function.createDelegate(data, onGetUserSuccess),\r\n      Function.createDelegate(data, onGetUserFailed)\r\n    );\r\n  }\r\n\r\n  function copyFiles(sourceLib, destLib, callback, onError) {\r\n    var context = new SP.ClientContext.get_current();\r\n    var web = context.get_web();\r\n    var folderSrc = web.getFolderByServerRelativeUrl(sourceLib);\r\n    context.load(folderSrc, \"Files\");\r\n    context.executeQueryAsync(\r\n      function () {\r\n        console.log(\"Got the source folder right here!\");\r\n        var files = folderSrc.get_files();\r\n        var e = files.getEnumerator();\r\n        var dest = [];\r\n        while (e.moveNext()) {\r\n          var file = e.get_current();\r\n          var destLibUrl = destLib + \"/\" + file.get_name();\r\n          dest.push(destLibUrl); //delete this when we're happy we got the file paths right\r\n          file.copyTo(destLibUrl, true);\r\n        }\r\n        console.log(dest); //delete this when we're happy we got the file paths right\r\n        context.executeQueryAsync(\r\n          function () {\r\n            console.log(\"Files moved successfully!\");\r\n            callback();\r\n          },\r\n          function (sender, args) {\r\n            console.log(\"error: \") + args.get_message();\r\n            onError;\r\n          }\r\n        );\r\n      },\r\n      function (sender, args) {\r\n        console.log(\"Sorry, something messed up: \" + args.get_message());\r\n      }\r\n    );\r\n  }\r\n\r\n  function copyFilesAsync(sourceFolder, destFolder) {\r\n    return new Promise((resolve, reject) => {\r\n      copyFiles(sourceFolder, destFolder, resolve, reject);\r\n    });\r\n  }\r\n\r\n  var publicMembers = {\r\n    copyFiles: copyFiles,\r\n    copyFilesAsync,\r\n    createSiteGroup: createSiteGroup,\r\n    getUserGroups: getUserGroups,\r\n    getUsersWithGroup: getUsersWithGroup,\r\n  };\r\n\r\n  return publicMembers;\r\n};\r\n\r\nexport async function copyFileAsync(sourceFilePath, destFilePath) {\r\n  const uri = `/web/getfilebyserverrelativeurl('${sourceFilePath}')/copyto('${destFilePath}')`;\r\n\r\n  const result = await fetchSharePointData(uri, \"POST\");\r\n\r\n  return result;\r\n}\r\n\r\n// Used in Authorization\r\nasync function getCurrentUserPropertiesAsync() {\r\n  var headers = {\r\n    \"Content-Type\": \"application/json;odata=verbose\",\r\n    \"X-RequestDigest\": document.getElementById(\"__REQUESTDIGEST\").value,\r\n  };\r\n  try {\r\n    var response = await fetch(\r\n      _spPageContextInfo.webAbsoluteUrl +\r\n        \"/_api/SP.UserProfiles.PeopleManager/GetMyProperties\",\r\n      {\r\n        method: \"GET\",\r\n        headers,\r\n      }\r\n    );\r\n    if (!response.ok) {\r\n      throw new Error(response.status);\r\n    }\r\n\r\n    const data = await response.json();\r\n    sal.globalConfig.currentUserProfile = data.d;\r\n    const requestorPhone = data.d.UserProfileProperties.results.find(function (\r\n      prop\r\n    ) {\r\n      return prop.Key == \"WorkPhone\";\r\n    }).Value;\r\n  } catch (error) {\r\n    console.error(\"Unable to fetch User Properties:\", error);\r\n  }\r\n}\r\n\r\n// Used in Knockout people custom binding\r\nexport async function ensureUserByKeyAsync(userName) {\r\n  return new Promise((resolve, reject) => {\r\n    var group = sal.globalConfig.siteGroups.find(function (group) {\r\n      return group.LoginName == userName;\r\n    });\r\n\r\n    if (group) {\r\n      resolve(group);\r\n      return;\r\n    }\r\n\r\n    var context = new SP.ClientContext.get_current();\r\n    var oUser = context.get_web().ensureUser(userName);\r\n\r\n    function onEnsureUserSucceeded(sender, args) {\r\n      const user = principalToPeople(oUser);\r\n      resolve(user);\r\n    }\r\n\r\n    function onEnsureUserFailed(sender, args) {\r\n      console.error(\r\n        \"Failed to ensure user :\" +\r\n          args.get_message() +\r\n          \"\\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n      reject(args);\r\n    }\r\n    const data = { oUser, resolve, reject };\r\n\r\n    context.load(oUser);\r\n    context.executeQueryAsync(\r\n      Function.createDelegate(data, onEnsureUserSucceeded),\r\n      Function.createDelegate(data, onEnsureUserFailed)\r\n    );\r\n  });\r\n}\r\n\r\nfunction getSPSiteGroupByName(groupName) {\r\n  var userGroup = null;\r\n  if (this.globalConfig.siteGroups != null) {\r\n    userGroup = this.globalConfig.siteGroups.find(function (group) {\r\n      return group.Title == groupName;\r\n    });\r\n  }\r\n  return userGroup;\r\n}\r\n\r\nexport class ItemPermissions {\r\n  constructor({ hasUniqueRoleAssignments, roles }) {\r\n    this.hasUniqueRoleAssignments = hasUniqueRoleAssignments;\r\n    this.roles = roles;\r\n  }\r\n\r\n  hasUniqueRoleAssignments;\r\n  roles = [];\r\n\r\n  addPrincipalRole(principal, roleName) {\r\n    const newRoleDef = new RoleDef({ name: roleName });\r\n    const principalRole = this.getPrincipalRole(principal);\r\n\r\n    if (principalRole) {\r\n      principalRole.addRoleDef(newRoleDef);\r\n      return;\r\n    }\r\n\r\n    const newRole = new Role({ principal });\r\n    newRole.addRoleDef(newRoleDef);\r\n    this.roles.push(newRole);\r\n  }\r\n\r\n  getPrincipalRole(principal) {\r\n    return this.roles.find((role) => role.principal.ID == principal.ID);\r\n  }\r\n\r\n  principalHasPermissionKind(principal, permission) {\r\n    const role = this.getPrincipalRole(principal);\r\n    return role?.roleDefs.find((roleDef) =>\r\n      roleDef.basePermissions?.has(permission)\r\n    )\r\n      ? true\r\n      : false;\r\n  }\r\n\r\n  getValuePairs() {\r\n    // For backwards compatibility\r\n    return this.roles.flatMap((role) =>\r\n      role.roleDefs.map((roleDef) => [role.principal.Title, roleDef.name])\r\n    );\r\n  }\r\n\r\n  static fromRestResult(result) {\r\n    const roles = result.RoleAssignments.results.map(\r\n      Role.fromRestRoleAssignment\r\n    );\r\n\r\n    return new ItemPermissions({\r\n      hasUniqueRoleAssignments: result.HasUniqueRoleAssignments,\r\n      roles,\r\n    });\r\n  }\r\n}\r\n\r\nexport class Role {\r\n  constructor({ principal, roleDefs = [] }) {\r\n    this.principal = principal;\r\n    this.roleDefs = roleDefs;\r\n  }\r\n\r\n  principal; // People Entity\r\n  roleDefs = [];\r\n\r\n  addRoleDef(roleDef) {\r\n    this.roleDefs.push(roleDef);\r\n  }\r\n\r\n  static fromRestRoleAssignment(role) {\r\n    return new Role({\r\n      principal: { ...role.Member, ID: role.Member.Id },\r\n      roleDefs: role.RoleDefinitionBindings.results.map(\r\n        RoleDef.fromRestRoleDef\r\n      ),\r\n    });\r\n  }\r\n  static fromJsomRole(role) {\r\n    const newRole = new Role({\r\n      principal: principalToPeople(role.get_member()),\r\n    });\r\n\r\n    var roleDefs = role.get_roleDefinitionBindings();\r\n    if (roleDefs != null) {\r\n      var roleDefsEnumerator = roleDefs.getEnumerator();\r\n      while (roleDefsEnumerator.moveNext()) {\r\n        var roleDef = roleDefsEnumerator.get_current();\r\n        newRole.roleDefs.push(RoleDef.fromJsomRoleDef(roleDef));\r\n      }\r\n    }\r\n    return newRole;\r\n  }\r\n}\r\n\r\nexport class RoleDef {\r\n  constructor({ name, basePermissions = null }) {\r\n    this.name = name;\r\n    this.basePermissions = basePermissions;\r\n  }\r\n  name;\r\n  basePermissions;\r\n\r\n  static fromRestRoleDef(roleDef) {\r\n    const newRoleDef = new RoleDef({\r\n      name: roleDef.Name,\r\n      basePermissions: roleDef.BasePermissions,\r\n    });\r\n    Object.assign(newRoleDef, roleDef);\r\n    return newRoleDef;\r\n  }\r\n\r\n  static fromJsomRoleDef(roleDef) {\r\n    const newRoleDef = new RoleDef({ name: roleDef.get_name() });\r\n    newRoleDef.basePermissions = roleDef.get_basePermissions();\r\n\r\n    return newRoleDef;\r\n  }\r\n}\r\n\r\nexport function SPList(listDef) {\r\n  /*\r\n      Expecting a list definition object in the following format:\r\n        var assignmentListDef = {\r\n        name: \"Assignment\",\r\n        title: \"Assignment\"\r\n      };\r\n    */\r\n\r\n  /*****************************************************************\r\n                                Globals       \r\n    ******************************************************************/\r\n\r\n  var self = this;\r\n\r\n  self.config = {\r\n    def: listDef,\r\n  };\r\n\r\n  /*****************************************************************\r\n                                Common Private Methods       \r\n    ******************************************************************/\r\n  async function init() {\r\n    if (!self.config.fieldSchema) {\r\n      const listEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')?$expand=Fields`;\r\n      const list = await fetchSharePointData(listEndpoint);\r\n      // const apiEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')/Fields`;\r\n      //const fields = await fetchData(apiEndpoint);\r\n      self.config.guid = list.d.Id;\r\n      self.config.fieldSchema = list.d.Fields.results;\r\n    }\r\n  }\r\n\r\n  init();\r\n\r\n  /*****************************************************************\r\n                                Common Public Methods       \r\n    ******************************************************************/\r\n\r\n  async function setListPermissionsAsync(itemPermissions, reset) {\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    // await executeQuery(currCtx).catch((sender, args) => {\r\n    //   console.warn(\"Unable to get list: \", sender);\r\n    //   return;\r\n    // });\r\n\r\n    return setResourcePermissionsAsync(oList, itemPermissions, reset);\r\n  }\r\n\r\n  function setListPermissions(valuePairs, callback, reset) {\r\n    reset = reset === undefined ? false : reset;\r\n\r\n    var users = new Array();\r\n    var resolvedGroups = new Array();\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    valuePairs.forEach(function (vp) {\r\n      var resolvedGroup = getSPSiteGroupByName(vp[0]);\r\n      if (resolvedGroup) {\r\n        resolvedGroups.push([resolvedGroup, vp[1]]);\r\n      } else {\r\n        users.push([currCtx.get_web().ensureUser(vp[0]), vp[1]]);\r\n      }\r\n    });\r\n\r\n    function onFindItemSucceeded() {\r\n      console.log(\"Successfully found item\");\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      if (reset) {\r\n        oList.resetRoleInheritance();\r\n        oList.breakRoleInheritance(false, false);\r\n        oList\r\n          .get_roleAssignments()\r\n          .getByPrincipal(sal.globalConfig.currentUser)\r\n          .deleteObject();\r\n      } else {\r\n        oList.breakRoleInheritance(false, false);\r\n      }\r\n\r\n      this.resolvedGroups.forEach(function (groupPairs) {\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(groupPairs[1])\r\n        );\r\n        oList.get_roleAssignments().add(groupPairs[0], roleDefBindingColl);\r\n      });\r\n\r\n      this.users.forEach(function (userPairs) {\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(userPairs[1])\r\n        );\r\n        oList.get_roleAssignments().add(userPairs[0], roleDefBindingColl);\r\n      });\r\n\r\n      var data = { oList: oList, callback: callback };\r\n\r\n      function onSetListPermissionsSuccess() {\r\n        console.log(\"Successfully set permissions\");\r\n        callback(oList);\r\n      }\r\n\r\n      function onSetListPermissionsFailure(sender, args) {\r\n        console.error(\r\n          \"Failed to update permissions on List: \" +\r\n            this.oList.get_title() +\r\n            args.get_message() +\r\n            \"\\n\",\r\n          args.get_stackTrace()\r\n        );\r\n      }\r\n\r\n      currCtx.load(oList);\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onSetListPermissionsSuccess),\r\n        Function.createDelegate(data, onSetListPermissionsFailure)\r\n      );\r\n    }\r\n\r\n    function onFindItemFailed(sender, args) {\r\n      console.error(\r\n        \"Failed to find List: \" + this.oList.get_title + args.get_message(),\r\n        args.get_stackTrace()\r\n      );\r\n    }\r\n    var data = {\r\n      oList: oList,\r\n      users: users,\r\n      resolvedGroups: resolvedGroups,\r\n      callback: callback,\r\n    };\r\n    //let data = { title: oListItem.get_item(\"Title\"), oListItem: oListItem };\r\n\r\n    currCtx.load(oList);\r\n    users.map(function (user) {\r\n      currCtx.load(user[0]);\r\n    });\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onFindItemSucceeded),\r\n      Function.createDelegate(data, onFindItemFailed)\r\n    );\r\n  }\r\n\r\n  /*****************************************************************\r\n                                createListItem      \r\n    ******************************************************************/\r\n  function mapObjectToListItem(val) {\r\n    if (!val) {\r\n      return val;\r\n    }\r\n    if (!Array.isArray(val)) {\r\n      return mapItemToListItem(val);\r\n    }\r\n    return val\r\n      .map((item) => {\r\n        return mapItemToListItem(item);\r\n      })\r\n      .join(\";#\");\r\n  }\r\n\r\n  function mapItemToListItem(item) {\r\n    if (item.ID) {\r\n      //var lookupValue = new SP.FieldLookupValue();\r\n      //lookupValue.set_lookupId(item.id);\r\n      //return lookupValue;\r\n      return `${item.ID};#${item.LookupValue ?? \"\"}`;\r\n    }\r\n    if (item.LookupValue) {\r\n      //var lookupValue = new SP.FieldLookupValue();\r\n      //lookupValue.set_lookupId(item.id);\r\n      //return lookupValue;\r\n      return item.LookupValue;\r\n    }\r\n    if (item.constructor.getName() == \"Date\") {\r\n      return item.toISOString();\r\n    }\r\n    return item;\r\n  }\r\n\r\n  function createListItemAsync(entity, folderPath = null) {\r\n    return new Promise((resolve, reject) => {\r\n      //self.updateConfig();\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const itemCreateInfo = new SP.ListItemCreationInformation();\r\n\r\n      if (folderPath) {\r\n        var folderUrl =\r\n          sal.globalConfig.siteUrl +\r\n          \"/Lists/\" +\r\n          self.config.def.name +\r\n          \"/\" +\r\n          folderPath;\r\n        itemCreateInfo.set_folderUrl(folderUrl);\r\n      }\r\n\r\n      const oListItem = oList.addItem(itemCreateInfo);\r\n      const restrictedFields = [\r\n        \"ID\",\r\n        \"Author\",\r\n        \"Created\",\r\n        \"Editor\",\r\n        \"Modified\",\r\n      ];\r\n      Object.keys(entity)\r\n        .filter((key) => !restrictedFields.includes(key))\r\n        .forEach((key) => {\r\n          oListItem.set_item(key, mapObjectToListItem(entity[key]));\r\n        });\r\n\r\n      oListItem.update();\r\n\r\n      function onCreateListItemSucceeded() {\r\n        resolve(oListItem.get_id());\r\n      }\r\n\r\n      function onCreateListItemFailed(sender, args) {\r\n        console.error(\"Create Item Failed - List: \" + self.config.def.name);\r\n        console.error(\"ValuePairs\", entity);\r\n        console.error(sender, args);\r\n        reject(sender);\r\n      }\r\n\r\n      const data = { entity, oListItem, resolve, reject };\r\n\r\n      currCtx.load(oListItem);\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onCreateListItemSucceeded),\r\n        Function.createDelegate(data, onCreateListItemFailed)\r\n      );\r\n    });\r\n  }\r\n\r\n  /*****************************************************************\r\n                                getListItems      \r\n    ******************************************************************/\r\n  function mapListItemToObject(val) {\r\n    if (!val) {\r\n      return val;\r\n    }\r\n    let out = {};\r\n    switch (val.constructor.getName()) {\r\n      case \"SP.FieldUserValue\":\r\n        out.LoginName = val.get_email();\r\n      case \"SP.FieldLookupValue\":\r\n        out.ID = val.get_lookupId();\r\n        out.LookupValue = val.get_lookupValue();\r\n        out.Title = val.get_lookupValue();\r\n        break;\r\n      default:\r\n        out = val;\r\n    }\r\n    return out;\r\n  }\r\n\r\n  function getListItems(caml, fields, callback) {\r\n    /*\r\n        Obtain all list items that match the querystring passed by caml.\r\n        */\r\n    var camlQuery = new SP.CamlQuery.createAllItemsQuery();\r\n\r\n    camlQuery.set_viewXml(caml);\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n    var oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    var collListItem = oList.getItems(camlQuery);\r\n\r\n    function onGetListItemsSucceeded() {\r\n      var self = this;\r\n      var listItemEnumerator = self.collListItem.getEnumerator();\r\n\r\n      const foundObjects = [];\r\n\r\n      while (listItemEnumerator.moveNext()) {\r\n        var oListItem = listItemEnumerator.get_current();\r\n        var listObj = {};\r\n        fields.forEach((field) => {\r\n          var colVal = oListItem.get_item(field);\r\n          //console.log(`SAL: Setting ${field} to`, colVal);\r\n          listObj[field] = Array.isArray(colVal)\r\n            ? colVal.map((val) => mapListItemToObject(val))\r\n            : mapListItemToObject(colVal);\r\n        });\r\n        //listObj.fileUrl = oListItem.get_item(\"FileRef\");\r\n        // listObj.oListItem = oListItem;\r\n        foundObjects.push(listObj);\r\n      }\r\n      //this.setState({ focusedItems })\r\n      //console.log(\"calling callback get list\");\r\n      callback(foundObjects);\r\n    }\r\n\r\n    function onGetListItemsFailed(sender, args) {\r\n      console.log(\"unsuccessful read\", sender);\r\n\r\n      alert(\r\n        \"Request on list \" +\r\n          self.config.def.name +\r\n          \" failed, producing the following error: \\n \" +\r\n          args.get_message() +\r\n          \"\\nStackTrack: \\n \" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n    var data = {\r\n      collListItem: collListItem,\r\n      callback: callback,\r\n      fields,\r\n      camlQuery,\r\n    };\r\n\r\n    currCtx.load(collListItem, `Include(${fields.join(\", \")})`);\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onGetListItemsSucceeded),\r\n      Function.createDelegate(data, onGetListItemsFailed)\r\n    );\r\n  }\r\n\r\n  function getListItemsAsync({ fields = null, caml = null }) {\r\n    if (!caml) {\r\n      var caml =\r\n        '<View Scope=\"RecursiveAll\"><Query><Where><Eq>' +\r\n        '<FieldRef Name=\"FSObjType\"/><Value Type=\"int\">0</Value>' +\r\n        \"</Eq></Where></Query></View>\";\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      getListItems(caml, fields, resolve);\r\n    });\r\n  }\r\n\r\n  function findByIdAsync(id, fields) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        findById(id, fields, resolve);\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    });\r\n  }\r\n\r\n  async function getById(id, fields) {\r\n    const [queryFields, expandFields] = await getQueryFields(fields);\r\n\r\n    const apiEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')/items(${id})?$Select=${queryFields}&$expand=${expandFields}`;\r\n\r\n    const result = await fetchSharePointData(apiEndpoint);\r\n    return result.d;\r\n  }\r\n\r\n  async function getListFields() {\r\n    if (!self.config.fieldSchema) {\r\n      const apiEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')/Fields`;\r\n      const fields = await fetchSharePointData(apiEndpoint);\r\n      self.config.fieldSchema = fields.d.results;\r\n    }\r\n    return self.config.fieldSchema;\r\n  }\r\n\r\n  async function getQueryFields(fields) {\r\n    const queryFields = [];\r\n    const expandFields = [];\r\n\r\n    const listFields = await getListFields();\r\n    fields.map((f) => {\r\n      // TODO: Figure out why FileRef is pretending to be a lookup\r\n      if (f == \"FileRef\") {\r\n        queryFields.push(f);\r\n        return;\r\n      }\r\n\r\n      if (f.includes(\"/\")) {\r\n        queryFields.push(f);\r\n        expandFields.push(f.split(\"/\")[0]);\r\n        return;\r\n      }\r\n      const fieldSchema = listFields.find((lf) => lf.StaticName == f);\r\n      if (!fieldSchema) {\r\n        alert(`Field '${f}' not found on list ${self.config.def.name}`);\r\n        return;\r\n      }\r\n\r\n      const idString = f + \"/ID\";\r\n      let titleString = f + \"/Title\";\r\n      switch (fieldSchema.TypeAsString) {\r\n        case \"LookupMulti\":\r\n        case \"Lookup\":\r\n          titleString = f + \"/\" + fieldSchema.LookupField;\r\n        case \"User\":\r\n          queryFields.push(idString);\r\n          queryFields.push(titleString);\r\n          expandFields.push(f);\r\n          // expandFields.push(titleString);\r\n          break;\r\n        case \"Choice\":\r\n        default:\r\n          queryFields.push(f);\r\n      }\r\n    });\r\n    return [queryFields, expandFields];\r\n  }\r\n\r\n  // { column, value, type = \"LookupValue\" }\r\n  async function findByColumnValueAsync(\r\n    columnFilters,\r\n    { orderByColumn = null, sortAsc },\r\n    { count = null, includePermissions = false, includeFolders = false },\r\n    fields\r\n  ) {\r\n    const [queryFields, expandFields] = await getQueryFields(fields);\r\n    if (includePermissions) {\r\n      queryFields.push(\"RoleAssignments\");\r\n      queryFields.push(\"HasUniqueRoleAssignments\");\r\n      expandFields.push(\"RoleAssignments\");\r\n    }\r\n    const orderBy = orderByColumn\r\n      ? `$orderby=${orderByColumn} ${sortAsc ? \"asc\" : \"desc\"}`\r\n      : \"\";\r\n    // TODO: fieldfilter should use 'lookupcolumnId' e.g. ServiceTypeId eq 1\r\n    const colFilterArr = [];\r\n    columnFilters.forEach((colFilter) =>\r\n      colFilterArr.push(\r\n        `${colFilter.column} ${colFilter.op ?? \"eq\"} '${colFilter.value}'`\r\n      )\r\n    );\r\n    if (!includeFolders) colFilterArr.push(`FSObjType eq '0'`);\r\n\r\n    const filter = \"$filter=(\" + colFilterArr.join(`) and (`) + \")\";\r\n\r\n    //const fsObjTypeFilter = `FSObjType eq '0'`;\r\n    // const fieldFilter = `${column} eq '${value}'`;\r\n    // const filter2 = !includeFolders\r\n    //   ? `$filter=(${fieldFilter}) and (${fsObjTypeFilter})`\r\n    //   : `$filter=${fieldFilter}`;\r\n\r\n    const include = \"$select=\" + queryFields;\r\n    const expand = `$expand=` + expandFields;\r\n    const page = count ? `$top=${count}` : \"\";\r\n\r\n    const apiEndpoint =\r\n      `/web/lists/GetByTitle('${self.config.def.title}')/items?` +\r\n      `${include}&${expand}&${orderBy}&${filter}&${page}`;\r\n\r\n    const result = await fetchSharePointData(apiEndpoint);\r\n    const cursor = {\r\n      results: result?.d?.results,\r\n      _next: result?.d?.__next,\r\n    };\r\n\r\n    // if (window.DEBUG) console.log(cursor);\r\n    return cursor;\r\n  }\r\n\r\n  async function loadNextPage(cursor) {\r\n    const result = await fetchSharePointData(cursor._next);\r\n    return {\r\n      results: result?.d?.results,\r\n      _next: result?.d?.__next,\r\n    };\r\n  }\r\n\r\n  function findById(id, fields, callback) {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n    var oList = web.get_lists().getByTitle(self.config.def.title);\r\n    var oListItem = oList.getItemById(id);\r\n\r\n    function onGetListItemSucceeded() {\r\n      const listObj = {};\r\n      fields.forEach((field) => {\r\n        var colVal = oListItem.get_item(field);\r\n        //console.log(`SAL: Setting ${field} to`, colVal);\r\n        listObj[field] = Array.isArray(colVal)\r\n          ? colVal.map((val) => mapListItemToObject(val))\r\n          : mapListItemToObject(colVal);\r\n      });\r\n      callback(listObj);\r\n    }\r\n\r\n    function onGetListItemFailed(sender, args) {\r\n      console.error(\"SAL: findById - List: \" + self.config.def.name);\r\n      console.error(\"Fields\", this);\r\n      console.error(sender, args);\r\n    }\r\n\r\n    var data = {\r\n      oListItem,\r\n      callback,\r\n      fields,\r\n    };\r\n    currCtx.load(oListItem);\r\n    // currCtx.load(oListItem, `Include(${fields.join(\", \")})`);\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onGetListItemSucceeded),\r\n      Function.createDelegate(data, onGetListItemFailed)\r\n    );\r\n  }\r\n\r\n  /*****************************************************************\r\n                            updateListItem      \r\n    ******************************************************************/\r\n\r\n  function updateListItemAsync(entity) {\r\n    if (!entity?.ID) {\r\n      return false;\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const oListItem = oList.getItemById(entity.ID);\r\n\r\n      const restrictedFields = [\r\n        \"ID\",\r\n        \"Author\",\r\n        \"Created\",\r\n        \"Editor\",\r\n        \"Modified\",\r\n      ];\r\n\r\n      Object.keys(entity)\r\n        .filter((key) => !restrictedFields.includes(key))\r\n        .forEach((key) => {\r\n          oListItem.set_item(key, mapObjectToListItem(entity[key]));\r\n        });\r\n\r\n      oListItem.update();\r\n\r\n      function onUpdateListItemsSucceeded() {\r\n        //alert('Item updated!');\r\n        console.log(\"Successfully updated \" + this.oListItem.get_item(\"Title\"));\r\n        resolve();\r\n      }\r\n\r\n      function onUpdateListItemFailed(sender, args) {\r\n        console.error(\"Update Failed - List: \" + self.config.def.name);\r\n        console.error(\"Item Id\", this.oListItem.get_id() ?? \"N/A\");\r\n        console.error(entity);\r\n        console.error(sender, args);\r\n        reject(args);\r\n      }\r\n\r\n      const data = { oListItem, entity, resolve, reject };\r\n\r\n      currCtx.load(oListItem);\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onUpdateListItemsSucceeded),\r\n        Function.createDelegate(data, onUpdateListItemFailed)\r\n      );\r\n    });\r\n  }\r\n\r\n  /*****************************************************************\r\n                            deleteListItem      \r\n    ******************************************************************/\r\n  function deleteListItem(id, callback) {\r\n    //[[\"ColName\", \"Value\"], [\"Col2\", \"Value2\"]]\r\n    //self.callbackDeleteListItem = callback;\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n    var oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    var data = { callback: callback };\r\n    const oListItem = oList.getItemById(id);\r\n    oListItem.deleteObject();\r\n\r\n    function onDeleteListItemsSucceeded(sender, args) {\r\n      //alert('Item updated!');\r\n      callback();\r\n    }\r\n\r\n    function onDeleteListItemsFailed(sender, args) {\r\n      console.error(\r\n        \"sal.SPList.deleteListItem: Request on list \" +\r\n          self.config.def.name +\r\n          \" failed, producing the following error: \\n \" +\r\n          args.get_message() +\r\n          \"\\nStackTrack: \\n \" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onDeleteListItemsSucceeded),\r\n      Function.createDelegate(data, onDeleteListItemsFailed)\r\n    );\r\n  }\r\n\r\n  async function deleteListItemAsync(id) {\r\n    const apiEndpoint = `/web/lists/GetByTitle('${self.config.def.title}')/items(${id})`;\r\n    return await fetchSharePointData(apiEndpoint, \"DELETE\", {\r\n      \"If-Match\": \"*\",\r\n    });\r\n    // return new Promise((resolve, reject) => deleteListItem(id, resolve));\r\n  }\r\n\r\n  /*****************************************************************\r\n                            Permissions  \r\n    ******************************************************************/\r\n  /**\r\n   * Documentation - setItemPermissions\r\n   * @param {number} id Item identifier, obtain using getListItems above\r\n   * @param {ItemPermissions} itemPermissions an instance of ItemPermissions\r\n   */\r\n  async function setItemPermissionsAsync(id, itemPermissions, reset) {\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n\r\n    const oListItem = await getoListItemByIdAsync(id);\r\n\r\n    return setResourcePermissionsAsync(oListItem, itemPermissions, reset);\r\n  }\r\n\r\n  async function setResourcePermissionsAsync(\r\n    oListItem,\r\n    itemPermissions,\r\n    reset\r\n  ) {\r\n    if (reset) {\r\n      oListItem.resetRoleInheritance();\r\n      oListItem.breakRoleInheritance(false, false);\r\n    }\r\n\r\n    // const result = await new Promise((resolve, reject) => {\r\n    //   currCtx.executeQueryAsync(\r\n    //     () => {\r\n    //       resolve();\r\n    //     },\r\n    //     (sender, args) => {\r\n    //       console.error(\r\n    //         \"Failed to break permissions on item: \" +\r\n    //           this.oListItem.get_lookupValue() +\r\n    //           args.get_message(),\r\n    //         args\r\n    //       );\r\n    //       reject();\r\n    //     }\r\n    //   );\r\n    // });\r\n\r\n    for (const role of itemPermissions.roles) {\r\n      const ensuredPrincipalResult = await ensureUserByKeyAsync(\r\n        role.principal.Title\r\n      );\r\n      if (!ensuredPrincipalResult) return;\r\n\r\n      const currCtx2 = new SP.ClientContext.get_current();\r\n      const web = currCtx2.get_web();\r\n\r\n      const oPrincipal = ensuredPrincipalResult.oPrincipal;\r\n\r\n      currCtx2.load(oPrincipal);\r\n\r\n      role.roleDefs.map((roleDef) => {\r\n        const roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(roleDef.name)\r\n        );\r\n        oListItem.get_roleAssignments().add(oPrincipal, roleDefBindingColl);\r\n      });\r\n\r\n      const data = {};\r\n      await executeQuery(currCtx2).catch(({ sender, args }) => {\r\n        console.error(\r\n          `Failed to set role permissions on item id ${id} for principal ${role.principal.Title} ` +\r\n            args.get_message(),\r\n          args\r\n        );\r\n      });\r\n    }\r\n\r\n    if (reset) {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n\r\n      oListItem\r\n        .get_roleAssignments()\r\n        .getByPrincipal(sal.globalConfig.currentUser)\r\n        .deleteObject();\r\n\r\n      await executeQuery(currCtx).catch(({ sender, args }) => {\r\n        console.error(\r\n          `Failed to remove role permissions on item id ${id} for Current User ` +\r\n            args.get_message(),\r\n          args\r\n        );\r\n      });\r\n    }\r\n  }\r\n\r\n  function getoListItemByIdAsync(id) {\r\n    return new Promise((resolve, reject) => {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const oListItem = oList.getItemById(id);\r\n      currCtx.executeQueryAsync(\r\n        () => {\r\n          resolve(oListItem);\r\n        },\r\n        (sender, args) => {\r\n          console.error(\r\n            \"Failed to find item: \" + id + args.get_message(),\r\n            args\r\n          );\r\n          reject();\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Documentation - getItemPermissionsAsync\r\n   * @param {number} id Item identifier, obtain using getListItems above\r\n   * @param {Function} callback The callback function to execute after\r\n   *  obtaining permissions\r\n   */\r\n  function getItemPermissionsAsync(id) {\r\n    return new Promise((resolve, reject) => {\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      var oList = web.get_lists().getByTitle(self.config.def.title);\r\n      var camlQuery = new SP.CamlQuery();\r\n      camlQuery.set_viewXml(\r\n        '<View><Query><Where><Eq><FieldRef Name=\"ID\"/><Value Type=\"Text\">' +\r\n          id +\r\n          \"</Value></Eq></Where></Query></View>\"\r\n      );\r\n\r\n      var oListItems = oList.getItems(camlQuery);\r\n\r\n      currCtx.load(\r\n        oListItems,\r\n        \"Include(ID, HasUniqueRoleAssignments, RoleAssignments, RoleAssignments.Include(Member, RoleDefinitionBindings))\"\r\n      );\r\n\r\n      function onQuerySuccess() {\r\n        var listItemEnumerator = oListItems.getEnumerator();\r\n\r\n        while (listItemEnumerator.moveNext()) {\r\n          var oListItem = listItemEnumerator.get_current();\r\n          var itemPermissions = new ItemPermissions({\r\n            hasUniqueRoleAssignments: oListItem.get_hasUniqueRoleAssignments(),\r\n            roles: [],\r\n          });\r\n\r\n          var roleEnumerator = oListItem.get_roleAssignments().getEnumerator();\r\n          // enumerate the roles\r\n          while (roleEnumerator.moveNext()) {\r\n            var roleColl = roleEnumerator.get_current();\r\n            const role = Role.fromJsomRole(roleColl);\r\n            // var principal = roleColl.get_member();\r\n\r\n            // const roleDef = {\r\n            //   principal: principalToPeople(principal),\r\n            //   permissions: [],\r\n            // };\r\n\r\n            // const roleDefBindingCollEnumerator = roleColl\r\n            //   .get_roleDefinitionBindings()\r\n            //   .getEnumerator();\r\n            // while (roleDefBindingCollEnumerator.moveNext()) {\r\n            //   const role = roleDefBindingCollEnumerator.get_current();\r\n            //   roleDef.permissions.push(role.get_name());\r\n            // }\r\n            itemPermissions.roles.push(role);\r\n          }\r\n          resolve(itemPermissions);\r\n          break;\r\n        }\r\n      }\r\n\r\n      function onQueryFailed(sender, args) {\r\n        reject(args.get_message());\r\n      }\r\n\r\n      const data = {\r\n        oListItems,\r\n        resolve,\r\n        reject,\r\n      };\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onQuerySuccess),\r\n        Function.createDelegate(data, onQueryFailed)\r\n      );\r\n    });\r\n  }\r\n\r\n  async function getListPermissions() {\r\n    const url =\r\n      `/web/lists/getByTitle('${self.config.def.name}')` +\r\n      `?$select=HasUniqueRoleAssignments,RoleAssignments` +\r\n      `&$expand=RoleAssignments/Member,RoleAssignments/RoleDefinitionBindings`;\r\n\r\n    const headers = {\r\n      \"Cache-Control\": \"no-cache\",\r\n    };\r\n    const result = await fetchSharePointData(url, \"GET\", headers);\r\n\r\n    if (!result) return;\r\n\r\n    return ItemPermissions.fromRestResult(result.d);\r\n  }\r\n\r\n  /*****************************************************************\r\n                            Folders          \r\n    ******************************************************************/\r\n\r\n  function getServerRelativeFolderPath(relFolderPath) {\r\n    let builtPath = sal.globalConfig.siteUrl;\r\n\r\n    builtPath += self.config.def.isLib\r\n      ? \"/\" + self.config.def.name\r\n      : \"/Lists/\" + self.config.def.name;\r\n\r\n    if (relFolderPath) {\r\n      builtPath += \"/\" + relFolderPath;\r\n    }\r\n\r\n    return builtPath;\r\n  }\r\n\r\n  function upsertFolderPathAsync(folderPath) {\r\n    if (self.config.def.isLib) {\r\n      return new Promise((resolve, reject) =>\r\n        upsertLibFolderByPath(folderPath, resolve)\r\n      );\r\n    }\r\n    return new Promise((resolve, reject) =>\r\n      upsertListFolderByPath(folderPath, resolve)\r\n    );\r\n  }\r\n\r\n  async function setFolderReadonlyAsync(folderPath) {\r\n    try {\r\n      const currentPerms = await getFolderPermissionsAsync(folderPath);\r\n\r\n      const targetPerms = currentPerms.map((user) => {\r\n        return [user.LoginName, sal.config.siteRoles.roles.RestrictedRead];\r\n      });\r\n      await setFolderPermissionsAsync(folderPath, targetPerms, true);\r\n    } catch (e) {\r\n      console.warn(e);\r\n    }\r\n    return;\r\n  }\r\n\r\n  async function ensureFolderPermissionsAsync(relFolderPath, targetPerms) {\r\n    const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n\r\n    const apiEndpoint =\r\n      sal.globalConfig.siteUrl +\r\n      `/_api/web/GetFolderByServerRelativeUrl('${serverRelFolderPath}')/` +\r\n      \"ListItemAllFields/RoleAssignments?$expand=Member,Member/Users,RoleDefinitionBindings\";\r\n\r\n    const response = await fetch(apiEndpoint, {\r\n      method: \"GET\",\r\n      headers: {\r\n        Accept: \"application/json; odata=verbose\",\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      if (response.status == 404) {\r\n        return;\r\n      }\r\n      console.error(response);\r\n    }\r\n    const result = await response.json();\r\n    const permissionResults = result?.d?.results;\r\n    if (!permissionResults) {\r\n      console.warn(\"No results found\", result);\r\n      return;\r\n    }\r\n\r\n    const missingPerms = targetPerms.filter((targetPermPair) => {\r\n      const targetLoginName = targetPermPair[0];\r\n      const targetPerm = targetPermPair[1];\r\n      // find an existing matching permissiont\r\n      const permExists = permissionResults.find((curPerm) => {\r\n        // If the target user isn't the member\r\n        if (curPerm.Member.LoginName != targetLoginName) {\r\n          // Or the member is a group that the target user isn't in\r\n          if (\r\n            !curPerm.Member.Users?.results.find(\r\n              (curUser) => curUser.LoginName == targetLoginName\r\n            )\r\n          ) {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        // The target principal has permissions assigned, let see if they include the target permission\r\n        if (\r\n          curPerm.RoleDefinitionBindings.results?.find((curBinding) =>\r\n            sal.config.siteRoles.fulfillsRole(curBinding.Name, targetPerm)\r\n          )\r\n        ) {\r\n          return true;\r\n        }\r\n\r\n        // Finally, the target principal is assigned, but don't have the appropriate permissions\r\n        return false;\r\n      });\r\n\r\n      return !permExists;\r\n    });\r\n\r\n    console.log(\"Adding missing permissions\", missingPerms);\r\n    if (missingPerms.length)\r\n      await setFolderPermissionsAsync(relFolderPath, missingPerms, false);\r\n\r\n    return;\r\n  }\r\n  /*****************************************************************\r\n                            List Folders          \r\n    ******************************************************************/\r\n  function getFolderContentsAsync(relFolderPath, fields) {\r\n    return new Promise((resolve, reject) => {\r\n      // TODO: everything is the same as getListItems except for the caml query\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n\r\n      const camlQuery = SP.CamlQuery.createAllItemsQuery();\r\n      camlQuery.set_folderServerRelativeUrl(serverRelFolderPath);\r\n      const allItems = oList.getItems(camlQuery);\r\n\r\n      currCtx.load(allItems, `Include(${fields.join(\", \")})`);\r\n\r\n      currCtx.executeQueryAsync(\r\n        function () {\r\n          const foundObjects = [];\r\n          var listItemEnumerator = allItems.getEnumerator();\r\n          while (listItemEnumerator.moveNext()) {\r\n            var oListItem = listItemEnumerator.get_current();\r\n            var listObj = {};\r\n            fields.forEach((field) => {\r\n              var colVal = oListItem.get_item(field);\r\n              //console.log(`SAL: Setting ${field} to`, colVal);\r\n              listObj[field] = Array.isArray(colVal)\r\n                ? colVal.map((val) => mapListItemToObject(val))\r\n                : mapListItemToObject(colVal);\r\n            });\r\n            //listObj.fileUrl = oListItem.get_item(\"FileRef\");\r\n            listObj.oListItem = oListItem;\r\n            foundObjects.push(listObj);\r\n          }\r\n          resolve(foundObjects);\r\n        },\r\n        function (sender, args) {\r\n          console.warn(\"Unable load list folder contents:\");\r\n          console.error(sender);\r\n          console.error(args);\r\n          reject(args);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  async function getFolderPermissionsAsync(relFolderPath) {\r\n    return new Promise(async (resolve, reject) => {\r\n      const oListItem = await getFolderItemByPath(relFolderPath);\r\n      if (!oListItem) {\r\n        reject(\"Folder item does not exist\");\r\n        return;\r\n      }\r\n      const roles = oListItem.get_roleAssignments();\r\n\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      currCtx.load(oListItem);\r\n      currCtx.load(roles);\r\n      currCtx.executeQueryAsync(\r\n        function () {\r\n          const currCtx = new SP.ClientContext.get_current();\r\n          console.log(oListItem);\r\n          const principals = [];\r\n          const bindings = [];\r\n          const roleEnumerator = roles.getEnumerator();\r\n          // enumerate the roles\r\n          while (roleEnumerator.moveNext()) {\r\n            const role = roleEnumerator.get_current();\r\n            const principal = role.get_member();\r\n            const bindings = role.get_roleDefinitionBindings();\r\n            // get the principal\r\n            currCtx.load(bindings);\r\n            currCtx.load(principal);\r\n            principals.push({ principal: principal, bindings: bindings });\r\n          }\r\n          currCtx.executeQueryAsync(\r\n            // success\r\n            function (sender, args) {\r\n              // alert the title\r\n              //alert(principal.get_title());\r\n\r\n              const logins = principals.map(function ({ principal, bindings }) {\r\n                const principalRoles = [];\r\n                const bindingEnumerator = bindings.getEnumerator();\r\n                while (bindingEnumerator.moveNext()) {\r\n                  const binding = bindingEnumerator.get_current();\r\n                  principalRoles.push(binding.get_name());\r\n                }\r\n                return {\r\n                  ID: principal.get_id(),\r\n                  Title: principal.get_title(),\r\n                  LoginName: principal.get_loginName(),\r\n                  Roles: principalRoles,\r\n                };\r\n              });\r\n              resolve(logins);\r\n            },\r\n            // failure\r\n            function (sender, args) {\r\n              console.warn(\"Unable load folder principals permissions:\");\r\n              console.error(sender);\r\n              console.error(args);\r\n              reject(args);\r\n            }\r\n          );\r\n        },\r\n        function (sender, args) {\r\n          console.warn(\"Unable load folder permissions:\");\r\n          console.error(sender);\r\n          console.error(args);\r\n          reject(args);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  async function getFolderItemByPath(relFolderPath) {\r\n    return new Promise((resolve, reject) => {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      const camlQuery = SP.CamlQuery.createAllItemsQuery();\r\n\r\n      const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n\r\n      var camlq =\r\n        '<View Scope=\"RecursiveAll\"><Query><Where><And><Eq>' +\r\n        '<FieldRef Name=\"FSObjType\"/><Value Type=\"int\">1</Value>' +\r\n        \"</Eq><Eq>\" +\r\n        '<FieldRef Name=\"FileRef\"/><Value Type=\"Text\">' +\r\n        serverRelFolderPath +\r\n        \"</Value>\" +\r\n        \"</Eq></And></Where></Query><RowLimit>1</RowLimit></View>\";\r\n\r\n      camlQuery.set_viewXml(camlq);\r\n\r\n      const allFolders = oList.getItems(camlQuery);\r\n\r\n      async function onFindItemSucceeded() {\r\n        const foundObjects = [];\r\n        var listItemEnumerator = allFolders.getEnumerator();\r\n        while (listItemEnumerator.moveNext()) {\r\n          // Should be only one item\r\n          const oListItem = listItemEnumerator.get_current();\r\n          foundObjects.push(oListItem);\r\n        }\r\n\r\n        if (!foundObjects) {\r\n          console.warn(\"folder not found\");\r\n          resolve(foundObjects);\r\n        }\r\n\r\n        if (foundObjects.length > 1) {\r\n          console.warn(\"Multiple folders found!\");\r\n          resolve(foundObjects);\r\n        }\r\n        const oListItem = foundObjects[0];\r\n        resolve(oListItem);\r\n      }\r\n\r\n      function onFindItemFailed(sender, args) {\r\n        console.warn(\"Unable load list folder contents:\");\r\n        console.error(sender);\r\n        console.error(args);\r\n        reject(args);\r\n      }\r\n      const data = {\r\n        allFolders,\r\n        resolve,\r\n        reject,\r\n      };\r\n      currCtx.load(allFolders);\r\n\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onFindItemSucceeded),\r\n        Function.createDelegate(data, onFindItemFailed)\r\n      );\r\n    });\r\n  }\r\n\r\n  /*****************************************************************\r\n                            Document Libraries Folders\r\n    ******************************************************************/\r\n\r\n  /*****************************************************************\r\n                        Folder Creation          \r\n    ******************************************************************/\r\n\r\n  function upsertListFolderByPath(folderPath, callback) {\r\n    var folderArr = folderPath.split(\"/\");\r\n    var idx = 0;\r\n\r\n    var upsertListFolderInner = function (parentPath, folderArr, idx, success) {\r\n      var folderName = folderArr[idx];\r\n      idx++;\r\n      var curPath = folderArr.slice(0, idx).join(\"/\");\r\n      ensureListFolder(\r\n        curPath,\r\n        function (iFolder) {\r\n          if (idx >= folderArr.length) {\r\n            //We've reached the innermost folder and found it exists\r\n            success(iFolder.get_id());\r\n          } else {\r\n            upsertListFolderInner(curPath, folderArr, idx, success);\r\n          }\r\n        },\r\n        function () {\r\n          self.createListFolder(\r\n            folderName,\r\n            function (folderId) {\r\n              if (idx >= folderArr.length) {\r\n                //We've reached the innermost folder and found it exists\r\n                success(folderId);\r\n              } else {\r\n                upsertListFolderInner(curPath, folderArr, idx, success);\r\n              }\r\n            },\r\n            parentPath\r\n          );\r\n        }\r\n      );\r\n    };\r\n    upsertListFolderInner(\"\", folderArr, idx, callback);\r\n  }\r\n\r\n  /**\r\n   * CreateListFolder\r\n   * Creates a folder at the specified path\r\n   * @param {String} folderName\r\n   * @param {Function} callback\r\n   * @param {String} path\r\n   */\r\n  self.createListFolder = function (folderName, callback, path) {\r\n    path = path === undefined ? \"\" : path;\r\n\r\n    // Used for lists, duh\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    const oList = web.get_lists().getByTitle(self.config.def.title);\r\n    let folderUrl = \"\";\r\n    const itemCreateInfo = new SP.ListItemCreationInformation();\r\n    itemCreateInfo.set_underlyingObjectType(SP.FileSystemObjectType.folder);\r\n    itemCreateInfo.set_leafName(folderName);\r\n    if (path) {\r\n      folderUrl =\r\n        sal.globalConfig.siteUrl +\r\n        \"/Lists/\" +\r\n        self.config.def.name +\r\n        \"/\" +\r\n        path;\r\n      itemCreateInfo.set_folderUrl(folderUrl);\r\n    }\r\n\r\n    const newItem = oList.addItem(itemCreateInfo);\r\n    newItem.set_item(\"Title\", folderName);\r\n\r\n    newItem.update();\r\n\r\n    function onCreateFolderSucceeded(sender, args) {\r\n      callback(this.newItem.get_id());\r\n    }\r\n\r\n    function onCreateFolderFailed(sender, args) {\r\n      alert(\r\n        \"Request on list \" +\r\n          self.config.def.name +\r\n          \" failed, producing the following error: \\n\" +\r\n          args.get_message() +\r\n          \"\\nStackTrack: \\n\" +\r\n          args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    const data = {\r\n      folderName: folderName,\r\n      callback: callback,\r\n      newItem: newItem,\r\n    };\r\n\r\n    currCtx.load(newItem);\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onCreateFolderSucceeded),\r\n      Function.createDelegate(data, onCreateFolderFailed)\r\n    );\r\n  };\r\n\r\n  function ensureListFolder(path, onExists, onNonExists) {\r\n    var folderUrl =\r\n      sal.globalConfig.siteUrl + \"/Lists/\" + self.config.def.name + \"/\" + path;\r\n\r\n    var ctx = SP.ClientContext.get_current();\r\n\r\n    // Could also call getFileByServerRelativeUrl() here. Doesn't matter.\r\n    // The way this works is identical for files and folders.\r\n    var folder = ctx.get_web().getFolderByServerRelativeUrl(folderUrl);\r\n    folder.get_listItemAllFields();\r\n    var data = {\r\n      folder: folder,\r\n      path: path,\r\n      onExists: onExists,\r\n      onNonExists: onNonExists,\r\n    };\r\n    ctx.load(folder, \"Exists\", \"Name\");\r\n\r\n    function onQueryFolderSucceeded() {\r\n      if (folder.get_exists()) {\r\n        // Folder exists and isn't hidden from us. Print its name.\r\n        console.log(\r\n          \"Folder \" + folder.get_name() + \" exists in \" + self.config.def.name\r\n        );\r\n        var currCtx = new SP.ClientContext.get_current();\r\n\r\n        var folderItem = folder.get_listItemAllFields();\r\n        function onQueryFolderItemSuccess() {\r\n          onExists(folderItem);\r\n        }\r\n        function onQueryFolderItemFailure(sender, args) {\r\n          console.error(\"Failed to find folder at \" + path, args);\r\n        }\r\n        data = { folderItem: folderItem, path: path, onExists: onExists };\r\n        currCtx.load(folderItem);\r\n        currCtx.executeQueryAsync(\r\n          Function.createDelegate(data, onQueryFolderItemSuccess),\r\n          Function.createDelegate(data, onQueryFolderItemFailure)\r\n        );\r\n      } else {\r\n        console.warn(\"Folder exists but is hidden (security-trimmed) for us.\");\r\n      }\r\n    }\r\n\r\n    function onQueryFolderFailed(sender, args) {\r\n      if (args.get_errorTypeName() === \"System.IO.FileNotFoundException\") {\r\n        // Folder doesn't exist at all.\r\n        console.log(\r\n          \"SAL.SPList.ensureListFolder: \\\r\n          Folder \" +\r\n            path +\r\n            \" does not exist in \" +\r\n            self.config.def.name\r\n        );\r\n        onNonExists();\r\n      } else {\r\n        // An unexpected error occurred.\r\n        console.error(\"Error: \" + args.get_message());\r\n      }\r\n    }\r\n    ctx.executeQueryAsync(\r\n      Function.createDelegate(data, onQueryFolderSucceeded),\r\n      Function.createDelegate(data, onQueryFolderFailed)\r\n    );\r\n  }\r\n\r\n  function upsertLibFolderByPath(folderUrl, success) {\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n    // TODO: Check if the folder exists before adding it\r\n\r\n    var createFolderInternal = function (parentFolder, folderUrl, success) {\r\n      var ctx = parentFolder.get_context();\r\n      var folderNames = folderUrl.split(\"/\");\r\n      var folderName = folderNames[0];\r\n      var curFolder = parentFolder.get_folders().add(folderName);\r\n      ctx.load(curFolder);\r\n      ctx.executeQueryAsync(\r\n        function () {\r\n          if (folderNames.length > 1) {\r\n            var subFolderUrl = folderNames\r\n              .slice(1, folderNames.length)\r\n              .join(\"/\");\r\n            createFolderInternal(curFolder, subFolderUrl, success);\r\n          } else {\r\n            success(curFolder);\r\n          }\r\n        },\r\n        function (sender, args) {\r\n          console.error(\"error creating new folder\");\r\n          console.error(sender);\r\n          console.error(error);\r\n        }\r\n      );\r\n    };\r\n    createFolderInternal(oList.get_rootFolder(), folderUrl, success);\r\n  }\r\n\r\n  function setFolderPermissionsAsync(folderPath, valuePairs, reset) {\r\n    return new Promise((resolve, reject) => {\r\n      setFolderPermissions(folderPath, valuePairs, resolve, reset);\r\n    });\r\n  }\r\n\r\n  function setFolderPermissions(relFolderPath, valuePairs, callback, reset) {\r\n    reset = reset === undefined ? false : reset;\r\n    // TODO: Validate that the users exist\r\n    var users = [];\r\n    var resolvedGroups = [];\r\n\r\n    const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    const folder = web.getFolderByServerRelativeUrl(serverRelFolderPath);\r\n\r\n    valuePairs.forEach(function (vp) {\r\n      var resolvedGroup = getSPSiteGroupByName(vp[0]);\r\n      if (resolvedGroup?.oGroup) {\r\n        resolvedGroups.push([resolvedGroup.oGroup, vp[1]]);\r\n      } else {\r\n        //This doesn't appear to be a group, let's see if we can find a user\r\n        users.push([currCtx.get_web().ensureUser(vp[0]), vp[1]]);\r\n      }\r\n    });\r\n\r\n    function onFindFolderSuccess() {\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      var folderItem = this.folder.get_listItemAllFields();\r\n      if (reset) {\r\n        folderItem.resetRoleInheritance();\r\n        folderItem.breakRoleInheritance(false, false);\r\n        folderItem\r\n          .get_roleAssignments()\r\n          .getByPrincipal(sal.globalConfig.currentUser)\r\n          .deleteObject();\r\n      } else {\r\n        folderItem.breakRoleInheritance(false, false);\r\n      }\r\n\r\n      this.resolvedGroups.forEach(function (groupPairs) {\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(groupPairs[1])\r\n        );\r\n        folderItem.get_roleAssignments().add(groupPairs[0], roleDefBindingColl);\r\n      });\r\n\r\n      this.users.forEach(function (userPairs) {\r\n        var roleDefBindingColl =\r\n          SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n        roleDefBindingColl.add(\r\n          web.get_roleDefinitions().getByName(userPairs[1])\r\n        );\r\n        folderItem.get_roleAssignments().add(userPairs[0], roleDefBindingColl);\r\n      });\r\n\r\n      var data = { folderItem: folderItem, callback: callback };\r\n\r\n      function onSetFolderPermissionsSuccess() {\r\n        console.log(\"Successfully set permissions\");\r\n        this.callback(folderItem);\r\n      }\r\n\r\n      function onSetFolderPermissionsFailure(sender, args) {\r\n        console.error(\r\n          \"Failed to update permissions on item: \" +\r\n            this.folderItem.get_lookupValue() +\r\n            args.get_message() +\r\n            \"\\n\" +\r\n            args.get_stackTrace(),\r\n          false\r\n        );\r\n      }\r\n\r\n      currCtx.load(folderItem);\r\n      currCtx.executeQueryAsync(\r\n        Function.createDelegate(data, onSetFolderPermissionsSuccess),\r\n        Function.createDelegate(data, onSetFolderPermissionsFailure)\r\n      );\r\n    }\r\n\r\n    function onFindFolderFailure(sender, args) {\r\n      console.error(\r\n        \"Something went wrong setting perms on library folder\",\r\n        args\r\n      );\r\n    }\r\n\r\n    var data = {\r\n      folder: folder,\r\n      users: users,\r\n      callback: callback,\r\n      resolvedGroups: resolvedGroups,\r\n      valuePairs: valuePairs,\r\n      reset: reset,\r\n    };\r\n\r\n    users.map(function (user) {\r\n      currCtx.load(user[0]);\r\n    });\r\n    currCtx.load(folder);\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onFindFolderSuccess),\r\n      Function.createDelegate(data, onFindFolderFailure)\r\n    );\r\n  }\r\n\r\n  /*****************************************************************\r\n                                  \r\n  ******************************************************************/\r\n\r\n  function showModal(formName, title, args, callback) {\r\n    var id = \"\";\r\n    if (args.id) {\r\n      id = args.id;\r\n    }\r\n    const options = SP.UI.$create_DialogOptions();\r\n\r\n    var listPath = self.config.def.isLib\r\n      ? \"/\" + self.config.def.name + \"/\"\r\n      : \"/Lists/\" + self.config.def.name + \"/\";\r\n\r\n    var rootFolder = \"\";\r\n\r\n    if (args.rootFolder) {\r\n      rootFolder = sal.globalConfig.siteUrl + listPath + args.rootFolder;\r\n    }\r\n\r\n    // WARNING: this looks similar to listPath but is different\r\n    var formsPath = self.config.def.isLib\r\n      ? \"/\" + self.config.def.name + \"/forms/\"\r\n      : \"/Lists/\" + self.config.def.name + \"/\";\r\n\r\n    Object.assign(options, {\r\n      title: title,\r\n      dialogReturnValueCallback: callback,\r\n      args: JSON.stringify(args),\r\n      height: 800,\r\n      url:\r\n        sal.globalConfig.siteUrl +\r\n        formsPath +\r\n        formName +\r\n        \"?ID=\" +\r\n        id +\r\n        \"&Source=\" +\r\n        location.pathname +\r\n        \"&RootFolder=\" +\r\n        rootFolder,\r\n    });\r\n    SP.UI.ModalDialog.showModalDialog(options);\r\n\r\n    // SP.SOD.execute(\r\n    //   \"sp.ui.dialog.js\",\r\n    //   \"SP.UI.ModalDialog.showModalDialog\",\r\n    //   options\r\n    // );\r\n  }\r\n\r\n  function showCheckinModal(fileRef, callback) {\r\n    var options = SP.UI.$create_DialogOptions();\r\n    options.title = \"Check in Document\";\r\n    options.height = \"600\";\r\n    options.dialogReturnValueCallback = callback;\r\n\r\n    options.url =\r\n      sal.globalConfig.siteUrl +\r\n      \"/_layouts/checkin.aspx?List={\" +\r\n      self.config.guid +\r\n      \"}&FileName=\" +\r\n      fileRef;\r\n\r\n    SP.UI.ModalDialog.showModalDialog(options);\r\n  }\r\n\r\n  function checkinWithComment(fileRef, comment) {\r\n    const url = `/web/GetFileByServerRelativeUrl('${fileRef}')/CheckIn(comment='${comment}',checkintype=0)`;\r\n    return fetchSharePointData(url, \"POST\");\r\n  }\r\n\r\n  function showVersionHistoryModal(itemId) {\r\n    return new Promise((resolve) => {\r\n      var options = SP.UI.$create_DialogOptions();\r\n      options.title = \"Version History\";\r\n      options.height = \"600\";\r\n      options.dialogReturnValueCallback = resolve;\r\n\r\n      options.url = getVersionHistoryUrl(itemId);\r\n\r\n      SP.UI.ModalDialog.showModalDialog(options);\r\n    });\r\n  }\r\n\r\n  function getVersionHistoryUrl(itemId) {\r\n    return (\r\n      sal.globalConfig.siteUrl +\r\n      \"/_layouts/15/versions.aspx?List={\" +\r\n      self.config.guid +\r\n      \"}&ID=\" +\r\n      itemId\r\n    );\r\n  }\r\n\r\n  function uploadNewDocumentAsync(folderPath, title, args) {\r\n    return new Promise((resolve, reject) => {\r\n      const currCtx = new SP.ClientContext.get_current();\r\n      const web = currCtx.get_web();\r\n      const oList = web.get_lists().getByTitle(self.config.def.title);\r\n\r\n      currCtx.load(oList);\r\n      currCtx.executeQueryAsync(\r\n        function () {\r\n          //folder = folder != '/' ? folder : '';\r\n\r\n          var siteString =\r\n            sal.globalConfig.siteUrl == \"/\" ? \"\" : sal.globalConfig.siteUrl;\r\n\r\n          const options = SP.UI.$create_DialogOptions();\r\n          Object.assign(options, {\r\n            title: title,\r\n            dialogReturnValueCallback: resolve,\r\n            args: JSON.stringify(args),\r\n            url:\r\n              siteString +\r\n              \"/_layouts/Upload.aspx?List=\" +\r\n              oList.get_id().toString() +\r\n              \"&RootFolder=\" +\r\n              siteString +\r\n              \"/\" +\r\n              self.config.def.name +\r\n              \"/\" +\r\n              encodeURI(folderPath) +\r\n              \"&Source=\" +\r\n              location.pathname +\r\n              \"&args=\" +\r\n              encodeURI(JSON.stringify(args)),\r\n          });\r\n          //console.log(\"Options url: \" + options.url);\r\n          SP.UI.ModalDialog.showModalDialog(options);\r\n          // SP.SOD.execute(\r\n          //   \"sp.ui.dialog.js\",\r\n          //   \"SP.UI.ModalDialog.showModalDialog\",\r\n          //   options\r\n          // );\r\n        },\r\n        function (sender, args) {\r\n          console.error(\"Error showing file modal: \");\r\n          console.error(sender);\r\n          console.error(args);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  const UPLOADCHUNKSIZE = 10485760; // PnPJs\r\n  // const UPLOADCHUNKSIZE = 262144000; // SPO\r\n\r\n  const uploadchunkActionTypes = {\r\n    start: \"startupload\",\r\n    continue: \"continueupload\",\r\n    finish: \"finishupload\",\r\n  };\r\n\r\n  async function uploadFileRestChunking(\r\n    file,\r\n    relFolderPath,\r\n    fileName,\r\n    progress\r\n  ) {\r\n    /* https://sharepoint.stackexchange.com/questions/287334/upload-files-250mb-via-sharepoint-rest-api\r\nhttps://learn.microsoft.com/en-us/previous-versions/office/developer/sharepoint-rest-reference/dn450841(v=office.15)\r\n    */\r\n    const blob = file;\r\n    const chunkSize = UPLOADCHUNKSIZE;\r\n    const fileSize = file.size;\r\n\r\n    const totalBlocks =\r\n      parseInt((fileSize / chunkSize).toString(), 10) +\r\n      (fileSize % chunkSize === 0 ? 1 : 0);\r\n\r\n    const fileRef = relFolderPath + \"/\" + fileName;\r\n\r\n    const jobGuid = getGUID();\r\n    // const jobGuid = crypto.randomUUID\r\n    //   ? crypto.randomUUID()\r\n    //   : \"74493426-fb10-4e47-bc82-120954b81a60\";\r\n\r\n    let currentPointer;\r\n    progress({ currentBlock: 0, totalBlocks });\r\n    currentPointer = await startUpload(\r\n      jobGuid,\r\n      file.slice(0, chunkSize),\r\n      fileRef,\r\n      relFolderPath\r\n    );\r\n\r\n    for (i = 2; i < totalBlocks; i++) {\r\n      progress({ currentBlock: i, totalBlocks });\r\n      currentPointer = await continueUpload(\r\n        jobGuid,\r\n        file.slice(currentPointer, currentPointer + chunkSize),\r\n        currentPointer,\r\n        fileRef\r\n      );\r\n    }\r\n\r\n    progress({ currentBlock: totalBlocks - 1, totalBlocks });\r\n    const result = await finishUpload(\r\n      jobGuid,\r\n      file.slice(currentPointer),\r\n      currentPointer,\r\n      fileRef\r\n    );\r\n\r\n    progress({ currentBlock: totalBlocks, totalBlocks });\r\n\r\n    return result;\r\n  }\r\n\r\n  async function startUpload(uploadId, chunk, fileRef, relFolderPath) {\r\n    const url =\r\n      `/web/getFolderByServerRelativeUrl(@folder)/files/getByUrlOrAddStub(@file)/StartUpload(guid'${uploadId}')?` +\r\n      `&@folder='${relFolderPath}'&@file='${fileRef}'`;\r\n\r\n    const headers = {\r\n      \"Content-Type\": \"application/octet-stream\",\r\n    };\r\n    const opts = {\r\n      body: chunk,\r\n    };\r\n\r\n    const result = await fetchSharePointData(url, \"POST\", headers, opts);\r\n    if (!result) {\r\n      console.error(\"Error starting upload!\");\r\n      return;\r\n    }\r\n\r\n    return parseFloat(result.d.StartUpload);\r\n  }\r\n\r\n  async function continueUpload(uploadId, chunk, fileOffset, fileRef) {\r\n    const url =\r\n      `/web/getFileByServerRelativeUrl(@file)/ContinueUpload(uploadId=guid'${uploadId}',fileOffset=${fileOffset})?` +\r\n      `&@file='${fileRef}'`;\r\n\r\n    const headers = {\r\n      \"Content-Type\": \"application/octet-stream\",\r\n    };\r\n    const opts = {\r\n      body: chunk,\r\n    };\r\n\r\n    const result = await fetchSharePointData(url, \"POST\", headers, opts);\r\n\r\n    if (!result) {\r\n      console.error(\"Error starting upload!\");\r\n      return;\r\n    }\r\n\r\n    return parseFloat(result.d.ContinueUpload);\r\n  }\r\n\r\n  async function finishUpload(uploadId, chunk, fileOffset, fileRef) {\r\n    const url =\r\n      `/web/getFileByServerRelativeUrl(@file)/FinishUpload(uploadId=guid'${uploadId}',fileOffset=${fileOffset})?` +\r\n      `&@file='${fileRef}'`;\r\n\r\n    const headers = {\r\n      \"Content-Type\": \"application/octet-stream\",\r\n    };\r\n    const opts = {\r\n      body: chunk,\r\n    };\r\n\r\n    const result = await fetchSharePointData(url, \"POST\", headers, opts);\r\n\r\n    if (!result) {\r\n      console.error(\"Error starting upload!\");\r\n      return;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async function uploadFileRest(file, relFolderPath, fileName) {\r\n    return await fetch(\r\n      _spPageContextInfo.webServerRelativeUrl +\r\n        `/_api/web/GetFolderByServerRelativeUrl('${relFolderPath}')/Files/add(url='${fileName}',overwrite=true)`,\r\n      {\r\n        method: \"POST\",\r\n        credentials: \"same-origin\",\r\n        body: file,\r\n        headers: {\r\n          Accept: \"application/json; odata=verbose\",\r\n          \"Content-Type\": \"application/json;odata=nometadata\",\r\n          \"X-RequestDigest\": document.getElementById(\"__REQUESTDIGEST\").value,\r\n        },\r\n      }\r\n    ).then((response) => {\r\n      if (!response.ok) {\r\n        console.error(\"Error Uploading File\", response);\r\n        return;\r\n      }\r\n\r\n      return response.json();\r\n    });\r\n  }\r\n\r\n  async function uploadFileToFolderAndUpdateMetadata(\r\n    file,\r\n    fileName,\r\n    relFolderPath,\r\n    payload,\r\n    progress = null\r\n  ) {\r\n    if (!progress) {\r\n      progress = () => {};\r\n    }\r\n\r\n    const serverRelFolderPath = getServerRelativeFolderPath(relFolderPath);\r\n    let result = null;\r\n    if (file.size > UPLOADCHUNKSIZE) {\r\n      const job = () =>\r\n        uploadFileRestChunking(file, serverRelFolderPath, fileName, progress);\r\n      result = await uploadQueue.addJob(job);\r\n    } else {\r\n      progress({ currentBlock: 0, totalBlocks: 1 });\r\n      result = await uploadFileRest(file, serverRelFolderPath, fileName);\r\n      progress({ currentBlock: 1, totalBlocks: 1 });\r\n    }\r\n\r\n    await updateUploadedFileMetadata(result.d, payload);\r\n\r\n    // check in\r\n    await checkinWithComment(serverRelFolderPath + \"/\" + fileName, \"\");\r\n\r\n    let itemUri = result.d.ListItemAllFields.__deferred.uri + \"?$select=ID\";\r\n\r\n    const listItem = await fetchSharePointData(itemUri);\r\n    return listItem.d.ID;\r\n  }\r\n\r\n  async function updateUploadedFileMetadata(fileResult, payload) {\r\n    var result = await fetch(fileResult.ListItemAllFields.__deferred.uri, {\r\n      method: \"POST\",\r\n      credentials: \"same-origin\",\r\n      body: JSON.stringify(payload),\r\n      headers: {\r\n        Accept: \"application/json; odata=nometadata\",\r\n        \"Content-Type\": \"application/json;odata=nometadata\",\r\n        \"X-RequestDigest\": document.getElementById(\"__REQUESTDIGEST\").value,\r\n        \"X-HTTP-Method\": \"MERGE\",\r\n        \"If-Match\": \"*\",\r\n      },\r\n    }).then((response) => {\r\n      if (!response.ok) {\r\n        console.error(\"Error Updating File\", response);\r\n        return;\r\n      }\r\n\r\n      return response;\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  function copyFiles(sourceFolderPath, destFolderPath, callback, onError) {\r\n    const sourcePath = getServerRelativeFolderPath(sourceFolderPath);\r\n    const destPath = getServerRelativeFolderPath(destFolderPath);\r\n    var context = new SP.ClientContext.get_current();\r\n    var web = context.get_web();\r\n    var folderSrc = web.getFolderByServerRelativeUrl(sourcePath);\r\n    context.load(folderSrc, \"Files\");\r\n    context.executeQueryAsync(\r\n      function () {\r\n        var files = folderSrc.get_files();\r\n        var e = files.getEnumerator();\r\n        var dest = [];\r\n        while (e.moveNext()) {\r\n          var file = e.get_current();\r\n          var destLibUrl = destPath + \"/\" + file.get_name();\r\n          dest.push(destLibUrl); //delete this when we're happy we got the file paths right\r\n          file.copyTo(destLibUrl, true);\r\n        }\r\n        console.log(dest); //delete this when we're happy we got the file paths right\r\n        context.executeQueryAsync(\r\n          function () {\r\n            console.log(\"Files moved successfully!\");\r\n            callback();\r\n          },\r\n          function (sender, args) {\r\n            console.log(\"error: \") + args.get_message();\r\n            onError;\r\n          }\r\n        );\r\n      },\r\n      function (sender, args) {\r\n        console.error(\"Unable to copy files: \", args.get_message());\r\n        console.error(sender);\r\n        console.error(args);\r\n        reject(args);\r\n      }\r\n    );\r\n  }\r\n\r\n  function copyFilesAsync(sourceFolder, destFolder) {\r\n    // TODO: this should stay as a static utility instead of list specific\r\n    return new Promise((resolve, reject) => {\r\n      copyFiles(sourceFolder, destFolder, resolve, reject);\r\n    });\r\n  }\r\n\r\n  // Ensure List/Library exists on the site\r\n  async function ensureList() {\r\n    // Query List Title\r\n    const listInfo = await fetchSharePointData(\r\n      `/web/lists/GetByTitle('${self.config.def.title}')`\r\n    );\r\n  }\r\n\r\n  const publicMembers = {\r\n    findByIdAsync,\r\n    getById,\r\n    findByColumnValueAsync,\r\n    loadNextPage,\r\n    getListItemsAsync,\r\n    createListItemAsync,\r\n    updateListItemAsync,\r\n    deleteListItemAsync,\r\n    setItemPermissionsAsync,\r\n    getItemPermissionsAsync,\r\n    getListPermissions,\r\n    setListPermissionsAsync,\r\n    getFolderContentsAsync,\r\n    upsertFolderPathAsync,\r\n    getServerRelativeFolderPath,\r\n    setFolderReadonlyAsync,\r\n    setFolderPermissionsAsync,\r\n    ensureFolderPermissionsAsync,\r\n    uploadFileToFolderAndUpdateMetadata,\r\n    uploadNewDocumentAsync,\r\n    copyFilesAsync,\r\n    showModal,\r\n    showCheckinModal,\r\n    showVersionHistoryModal,\r\n    getVersionHistoryUrl,\r\n  };\r\n\r\n  return publicMembers;\r\n}\r\n\r\nasync function fetchSharePointData(\r\n  uri,\r\n  method = \"GET\",\r\n  headers = {},\r\n  opts = {}\r\n) {\r\n  const siteEndpoint = uri.startsWith(\"http\")\r\n    ? uri\r\n    : sal.globalConfig.siteUrl + \"/_api\" + uri;\r\n  const response = await fetch(siteEndpoint, {\r\n    method,\r\n    headers: {\r\n      Accept: \"application/json; odata=verbose\",\r\n      \"X-RequestDigest\": document.getElementById(\"__REQUESTDIGEST\").value,\r\n      ...headers,\r\n    },\r\n    ...opts,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    if (response.status == 404) {\r\n      return;\r\n    }\r\n    console.error(response);\r\n  }\r\n  try {\r\n    const result = await response.json();\r\n    return result;\r\n  } catch (e) {\r\n    return;\r\n  }\r\n}\r\n\r\nwindow.fetchSharePointData = fetchSharePointData;\r\n\r\n/**\r\n * Gets a random GUID value\r\n *\r\n * http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\r\n */\r\n/* eslint-disable no-bitwise */\r\nfunction getGUID() {\r\n  if (crypto.randomUUID) return crypto.randomUUID();\r\n\r\n  let d = Date.now();\r\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\r\n    const r = (d + Math.random() * 16) % 16 | 0;\r\n    d = Math.floor(d / 16);\r\n    return (c === \"x\" ? r : (r & 0x3) | 0x8).toString(16);\r\n  });\r\n}\r\n\r\nclass UploadQueue {\r\n  constructor() {}\r\n\r\n  jobs = [];\r\n  _queue = [];\r\n\r\n  enqueue(job) {\r\n    this._queue.push(job);\r\n  }\r\n\r\n  async dequeue() {\r\n    this._queue.shift();\r\n  }\r\n\r\n  async doWork() {\r\n    const job = await this.dequeue();\r\n  }\r\n\r\n  addJob(job) {\r\n    return new Promise((resolve) => {\r\n      this.enqueue(job);\r\n    });\r\n  }\r\n}\r\n\r\nclass JobProcessor {\r\n  constructor(maxConcurrency) {\r\n    this.maxConcurrency = maxConcurrency;\r\n    this.runningJobs = 0;\r\n    this.queue = [];\r\n  }\r\n\r\n  addJob(asyncFunction) {\r\n    return new Promise((resolve, reject) => {\r\n      const job = async () => {\r\n        try {\r\n          const result = await asyncFunction();\r\n          resolve(result);\r\n        } catch (error) {\r\n          reject(error);\r\n        } finally {\r\n          this.runningJobs--;\r\n          this.processQueue();\r\n        }\r\n      };\r\n\r\n      this.queue.push(job);\r\n      this.processQueue();\r\n    });\r\n  }\r\n\r\n  processQueue() {\r\n    while (this.runningJobs < this.maxConcurrency && this.queue.length > 0) {\r\n      const job = this.queue.shift();\r\n      this.runningJobs++;\r\n      job();\r\n    }\r\n  }\r\n}\r\n\r\nconst uploadQueue = new JobProcessor(5);\r\n", "import { getGroupUsers } from \"./sal.js\";\r\n\r\nexport async function getUsersByGroupName(groupName) {\r\n  const users = await getGroupUsers(groupName);\r\n\r\n  if (!users) return [];\r\n\r\n  return users.map((userProps) => new People(userProps));\r\n}\r\n", "export * from \"./entity_utilities.js\";\r\nexport * from \"./knockout_extensions.js\";\r\nexport * from \"./register_components.js\";\r\nexport * from \"./sal.js\";\r\nexport * from \"./authorization.js\";\r\n", "import { sortByTitle } from \"../infrastructure/index.js\";\r\nimport { PeopleModule } from \"../components/fields/PeopleModule.js\";\r\nimport { People } from \"../entities/People.js\";\r\nimport { getUsersByGroupName } from \"../infrastructure/index.js\";\r\nimport { ensureUserByKeyAsync } from \"../infrastructure/sal.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nconst components = {\r\n  view: \"people-view\",\r\n  edit: \"people-edit\",\r\n  new: \"people-edit\",\r\n};\r\n\r\nexport class PeopleField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    // this.pickerOptions = params.pickerOptions ?? {};\r\n    this.spGroupName = params.spGroupName ?? null;\r\n    this.multiple = params.multiple ?? false;\r\n    // this.pickerOptions = params.pickerOptions ?? {};\r\n\r\n    this.Value = this.multiple ? ko.observableArray() : ko.observable();\r\n\r\n    if (ko.isObservable(this.spGroupName)) {\r\n      this.spGroupName.subscribe(this.spGroupNameChangedHandler);\r\n    }\r\n    if (ko.unwrap(this.spGroupName)) {\r\n      this.spGroupNameChangedHandler(ko.unwrap(this.spGroupName));\r\n    }\r\n  }\r\n\r\n  spGroupId = ko.observable();\r\n  userOpts = ko.observableArray();\r\n  expandUsers = ko.observable(false);\r\n\r\n  spGroupNameChangedHandler = async (groupName) => {\r\n    if (!groupName) {\r\n      this.userOpts.removeAll();\r\n      this.spGroupId(null);\r\n    }\r\n\r\n    const group = await ensureUserByKeyAsync(groupName);\r\n    this.spGroupId(group.ID);\r\n    const users = await getUsersByGroupName(groupName);\r\n    this.userOpts(users.sort(sortByTitle));\r\n  };\r\n\r\n  pickerOptions = ko.pureComputed(() => {\r\n    const groupId = ko.unwrap(this.spGroupId);\r\n\r\n    const opts = {\r\n      AllowMultipleValues: this.multiple,\r\n    };\r\n\r\n    if (groupId) opts.SharePointGroupID = groupId;\r\n\r\n    return opts;\r\n  });\r\n\r\n  toString = ko.pureComputed(() => {\r\n    if (!this.multiple) return this.Value()?.Title;\r\n\r\n    return this.Value()?.map((user) => user.Title);\r\n  });\r\n\r\n  set = (val) => {\r\n    if (!this.multiple) {\r\n      this.Value(People.Create(val));\r\n      return;\r\n    }\r\n\r\n    if (!val) {\r\n      this.Value.removeAll();\r\n      return;\r\n    }\r\n\r\n    const vals = val.results ?? val;\r\n\r\n    if (!vals.length) {\r\n      this.Value.removeAll();\r\n      return;\r\n    }\r\n    this.Value(vals.map((u) => People.Create(u)));\r\n  };\r\n\r\n  components = PeopleModule;\r\n}\r\n", "import {\r\n  SearchSelectModule,\r\n  SelectModule,\r\n} from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nexport class SelectField extends BaseField {\r\n  constructor({\r\n    displayName,\r\n    isRequired = false,\r\n    Visible,\r\n    options,\r\n    multiple = false,\r\n    optionsText,\r\n    instructions,\r\n  }) {\r\n    super({ Visible, displayName, isRequired, instructions });\r\n    this.Options(options);\r\n    this.multiple = multiple;\r\n    this.Value = multiple ? ko.observableArray() : ko.observable();\r\n    this.optionsText = optionsText;\r\n\r\n    this.components = this.multiple ? SearchSelectModule : SelectModule;\r\n  }\r\n\r\n  toString = ko.pureComputed(() =>\r\n    this.multiple ? this.Value().join(\", \") : this.Value()\r\n  );\r\n\r\n  get = () => this.Value();\r\n\r\n  set = (val) => {\r\n    if (val && this.multiple) {\r\n      if (Array.isArray(val)) {\r\n        this.Value(val);\r\n      } else {\r\n        this.Value(val.results ?? val.split(\";#\"));\r\n      }\r\n      return;\r\n    }\r\n    this.Value(val);\r\n  };\r\n\r\n  Options = ko.observableArray();\r\n}\r\n", "import { TextAreaModule } from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\nexport class TextAreaField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    this.isRichText = params.isRichText;\r\n    this.attr = params.attr ?? {};\r\n  }\r\n\r\n  components = TextAreaModule;\r\n}\r\n", "import { TextModule } from \"../components/fields/index.js\";\r\nimport { BaseField } from \"./index.js\";\r\n\r\n// import ValidationError from \"../primitives/ValidationError.js\";\r\n\r\nexport class TextField extends BaseField {\r\n  constructor(params) {\r\n    super(params);\r\n    this.attr = params.attr ?? {};\r\n    this.options = params.options ?? null;\r\n  }\r\n\r\n  components = TextModule;\r\n}\r\n", "export * from \"./BaseField.js\";\r\nexport * from \"./BlobField.js\";\r\nexport * from \"./CheckboxField.js\";\r\nexport * from \"./DateField.js\";\r\nexport * from \"./LookupField.js\";\r\nexport * from \"./PeopleField.js\";\r\nexport * from \"./SelectField.js\";\r\nexport * from \"./TextAreaField.js\";\r\nexport * from \"./TextField.js\";\r\n\r\n// export default {BaseField, BlobField}\r\n", "import { Entity } from \"./index.js\";\r\nimport { BaseField } from \"../fields/index.js\";\r\n\r\n/**\r\n * Constrained Entity's are validated based on their declared fields.\r\n * We are expecting user input, so need to validate each input field.\r\n */\r\n\r\nexport class ConstrainedEntity extends Entity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  toJSON = () => {\r\n    const out = {};\r\n    Object.keys(this.FieldMap).map(\r\n      (key) => (out[key] = this.FieldMap[key]?.get())\r\n    );\r\n    return out;\r\n  };\r\n\r\n  fromJSON(inputObj) {\r\n    if (window.DEBUG)\r\n      console.log(\"Setting constrained entity from JSON\", inputObj);\r\n    Object.keys(inputObj).map((key) => this.FieldMap[key]?.set(inputObj[key]));\r\n  }\r\n\r\n  get FieldMap() {\r\n    const fieldMap = {};\r\n    Object.entries(this)\r\n      .filter(([key, val]) => val instanceof BaseField)\r\n      .map(([key, val]) => {\r\n        key = val.systemName ?? key;\r\n        fieldMap[key] = val;\r\n      });\r\n    return fieldMap;\r\n  }\r\n\r\n  FormFields = () => Object.values(this.FieldMap);\r\n\r\n  // Validate the entire entity\r\n  validate = (showErrors = true) => {\r\n    Object.values(this.FieldMap).map(\r\n      (field) => field?.validate && field.validate(showErrors)\r\n    );\r\n    return this.Errors();\r\n  };\r\n\r\n  Errors = ko.pureComputed(() => {\r\n    return Object.values(this.FieldMap)\r\n      .filter((field) => field?.Errors && field.Errors())\r\n      .flatMap((field) => field.Errors());\r\n  });\r\n\r\n  IsValid = ko.pureComputed(() => !this.Errors().length);\r\n\r\n  /**\r\n   * Expose methods to generate default new, edit, and view forms\r\n   * for a constrained entity. Uses the constrained\r\n   * entity components.\r\n   *\r\n   * This could be broken into a separate service, but since it's\r\n   * tightly coupled leave it here?\r\n   */\r\n  // static components = {\r\n  //   new: (entity, view = null) =>\r\n  //     new ConstrainedEntityComponent({\r\n  //       entityView: new ConstrainedEntityView({ entity, view }),\r\n  //       displayMode: \"edit\",\r\n  //     }),\r\n  //   edit: (entity, view = null) =>\r\n  //     new ConstrainedEntityComponent({\r\n  //       entityView: new ConstrainedEntityView({ entity, view }),\r\n  //       displayMode: \"edit\",\r\n  //     }),\r\n  //   view: (entity, view = null) =>\r\n  //     new ConstrainedEntityComponent({\r\n  //       entityView: new ConstrainedEntityView({ entity, view }),\r\n  //       displayMode: \"view\",\r\n  //     }),\r\n  // };\r\n}\r\n", "import { AuditRequest, AuditOrganization } from \"./index.js\";\r\nimport { auditOrganizationStore } from \"../infrastructure/store.js\";\r\n\r\nimport { ConstrainedEntity } from \"../sal/primitives/constrained_entity.js\";\r\nimport { LookupField, TextField } from \"../sal/fields/index.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport class AuditCoversheet extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  Title = new TextField({\r\n    displayName: \"Title\",\r\n    required: true,\r\n  });\r\n\r\n  FileName = new TextField({\r\n    displayName: \"Name\",\r\n    systemName: \"FileLeafRef\",\r\n    required: true,\r\n  });\r\n\r\n  FileRef = new TextField({\r\n    displayName: \"File Link\",\r\n    systemName: \"FileRef\",\r\n  });\r\n\r\n  ReqNum = new LookupField({\r\n    displayName: \"Request Number\",\r\n    type: AuditRequest,\r\n    lookupCol: \"Title\",\r\n    required: true,\r\n    entitySet: appContext.AuditRequests,\r\n  });\r\n\r\n  ActionOffice = new LookupField({\r\n    displayName: \"Action Offices\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: ko.pureComputed(() => {\r\n      // Only allow action offices from this coversheets associated request\r\n      const request = ko.unwrap(this.ReqNum.Value);\r\n      if (!request) return (val) => val;\r\n\r\n      const requestActionOffices = ko.unwrap(request.ActionOffice.Value);\r\n\r\n      return (opt) => requestActionOffices.includes(opt);\r\n    }),\r\n    lookupCol: \"Title\",\r\n    multiple: true,\r\n    entitySet: appContext.AuditOrganizations,\r\n  });\r\n\r\n  static Views = {\r\n    All: [\"ID\", \"Title\", \"FileLeafRef\", \"FileRef\", \"ReqNum\", \"ActionOffice\"],\r\n    AOCanUpdate: [\"Title\", \"FileLeafRef\", \"ActionOffice\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    title: \"AuditCoversheets\",\r\n    name: \"AuditCoversheets\",\r\n    isLib: true,\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/constrained_entity.js\";\r\n\r\nexport class AuditEmail extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static Views = {\r\n    All: [\"ID\", \"Title\", \"To\", \"Body\", \"NotificationType\", \"ReqNum\", \"ResID\"],\r\n  };\r\n  static ListDef = {\r\n    name: \"AuditEmails\",\r\n    title: \"AuditEmails\",\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/constrained_entity.js\";\r\n\r\nexport const ORGTYPES = {\r\n  BUREAU: \"Bureau\",\r\n  EXTERNAL: \"External\",\r\n  INTERNAL: \"Internal\",\r\n  POST: \"Post\",\r\n};\r\n\r\nexport const ORGROLES = {\r\n  ACTIONOFFICE: \"Action Office\",\r\n  REQUESTINGOFFICE: \"Requesting Office\",\r\n  QUALITYASSURANCE: \"Quality Assurance\",\r\n  SPECIALPERMISSIONS: \"Special Permissions\",\r\n  RESTRICTEDREADERS: \"Restricted Readers\",\r\n};\r\n\r\nexport class AuditOrganization extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"Country\",\r\n      \"Organization_x0020_Description\",\r\n      \"EmailGroup\",\r\n      \"Org_Type\",\r\n      \"Post_x0020_Code\",\r\n      \"UserGroup\",\r\n      \"Role\",\r\n    ],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditOrganizations\",\r\n    title: \"AuditOrganizations\",\r\n  };\r\n}\r\n", "import { AuditOrganization, ORGTYPES } from \"./audit_organization.js\";\r\nimport {\r\n  LookupField,\r\n  PeopleField,\r\n  TextField,\r\n  TextAreaField,\r\n  DateField,\r\n  dateFieldTypes,\r\n  SelectField,\r\n  CheckboxField,\r\n} from \"../sal/fields/index.js\";\r\nimport { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\n\r\nimport { ValidationError } from \"../sal/primitives/validation_error.js\";\r\nimport {\r\n  allActionOfficesFilter,\r\n  allRequestingOfficesFilter,\r\n  auditOrganizationStore,\r\n} from \"../infrastructure/store.js\";\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport const AUDITREQUESTSTATES = {\r\n  OPEN: \"Open\",\r\n  CANCELLED: \"Canceled\",\r\n  CLOSED: \"Closed\",\r\n  REOPENED: \"ReOpened\",\r\n};\r\n\r\nexport const AUDITREQUESTTYPES = {\r\n  TASKER: \"Tasker\",\r\n  REQUEST: \"Request\",\r\n  NOTIFICATION: \"Notification\",\r\n};\r\n\r\nexport class AuditRequest extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n\r\n    this.InternalDueDate.addFieldRequirement({\r\n      requirement: ko.pureComputed(() => {\r\n        return this.InternalDueDate.Value() > this.ReqDueDate.Value();\r\n      }),\r\n      error: new ValidationError(\r\n        \"text-field\",\r\n        \"required-field\",\r\n        \"The Internal Due Date must be before the Request Due Date!\"\r\n      ),\r\n    });\r\n  }\r\n\r\n  ReqType = new SelectField({\r\n    displayName: \"Request Type\",\r\n    options: Object.values(AUDITREQUESTTYPES),\r\n    isRequired: true,\r\n    instructions: ko.pureComputed(() => {\r\n      switch (this.ReqType.Value()) {\r\n        case AUDITREQUESTTYPES.TASKER:\r\n          return \"A request that doesn't require QA Approval.\";\r\n        case AUDITREQUESTTYPES.REQUEST:\r\n          return \"A request requiring QA Approval\";\r\n        case AUDITREQUESTTYPES.NOTIFICATION:\r\n          return \"A request that is closed after the email is sent\";\r\n        default:\r\n      }\r\n    }),\r\n  });\r\n\r\n  ReqNum = new TextField({\r\n    displayName: \"Request Number\",\r\n    systemName: \"Title\",\r\n    isRequired: true,\r\n  });\r\n\r\n  ReqSubject = new TextField({\r\n    displayName: \"Request Subject\",\r\n    isRequired: true,\r\n  });\r\n\r\n  RequestingOffice = new LookupField({\r\n    displayName: \"Requesting Office\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: allRequestingOfficesFilter,\r\n    lookupCol: \"Title\",\r\n    entitySet: appContext.AuditOrganizations,\r\n    isRequired: true,\r\n  });\r\n\r\n  FiscalYear = new TextField({\r\n    displayName: \"Fiscal Year\",\r\n    isRequired: true,\r\n  });\r\n\r\n  InternalDueDate = new DateField({\r\n    displayName: \"Internal Due Date\",\r\n    type: dateFieldTypes.date,\r\n    isRequired: true,\r\n  });\r\n\r\n  ReqDueDate = new DateField({\r\n    displayName: \"Request Due Date\",\r\n    type: dateFieldTypes.date,\r\n    isRequired: true,\r\n  });\r\n\r\n  ReqStatus = new SelectField({\r\n    displayName: \"Request Status\",\r\n    options: Object.values(AUDITREQUESTSTATES),\r\n    isRequired: true,\r\n  });\r\n\r\n  IsSample = new CheckboxField({\r\n    displayName: \"Is Sample?\",\r\n  });\r\n\r\n  ReceiptDate = new DateField({\r\n    displayName: \"Receipt Date\",\r\n    type: dateFieldTypes.date,\r\n    isRequired: false,\r\n  });\r\n\r\n  RelatedAudit = new TextField({\r\n    displayName: \"Related Audit\",\r\n    isRequired: false,\r\n    instructions:\r\n      \"The Audit Request number of the similar audit performed in the previous FY\",\r\n  });\r\n\r\n  ActionItems = new TextAreaField({\r\n    displayName: \"Action Items\",\r\n    instructions: \"Items that have been requested by the Auditor\",\r\n    isRichText: true,\r\n    isMinimalEditor: true,\r\n    classList: [\"min-w-full\"],\r\n  });\r\n\r\n  Comments = new TextAreaField({\r\n    displayName: \"Comments\",\r\n    isRichText: true,\r\n    isMinimalEditor: true,\r\n    classList: [\"min-w-full\"],\r\n  });\r\n\r\n  Reminders = new SelectField({\r\n    displayName: \"Reminders\",\r\n    options: [\r\n      \"3 Days Before Due\",\r\n      \"1 Day Before Due\",\r\n      \"1 Day Past Due\",\r\n      \"3 Days Past Due\",\r\n      \"7 Days Past Due\",\r\n    ],\r\n    multiple: true,\r\n  });\r\n\r\n  EmailSent = new CheckboxField({\r\n    displayName: \"Email has been sent\",\r\n  });\r\n\r\n  Sensitivity = new SelectField({\r\n    displayName: \"Sensitivity\",\r\n    options: [\"None\", \"Official\", \"SBU\", \"PII_SBU\"],\r\n  });\r\n\r\n  ActionOffice = new LookupField({\r\n    displayName: \"Action Offices\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: allActionOfficesFilter,\r\n    lookupCol: \"Title\",\r\n    multiple: true,\r\n    entitySet: appContext.AuditOrganizations,\r\n  });\r\n\r\n  EmailActionOffice = new LookupField({\r\n    displayName: \"Email Action Offices\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: allActionOfficesFilter,\r\n    lookupCol: \"Title\",\r\n    multiple: true,\r\n    entitySet: appContext.AuditOrganizations,\r\n  });\r\n\r\n  ClosedDate = new DateField({\r\n    displayName: \"Closed Date\",\r\n    isRequired: false,\r\n  });\r\n\r\n  ClosedBy = new PeopleField({\r\n    displayName: \"Closed By\",\r\n    isRequired: false,\r\n  });\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"ReqType\",\r\n      \"ReqSubject\",\r\n      \"FiscalYear\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"EmailSent\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n      \"EmailActionOffice\",\r\n      \"RequestingOffice\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n    ],\r\n    New: [\r\n      \"Title\",\r\n      \"ReqType\",\r\n      \"ReqSubject\",\r\n      \"RequestingOffice\",\r\n      \"FiscalYear\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n    ],\r\n    IACanUpdate: [\r\n      \"ReqType\",\r\n      \"ReqSubject\",\r\n      \"FiscalYear\",\r\n      \"RequestingOffice\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n      \"EmailActionOffice\",\r\n      \"ClosedBy\",\r\n      \"ClosedDate\",\r\n    ],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditRequests\",\r\n    title: \"AuditRequests\",\r\n  };\r\n}\r\n", "import { AuditRequest } from \"./audit_request.js\";\r\n// import { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport class AuditBulkRequest extends AuditRequest {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  toRequest() {\r\n    const newReq = new AuditRequest(this);\r\n\r\n    newReq.fromJSON(this.toJSON());\r\n    return newReq;\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"ReqSubject\",\r\n      \"FiscalYear\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"EmailSent\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n      \"EmailActionOffice\",\r\n      \"EmailActionOffice\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n    ],\r\n    New: [\r\n      \"Title\",\r\n      \"ReqSubject\",\r\n      \"FiscalYear\",\r\n      \"InternalDueDate\",\r\n      \"ReqDueDate\",\r\n      \"ReqStatus\",\r\n      \"IsSample\",\r\n      \"ReceiptDate\",\r\n      \"RelatedAudit\",\r\n      \"ActionItems\",\r\n      \"Comments\",\r\n      \"Reminders\",\r\n      \"Sensitivity\",\r\n      \"ActionOffice\",\r\n    ],\r\n  };\r\n  static ListDef = {\r\n    name: \"AuditBulkRequests\",\r\n    title: \"AuditBulkRequests\",\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\nimport { TextField, DateField, dateFieldTypes } from \"../sal/fields/index.js\";\r\n\r\nexport class Comment extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  id = new TextField({\r\n    displayName: \"ID\",\r\n  });\r\n  text = new TextField({\r\n    displayName: \"Comment\",\r\n  });\r\n  author = new TextField({\r\n    displayName: \"author\",\r\n  });\r\n  timestamp = new TextField({\r\n    displayName: \"timestamp\",\r\n  });\r\n\r\n  FieldMap = {\r\n    id: this.id,\r\n    text: this.text,\r\n    author: this.author,\r\n    timestamp: this.timestamp,\r\n  };\r\n\r\n  static Create({ id, text, author, timestamp }) {\r\n    const newComment = new Comment();\r\n    newComment.id.Value(id);\r\n    newComment.text.Value(text);\r\n    newComment.author.Value(author);\r\n    newComment.timestamp.Value(timestamp);\r\n\r\n    return newComment;\r\n  }\r\n  static Views = {\r\n    All: [\"id\", \"text\", \"author\", \"timestamp\"],\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\nimport { TextField, DateField, dateFieldTypes } from \"../sal/fields/index.js\";\r\n\r\nexport class ActiveViewer extends ConstrainedEntity {\r\n  id = new TextField({\r\n    displayName: \"ID\",\r\n  });\r\n  viewer = new TextField({\r\n    displayName: \"Viewer\",\r\n  });\r\n  timestamp = new DateField({\r\n    displayName: \"Timestamp\",\r\n    type: dateFieldTypes.datetime,\r\n  });\r\n\r\n  FieldMap = {\r\n    id: this.id,\r\n    viewer: this.viewer,\r\n    timestamp: this.timestamp,\r\n  };\r\n\r\n  static Views = {\r\n    All: [\"id\", \"viewer\", \"timestamp\"],\r\n  };\r\n}\r\n", "import { ActiveViewer } from \"../../value_objects/active_viewer.js\";\r\nimport { appContext } from \"../../infrastructure/application_db_context.js\";\r\n\r\nexport class ActiveViewersComponent {\r\n  constructor({ entity, fieldName }) {\r\n    this.entity = entity;\r\n    this.blobField = entity[fieldName];\r\n    this.fieldName = fieldName;\r\n    this.viewers = this.blobField.TypedValues;\r\n  }\r\n  entity;\r\n  blobField;\r\n  fieldName;\r\n\r\n  pushCurrentUser() {\r\n    this.pushUser(_spPageContextInfo.userLoginName);\r\n  }\r\n\r\n  pushUser(loginName) {\r\n    // Check if our viewer is listed\r\n    var filteredViewers = this.viewers().filter(function (viewer) {\r\n      return viewer.viewer != loginName;\r\n    });\r\n\r\n    this.viewers(filteredViewers);\r\n\r\n    var viewer = new ActiveViewer();\r\n    viewer.fromJSON({\r\n      id: Math.ceil(Math.random() * 1000000).toString(16),\r\n      viewer: loginName,\r\n      timestamp: new Date().toLocaleString(),\r\n    });\r\n    this.viewers.push(viewer);\r\n    this.commitChanges();\r\n  }\r\n\r\n  removeUser(viewerToRemove) {\r\n    this.viewers.remove(viewerToRemove);\r\n    this.commitChanges();\r\n  }\r\n\r\n  removeCurrentuser() {\r\n    this.removeUserByLogin(_spPageContextInfo.userLoginName);\r\n  }\r\n\r\n  removeUserByLogin(loginName) {\r\n    // Check if our viewer is listed\r\n    var viewerToRemove = this.viewers().find(function (viewer) {\r\n      return viewer.viewer == loginName;\r\n    });\r\n\r\n    if (viewerToRemove) {\r\n      this.removeUser(viewerToRemove);\r\n    }\r\n  }\r\n\r\n  onRemove = (viewerToRemove) => {\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      this.removeUser(viewerToRemove);\r\n    }\r\n  };\r\n\r\n  async commitChanges() {\r\n    const set = appContext.Set(this.entity.constructor);\r\n    if (!set) {\r\n      alert(\"Cannot find entity set\", this.entity);\r\n      return;\r\n    }\r\n    await set.UpdateEntity(this.entity, [this.fieldName]);\r\n  }\r\n}\r\n\r\n// TODO: convert to class\r\nexport function ActiveViewersModuleLegacy(requestId, props) {\r\n  var requestListTitle = props.requestListTitle;\r\n  var columnName = props.columnName;\r\n  var initialValue = props.initialValue;\r\n  var arrInitialViewers = [];\r\n  // If we have comments here, try to parse them.\r\n  if (initialValue) {\r\n    try {\r\n      arrInitialViewers = JSON.parse(initialValue);\r\n      arrInitialViewers.forEach(function (viewer) {\r\n        viewer.timestamp = new Date(viewer.timestamp);\r\n      });\r\n    } catch (e) {\r\n      console.error(\"could not parse internal status comments.\");\r\n    }\r\n  }\r\n  var viewers = ko.observableArray(arrInitialViewers);\r\n\r\n  function pushCurrentUser() {\r\n    pushUser(_spPageContextInfo.userLoginName);\r\n  }\r\n\r\n  function pushUser(loginName) {\r\n    // Check if our viewer is listed\r\n    var filteredViewers = viewers().filter(function (viewer) {\r\n      return viewer.viewer != loginName;\r\n    });\r\n\r\n    viewers(filteredViewers);\r\n\r\n    var viewer = {\r\n      id: Math.ceil(Math.random() * 1000000).toString(16),\r\n      viewer: loginName,\r\n      timestamp: new Date(),\r\n    };\r\n    viewers.push(viewer);\r\n    commitChanges();\r\n  }\r\n\r\n  function removeCurrentuser() {\r\n    removeUserByLogin(_spPageContextInfo.userLoginName);\r\n  }\r\n\r\n  function removeUserByLogin(loginName) {\r\n    // Check if our viewer is listed\r\n    var viewerToRemove = viewers().filter(function (viewer) {\r\n      return viewer.viewer == loginName;\r\n    });\r\n\r\n    if (viewerToRemove.length) {\r\n      removeUser(viewerToRemove[0]);\r\n    }\r\n  }\r\n\r\n  function onRemove(viewerToRemove) {\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      removeUser(viewerToRemove);\r\n    }\r\n  }\r\n\r\n  function removeUser(viewerToRemove) {\r\n    var viewerIndex = viewers.indexOf(viewerToRemove);\r\n    viewers.splice(viewerIndex, 1);\r\n    commitChanges();\r\n  }\r\n\r\n  function commitChanges() {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n    //Now push to the request item:\r\n    var requestList = web.get_lists().getByTitle(requestListTitle);\r\n    const oListItem = requestList.getItemById(requestId);\r\n    oListItem.set_item(columnName, JSON.stringify(viewers()));\r\n    oListItem.update();\r\n\r\n    currCtx.load(oListItem);\r\n\r\n    currCtx.executeQueryAsync(\r\n      function onSuccess() {\r\n        // console.log(\"Added User\");\r\n      },\r\n      function onFailure(args, sender) {\r\n        console.error(\"Failed to commit changes - \" + columnName, args);\r\n      }\r\n    );\r\n  }\r\n\r\n  var publicMembers = {\r\n    viewers: viewers,\r\n    pushCurrentUser: pushCurrentUser,\r\n    pushUser: pushUser,\r\n    removeCurrentuser: removeCurrentuser,\r\n    removeUserByLogin: removeUserByLogin,\r\n    onRemove: onRemove,\r\n  };\r\n\r\n  return publicMembers;\r\n}\r\n", "import { html } from \"../../sal/infrastructure/index.js\";\r\n\r\nexport const commentChainTemplate = html`\r\n  <div>\r\n    <!-- ko if: showHistoryBool -->\r\n    <!-- ko foreach: comments -->\r\n    <div class=\"comment\">\r\n      <div data-bind=\"text: text.Value\"></div>\r\n      <div>\r\n        <span\r\n          data-bind=\"text: author.Value() + ' @ ' + timestamp.Value()\"\r\n        ></span\r\n        ><span class=\"remove\" data-bind=\"click: $parent.onRemove\">x</span>\r\n      </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- ko ifnot: showHistoryBool -->\r\n    <div class=\"comment\" data-bind=\"with: comments()[comments().length - 1]\">\r\n      <div data-bind=\"text: text.Value\"></div>\r\n      <div>\r\n        <span\r\n          data-bind=\"text: author.Value() + ' @ ' + timestamp.Value()\"\r\n        ></span\r\n        ><span class=\"remove\" data-bind=\"click: $parent.onRemove\">x</span>\r\n      </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <a\r\n      title=\"Show hidden comments\"\r\n      href=\"javascript:void(0)\"\r\n      data-bind=\"click: toggleShowHistory\"\r\n    >\r\n      <span class=\"ui-icon ui-icon-comment\"></span>\r\n      Toggle Comment History (<span data-bind=\"text: comments().length\"></span>\r\n      Total)\r\n    </a>\r\n    <div class=\"newComment\">\r\n      <textarea cols=\"50\" data-bind=\"value: newCommentText\"></textarea>\r\n      <button type=\"button\" data-bind=\"click: onSubmit\">Submit</button>\r\n    </div>\r\n  </div>\r\n`;\r\n", "import { appContext } from \"../../infrastructure/application_db_context.js\";\r\nimport {\r\n  registerComponent,\r\n  directRegisterComponent,\r\n} from \"../../sal/infrastructure/index.js\";\r\nimport { Comment } from \"../../value_objects/comment.js\";\r\nimport { commentChainTemplate } from \"./CommentChainTemplate.js\";\r\n\r\nconst commentChainComponentName = \"commentChain\";\r\n\r\nexport class CommentChainComponent {\r\n  constructor({ entity, fieldName }) {\r\n    this.entity = entity;\r\n    this.blobField = entity[fieldName];\r\n    this.fieldName = fieldName;\r\n  }\r\n  entity;\r\n  blobField;\r\n  fieldName;\r\n\r\n  componentName = commentChainComponentName;\r\n}\r\n\r\nclass CommentChainModule {\r\n  constructor({ entity, fieldName, blobField }) {\r\n    this.entity = entity;\r\n    this.fieldName = fieldName;\r\n    this.blobField = blobField;\r\n    this.comments = blobField.TypedValues;\r\n  }\r\n\r\n  // comments = ko.observableArray();\r\n  newCommentText = ko.observable();\r\n\r\n  showHistoryBool = ko.observable(false);\r\n\r\n  toggleShowHistory = function () {\r\n    this.showHistoryBool(!this.showHistoryBool());\r\n  };\r\n\r\n  async onSubmit() {\r\n    var comment = Comment.Create({\r\n      id: Math.ceil(Math.random() * 1000000).toString(16),\r\n      text: this.newCommentText(),\r\n      author: _spPageContextInfo.userLoginName,\r\n      timestamp: new Date().toLocaleString(),\r\n    });\r\n    this.blobField.add(comment);\r\n    await this.commitChanges();\r\n    this.newCommentText(\"\");\r\n  }\r\n\r\n  onRemove = (commentToRemove) => {\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      this.blobField.remove(commentToRemove);\r\n      this.commitChanges();\r\n    }\r\n  };\r\n\r\n  async commitChanges() {\r\n    const set = appContext.Set(this.entity.constructor);\r\n    if (!set) {\r\n      alert(\"Cannot find entity set\", this.entity);\r\n      return;\r\n    }\r\n    await set.UpdateEntity(this.entity, [this.fieldName]);\r\n  }\r\n}\r\n\r\ndirectRegisterComponent(commentChainComponentName, {\r\n  template: commentChainTemplate,\r\n  viewModel: CommentChainModule,\r\n});\r\n\r\nexport class CommentChainModuleLegacy {\r\n  constructor(requestId, props) {\r\n    this.requestId = requestId;\r\n    this.requestListTitle = props.requestListTitle;\r\n    this.columnName = props.columnName;\r\n\r\n    const initialValue = props.initialValue;\r\n    if (initialValue) {\r\n      try {\r\n        const arrInitialComments = JSON.parse(initialValue);\r\n        arrInitialComments.map(function (comment) {\r\n          comment.timestamp = new Date(comment.timestamp);\r\n        });\r\n        this.comments(arrInitialComments);\r\n      } catch (e) {\r\n        console.error(\"could not parse internal status comments.\");\r\n      }\r\n    }\r\n  }\r\n\r\n  comments = ko.observableArray();\r\n  newCommentText = ko.observable();\r\n\r\n  showHistoryBool = ko.observable(false);\r\n\r\n  toggleShowHistory = function () {\r\n    this.showHistoryBool(!this.showHistoryBool());\r\n  };\r\n\r\n  onSubmit = () => {\r\n    var comment = {\r\n      id: Math.ceil(Math.random() * 1000000).toString(16),\r\n      text: this.newCommentText(),\r\n      author: _spPageContextInfo.userLoginName,\r\n      timestamp: new Date(),\r\n    };\r\n    this.comments.push(comment);\r\n    this.commitChanges();\r\n    this.newCommentText(\"\");\r\n  };\r\n\r\n  onRemove = (commentToRemove) => {\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      this.comments.remove(commentToRemove);\r\n      this.commitChanges();\r\n    }\r\n  };\r\n\r\n  commitChanges = () => {\r\n    const currCtx = new SP.ClientContext.get_current();\r\n    const web = currCtx.get_web();\r\n    //Now push to the request item:\r\n    const requestList = web.get_lists().getByTitle(this.requestListTitle);\r\n    const oListItem = requestList.getItemById(this.requestId);\r\n    oListItem.set_item(this.columnName, JSON.stringify(this.comments()));\r\n    oListItem.update();\r\n\r\n    currCtx.load(oListItem);\r\n\r\n    currCtx.executeQueryAsync(\r\n      function onSuccess() {\r\n        // console.log(\"Updated comments\");\r\n      },\r\n      function onFailure(args, sender) {\r\n        console.error(\"Failed to commit changes.\", args);\r\n      }\r\n    );\r\n  };\r\n}\r\n", "import { LookupField, BlobField } from \"../sal/fields/index.js\";\r\n\r\nimport { ConstrainedEntity } from \"../sal/primitives/constrained_entity.js\";\r\n\r\nimport { AuditRequest } from \"./audit_request.js\";\r\nimport { Comment } from \"../value_objects/comment.js\";\r\nimport { ActiveViewer } from \"../value_objects/active_viewer.js\";\r\n\r\nimport { ActiveViewersComponent } from \"../components/active_viewers/active_viewers_module.js\";\r\nimport { CommentChainComponent } from \"../components/comment_chain/comment_chain_module.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport class AuditRequestsInternal extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  ActiveViewers = new BlobField({\r\n    displayName: \"Active Viewers\",\r\n    entityType: ActiveViewer,\r\n    multiple: true,\r\n  });\r\n\r\n  InternalStatus = new BlobField({\r\n    displayName: \"Internal Status\",\r\n    entityType: Comment,\r\n    multiple: true,\r\n  });\r\n\r\n  ReqNum = new LookupField({\r\n    displayName: \"Request\",\r\n    type: AuditRequest,\r\n    lookupCol: \"Title\",\r\n    entitySet: appContext.AuditRequests,\r\n  });\r\n\r\n  commentChainComponent = new CommentChainComponent({\r\n    entity: this,\r\n    fieldName: \"InternalStatus\",\r\n  });\r\n\r\n  activeViewersComponent = new ActiveViewersComponent({\r\n    entity: this,\r\n    fieldName: \"ActiveViewers\",\r\n  });\r\n\r\n  static Views = {\r\n    All: [\"ID\", \"ActiveViewers\", \"InternalStatus\", \"ReqNum\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    title: \"AuditRequestsInternal\",\r\n    name: \"AuditRequestsInternal\",\r\n  };\r\n}\r\n", "import { People } from \"../sal/entities/index.js\";\r\nimport {\r\n  ensureUserByKeyAsync,\r\n  getDefaultGroups,\r\n  getUserPropsAsync,\r\n} from \"../sal/infrastructure/index.js\";\r\n\r\nconst groupNameSpecialPermName1 = \"CGFS Special Access1\";\r\nconst groupNameSpecialPermName2 = \"CGFS Special Access2\";\r\nconst groupNameQA = \"Quality Assurance\";\r\nconst groupNameEA = \"External Auditors\";\r\n\r\nexport function getSiteGroups() {\r\n  const groups = getDefaultGroups();\r\n  const mappedGroups = {};\r\n  Object.entries(groups).map(\r\n    ([key, group]) => (mappedGroups[key] = new People(group))\r\n  );\r\n  return mappedGroups;\r\n}\r\n\r\nexport async function getPeopleByUsername(userName) {\r\n  const user = await ensureUserByKeyAsync(userName);\r\n  if (!user) return null;\r\n  return new People(user);\r\n}\r\n\r\nlet specialGroups = null;\r\nlet specialGroupsLoading = ko.observable(false);\r\nexport async function getSpecialPermGroups() {\r\n  if (specialGroups) return specialGroups;\r\n  if (specialGroupsLoading()) {\r\n    return new Promise((resolve) => {\r\n      const subscriber = specialGroupsLoading.subscribe(() => {\r\n        subscriber.dispose();\r\n        resolve(specialGroups);\r\n      });\r\n    });\r\n  }\r\n\r\n  specialGroupsLoading(true);\r\n  const specialPermGroup1 = await getPeopleByUsername(\r\n    groupNameSpecialPermName1\r\n  );\r\n  const specialPermGroup2 = await getPeopleByUsername(\r\n    groupNameSpecialPermName2\r\n  );\r\n\r\n  specialGroups = {\r\n    specialPermGroup1,\r\n    specialPermGroup2,\r\n  };\r\n\r\n  specialGroupsLoading(false);\r\n\r\n  return specialGroups;\r\n}\r\n\r\nlet qaGroup = null;\r\nlet qaGroupLoading = ko.observable(false);\r\nexport async function getQAGroup() {\r\n  if (qaGroup) return qaGroup;\r\n  if (qaGroupLoading()) {\r\n    return new Promise((resolve) => {\r\n      const subscriber = qaGroupLoading.subscribe(() => {\r\n        subscriber.dispose();\r\n        resolve(qaGroup);\r\n      });\r\n    });\r\n  }\r\n  qaGroupLoading(true);\r\n  qaGroup = await getPeopleByUsername(groupNameQA);\r\n  qaGroupLoading(false);\r\n  return qaGroup;\r\n}\r\n\r\nclass User extends People {\r\n  constructor({\r\n    ID,\r\n    Title,\r\n    LoginName = null,\r\n    LookupValue = null,\r\n    WorkPhone = null,\r\n    EMail = null,\r\n    IsGroup = null,\r\n    IsEnsured = false,\r\n    Groups = null,\r\n  }) {\r\n    super({ ID, Title, LookupValue, LoginName, IsGroup, IsEnsured });\r\n\r\n    this.WorkPhone = WorkPhone;\r\n    this.EMail = EMail;\r\n\r\n    this.Groups = Groups;\r\n  }\r\n\r\n  Groups = [];\r\n\r\n  isInGroup(group) {\r\n    if (!group?.ID) return false;\r\n    return this.getGroupIds().includes(group.ID);\r\n  }\r\n\r\n  getGroupIds() {\r\n    return this.Groups.map((group) => group.ID);\r\n  }\r\n\r\n  IsSiteOwner = ko.pureComputed(() =>\r\n    this.isInGroup(getDefaultGroups().owners)\r\n  );\r\n\r\n  hasSystemRole = (systemRole) => {\r\n    const userIsOwner = this.IsSiteOwner();\r\n    switch (systemRole) {\r\n      case systemRoles.Admin:\r\n        return userIsOwner;\r\n        break;\r\n      case systemRoles.ActionOffice:\r\n        return userIsOwner || this.ActionOffices().length;\r\n      default:\r\n    }\r\n  };\r\n\r\n  static _user = null;\r\n  static Create = async function () {\r\n    if (User._user) return User._user;\r\n    // TODO: Major - Switch to getUserPropertiesAsync since that includes phone # etc\r\n    const userProps = await getUserPropsAsync();\r\n    // const userProps2 = await UserManager.getUserPropertiesAsync();\r\n    User._user = new User(userProps);\r\n    return User._user;\r\n  };\r\n}\r\n\r\nexport const currentUser = User.Create;\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\nimport {\r\n  LookupField,\r\n  BlobField,\r\n  TextField,\r\n  TextAreaField,\r\n  DateField,\r\n  dateFieldTypes,\r\n  SelectField,\r\n  PeopleField,\r\n} from \"../sal/fields/index.js\";\r\n\r\nimport { AuditRequest, AuditOrganization } from \"./index.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nimport { ActiveViewer } from \"../value_objects/active_viewer.js\";\r\nimport { ActiveViewersComponent } from \"../components/active_viewers/active_viewers_module.js\";\r\n\r\nimport { auditOrganizationStore } from \"../infrastructure/store.js\";\r\nimport { currentUser } from \"../services/people_manager.js\";\r\n\r\n// import { appContext } from \"../infrastructure/ServiceContainer.js\";\r\n\r\nexport const AuditResponseStates = {\r\n  Open: \"1-Open\",\r\n  Submitted: \"2-Submitted\",\r\n  ReturnedToAO: \"3-Returned to Action Office\",\r\n  ApprovedForQA: \"4-Approved for QA\",\r\n  ReturnedToGFS: \"5-Returned to GFS\",\r\n  RepostedAfterRejection: \"6-Reposted After Rejection\",\r\n  Closed: \"7-Closed\",\r\n};\r\n\r\nexport class AuditResponse extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  Title = new TextField({\r\n    displayName: \"Name\",\r\n  });\r\n\r\n  ReqNum = new LookupField({\r\n    displayName: \"Request Number\",\r\n    type: AuditRequest,\r\n    entitySet: appContext.AuditRequests,\r\n  });\r\n\r\n  SampleNumber = new TextField({\r\n    displayName: \"Sample Number\",\r\n    isRequired: true,\r\n  });\r\n\r\n  ResStatus = new SelectField({\r\n    displayName: \"Response Status\",\r\n    options: Object.values(AuditResponseStates),\r\n  });\r\n\r\n  ReturnReason = new TextField({\r\n    displayName: \"Return Reason\",\r\n    options: [\"Incomplete Document\", \"Incorrect POC\"],\r\n  });\r\n\r\n  Comments = new TextAreaField({\r\n    displayName: \"Comments\",\r\n    isRichText: true,\r\n    isMinimalEditor: true,\r\n    classList: [\"min-w-full\"],\r\n  });\r\n\r\n  ClosedDate = new DateField({\r\n    displayName: \"Closed Date\",\r\n    type: dateFieldTypes.date,\r\n  });\r\n\r\n  ClosedBy = new PeopleField({\r\n    displayName: \"Closed By\",\r\n  });\r\n\r\n  POC = new PeopleField({\r\n    displayName: \"POC\",\r\n  });\r\n\r\n  POCCC = new PeopleField({\r\n    displayName: \"POCCC\",\r\n  });\r\n\r\n  ActionOffice = new LookupField({\r\n    displayName: \"Action Office\",\r\n    type: AuditOrganization,\r\n    options: auditOrganizationStore,\r\n    optionsFilter: ko.pureComputed(() => {\r\n      // Only allow action offices from this coversheets associated request\r\n      const request = ko.unwrap(this.ReqNum.Value);\r\n      if (!request) return (val) => val;\r\n\r\n      const requestActionOffices = ko.unwrap(request.ActionOffice.Value);\r\n\r\n      return (opt) => requestActionOffices.includes(opt);\r\n    }),\r\n    entitySet: appContext.AuditOrganizations,\r\n    lookupCol: \"Title\",\r\n    isRequired: true,\r\n  });\r\n\r\n  ActiveViewers = new BlobField({\r\n    displayName: \"Active Viewers\",\r\n    entityType: ActiveViewer,\r\n    multiple: true,\r\n  });\r\n\r\n  activeViewersComponent = new ActiveViewersComponent({\r\n    entity: this,\r\n    fieldName: \"ActiveViewers\",\r\n  });\r\n\r\n  async uploadResponseDocFile(file) {\r\n    const fileMetadata = {\r\n      Title: file.name,\r\n      ReqNumId: this.ReqNum.Value().ID,\r\n      ResIDId: this.ID,\r\n    };\r\n\r\n    const { appContext } = await import(\r\n      \"../infrastructure/application_db_context.js\"\r\n    );\r\n\r\n    return await appContext.AuditResponseDocs.UploadFileToFolderAndUpdateMetadata(\r\n      file,\r\n      file.name,\r\n      this.Title.Value(),\r\n      fileMetadata\r\n    );\r\n  }\r\n\r\n  markClosed() {\r\n    this.ResStatus.Value(AuditResponseStates.Closed);\r\n    this.ClosedDate.set(new Date());\r\n    this.ClosedBy.set(currentUser());\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"SampleNumber\",\r\n      \"ResStatus\",\r\n      \"ReturnReason\",\r\n      \"Comments\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n      \"POC\",\r\n      \"POCCC\",\r\n      \"ReqNum\",\r\n      \"ActionOffice\",\r\n      \"ActiveViewers\",\r\n    ],\r\n    NewForm: [\"ReqNum\", \"ActionOffice\", \"SampleNumber\", \"Comments\"],\r\n    EditForm: [\r\n      \"ReqNum\",\r\n      \"SampleNumber\",\r\n      \"Title\",\r\n      \"ActionOffice\",\r\n      \"ResStatus\",\r\n      \"ReturnReason\",\r\n      \"Comments\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n      \"POC\",\r\n      \"POCCC\",\r\n    ],\r\n    IACanUpdate: [\r\n      \"Title\",\r\n      \"ActionOffice\",\r\n      \"ResStatus\",\r\n      \"ReturnReason\",\r\n      \"Comments\",\r\n      \"ClosedDate\",\r\n      \"ClosedBy\",\r\n      \"POC\",\r\n      \"POCCC\",\r\n    ],\r\n    IAUpdateClosed: [\"ResStatus\", \"ClosedDate\", \"ClosedBy\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditResponses\",\r\n    title: \"AuditResponses\",\r\n  };\r\n}\r\n", "import { AuditResponse } from \"./index.js\";\r\n\r\nexport class AuditBulkResponse extends AuditResponse {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  static ListDef = {\r\n    name: \"AuditBulkResponses\",\r\n    title: \"AuditBulkResponses\",\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\nimport {\r\n  LookupField,\r\n  TextField,\r\n  TextAreaField,\r\n  DateField,\r\n  dateFieldTypes,\r\n  SelectField,\r\n  PeopleField,\r\n} from \"../sal/fields/index.js\";\r\n\r\nimport { AuditResponse } from \"./audit_response.js\";\r\nimport { AuditRequest } from \"./audit_request.js\";\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport const AuditResponseDocStates = {\r\n  Open: \"Open\",\r\n  Submitted: \"Submitted\",\r\n  SentToQA: \"Sent to QA\",\r\n  Approved: \"Approved\",\r\n  Rejected: \"Rejected\",\r\n  Archived: \"Archived\",\r\n  MarkedForDeletion: \"Marked for Deletion\",\r\n};\r\n\r\nexport class AuditResponseDoc extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  Title = new TextField({\r\n    displayName: \"Name\",\r\n  });\r\n\r\n  ReceiptDate = new DateField({\r\n    displayName: \"Receipt Date\",\r\n    type: dateFieldTypes.date,\r\n  });\r\n\r\n  DocumentStatus = new SelectField({\r\n    displayName: \"Document Status\",\r\n    options: Object.values(AuditResponseDocStates),\r\n  });\r\n\r\n  RejectReason = new TextAreaField({\r\n    displayName: \"Reject Reason\",\r\n  });\r\n\r\n  ReqNum = new LookupField({\r\n    displayName: \"Request Number\",\r\n    type: AuditRequest,\r\n    entitySet: appContext.AuditRequests,\r\n  });\r\n\r\n  ResID = new LookupField({\r\n    displayName: \"Response ID\",\r\n    type: AuditResponse,\r\n    entitySet: appContext.AuditResponses,\r\n  });\r\n\r\n  FileName = new TextField({\r\n    displayName: \"Name\",\r\n    systemName: \"FileLeafRef\",\r\n  });\r\n\r\n  FileRef = new TextField({\r\n    displayName: \"File Link\",\r\n    systemName: \"FileRef\",\r\n  });\r\n\r\n  Modified = new DateField({\r\n    displayName: \"Modified\",\r\n    type: dateFieldTypes.datetime,\r\n  });\r\n\r\n  Editor = new PeopleField({\r\n    displayName: \"Modified By\",\r\n  });\r\n\r\n  Created = new DateField({\r\n    displayName: \"Created\",\r\n    type: dateFieldTypes.datetime,\r\n  });\r\n\r\n  FileSizeDisplay = new TextField({\r\n    displayName: \"File\",\r\n  });\r\n\r\n  File_x0020_Type = new TextField({\r\n    displayName: \"File Type\",\r\n    systemName: \"File_x0020_Type\",\r\n  });\r\n\r\n  CheckoutUser = new PeopleField({\r\n    displayName: \"Checked Out To\",\r\n  });\r\n\r\n  markApprovedForRO(newFileName) {\r\n    this.DocumentStatus.Value(AuditResponseDocStates.Approved);\r\n    this.RejectReason.Value(\"\");\r\n    if (this.FileName.Value() != newFileName) this.FileName.Value(newFileName);\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"ReceiptDate\",\r\n      \"DocumentStatus\",\r\n      \"RejectReason\",\r\n      \"ReqNum\",\r\n      \"ResID\",\r\n      \"FileLeafRef\",\r\n      \"FileRef\",\r\n      \"FileSizeDisplay\",\r\n      \"File_x0020_Type\",\r\n      \"CheckoutUser\",\r\n      \"Modified\",\r\n      \"Editor\",\r\n      \"Created\",\r\n    ],\r\n    EditForm: [\r\n      \"FileLeafRef\",\r\n      \"Title\",\r\n      \"ReceiptDate\",\r\n      \"DocumentStatus\",\r\n      \"RejectReason\",\r\n      \"ReqNum\",\r\n      \"ResID\",\r\n    ],\r\n    AOCanUpdate: [\r\n      \"Title\",\r\n      \"ReceiptDate\",\r\n      \"DocumentStatus\",\r\n      \"RejectReason\",\r\n      \"FileLeafRef\",\r\n    ],\r\n    UpdateDocStatus: [\"Title\", \"FileLeafRef\", \"DocumentStatus\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditResponseDocs\",\r\n    title: \"AuditResponseDocs\",\r\n    isLib: true,\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\n\r\nexport class AuditResponseDocRO extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  markApprovedForRO(request, response) {\r\n    this.ReqNum = request.Title;\r\n    this.ResID = response.Title.toString();\r\n    this.FiscalYear = request.FiscalYear.toString();\r\n    this.ReqSubject = request.ReqSubject.toString();\r\n    this.RequestingOffice = request.RequestingOffice.Value()?.UserGroup?.Title;\r\n  }\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"ReqNum\",\r\n      \"ResID\",\r\n      \"FiscalYear\",\r\n      \"RequestingOffice\",\r\n      \"ReqSubject\",\r\n      \"FileLeafRef\",\r\n      \"FileRef\",\r\n    ],\r\n    ApprovedForROUpdate: [\r\n      \"ReqNum\",\r\n      \"ResID\",\r\n      \"FiscalYear\",\r\n      \"ReqSubject\",\r\n      \"RequestingOffice\",\r\n    ],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditResponseDocsRO\",\r\n    title: \"AuditResponseDocsRO\",\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\n\r\nexport class AuditROEmailLog extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  Responses = \"\";\r\n  ResponseCount = 0;\r\n\r\n  static Views = {\r\n    All: [\r\n      \"ID\",\r\n      \"Title\",\r\n      \"RequestingOffice\",\r\n      \"Responses\",\r\n      \"ResponseCount\",\r\n      \"SentEmail\",\r\n    ],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"AuditROEmailLog\",\r\n    title: \"AuditROEmailLog\",\r\n    fields: AuditROEmailLog.Views.All,\r\n  };\r\n}\r\n", "import { ConstrainedEntity } from \"../sal/primitives/index.js\";\r\n\r\nexport class AuditConfiguration extends ConstrainedEntity {\r\n  constructor(params) {\r\n    super(params);\r\n  }\r\n\r\n  key;\r\n  value;\r\n\r\n  FieldMap = {\r\n    Title: {\r\n      get: () => this.key,\r\n      set: (val) => (this.key = val),\r\n    },\r\n    Value: {\r\n      get: () => this.value,\r\n      set: (val) => (this.value = val),\r\n    },\r\n  };\r\n  static Views = {\r\n    All: [\"ID\", \"Title\", \"Value\"],\r\n  };\r\n\r\n  static ListDef = {\r\n    name: \"Config\",\r\n    title: \"Config\",\r\n  };\r\n}\r\n", "export * from \"./audit_coversheet.js\";\r\nexport * from \"./audit_email.js\";\r\nexport * from \"./audit_organization.js\";\r\nexport * from \"./audit_request.js\";\r\nexport * from \"./audit_bulk_request.js\";\r\nexport * from \"./audit_request_internal.js\";\r\nexport * from \"./audit_response.js\";\r\nexport * from \"./audit_bulk_response.js\";\r\nexport * from \"./audit_response_doc.js\";\r\nexport * from \"./audit_response_doc_ro.js\";\r\nexport * from \"./audit_ro_email_log.js\";\r\nexport * from \"./config.js\";\r\n", "import { Page } from \"./entities/index.js\";\r\nimport { SPList, copyFileAsync } from \"./infrastructure/index.js\";\r\n\r\nconst DEBUG = false;\r\n\r\nexport class DbContext {\r\n  constructor() {}\r\n\r\n  Pages = new EntitySet(Page);\r\n\r\n  utilities = {\r\n    copyFileAsync,\r\n  };\r\n  virtualSets = new Map();\r\n\r\n  Set = (entityType) => {\r\n    const key = entityType.ListDef.name;\r\n\r\n    // If we have a defined entityset, return that\r\n    const set = Object.values(this)\r\n      .filter((val) => val.constructor.name == EntitySet.name)\r\n      .find((set) => set.ListDef?.name == key);\r\n    if (set) return set;\r\n\r\n    if (!this.virtualSets.has(key)) {\r\n      const newSet = new EntitySet(listDef);\r\n      this.virtualSets.set(key, newSet);\r\n      return newSet;\r\n    }\r\n    return this.virtualSets.get(key);\r\n  };\r\n}\r\n\r\nexport class CachedEntitySet {\r\n  constructor(entityType) {\r\n    this.entitySet = new EntitySet(entityType);\r\n\r\n    this.AllDeclaredFields = this.entitySet.AllDeclaredFields;\r\n  }\r\n  _cache = ko.observable({});\r\n\r\n  FindById = async (id, fields = this.AllDeclaredFields) => {};\r\n}\r\n\r\nexport class EntitySet {\r\n  constructor(entityType) {\r\n    if (!entityType.ListDef) {\r\n      console.error(\"Missing entityType listdef for\", entityType);\r\n      return;\r\n    }\r\n\r\n    // Check if the object we passed in defines a ListDef\r\n    this.entityType = entityType;\r\n\r\n    try {\r\n      const allFieldsSet = new Set();\r\n      entityType.Views?.All?.map((field) => allFieldsSet.add(field));\r\n\r\n      // TODO: this is bombing due to circular dependencies,\r\n      // all fields need to be in View\r\n      // const newEntity = new this.entityType({ ID: null, Title: null });\r\n      // if (newEntity.FieldMap) {\r\n      //   Object.keys(newEntity.FieldMap).map((field) => allFieldsSet.add(field));\r\n      // }\r\n      // const fieldMapKeysSet = new Set(...);\r\n      // entityType.Views.All.map((field) => fieldMapKeysSet.add(field));\r\n      this.AllDeclaredFields = [...allFieldsSet];\r\n    } catch (e) {\r\n      console.warn(\"Could not instantiate\", entityType), console.warn(e);\r\n      this.AllDeclaredFields = entityType.Views?.All ?? [];\r\n    }\r\n\r\n    this.ListDef = entityType.ListDef;\r\n    this.Views = entityType.Views;\r\n    this.Title = entityType.ListDef.title;\r\n    this.Name = entityType.ListDef.name;\r\n\r\n    this.ListRef = new SPList(entityType.ListDef);\r\n\r\n    this.entityConstructor =\r\n      this.entityType.FindInStore || this.entityType.Create || this.entityType;\r\n  }\r\n\r\n  // Queries\r\n  FindById = async (id, fields = this.AllDeclaredFields) => {\r\n    // Hit our cache first\r\n\r\n    const result = await this.ListRef.getById(id, fields);\r\n    if (!result) return null;\r\n    const newEntity = new this.entityType(result);\r\n    mapObjectToEntity(result, newEntity);\r\n    return newEntity;\r\n  };\r\n\r\n  // TODO: Feature - Queries should return options to read e.g. toList, first, toCursor\r\n  /**\r\n   * Takes an array of columns and filter values with an optional comparison operator\r\n   * @param {[{column, op?, value}]} columnFilters\r\n   * @param {*} param1\r\n   * @param {*} param2\r\n   * @param {*} fields\r\n   * @param {*} includeFolders\r\n   * @returns\r\n   */\r\n  FindByColumnValue = async (\r\n    columnFilters,\r\n    { orderByColumn, sortAsc },\r\n    { count = null, includePermissions = false, includeFolders = false },\r\n    fields = this.AllDeclaredFields\r\n  ) => {\r\n    // if we pass in a count, we are expecting a cursor result\r\n    const returnCursor = count != null;\r\n    count = count ?? 5000;\r\n    // else, we should apply a count of 5000 and keep fetching\r\n\r\n    const results = await this.ListRef.findByColumnValueAsync(\r\n      columnFilters,\r\n      { orderByColumn, sortAsc },\r\n      { count, includePermissions, includeFolders },\r\n      fields\r\n    );\r\n\r\n    let cursor = {\r\n      _next: results._next,\r\n      results: results.results.map((item) => {\r\n        const newEntity = new this.entityConstructor(item);\r\n        mapObjectToEntity(item, newEntity);\r\n        return newEntity;\r\n      }),\r\n    };\r\n\r\n    if (returnCursor) {\r\n      return cursor;\r\n    }\r\n\r\n    const resultObj = {\r\n      results: cursor.results,\r\n    };\r\n\r\n    while (cursor._next) {\r\n      cursor = await this.LoadNextPage(cursor);\r\n      resultObj.results = resultObj.results.concat(cursor.results);\r\n    }\r\n\r\n    return resultObj;\r\n  };\r\n\r\n  LoadNextPage = async (cursor) => {\r\n    const results = await this.ListRef.loadNextPage(cursor);\r\n    return {\r\n      _next: results._next,\r\n      results: results.results.map((item) => {\r\n        const newEntity = new this.entityType(item);\r\n        mapObjectToEntity(item, newEntity);\r\n        return newEntity;\r\n      }),\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Return all items in list\r\n   */\r\n  ToList = async (refresh = false) => {\r\n    const fields = this.Views.All;\r\n    const results = await this.ListRef.getListItemsAsync({ fields });\r\n    const allItems = results.map((item) => {\r\n      let entityToLoad = new this.entityType(item);\r\n      mapObjectToEntity(item, entityToLoad);\r\n      return entityToLoad;\r\n    });\r\n    return allItems;\r\n  };\r\n\r\n  LoadEntity = async function (entity, refresh = false) {\r\n    if (!entity.ID) {\r\n      console.error(\"entity missing Id\", entity);\r\n      return false;\r\n    }\r\n\r\n    const result = await this.ListRef.getById(\r\n      entity.ID,\r\n      this.AllDeclaredFields\r\n    );\r\n    if (!result) return null;\r\n\r\n    mapObjectToEntity(result, entity);\r\n    return entity;\r\n  };\r\n\r\n  // Mutators\r\n  AddEntity = async function (entity, folderPath) {\r\n    const creationfunc = mapEntityToObject.bind(this);\r\n    const writeableEntity = creationfunc(entity, this.AllDeclaredFields);\r\n\r\n    if (DEBUG) console.log(writeableEntity);\r\n    const newId = await this.ListRef.createListItemAsync(\r\n      writeableEntity,\r\n      folderPath\r\n    );\r\n    mapObjectToEntity({ ID: newId }, entity);\r\n    return;\r\n  };\r\n\r\n  UpdateEntity = async function (entity, fields = null) {\r\n    const writeableEntity = mapEntityToObject.bind(this)(entity, fields);\r\n    writeableEntity.ID =\r\n      typeof entity.ID == \"function\" ? entity.ID() : entity.ID;\r\n    if (DEBUG) console.log(writeableEntity);\r\n    return this.ListRef.updateListItemAsync(writeableEntity);\r\n  };\r\n\r\n  RemoveEntity = async function (entity) {\r\n    if (!entity.ID) return false;\r\n    await this.ListRef.deleteListItemAsync(entity.ID);\r\n    return true;\r\n  };\r\n\r\n  RemoveEntityById = function (entityId) {\r\n    return this.ListRef.deleteListItemAsync(entityId);\r\n  };\r\n\r\n  // Permissions\r\n  GetItemPermissions = function (entity) {\r\n    return this.ListRef.getItemPermissionsAsync(entity.ID);\r\n  };\r\n\r\n  SetItemPermissions = async function (entity, valuePairs, reset = false) {\r\n    // const salValuePairs = valuePairs\r\n    //   .filter((vp) => vp[0] && vp[1])\r\n    //   .map((vp) => [vp[0].getKey(), vp[1]]);\r\n    return this.ListRef.setItemPermissionsAsync(entity.ID, valuePairs, reset);\r\n  };\r\n\r\n  GetRootPermissions = function () {\r\n    return this.ListRef.getListPermissions();\r\n  };\r\n\r\n  SetRootPermissions = async function (itemPermissions, reset) {\r\n    // const valuePairs = itemPermissions.getValuePairs();\r\n    await this.ListRef.setListPermissionsAsync(itemPermissions, reset);\r\n  };\r\n\r\n  // Folder Methods\r\n  GetFolderUrl = function (relFolderPath = \"\") {\r\n    return this.ListRef.getServerRelativeFolderPath(relFolderPath);\r\n  };\r\n\r\n  GetItemsByFolderPath = async function (\r\n    folderPath,\r\n    fields = this.AllDeclaredFields\r\n  ) {\r\n    //return this.ListRef.getFolderContentsAsync(folderPath, fields);\r\n    const results = await this.ListRef.getFolderContentsAsync(\r\n      folderPath,\r\n      fields\r\n    );\r\n    return results.map((result) => {\r\n      const newEntity = new this.entityType(result);\r\n      mapObjectToEntity(result, newEntity);\r\n      return newEntity;\r\n    });\r\n  };\r\n\r\n  UpsertFolderPath = async function (folderPath) {\r\n    return this.ListRef.upsertFolderPathAsync(folderPath);\r\n  };\r\n\r\n  RemoveFolderByPath = async function (folderPath) {\r\n    const itemResults = await this.FindByColumnValue(\r\n      [{ column: \"FileLeafRef\", value: folderPath }],\r\n      {},\r\n      {},\r\n      [\"ID\", \"Title\", \"FileLeafRef\"],\r\n      true\r\n    );\r\n    const entities = itemResults.results ?? [];\r\n    for (const entity of entities) {\r\n      await this.RemoveEntityById(entity.ID);\r\n    }\r\n  };\r\n\r\n  // Permissions\r\n  SetFolderReadOnly = async function (relFolderPath) {\r\n    return this.ListRef.setFolderReadonlyAsync(relFolderPath);\r\n  };\r\n\r\n  SetFolderPermissions = async function (folderPath, valuePairs, reset = true) {\r\n    const salValuePairs = valuePairs\r\n      .filter((vp) => vp[0] && vp[1])\r\n      .map((vp) => [vp[0].getKey(), vp[1]]);\r\n    return this.ListRef.setFolderPermissionsAsync(\r\n      folderPath,\r\n      salValuePairs,\r\n      reset\r\n    );\r\n  };\r\n\r\n  EnsureFolderPermissions = async function (relFolderPath, valuePairs) {\r\n    // Slightly more expensive operation to verify a user has the required permissions\r\n    // before adding them. This will cut down on the number of unique permissions in the\r\n    // system since a user may already have the permission via group membership.\r\n    const salValuePairs = valuePairs\r\n      .filter((vp) => vp[0] && vp[1])\r\n      .map((vp) => [vp[0].LoginName ?? vp[0].Title, vp[1]]);\r\n    return this.ListRef.ensureFolderPermissionsAsync(\r\n      relFolderPath,\r\n      salValuePairs\r\n    );\r\n  };\r\n\r\n  // Other Functions\r\n  // Upload file directly from browser \"File\" object e.g. from input field\r\n  UploadFileToFolderAndUpdateMetadata = async function (\r\n    file,\r\n    filename,\r\n    folderPath,\r\n    updates,\r\n    progress\r\n  ) {\r\n    const itemId = await this.ListRef.uploadFileToFolderAndUpdateMetadata(\r\n      file,\r\n      filename,\r\n      folderPath,\r\n      updates,\r\n      progress\r\n    );\r\n    const item = await this.ListRef.getById(itemId, this.AllDeclaredFields);\r\n    const newEntity = new this.entityConstructor(item);\r\n    mapObjectToEntity(item, newEntity);\r\n    return newEntity;\r\n  };\r\n\r\n  // Open file upload Modal\r\n  UploadNewDocument = async function (folderPath, args) {\r\n    return this.ListRef.uploadNewDocumentAsync(\r\n      folderPath,\r\n      \"Attach a New Document\",\r\n      args\r\n    );\r\n  };\r\n\r\n  CopyFolderContents = async function (sourceFolder, targetFolder) {\r\n    return this.ListRef.copyFilesAsync(sourceFolder, targetFolder);\r\n  };\r\n\r\n  // Form Methods\r\n  ShowForm = async function (name, title, args) {\r\n    return new Promise((resolve, reject) =>\r\n      this.ListRef.showModal(name, title, args, resolve)\r\n    );\r\n  };\r\n\r\n  CheckInDocument = async function (fileRef) {\r\n    return new Promise((resolve) =>\r\n      this.ListRef.showCheckinModal(fileRef, resolve)\r\n    );\r\n  };\r\n\r\n  EnsureList = async function () {};\r\n}\r\n\r\nfunction mapObjectToEntity(inputObject, targetEntity) {\r\n  if (DEBUG)\r\n    console.log(\r\n      `ApplicationDBContext: ${targetEntity.constructor.name}: `,\r\n      inputObject\r\n    );\r\n  if (!inputObject || !targetEntity) return;\r\n  // Takes an object and attempts to map it to the target entity\r\n  Object.keys(inputObject).forEach((key) => {\r\n    mapValueToEntityProperty(key, inputObject[key], targetEntity);\r\n  });\r\n}\r\n\r\nfunction mapValueToEntityProperty(propertyName, inputValue, targetEntity) {\r\n  if (DEBUG)\r\n    console.log(\r\n      `ApplicationDBContext: ${targetEntity.constructor.name}.${propertyName} to ${inputValue}`\r\n    );\r\n  //1. Check if the targetEntity has a fieldmapping for this property\r\n  if (targetEntity.FieldMap && targetEntity.FieldMap[propertyName]) {\r\n    mapObjectToViewField(inputValue, targetEntity.FieldMap[propertyName]);\r\n    return;\r\n  }\r\n  // 2. This is just a regular property, set it\r\n  if (\r\n    targetEntity[propertyName] &&\r\n    typeof targetEntity[propertyName] == \"function\"\r\n  ) {\r\n    targetEntity[propertyName](inputValue);\r\n    return;\r\n  }\r\n  targetEntity[propertyName] = inputValue;\r\n  return;\r\n}\r\n\r\nfunction mapObjectToViewField(inVal, fieldMapping) {\r\n  // Fieldmap has Three options for setting,\r\n  // 1. observable - the fieldmap represents an observable\r\n  // 2. setter - the fieldmap exposes a setter\r\n  // 3. factory/obs - the fieldmap exposes a factory and an observable to put the result.\r\n\r\n  if (typeof fieldMapping == \"function\") {\r\n    fieldMapping(inVal);\r\n    return;\r\n  }\r\n\r\n  if (typeof fieldMapping != \"object\") {\r\n    fieldMapping = inVal;\r\n    return;\r\n  }\r\n\r\n  if (fieldMapping.set && typeof fieldMapping.set == \"function\") {\r\n    fieldMapping.set(inVal);\r\n    return;\r\n  }\r\n\r\n  if (fieldMapping.obs) {\r\n    if (!inVal) {\r\n      fieldMapping.obs(null);\r\n      return;\r\n    }\r\n    // If the input value is an array, then we are putting an array into the observable.\r\n    const outVal = Array.isArray(inVal)\r\n      ? inVal.map((item) => generateObject(item, fieldMapping))\r\n      : generateObject(inVal, fieldMapping);\r\n\r\n    fieldMapping.obs(outVal);\r\n    return;\r\n  }\r\n\r\n  fieldMapping = inVal;\r\n  //throw \"Error setting fieldmap?\";\r\n}\r\n\r\nfunction generateObject(inVal, fieldMap) {\r\n  // If the fieldMap provides a factory, use that, otherwise return the value\r\n  return fieldMap.factory ? fieldMap.factory(inVal) : inVal;\r\n}\r\n\r\nexport function mapEntityToObject(input, selectedFields = null) {\r\n  const entity = {};\r\n  // We either predefine the fields in the ListDef, or provide a complete fieldmap\r\n  const allWriteableFieldsSet = new Set([]);\r\n  if (this?.ListDef?.fields) {\r\n    this.ListDef.fields.forEach((field) => allWriteableFieldsSet.add(field));\r\n  }\r\n  if (this?.AllDeclaredFields) {\r\n    this.AllDeclaredFields.map((field) => allWriteableFieldsSet.add(field));\r\n  }\r\n  if (input.FieldMap) {\r\n    Object.keys(input.FieldMap).forEach((field) =>\r\n      allWriteableFieldsSet.add(field)\r\n    );\r\n  }\r\n  const allWriteableFields = [...allWriteableFieldsSet];\r\n\r\n  const fields =\r\n    selectedFields ??\r\n    (input.FieldMap ? Object.keys(input.FieldMap) : null) ??\r\n    Object.keys(input);\r\n\r\n  fields\r\n    .filter((field) => allWriteableFields.includes(field))\r\n    .map((field) => {\r\n      if (input.FieldMap && input.FieldMap[field]) {\r\n        const storedFieldKey = input.FieldMap[field].systemName ?? field;\r\n        entity[storedFieldKey] = mapViewFieldToValue(input.FieldMap[field]);\r\n        return;\r\n      }\r\n      entity[field] = input[field];\r\n    });\r\n\r\n  return entity;\r\n}\r\n\r\nfunction mapViewFieldToValue(fieldMap) {\r\n  // Fieldmap has Three options for getting,\r\n  // 1. observable - the fieldmap represents an observable or other function that returns a value\r\n  // 2. get - the fieldmap is an object that exposes a getter function\r\n  // 3. factory/obs - the fieldmap is an object exposes a factory and an observable.\r\n  if (typeof fieldMap == \"function\") {\r\n    return fieldMap();\r\n  }\r\n  if (fieldMap.get && typeof fieldMap.get == \"function\") {\r\n    return fieldMap.get();\r\n  }\r\n\r\n  if (fieldMap.obs) {\r\n    return fieldMap.obs();\r\n  }\r\n\r\n  return fieldMap;\r\n\r\n  // console.error(\"Error setting fieldMap\", fieldMap);\r\n  // throw \"Error getting fieldmap\";\r\n}\r\n", "export { EntitySet, CachedEntitySet, DbContext } from \"./orm.js\";\r\n", "import {\r\n  AuditOrganization,\r\n  AuditRequest,\r\n  AuditBulkRequest,\r\n  AuditEmail,\r\n  AuditRequestsInternal,\r\n  AuditResponse,\r\n  AuditBulkResponse,\r\n  AuditResponseDoc,\r\n  AuditCoversheet,\r\n  AuditConfiguration,\r\n  AuditResponseDocRO,\r\n  AuditROEmailLog,\r\n} from \"../entities/index.js\";\r\nimport { EntitySet, DbContext } from \"../sal/index.js\";\r\n\r\nconst DEBUG = false;\r\n\r\nexport class ApplicationDbContext extends DbContext {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  AuditBulkRequests = new EntitySet(AuditBulkRequest);\r\n\r\n  AuditBulkResponses = new EntitySet(AuditBulkResponse);\r\n\r\n  AuditConfigurations = new EntitySet(AuditConfiguration);\r\n\r\n  AuditCoversheets = new EntitySet(AuditCoversheet);\r\n\r\n  AuditEmails = new EntitySet(AuditEmail);\r\n\r\n  AuditOrganizations = new EntitySet(AuditOrganization);\r\n\r\n  AuditResponses = new EntitySet(AuditResponse);\r\n\r\n  AuditResponseDocs = new EntitySet(AuditResponseDoc);\r\n\r\n  AuditResponseDocsRO = new EntitySet(AuditResponseDocRO);\r\n\r\n  AuditRequests = new EntitySet(AuditRequest);\r\n\r\n  AuditRequestsInternals = new EntitySet(AuditRequestsInternal);\r\n\r\n  AuditROEmailsLog = new EntitySet(AuditROEmailLog);\r\n}\r\n\r\nexport const appContext = new ApplicationDbContext();\r\n", "\uFEFFwindow.Audit = window.Audit || {};\r\nAudit.Common = Audit.Common || {};\r\n\r\nfunction InitReport() {\r\n  Audit.Common.Utilities = new Audit.Common.NewUtilities();\r\n  Audit.Common.Init();\r\n}\r\n\r\nAudit.Common.Init = function () {};\r\n\r\nAudit.Common.NewUtilities = function () {\r\n  var m_siteUrl = _spPageContextInfo.webServerRelativeUrl; //IE11 in sp 2013 does not recognize L_Menu_BaseUrl\r\n\r\n  var m_listTitleRequests = \"AuditRequests\";\r\n  var m_listNameRequests = \"AuditRequests\";\r\n\r\n  var m_listTitleRequestsInternal = \"AuditRequestsInternal\";\r\n  var m_listNameRequestsInternal = \"AuditRequestsInternal\";\r\n\r\n  var m_listTitleResponses = \"AuditResponses\";\r\n  var m_listNameResponses = \"AuditResponses\";\r\n\r\n  var m_libTitleRequestDocs = \"AuditRequestDocs\";\r\n  var m_libNameRequestDocs = \"AuditRequestDocs\";\r\n\r\n  var m_libTitleCoverSheet = \"AuditCoverSheets\";\r\n  var m_libNameCoverSheet = \"AuditCoverSheets\";\r\n\r\n  var m_libTitleResponseDocs = \"AuditResponseDocs\";\r\n  var m_libNameResponseDocs = \"AuditResponseDocs\";\r\n\r\n  var m_libTitleResponseDocsEA = \"AuditResponseDocsEA\";\r\n  var m_libNameResponseDocsEA = \"AuditResponseDocsEA\";\r\n\r\n  var m_listTitleActionOffices = \"AuditOrganizations\";\r\n  var m_listNameActionOffices = \"AuditOrganizations\";\r\n\r\n  var m_listTitleEmailHistory = \"AuditEmails\";\r\n  var m_listNameEmailHistory = \"AuditEmails\";\r\n\r\n  var m_listTitleBulkResponses = \"AuditBulkResponses\";\r\n  var m_listNameBulkResponses = \"AuditBulkResponses\";\r\n\r\n  var m_listTitleBulkPermissions = \"AuditBulkPermissions\";\r\n  var m_listNameBulkPermissions = \"AuditBulkPermissions\";\r\n\r\n  var m_groupNameSpecialPermName1 = \"CGFS Special Access1\";\r\n  var m_groupNameSpecialPermName2 = \"CGFS Special Access2\";\r\n  var m_groupNameQA = \"Quality Assurance\";\r\n  var m_groupNameEA = \"External Auditors\";\r\n\r\n  var m_libResponseDocsLibraryGUID = null;\r\n\r\n  var m_arrSiteGroups = null;\r\n  var m_arrAOs = null;\r\n  /**\r\n   * Reloads the page, trys to preserve current path\r\n   * @param {bool} hard flag to remove all url params\r\n   * @returns\r\n   */\r\n  function m_fnRefresh(hard = false) {\r\n    if (hard) {\r\n      location.href = location.pathname;\r\n      return;\r\n    }\r\n    var curPath = location.pathname;\r\n\r\n    if ($(\"#tabs\").html() != null && $(\"#tabs\").html() != \"\") {\r\n      var tabIndex = 0;\r\n      try {\r\n        tabIndex = $(\"#tabs\").tabs(\"option\", \"active\");\r\n      } catch (ex) {}\r\n\r\n      curPath += \"?Tab=\" + tabIndex;\r\n\r\n      if (tabIndex == 0 && $(\"#ddlResponseName\").val() != \"\") {\r\n        curPath += \"&ResNum=\" + $(\"#ddlResponseName\").val();\r\n      } else if (tabIndex == 1) {\r\n        var responseNumOpen = $(\"#ddlResponsesOpen\").val();\r\n        var responseNumProcessed = $(\"#ddlResponsesProcessed\").val();\r\n\r\n        if (responseNumOpen != null && responseNumOpen != \"\")\r\n          curPath += \"&ResNum=\" + responseNumOpen;\r\n        else if (responseNumProcessed != null && responseNumProcessed != \"\")\r\n          curPath += \"&ResNum=\" + responseNumProcessed;\r\n      }\r\n\r\n      location.href = curPath;\r\n    } else {\r\n      location.reload();\r\n    }\r\n  }\r\n\r\n  function m_fnOnLoadDisplayTimeStamp() {\r\n    var curDate = new Date();\r\n    $(\"#divLoading\").text(\"Loaded at \" + curDate.format(\"MM/dd/yyyy hh:mm tt\"));\r\n  }\r\n\r\n  function m_fnOnLoadDisplayTabAndResponse() {\r\n    var paramTabIndex = GetUrlKeyValue(\"Tab\");\r\n    if (paramTabIndex != null && paramTabIndex != \"\") {\r\n      $(\"#tabs\").tabs(\"option\", \"active\", paramTabIndex);\r\n    }\r\n\r\n    var bFiltered = false;\r\n\r\n    var paramResponseNum = GetUrlKeyValue(\"ResNum\");\r\n    if (paramResponseNum != null && paramResponseNum != \"\") {\r\n      if (paramTabIndex == 0) {\r\n        if (\r\n          $(\"#ddlResponseName option[value='\" + paramResponseNum + \"']\")\r\n            .length > 0\r\n        ) {\r\n          $(\"#ddlResponseName\").val(paramResponseNum).change();\r\n          bFiltered = true;\r\n        }\r\n      } else {\r\n        if (\r\n          $(\"#ddlResponsesOpen option[value='\" + paramResponseNum + \"']\")\r\n            .length > 0\r\n        ) {\r\n          $(\"#ddlResponsesOpen\").val(paramResponseNum).change();\r\n        } else if (\r\n          $(\"#ddlResponsesProcessed option[value='\" + paramResponseNum + \"']\")\r\n            .length > 0\r\n        ) {\r\n          $(\"#ddlResponsesProcessed\").val(paramResponseNum).change();\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!bFiltered) {\r\n      $(\".sr-response-item\").show(); //hiding rows by default\r\n    }\r\n  }\r\n\r\n  function m_fnOnLoadFilterResponses(responseStatus1, responseStatus2) {\r\n    var count = 0;\r\n    var cntOpen = 0;\r\n    var cntReOpened = 0;\r\n    var resStatus1 = 0;\r\n    var resStatus2 = 0;\r\n\r\n    var eacher = $(\".sr-response-item\");\r\n\r\n    eacher.each(function () {\r\n      var reqStatus = $.trim($(this).find(\".sr-response-requestStatus\").text());\r\n      var resStatus = $.trim($(this).find(\".sr-response-status\").text());\r\n\r\n      if (\r\n        (resStatus == responseStatus1 || resStatus == responseStatus2) &&\r\n        (reqStatus == \"Open\" || reqStatus == \"ReOpened\")\r\n      ) {\r\n        $(this).addClass(\"highlighted\");\r\n        count++;\r\n\r\n        if (resStatus == responseStatus1) resStatus1++;\r\n        else if (resStatus == responseStatus2) resStatus2++;\r\n\r\n        if (reqStatus == \"Open\") cntOpen++;\r\n        else if (reqStatus == \"ReOpened\") cntReOpened++;\r\n      }\r\n    });\r\n\r\n    if (count > 0) {\r\n      $(\"#lblStatusReportResponsesMsg\").html(\r\n        \"<span class='ui-icon ui-icon-alert'></span>There are \" +\r\n          count +\r\n          \" Responses pending your review\"\r\n      );\r\n\r\n      if (resStatus1 > 0 && resStatus2 == 0)\r\n        $(\"#ddlResponseStatus\").val(responseStatus1).change();\r\n      else if (resStatus2 > 0 && resStatus1 == 0)\r\n        $(\"#ddlResponseStatus\").val(responseStatus2).change();\r\n    } else\r\n      $(\"#lblStatusReportResponsesMsg\").html(\r\n        \"<span class='ui-icon ui-icon-circle-check'></span>There are 0 Responses pending your review\"\r\n      );\r\n  }\r\n\r\n  function m_fnLoadSiteGroups(itemColl) {\r\n    m_arrSiteGroups = new Array();\r\n\r\n    var listItemEnumerator = itemColl.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var id = oListItem.get_id();\r\n      var loginName = oListItem.get_loginName();\r\n      var title = oListItem.get_title();\r\n\r\n      var groupObject = new Object();\r\n      groupObject[\"ID\"] = id;\r\n      groupObject[\"loginName\"] = loginName;\r\n      groupObject[\"title\"] = title;\r\n      groupObject[\"group\"] = oListItem;\r\n\r\n      m_arrSiteGroups.push(groupObject);\r\n    }\r\n  }\r\n\r\n  function m_fnGetSPSiteGroup(groupName) {\r\n    var userGroup = null;\r\n    if (m_arrSiteGroups != null) {\r\n      for (var x = 0; x < m_arrSiteGroups.length; x++) {\r\n        if (m_arrSiteGroups[x].title == groupName) {\r\n          userGroup = m_arrSiteGroups[x].group;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return userGroup;\r\n  }\r\n\r\n  function m_fnLoadActionOffices(itemColl) {\r\n    m_arrAOs = new Array();\r\n\r\n    var listItemEnumerator = itemColl.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var id = oListItem.get_item(\"ID\");\r\n      var title = oListItem.get_item(\"Title\");\r\n      var userGroup = oListItem.get_item(\"UserGroup\");\r\n      if (userGroup != null) {\r\n        userGroup = userGroup.get_lookupValue();\r\n      } else userGroup = \"\";\r\n\r\n      var aoObject = new Object();\r\n      aoObject[\"ID\"] = id;\r\n      aoObject[\"title\"] = title;\r\n      aoObject[\"userGroup\"] = userGroup;\r\n\r\n      m_arrAOs.push(aoObject);\r\n    }\r\n  }\r\n\r\n  function m_fnGetAOSPGroupName(groupName) {\r\n    //finds the group name corresponding to the lookup field selected\r\n    var userGroup = null;\r\n    if (m_arrAOs != null) {\r\n      for (var x = 0; x < m_arrAOs.length; x++) {\r\n        var oGroup = m_arrAOs[x];\r\n        if (oGroup.title == groupName) {\r\n          userGroup = oGroup.userGroup;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return userGroup;\r\n  }\r\n\r\n  function m_fnCheckSPItemHasGroupPermission(item, groupName, permissionLevel) {\r\n    if (\r\n      item == null ||\r\n      groupName == \"\" ||\r\n      groupName == null ||\r\n      permissionLevel == null\r\n    )\r\n      return false;\r\n\r\n    var match = false;\r\n    var roleAssignments = item.get_roleAssignments();\r\n    if (roleAssignments == null) {\r\n      alert(\"Error retrieving role assignments\");\r\n      return false;\r\n    }\r\n\r\n    var rolesEnumerator = roleAssignments.getEnumerator();\r\n    while (rolesEnumerator.moveNext()) {\r\n      var role = rolesEnumerator.get_current();\r\n      if (role != null) {\r\n        var roleMember = role.get_member();\r\n        if (roleMember.isPropertyAvailable(\"Title\")) {\r\n          var memberTitleName = roleMember.get_title();\r\n\r\n          var roleDefs = role.get_roleDefinitionBindings();\r\n          if (roleDefs != null) {\r\n            var roleDefsEnumerator = roleDefs.getEnumerator();\r\n            while (roleDefsEnumerator.moveNext()) {\r\n              var rd = roleDefsEnumerator.get_current();\r\n              var rdName = rd.get_name();\r\n\r\n              if (\r\n                memberTitleName == groupName &&\r\n                rd.get_basePermissions().has(permissionLevel)\r\n              ) {\r\n                match = true;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return match;\r\n  }\r\n\r\n  function m_fnGoToResponse(responseTitle, isIA) {\r\n    if (!isIA) {\r\n      var bFound = false;\r\n      $(\"#ddlResponsesOpen > option\").each(function () {\r\n        if ($(this).text() == responseTitle) {\r\n          bFound = true;\r\n          notifyId = SP.UI.Notify.addNotification(\r\n            \"Displaying Response (\" + responseTitle + \")\",\r\n            false\r\n          );\r\n          $(\"#ddlResponsesOpen\").val(responseTitle).change();\r\n\r\n          return false;\r\n        }\r\n      });\r\n      if (!bFound) {\r\n        $(\"#ddlResponsesProcessed > option\").each(function () {\r\n          if ($(this).text() == responseTitle) {\r\n            bFound = true;\r\n            notifyId = SP.UI.Notify.addNotification(\r\n              \"Displaying Response (\" + responseTitle + \")\",\r\n              false\r\n            );\r\n            $(\"#ddlResponsesProcessed\").val(responseTitle).change();\r\n\r\n            return false;\r\n          }\r\n        });\r\n      }\r\n\r\n      $(\"#tabs\").tabs({ active: 1 });\r\n    }\r\n  }\r\n\r\n  function m_fnGetResponseDocStyleTag2(documentStatus) {\r\n    var styleTag = {};\r\n    if (documentStatus == \"Archived\")\r\n      styleTag = { \"background-color\": \"Gainsboro\" };\r\n    else if (documentStatus == \"Approved\")\r\n      styleTag = { \"background-color\": \"PaleGreen\" };\r\n    else if (documentStatus == \"Rejected\")\r\n      styleTag = { \"background-color\": \"LightSalmon\" };\r\n    else if (documentStatus == \"Sent to QA\")\r\n      styleTag = { \"background-color\": \"LightCyan\" };\r\n    else if (documentStatus == \"Submitted\")\r\n      styleTag = { \"background-color\": \"LemonChiffon\" };\r\n    else if (documentStatus == \"Marked for Deletion\")\r\n      styleTag = {\r\n        \"background-color\": \"Gainsboro\",\r\n        \"font-style\": \"italic\",\r\n      };\r\n    return styleTag;\r\n    //\t\t\tstyleTag = \" style='background-color:Gainsboro; font-style:italic' title='Marked for Deletion by the Action Office' \";\r\n  }\r\n\r\n  function m_fnGetResponseDocStyleTag(documentStatus) {\r\n    var styleTag = \"\";\r\n\r\n    if (documentStatus == \"Archived\")\r\n      styleTag = \" style='background-color:Gainsboro;' \";\r\n    else if (documentStatus == \"Approved\")\r\n      styleTag = \" style='background-color:PaleGreen;' \";\r\n    else if (documentStatus == \"Rejected\")\r\n      styleTag = \" style='background-color:LightSalmon;' \";\r\n    else if (documentStatus == \"Sent to QA\")\r\n      styleTag = \" style='background-color:LightCyan;' \";\r\n    else if (documentStatus == \"Submitted\")\r\n      styleTag = \" style='background-color:LemonChiffon;' \";\r\n    else if (documentStatus == \"Marked for Deletion\")\r\n      styleTag =\r\n        \" style='background-color:Gainsboro; font-style:italic' title='Marked for Deletion by the Action Office' \";\r\n\r\n    return styleTag;\r\n  }\r\n\r\n  function m_fnCheckIfEmailFolderExists(items, requestNumber) {\r\n    //Check if folder exists in email library\r\n    var bFolderExists = false;\r\n    var listItemEnumerator = items.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var folderItem = listItemEnumerator.get_current();\r\n      var itemName = folderItem.get_displayName();\r\n      if (itemName == requestNumber) {\r\n        var bFolderExists = true;\r\n        break;\r\n      }\r\n    }\r\n    return bFolderExists;\r\n  }\r\n\r\n  var m_cntAddToEmailFolder = 0;\r\n  var m_cntAddedToEmailFolder = 0;\r\n\r\n  function m_fnCreateEmailFolder(list, requestNumber, requestItem, OnComplete) {\r\n    m_cntAddToEmailFolder = 0;\r\n    m_cntAddedToEmailFolder = 0;\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var itemCreateInfo = new SP.ListItemCreationInformation();\r\n    itemCreateInfo.set_underlyingObjectType(SP.FileSystemObjectType.folder);\r\n    itemCreateInfo.set_leafName(requestNumber);\r\n    oNewEmailFolder = list.addItem(itemCreateInfo);\r\n    oNewEmailFolder.set_item(\"Title\", requestNumber);\r\n    oNewEmailFolder.update();\r\n\r\n    this.currentUser = web.get_currentUser();\r\n    this.ownerGroup = web.get_associatedOwnerGroup();\r\n    this.memberGroup = web.get_associatedMemberGroup();\r\n    this.visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n    oNewEmailFolder.resetRoleInheritance();\r\n    oNewEmailFolder.breakRoleInheritance(false, false);\r\n\r\n    var roleDefBindingCollAdmin =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollAdmin.add(\r\n      web.get_roleDefinitions().getByType(SP.RoleType.administrator)\r\n    );\r\n\r\n    var roleDefBindingCollContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollContribute.add(\r\n      web.get_roleDefinitions().getByType(SP.RoleType.contributor)\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedRead =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedRead.add(\r\n      web.get_roleDefinitions().getByName(\"Restricted Read\")\r\n    );\r\n\r\n    var roleDefBindingCollRestrictedContribute =\r\n      SP.RoleDefinitionBindingCollection.newObject(currCtx);\r\n    roleDefBindingCollRestrictedContribute.add(\r\n      web.get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n    );\r\n\r\n    //add associated site groups\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(ownerGroup, roleDefBindingCollAdmin);\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(memberGroup, roleDefBindingCollContribute);\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .add(visitorGroup, roleDefBindingCollRestrictedRead);\r\n\r\n    var spGroupQA = Audit.Common.Utilities.GetSPSiteGroup(\r\n      Audit.Common.Utilities.GetGroupNameQA()\r\n    );\r\n    if (spGroupQA != null)\r\n      oNewEmailFolder\r\n        .get_roleAssignments()\r\n        .add(spGroupQA, roleDefBindingCollRestrictedContribute);\r\n\r\n    oNewEmailFolder\r\n      .get_roleAssignments()\r\n      .getByPrincipal(currentUser)\r\n      .deleteObject();\r\n\r\n    //Need to break up adding AOs because it exceeds the resource limit (request uses too many resources)\r\n    function onUpdatePermsSucceeded() {\r\n      if (this.requestItem) {\r\n        //this will be null when sending from permissions page\r\n        //add action offices\r\n        var arrActionOffice = this.requestItem.get_item(\"ActionOffice\");\r\n        if (arrActionOffice == null || arrActionOffice.length == 0) {\r\n          if (this.OnComplete) this.OnComplete(true);\r\n          return;\r\n        }\r\n\r\n        for (var x = 0; x < arrActionOffice.length; x++) {\r\n          var actionOfficeName = arrActionOffice[x].get_lookupValue();\r\n\r\n          var actionOfficeGroupName =\r\n            Audit.Common.Utilities.GetAOSPGroupName(actionOfficeName);\r\n          var actionOfficeGroup = Audit.Common.Utilities.GetSPSiteGroup(\r\n            actionOfficeGroupName\r\n          );\r\n\r\n          if (actionOfficeGroup != null) {\r\n            m_cntAddToEmailFolder++;\r\n\r\n            var currCtx2 = new SP.ClientContext.get_current();\r\n            var web2 = currCtx2.get_web();\r\n\r\n            var roleDefBindingCollRestrictedContribute =\r\n              SP.RoleDefinitionBindingCollection.newObject(currCtx2);\r\n            roleDefBindingCollRestrictedContribute.add(\r\n              web2.get_roleDefinitions().getByName(\"Restricted Contribute\")\r\n            );\r\n\r\n            this.oNewEmailFolder\r\n              .get_roleAssignments()\r\n              .add(actionOfficeGroup, roleDefBindingCollRestrictedContribute);\r\n\r\n            function onUpdateAOPermsSucceeded() {\r\n              m_cntAddedToEmailFolder++;\r\n              if (m_cntAddedToEmailFolder == m_cntAddToEmailFolder) {\r\n                if (this.OnComplete) this.OnComplete(true);\r\n              }\r\n            }\r\n            function onUpdateAOPermsFailed(sender, args) {\r\n              m_cntAddedToEmailFolder++;\r\n              if (m_cntAddedToEmailFolder == m_cntAddToEmailFolder) {\r\n                if (this.OnComplete) this.OnComplete(true);\r\n              }\r\n            }\r\n            var data = { OnComplete: this.OnComplete };\r\n            currCtx2.executeQueryAsync(\r\n              Function.createDelegate(data, onUpdateAOPermsSucceeded),\r\n              Function.createDelegate(data, onUpdateAOPermsFailed)\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        if (this.OnComplete) this.OnComplete(true);\r\n      }\r\n    }\r\n\r\n    function onUpdatePermsFailed(sender, args) {\r\n      statusId = SP.UI.Status.addStatus(\r\n        \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n      );\r\n    }\r\n\r\n    var data = {\r\n      /*item: oListItem, */ requestItem: requestItem,\r\n      oNewEmailFolder: oNewEmailFolder,\r\n      OnComplete: OnComplete,\r\n    };\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, onUpdatePermsSucceeded),\r\n      Function.createDelegate(data, onUpdatePermsFailed)\r\n    );\r\n  }\r\n\r\n  function m_fnSortResponseTitleNoCase(a, b) {\r\n    var aTitle = a;\r\n    var bTitle = b;\r\n    let newA, newB;\r\n\r\n    if (aTitle == null) aTitle = \"\";\r\n    if (bTitle == null) bTitle = \"\";\r\n\r\n    var aIndex = aTitle.lastIndexOf(\"-\");\r\n    if (aIndex >= 0) {\r\n      var subA = aTitle.substring(0, aIndex + 1);\r\n      var lastA = aTitle.replace(subA, \"\");\r\n      var intA = parseInt(lastA, 10);\r\n      var newIntA = Audit.Common.Utilities.PadDigits(intA, 5);\r\n      newA = subA + newIntA;\r\n    } else newA = aTitle;\r\n\r\n    var bIndex = bTitle.lastIndexOf(\"-\");\r\n    if (bIndex >= 0) {\r\n      var subB = bTitle.substring(0, bIndex + 1);\r\n      var lastB = bTitle.replace(subB, \"\");\r\n      var intB = parseInt(lastB, 10);\r\n      var newIntB = Audit.Common.Utilities.PadDigits(intB, 5);\r\n      newB = subB + newIntB;\r\n    } else newB = bTitle;\r\n\r\n    return newA.toLowerCase().localeCompare(newB.toLowerCase());\r\n  }\r\n\r\n  function m_fnSortResponseObjectNoCase(a, b) {\r\n    var aTitle = a.title;\r\n    var bTitle = b.title;\r\n    var newA;\r\n    var newB;\r\n    if (aTitle == null) aTitle = \"\";\r\n    if (bTitle == null) bTitle = \"\";\r\n\r\n    var aIndex = aTitle.lastIndexOf(\"-\");\r\n    if (aIndex >= 0) {\r\n      var subA = aTitle.substring(0, aIndex + 1);\r\n      var lastA = aTitle.replace(subA, \"\");\r\n      var intA = parseInt(lastA, 10);\r\n      var newIntA = Audit.Common.Utilities.PadDigits(intA, 5);\r\n      newA = subA + newIntA;\r\n    } else newA = aTitle;\r\n\r\n    var bIndex = bTitle.lastIndexOf(\"-\");\r\n    if (bIndex >= 0) {\r\n      var subB = bTitle.substring(0, bIndex + 1);\r\n      var lastB = bTitle.replace(subB, \"\");\r\n      var intB = parseInt(lastB, 10);\r\n      var newIntB = Audit.Common.Utilities.PadDigits(intB, 5);\r\n      newB = subB + newIntB;\r\n    } else newB = bTitle;\r\n\r\n    return newA.toLowerCase().localeCompare(newB.toLowerCase());\r\n  }\r\n\r\n  function m_fnSortNoCase(a, b) {\r\n    return a.toLowerCase().localeCompare(b.toLowerCase());\r\n  }\r\n\r\n  function m_fnSortDate(a, b) {\r\n    if (a == \"\") return -1;\r\n    if (b == \"\") return 1;\r\n    return new Date(a).getTime() - new Date(b).getTime();\r\n  }\r\n\r\n  //Adds the values in the arr array to the drop down with the specified id\r\n  function m_fnAddOptions(arr, ddlID, dateSort, responseSort) {\r\n    if (arr == null) return;\r\n    if (responseSort) arr.sort(m_fnSortResponseTitleNoCase);\r\n    else if (!dateSort) arr.sort(m_fnSortNoCase);\r\n    else arr.sort(m_fnSortDate);\r\n\r\n    var rOptions = new Array(),\r\n      j = -1;\r\n    rOptions[++j] = \"<option value=''>-Select-</option>\";\r\n\r\n    var arrLength = arr.length;\r\n\r\n    /*\tvar fragment = document.createDocumentFragment();\r\n\t\t\tvar choice = document.createElement('option');\r\n\t\t\tchoice.value = \"\";\r\n\t\t\tchoice.innerHTML = \"-Select-\";\r\n\t\t\tfragment.appendChild(choice);\r\n\t\t*/\r\n    for (var x = 0; x < arrLength; x++) {\r\n      var option = $.trim(arr[x]);\r\n\r\n      rOptions[++j] = \"<option value='\" + option + \"'>\" + option + \"</option>\";\r\n\r\n      /*\t\r\n\t\t\tvar choice = document.createElement('option');\r\n\t        choice.value = option;\r\n\t        choice.innerHTML = option;\r\n\t        fragment.appendChild(choice);*/\r\n    }\r\n\r\n    //ddlID = ddlID.replace(\"#\", \"\");\r\n    //document.getElementById(ddlID).innerHTML = rOptions.join('');\r\n\r\n    var thisDDL = $(ddlID);\r\n    thisDDL.empty().append(rOptions.join(\"\"));\r\n    /*var thisDDL = $(ddlID);\r\n\t\tthisDDL.empty().html( fragment );*/\r\n  }\r\n\r\n  function m_fnExistsInArr(arr, val) {\r\n    if (arr == null) return false;\r\n\r\n    var arrLength = arr.length;\r\n    for (var x = 0; x < arrLength; x++) {\r\n      if (arr[x] == val) return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function m_fnGetTrueFalseIcon(val) {\r\n    if (val == true)\r\n      return \"<span class='ui-icon ui-icon-check'>\" + val + \"</span>\";\r\n    else return \"<span class='ui-icon ui-icon-close'>\" + val + \"</span>\";\r\n  }\r\n\r\n  function m_fnGetFriendlyDisplayName(oListItem, fieldName) {\r\n    var user = oListItem.get_item(fieldName);\r\n    if (user == null) return \"\";\r\n    else return user.get_lookupValue();\r\n  }\r\n\r\n  function m_fnPadDigits(n, totalDigits) {\r\n    n = n.toString();\r\n    var pd = \"\";\r\n    if (totalDigits > n.length) {\r\n      for (let i = 0; i < totalDigits - n.length; i++) {\r\n        pd += \"0\";\r\n      }\r\n    }\r\n    return pd + n.toString();\r\n  }\r\n\r\n  function m_fnPreciseRound(num, decimals) {\r\n    var sign = num >= 0 ? 1 : -1;\r\n    return (\r\n      Math.round(num * Math.pow(10, decimals) + sign * 0.001) /\r\n      Math.pow(10, decimals)\r\n    ).toFixed(decimals);\r\n  }\r\n\r\n  function m_fnGetFriendlyFileSize(fileSize) {\r\n    if (fileSize == null || fileSize == \"\") return \"\";\r\n\r\n    if (fileSize > 1048576) {\r\n      fileSize =\r\n        Audit.Common.Utilities.PreciseRound(fileSize / 1048576, 2) + \" MB\";\r\n    } else if (fileSize > 1024) {\r\n      fileSize =\r\n        Audit.Common.Utilities.PreciseRound(fileSize / 1024, 2) + \" KB\";\r\n    } else {\r\n      fileSize += \" B\";\r\n    }\r\n    return fileSize;\r\n  }\r\n\r\n  function m_fnISODateString(d) {\r\n    function pad(n) {\r\n      return n < 10 ? \"0\" + n : n;\r\n    }\r\n\r\n    return (\r\n      d.getUTCFullYear() +\r\n      \"-\" +\r\n      pad(d.getUTCMonth() + 1) +\r\n      \"-\" +\r\n      pad(d.getUTCDate()) +\r\n      \"T\" +\r\n      pad(d.getUTCHours()) +\r\n      \":\" +\r\n      pad(d.getUTCMinutes()) +\r\n      \":\" +\r\n      pad(d.getUTCSeconds()) +\r\n      \"Z\"\r\n    );\r\n  }\r\n\r\n  function m_fnBindHandlerResponseDoc() {\r\n    $(\".requestInfo-response-doc img\").click(function (event) {\r\n      event.preventDefault();\r\n      var curIcon = $(this).attr(\"src\");\r\n      if (curIcon == \"/_layouts/images/minus.gif\")\r\n        $(this).attr(\"src\", \"/_layouts/images/plus.gif\");\r\n      else $(this).attr(\"src\", \"/_layouts/images/minus.gif\");\r\n\r\n      //$(this).nextUntil('tr.Grouping').slideToggle(200);\r\n      $(this)\r\n        .parent()\r\n        .parent()\r\n        .nextUntil(\"tr.requestInfo-response-doc\")\r\n        .each(function () {\r\n          $(this).toggleClass(\"collapsed\");\r\n        });\r\n    });\r\n  }\r\n\r\n  /************\r\n\tNotice - for some reason, when the list item opens in a dialog or not in the dialog, it renders differently causing the values to get back data differently\r\n\t********/\r\n  /*\r\n\tfunction m_fnGetLookupFieldText( fieldName )\r\n\t{\r\n\t\tvar field = $( \"select[title='\" + fieldName  + \"']\" );\r\n\t\t\r\n\t\tif( field == null || field.html() == null ) //more than 20 items in the lookup\r\n\t\t{\r\n\t\t\tfield = $( \"input[title='\" + fieldName  + \"']\" );\r\n\t\t\treturn field.val();\r\n\t\t}\r\n\t\telse return $(\"select[title='\" + fieldName  + \"'] option:selected\").text();\r\n\t}\r\n\r\n\t*/\r\n\r\n  function m_fnGetLookupFormField(fieldTitle) {\r\n    if ($(\"select[title='\" + fieldTitle + \"']\").html() !== null) {\r\n      return $(\"select[title='\" + fieldTitle + \"']\");\r\n    } else {\r\n      return $(\"input[title='\" + fieldTitle + \"']\");\r\n    }\r\n  }\r\n\r\n  function m_fnGetLookupDisplayText(fieldTitle) {\r\n    //Set default value for lookups with less that 20 items\r\n    if ($(\"select[title='\" + fieldTitle + \"']\").html() !== null) {\r\n      return $(\"select[title='\" + fieldTitle + \"'] option:selected\").text();\r\n    } else {\r\n      return $(\"input[title='\" + fieldTitle + \"']\").val();\r\n    }\r\n  }\r\n\r\n  function m_fnSetLookupFromFieldNameByText(fieldName, text) {\r\n    try {\r\n      if (text == undefined) return;\r\n      var theSelect = m_fnGetTagFromIdentifierAndTitle(\"select\", \"\", fieldName);\r\n\r\n      if (theSelect == null) {\r\n        var theInput = m_fnGetTagFromIdentifierAndTitle(\"input\", \"\", fieldName);\r\n        //builtin\r\n        ShowDropdown(theInput.id);\r\n        var opt = document.getElementById(theInput.opt);\r\n        m_fnSetSelectedOptionByText(opt, text);\r\n        //builtin\r\n        OptLoseFocus(opt);\r\n      } else {\r\n        m_fnSetSelectedOptionByText(theSelect, text);\r\n      }\r\n    } catch (ex) {}\r\n  }\r\n\r\n  function m_fnSetSelectedOptionByText(select, text) {\r\n    var opts = select.options;\r\n    var optLength = opts.length;\r\n    if (select == null) return;\r\n\r\n    for (var i = 0; i < optLength; i++) {\r\n      if (opts[i].text == text) {\r\n        select.selectedIndex = i;\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function m_fnGetTagFromIdentifierAndTitle(tagName, identifier, title) {\r\n    var idLength = identifier.length;\r\n    var tags = document.getElementsByTagName(tagName);\r\n    for (var i = 0; i < tags.length; i++) {\r\n      var tagID = tags[i].id;\r\n      if (\r\n        tags[i].title == title &&\r\n        (identifier == \"\" ||\r\n          tagID.indexOf(identifier) == tagID.length - idLength)\r\n      ) {\r\n        return tags[i];\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  function m_fnViewUserManuals(docType) {\r\n    var options = SP.UI.$create_DialogOptions();\r\n    options.title = \"User Manual\";\r\n    options.height = 250;\r\n    //options.dialogReturnValueCallback = OnCallbackForm;\r\n    if (docType != null)\r\n      options.url =\r\n        Audit.Common.Utilities.GetSiteUrl() +\r\n        \"/pages/AuditUserManuals.aspx?FilterField1=DocType&FilterValue1=\" +\r\n        docType;\r\n    else\r\n      options.url =\r\n        Audit.Common.Utilities.GetSiteUrl() + \"/pages/AuditUserManuals.aspx\";\r\n\r\n    SP.UI.ModalDialog.showModalDialog(options);\r\n  }\r\n\r\n  function m_fnPrintPage(pageTitle, divTbl) {\r\n    var curDate = new Date();\r\n    var siteUrl = Audit.Common.Utilities.GetSiteUrl();\r\n    var cssLink1 =\r\n      siteUrl +\r\n      \"/siteassets/css/tablesorter/style.css?v=\" +\r\n      curDate.format(\"MM_dd_yyyy\");\r\n    var cssLink2 =\r\n      siteUrl +\r\n      \"/siteAssets/css/audit_styles.css?v=\" +\r\n      curDate.format(\"MM_dd_yyyy\");\r\n\r\n    var divOutput = $(divTbl).html();\r\n\r\n    //remove hyperlinks pointing to the job codes\r\n    var updatedDivOutput = $(\"<div>\").append(divOutput);\r\n    updatedDivOutput.find(\".sr-response-title a\").each(function () {\r\n      $(this).removeAttr(\"onclick\");\r\n      $(this).removeAttr(\"href\");\r\n    });\r\n\r\n    divOutput = updatedDivOutput.html();\r\n\r\n    var printDateString = curDate.format(\"MM/dd/yyyy hh:mm tt\");\r\n    printDateString =\r\n      \"<div style='padding-bottom:10px;'>\" + printDateString + \"</div>\";\r\n    divOutput = printDateString + divOutput;\r\n\r\n    var cssFile1 = $(\"<div></div>\");\r\n    var cssFile2 = $(\"<div></div>\");\r\n\r\n    var def1 = $.Deferred();\r\n    var def2 = $.Deferred();\r\n\r\n    var cssFileText = \"\";\r\n    cssFile1.load(cssLink1, function () {\r\n      cssFileText += \"<style>\" + cssFile1.html() + \"</style>\";\r\n      def1.resolve();\r\n    });\r\n    cssFile2.load(cssLink2, function () {\r\n      cssFileText += \"<style>\" + cssFile2.html() + \"</style>\";\r\n      def2.resolve();\r\n    });\r\n\r\n    //gets called asynchronously after the css files have been loaded\r\n    $.when(def1, def2).done(function () {\r\n      var html =\r\n        \"<HTML>\\n\" +\r\n        \"<HEAD>\\n\\n\" +\r\n        \"<Title>\" +\r\n        pageTitle +\r\n        \"</Title>\\n\" +\r\n        cssFileText +\r\n        \"\\n\" +\r\n        \"<style>\" +\r\n        \".hideOnPrint, .rowFilters {display:none}\" +\r\n        \"</style>\\n\" +\r\n        \"</HEAD>\\n\" +\r\n        \"<BODY>\\n\" +\r\n        divOutput +\r\n        \"\\n\" +\r\n        \"</BODY>\\n\" +\r\n        \"</HTML>\";\r\n\r\n      var printWP = window.open(\"\", \"printWebPart\");\r\n      printWP.document.open();\r\n      //insert content\r\n      printWP.document.write(html);\r\n\r\n      printWP.document.close();\r\n      //open print dialog\r\n      printWP.print();\r\n    });\r\n  }\r\n\r\n  //make sure iframe with id csvexprframe is added to page up top\r\n  //http://stackoverflow.com/questions/18185660/javascript-jquery-exporting-data-in-csv-not-working-in-ie\r\n  function m_fnExportToCsv(fileName, tableName, removeHeader) {\r\n    var data = m_fnGetCellValues(tableName);\r\n\r\n    if (removeHeader == true) data = data.slice(1);\r\n\r\n    var csv = m_fnConvertToCsv(data);\r\n    //\tconsole.log( csv );\r\n    if (navigator.userAgent.search(\"Trident\") >= 0) {\r\n      window.CsvExpFrame.document.open(\"text/html\", \"replace\");\r\n      //\t\twindow.CsvExpFrame.document.open(\"application/csv\", \"replace\");\r\n      //\t\twindow.CsvExpFrame.document.charset = \"utf-8\";\r\n      //\t\twindow.CsvExpFrame.document.open(\"application/ms-excel\", \"replace\");\r\n      window.CsvExpFrame.document.write(csv);\r\n      window.CsvExpFrame.document.close();\r\n      window.CsvExpFrame.focus();\r\n      window.CsvExpFrame.document.execCommand(\r\n        \"SaveAs\",\r\n        true,\r\n        fileName + \".csv\"\r\n      );\r\n    } else {\r\n      var uri = \"data:text/csv;charset=utf-8,\" + escape(csv);\r\n      var downloadLink = document.createElement(\"a\");\r\n      downloadLink.href = uri;\r\n      downloadLink.download = fileName + \".csv\";\r\n      document.body.appendChild(downloadLink);\r\n      downloadLink.click();\r\n      document.body.removeChild(downloadLink);\r\n    }\r\n  }\r\n\r\n  function m_fnGetCellValues(tableName) {\r\n    var table = document.getElementById(tableName);\r\n\r\n    //remove headers and footers\r\n    if (table.innerHTML.indexOf(\"rowFilters\") >= 0) {\r\n      var deets = $(\"<div>\").append(table.outerHTML);\r\n      deets.find(\".rowFilters\").each(function () {\r\n        $(this).remove();\r\n      });\r\n      table = deets.find(\"table\")[0];\r\n    }\r\n    if (table.innerHTML.indexOf(\"footer\") >= 0) {\r\n      var deets = $(\"<div>\").append(table.outerHTML);\r\n      deets.find(\".footer\").each(function () {\r\n        $(this).remove();\r\n      });\r\n      table = deets.find(\"table\")[0];\r\n    }\r\n\r\n    var tableArray = [];\r\n    for (var r = 0, n = table.rows.length; r < n; r++) {\r\n      tableArray[r] = [];\r\n      for (var c = 0, m = table.rows[r].cells.length; c < m; c++) {\r\n        var text =\r\n          table.rows[r].cells[c].textContent ||\r\n          table.rows[r].cells[c].innerText;\r\n        tableArray[r][c] = text.trim();\r\n      }\r\n    }\r\n    return tableArray;\r\n  }\r\n\r\n  function m_fnConvertToCsv(objArray) {\r\n    var array = typeof objArray != \"object\" ? JSON.parse(objArray) : objArray;\r\n    var str = \"sep=,\\r\\n\";\r\n    var line = \"\";\r\n    var index;\r\n    var value;\r\n    for (var i = 0; i < array.length; i++) {\r\n      line = \"\";\r\n      var array1 = array[i];\r\n      for (index in array1) {\r\n        if (array1.hasOwnProperty(index)) {\r\n          value = array1[index] + \"\";\r\n          line += '\"' + value.replace(/\"/g, '\"\"') + '\",';\r\n        }\r\n      }\r\n      line = line.slice(0, -1);\r\n      str += line + \"\\r\\n\";\r\n    }\r\n    return str;\r\n  }\r\n\r\n  var publicMembers = {\r\n    GetSiteUrl: function () {\r\n      if (m_siteUrl == \"/\") return \"\";\r\n      else return m_siteUrl;\r\n    },\r\n    GetListTitleRequests: function () {\r\n      return m_listTitleRequests;\r\n    },\r\n    GetListNameRequests: function () {\r\n      return m_listNameRequests;\r\n    },\r\n    GetListTitleRequestsInternal: function () {\r\n      return m_listTitleRequestsInternal;\r\n    },\r\n    GetListNameRequestsInternal: function () {\r\n      return m_listNameRequestsInternal;\r\n    },\r\n    GetListTitleResponses: function () {\r\n      return m_listTitleResponses;\r\n    },\r\n    GetListNameResponses: function () {\r\n      return m_listNameResponses;\r\n    },\r\n    GetLibTitleRequestDocs: function () {\r\n      return m_libTitleRequestDocs;\r\n    },\r\n    GetLibNameRequestDocs: function () {\r\n      return m_libNameRequestDocs;\r\n    },\r\n    GetLibTitleCoverSheets: function () {\r\n      return m_libTitleCoverSheet;\r\n    },\r\n    GetLibNameCoverSheets: function () {\r\n      return m_libNameCoverSheet;\r\n    },\r\n    GetLibTitleResponseDocs: function () {\r\n      return m_libTitleResponseDocs;\r\n    },\r\n    GetLibNameResponseDocs: function () {\r\n      return m_libNameResponseDocs;\r\n    },\r\n    GetLibTitleResponseDocsEA: function () {\r\n      return m_libTitleResponseDocsEA;\r\n    },\r\n    GetLibNameResponseDocsEA: function () {\r\n      return m_libNameResponseDocsEA;\r\n    },\r\n    GetListTitleActionOffices: function () {\r\n      return m_listTitleActionOffices;\r\n    },\r\n    GetListNameActionOffices: function () {\r\n      return m_listNameActionOffices;\r\n    },\r\n    GetListTitleEmailHistory: function () {\r\n      return m_listTitleEmailHistory;\r\n    },\r\n    GetListNameEmailHistory: function () {\r\n      return m_listNameEmailHistory;\r\n    },\r\n    GetListTitleBulkResponses: function () {\r\n      return m_listTitleBulkResponses;\r\n    },\r\n    GetListNameBulkResponses: function () {\r\n      return m_listNameBulkResponses;\r\n    },\r\n    GetListTitleBulkPermissions: function () {\r\n      return m_listTitleBulkPermissions;\r\n    },\r\n    GetListNameBulkPermissions: function () {\r\n      return m_listNameBulkPermissions;\r\n    },\r\n    GetGroupNameSpecialPerm1: function () {\r\n      return m_groupNameSpecialPermName1;\r\n    },\r\n    GetGroupNameSpecialPerm2: function () {\r\n      return m_groupNameSpecialPermName2;\r\n    },\r\n    GetGroupNameQA: function () {\r\n      return m_groupNameQA;\r\n    },\r\n    GetGroupNameEA: function () {\r\n      return m_groupNameEA;\r\n    },\r\n    Refresh: m_fnRefresh,\r\n    OnLoadDisplayTimeStamp: m_fnOnLoadDisplayTimeStamp,\r\n    OnLoadDisplayTabAndResponse: m_fnOnLoadDisplayTabAndResponse,\r\n    OnLoadFilterResponses: function (responseStatus1, responseStatus2) {\r\n      m_fnOnLoadFilterResponses(responseStatus1, responseStatus2);\r\n    },\r\n    SetResponseDocLibGUID: function (libGUID) {\r\n      m_libResponseDocsLibraryGUID = libGUID;\r\n    },\r\n    GetResponseDocLibGUID: function () {\r\n      return m_libResponseDocsLibraryGUID;\r\n    },\r\n    LoadSiteGroups: function (itemColl) {\r\n      m_fnLoadSiteGroups(itemColl);\r\n    },\r\n    GetSPSiteGroup: function (groupName) {\r\n      return m_fnGetSPSiteGroup(groupName);\r\n    },\r\n    LoadActionOffices: function (itemColl) {\r\n      m_fnLoadActionOffices(itemColl);\r\n    },\r\n    GetActionOffices: function () {\r\n      return m_arrAOs;\r\n    },\r\n    GetAOSPGroupName: function (groupName) {\r\n      return m_fnGetAOSPGroupName(groupName);\r\n    },\r\n    CheckSPItemHasGroupPermission: function (item, groupName, permissionLevel) {\r\n      return m_fnCheckSPItemHasGroupPermission(\r\n        item,\r\n        groupName,\r\n        permissionLevel\r\n      );\r\n    },\r\n    GoToResponse: function (responseTitle, isIA) {\r\n      m_fnGoToResponse(responseTitle, isIA);\r\n    },\r\n    GetResponseDocStyleTag: function (documentStatus) {\r\n      return m_fnGetResponseDocStyleTag(documentStatus);\r\n    },\r\n    GetResponseDocStyleTag2: function (documentStatus) {\r\n      return m_fnGetResponseDocStyleTag2(documentStatus);\r\n    },\r\n    CheckIfEmailFolderExists: function (items, requestNumber) {\r\n      return m_fnCheckIfEmailFolderExists(items, requestNumber);\r\n    },\r\n    CreateEmailFolder: function (list, requestNumber, requestItem, OnComplete) {\r\n      return m_fnCreateEmailFolder(\r\n        list,\r\n        requestNumber,\r\n        requestItem,\r\n        OnComplete\r\n      );\r\n    },\r\n    AddOptions: function (arr, ddlID, dateSort, responseSort) {\r\n      m_fnAddOptions(arr, ddlID, dateSort, responseSort);\r\n    },\r\n    ExistsInArr: function (arr, val) {\r\n      return m_fnExistsInArr(arr, val);\r\n    },\r\n    GetTrueFalseIcon: function (val) {\r\n      return m_fnGetTrueFalseIcon(val);\r\n    },\r\n    PadDigits: function (n, totalDigits) {\r\n      return m_fnPadDigits(n, totalDigits);\r\n    },\r\n    PreciseRound: function (num, decimals) {\r\n      return m_fnPreciseRound(num, decimals);\r\n    },\r\n    GetFriendlyFileSize: function (fileSize) {\r\n      return m_fnGetFriendlyFileSize(fileSize);\r\n    },\r\n    GetISODateString: function (d) {\r\n      return m_fnISODateString(d);\r\n    },\r\n    GetFriendlyDisplayName: function (oListItem, fieldName) {\r\n      return m_fnGetFriendlyDisplayName(oListItem, fieldName);\r\n    },\r\n    BindHandlerResponseDoc: m_fnBindHandlerResponseDoc,\r\n    PrintStatusReport: function (pageTitle, divTbl) {\r\n      m_fnPrintPage(pageTitle, divTbl);\r\n    },\r\n    ExportToCsv: function (fileName, tableName, removeHeader) {\r\n      m_fnExportToCsv(fileName, tableName, removeHeader);\r\n    },\r\n    ViewUserManuals: function (docType) {\r\n      m_fnViewUserManuals(docType);\r\n    },\r\n    //GetLookupFieldText: function( fieldName ){ return m_fnGetLookupFieldText( fieldName); },\r\n    GetLookupDisplayText: function (fieldName) {\r\n      return m_fnGetLookupDisplayText(fieldName);\r\n    },\r\n    GetLookupFormField: function (fieldName) {\r\n      return m_fnGetLookupFormField(fieldName);\r\n    },\r\n    SetLookupFromFieldNameByText: function (fieldName, text) {\r\n      return m_fnSetLookupFromFieldNameByText(fieldName, text);\r\n    },\r\n    SortResponseObjects: function (a, b) {\r\n      return m_fnSortResponseObjectNoCase(a, b);\r\n    },\r\n    SortResponseTitles: m_fnSortResponseTitleNoCase,\r\n  };\r\n\r\n  return publicMembers;\r\n};\r\n\r\n// ExecuteOrDelayUntilScriptLoaded(InitReport, \"sp.js\");\r\nInitReport();\r\n", "\uFEFFconst html = String.raw;\r\n\r\nexport const aoDbTemplate = html`\r\n  <link\r\n    rel=\"stylesheet\"\r\n    type=\"text/css\"\r\n    href=\"/sites/CGFS/Style Library/apps/audit/lib/jquery-ui-1.13.2/jquery-ui.theme.min.css\"\r\n  />\r\n  <link\r\n    rel=\"stylesheet\"\r\n    type=\"text/css\"\r\n    href=\"/sites/CGFS/Style Library/apps/audit/lib/tablesorter-2.31.3/css/theme.default.min.css\"\r\n  />\r\n  <!--\r\n  <script\r\n    type=\"text/javascript\"\r\n    src=\"/sites/CGFS/Style Library/apps/audit/lib/jquery-3.7.1.min.js\"\r\n  ></script>\r\n  <script\r\n    type=\"text/javascript\"\r\n    src=\"/sites/CGFS/Style Library/apps/audit/lib/jquery-ui-1.13.2/jquery-ui.min.js\"\r\n  ></script>\r\n\r\n  <script\r\n    type=\"text/javascript\"\r\n    src=\"/sites/CGFS/Style Library/apps/audit/lib/tablesorter-2.31.3/js/jquery.tablesorter.min.js\"\r\n  ></script>\r\n  <script\r\n    type=\"text/javascript\"\r\n    src=\"/sites/CGFS/Style Library/apps/audit/lib/knockout-3.5.1.js\"\r\n  ></script>\r\n  -->\r\n\r\n  <iframe id=\"CsvExpFrame\" style=\"display: none\"></iframe>\r\n\r\n  <div\r\n    id=\"divCounter\"\r\n    style=\"display: none\"\r\n    title=\"used to auto refresh the page\"\r\n  >\r\n    600\r\n  </div>\r\n\r\n  <div class=\"audit\">\r\n    <!-- ko with: blockingTasks -->\r\n    <div\r\n      class=\"tasks blocking dimmer\"\r\n      data-bind=\"css: {'active': $data.length}\"\r\n    >\r\n      <span class=\"loader\"></span>\r\n      <ul class=\"\" data-bind=\"foreach: $data\">\r\n        <li data-bind=\"text: msg + '... ' + Status()\"></li>\r\n      </ul>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko with: runningTasks -->\r\n    <div class=\"tasks running\">\r\n      <ul class=\"\" data-bind=\"foreach: $data\">\r\n        <li data-bind=\"text: msg + '... ' + Status()\"></li>\r\n      </ul>\r\n    </div>\r\n    <!-- /ko -->\r\n    <div id=\"divLoading\" style=\"color: green; padding-bottom: 10px\">\r\n      Please Wait... Loading\r\n      <span\r\n        data-bind=\"visible: arrResponses().length > 0 && debugMode, text: arrResponses().length\"\r\n      ></span>\r\n    </div>\r\n    <div id=\"divUsersGroups\" style=\"color: green; padding-bottom: 10px\"></div>\r\n    <div class=\"audit-body\">\r\n      <div class=\"reports-container\">\r\n        <div id=\"divRefresh\" class=\"quick-links\" style=\"display: none\">\r\n          <div>\r\n            <a\r\n              title=\"Refresh this page\"\r\n              href=\"javascript:void(0)\"\r\n              data-bind=\"click: refresh\"\r\n              ><span class=\"ui-icon ui-icon-refresh\"></span>Refresh</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a\r\n              title=\"View User Manual\"\r\n              href=\"javascript:void(0)\"\r\n              onclick=\"Audit.Common.Utilities.ViewUserManuals('AO User Manual')\"\r\n              ><span class=\"ui-icon ui-icon-help\"></span>User Manual</a\r\n            >\r\n          </div>\r\n          <div>\r\n            <a title=\"Help\" href=\"mailto:cgfsauditrequests@state.gov\"\r\n              ><span class=\"ui-icon ui-icon-mail-closed\"></span>Request Help</a\r\n            >\r\n          </div>\r\n        </div>\r\n        <div id=\"\" style=\"margin-top: 20px\">\r\n          <!-- ko using: tabs -->\r\n          <ul class=\"ui-tabs-nav\" data-bind=\"foreach: tabOpts\">\r\n            <li\r\n              data-bind=\"text: linkText, \r\n            click: $parent.clickTabLink, \r\n            css: {active: $parent.isSelected($data)}\"\r\n            ></li>\r\n          </ul>\r\n          <!-- ko foreach: tabOpts -->\r\n          <div\r\n            data-bind=\"template: {\r\n              name: template.id,\r\n              data: template.data\r\n            },\r\n            visible: $parent.isSelected($data)\"\r\n          ></div>\r\n          <!-- /ko -->\r\n          <!-- /ko -->\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <script type=\"text/html\" id=\"responseStatusReportTemplate\">\r\n    <div id=\"tabs-0\">\r\n      <div\r\n        id=\"lblStatusReportResponsesMsg\"\r\n        style=\"padding-top: 5px; color: green\"\r\n      >\r\n        <span\r\n          data-bind=\"css: (cntPendingReview() > 0 ? 'ui-icon ui-icon-alert' : 'ui-icon ui-icon-circle-check')\"\r\n        ></span\r\n        >There are <span data-bind=\"text: cntPendingReview\"></span> Responses\r\n        pending your review\r\n      </div>\r\n      <div\r\n        id=\"divButtons\"\r\n        style=\"padding-top: 3px\"\r\n        data-bind=\"visible: arrResponses().length > 0\"\r\n      >\r\n        <a\r\n          id=\"btnPrint1\"\r\n          title=\"Click here to Print\"\r\n          href=\"javascript:void(0)\"\r\n          class=\"hideOnPrint\"\r\n          ><span class=\"ui-icon ui-icon-print\">Print</span></a\r\n        >\r\n        <a class=\"export1 hideOnPrint\" title=\"Export to CSV\" href=\"#\"\r\n          ><span class=\"ui-icon ui-icon-disk\">Export to CSV</span></a\r\n        >\r\n        <a\r\n          id=\"btnViewAll\"\r\n          title=\"View All\"\r\n          href=\"javascript:void(0)\"\r\n          data-bind=\"visible: arrFilteredResponsesCount() < arrResponses().length && doSort, click: ClearFiltersResponseTab\"\r\n          ><span class=\"ui-icon ui-icon-circle-zoomout\"></span>View All\r\n          Responses</a\r\n        >\r\n      </div>\r\n\r\n      <div id=\"divStatusReportRespones\">\r\n        <table\r\n          id=\"tblStatusReportResponses\"\r\n          class=\"tablesorter report\"\r\n          data-bind=\"visible: arrResponses().length > 0\"\r\n        >\r\n          <thead>\r\n            <tr\r\n              valign=\"top\"\r\n              class=\"rowFilters\"\r\n              data-bind=\"visible: arrResponses().length > 0\"\r\n            >\r\n              <th class=\"sorter-false filter\" nowrap=\"nowrap\">\r\n                <select\r\n                  id=\"ddlResponseName\"\r\n                  data-bind=\"options: $root.ddOptionsResponseTabResponseTitle, value: filterResponseTabResponseName, optionsCaption: '-Select-'\"\r\n                ></select>\r\n              </th>\r\n              <th class=\"sorter-false\" nowrap=\"nowrap\"></th>\r\n              <th class=\"sorter-false filter\" nowrap=\"nowrap\">\r\n                <select\r\n                  id=\"ddlResponseRequestInternalDueDate\"\r\n                  data-bind=\"options: $root.ddOptionsResponseTabRequestInternalDueDate, value: filterResponseTabRequestIntDueDate, optionsCaption: '-Select-'\"\r\n                ></select>\r\n              </th>\r\n              <th class=\"sorter-false filter\" nowrap=\"nowrap\">\r\n                <select\r\n                  id=\"ddlResponseStatus\"\r\n                  data-bind=\"options: $root.ddOptionsResponseTabResponseStatus, value: filterResponseTabResponseStatus, optionsCaption: '-Select-'\"\r\n                ></select>\r\n              </th>\r\n              <th class=\"sorter-false\"></th>\r\n              <th class=\"sorter-false\"></th>\r\n            </tr>\r\n            <tr valign=\"top\">\r\n              <th class=\"sorter-true\" nowrap=\"nowrap\">Response Name</th>\r\n              <th class=\"sorter-false\" nowrap=\"nowrap\">Response Subject</th>\r\n              <th class=\"sorter-true\" nowrap=\"nowrap\">Due Date</th>\r\n              <th class=\"sorter-true\" nowrap=\"nowrap\">Response Status</th>\r\n              <th class=\"sorter-true\" nowrap=\"nowrap\"># of Documents</th>\r\n              <th class=\"sorter-true\" nowrap=\"nowrap\">Modified</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody id=\"fbody\">\r\n            <!-- ko foreach: arrResponses -->\r\n            <tr\r\n              class=\"sr-response-item\"\r\n              data-bind=\"css: {'highlighted': highlight}\"\r\n            >\r\n              <td class=\"sr-response-title\">\r\n                <a\r\n                  href=\"javascript:void(0);\"\r\n                  title=\"Go to Response Details\"\r\n                  data-bind=\"text: title,\r\n          click: () => Audit.AOReport.Report.GoToResponse(title)\"\r\n                >\r\n                </a>\r\n              </td>\r\n              <td\r\n                class=\"sr-response-requestSubject\"\r\n                data-bind=\"text: requestSubject\"\r\n              ></td>\r\n              <td\r\n                class=\"sr-response-internalDueDate\"\r\n                data-bind=\"text: internalDueDate\"\r\n              ></td>\r\n              <td class=\"sr-response-status\" data-bind=\"text: status\"></td>\r\n              <td class=\"sr-response-docCount\" data-bind=\"text: docCount\"></td>\r\n              <td class=\"sr-response-modified\" data-bind=\"text: modified\"></td>\r\n            </tr>\r\n            <!-- /ko -->\r\n          </tbody>\r\n          <tfoot class=\"footer\">\r\n            <tr>\r\n              <th colspan=\"6\">\r\n                Displaying\r\n                <span\r\n                  id=\"spanResponsesDisplayedTotal\"\r\n                  style=\"color: green\"\r\n                  data-bind=\"text: arrFilteredResponsesCount()\"\r\n                  >0</span\r\n                >\r\n                out of\r\n                <span\r\n                  id=\"spanResponsesTotal\"\r\n                  style=\"color: green\"\r\n                  data-bind=\"text: arrResponses().length\"\r\n                  >0</span\r\n                >\r\n                Responses\r\n              </th>\r\n            </tr>\r\n          </tfoot>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  </script>\r\n\r\n  <script type=\"text/html\" id=\"responseDetailTemplate\">\r\n    <div id=\"tabs-1\">\r\n      <div style=\"padding-bottom: 15px\">\r\n        <table>\r\n          <tr>\r\n            <td><span>Responses Pending Action:</span></td>\r\n            <td>\r\n              <select\r\n                id=\"ddlResponsesOpen\"\r\n                data-bind=\"options: $root.ddOptionsResponseInfoTabResponseNameOpen2, value: filterResponseInfoTabResponseNameOpen2, optionsCaption: '-Select-'\"\r\n              ></select>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td><span>Other Responses:</span></td>\r\n            <td>\r\n              <select\r\n                id=\"ddlResponsesProcessed\"\r\n                data-bind=\"options: $root.ddOptionsResponseInfoTabResponseNameProcessed2, value: filterResponseInfoTabResponseNameProcessed2, optionsCaption: '-Select-'\"\r\n              ></select>\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </div>\r\n      <div class=\"response-detail-view\">\r\n        <div\r\n          id=\"divResponseInfo\"\r\n          class=\"audit-form response-info-form\"\r\n          data-bind=\"with: currentResponse\"\r\n        >\r\n          <div class=\"form-header\">\r\n            <h3 class=\"uppercase form-title\">\r\n              AUDIT RESPONSE DETAILS\r\n              <div class=\"fw-semibold\" data-bind=\"text: title\"></div>\r\n            </h3>\r\n            <!-- <button\r\n          type=\"button\"\r\n          class=\"btn btn-link form-title\"\r\n          data-bind=\"click: $parent.refreshRequest\"\r\n        >\r\n          <i title=\"Refresh Request\" class=\"fa-solid fa-arrows-rotate\"></i>\r\n        </button> -->\r\n          </div>\r\n\r\n          <div class=\"form-row uppercase\">\r\n            <dl>\r\n              <dt>Subject</dt>\r\n              <dd>\r\n                <span\r\n                  id=\"requestInfoSubject\"\r\n                  data-bind=\"text: request.subject\"\r\n                ></span>\r\n              </dd>\r\n              <dt>Due Date</dt>\r\n              <dd>\r\n                <span\r\n                  id=\"requestInfoInternalDueDate\"\r\n                  data-bind=\"text: request.internalDueDate\"\r\n                ></span>\r\n              </dd>\r\n            </dl>\r\n            <dl>\r\n              <dt>Response Status</dt>\r\n              <dd>\r\n                <span\r\n                  id=\"responseInfoStatus\"\r\n                  data-bind=\"style: { color:  resStatus == '7-Closed' ? 'red' : 'green' }\"\r\n                >\r\n                  <span data-bind=\"text: resStatus\"></span\r\n                  ><span data-bind=\"visible: resStatus == '7-Closed'\">\r\n                    on <span data-bind=\"text: closedDate \"></span> by\r\n                    <span data-bind=\"text: closedBy\"></span>\r\n                  </span>\r\n                </span>\r\n              </dd>\r\n              <dt>Action Office</dt>\r\n              <dd>\r\n                <span id=\"responseInfoAO\" data-bind=\"text: actionOffice\"></span>\r\n                <span data-bind=\"visible: poc\" style=\"color: green\">POC: </span\r\n                ><span data-bind=\"text: poc\" style=\"color: green\"></span>\r\n              </dd>\r\n              <dt>Related Audit</dt>\r\n              <dd>\r\n                <span\r\n                  id=\"requestInfoRelatedAudit\"\r\n                  data-bind=\"text: request.relatedAudit\"\r\n                ></span>\r\n              </dd>\r\n            </dl>\r\n          </div>\r\n          <div class=\"form-row uppercase\">\r\n            <dl>\r\n              <dt>Action Items</dt>\r\n              <dd>\r\n                <span\r\n                  id=\"requestInfoActionItems\"\r\n                  data-bind=\"html: request.actionItems\"\r\n                ></span>\r\n              </dd>\r\n              <dt>Comments</dt>\r\n              <dd>\r\n                <span\r\n                  id=\"responseInfoComments\"\r\n                  data-bind=\"html: comments\"\r\n                ></span>\r\n              </dd>\r\n            </dl>\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <div id=\"divCoverSheets\" data-bind=\"visible: currentResponse\">\r\n            <fieldset>\r\n              <legend>Cover Sheets/Supplemental Documents</legend>\r\n\r\n              <div\r\n                id=\"divEmptyCoversheetsMsg\"\r\n                style=\"border: 0px !important; font-style: italic\"\r\n                data-bind=\"visible: arrCoverSheets().length <= 0\"\r\n              >\r\n                There are 0 cover sheets or supplemental documents\r\n              </div>\r\n              <table\r\n                id=\"tblCoverSheets\"\r\n                class=\"tablesorter report\"\r\n                data-bind=\"visible: arrCoverSheets().length > 0\"\r\n              >\r\n                <thead>\r\n                  <tr valign=\"top\">\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">Name</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody data-bind=\"foreach: arrCoverSheets\">\r\n                  <tr class=\"coversheet-item\">\r\n                    <td class=\"coversheet-title\" title=\"Click to Download\">\r\n                      <a\r\n                        data-bind=\"attr: { href: 'javascript:void(0)', onclick: link}\"\r\n                        ><span data-bind=\"text: title\"></span\r\n                      ></a>\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n                <tfoot>\r\n                  <tr valign=\"top\">\r\n                    <th nowrap=\"nowrap\">\r\n                      Total:\r\n                      <span\r\n                        id=\"tblCoverSheetsTotal\"\r\n                        data-bind=\"text: arrCoverSheets().length\"\r\n                        >0</span\r\n                      >\r\n                    </th>\r\n                  </tr>\r\n                </tfoot>\r\n              </table>\r\n            </fieldset>\r\n          </div>\r\n\r\n          <div\r\n            class=\"divSubmit\"\r\n            data-bind=\"visible: currentResponse && showSubmit\"\r\n          >\r\n            <fieldset style=\"border-color: GreenYellow\">\r\n              <legend style=\"font-weight: bold; font-size: 11pt\">\r\n                SUBMIT RESPONSE\r\n              </legend>\r\n              <div style=\"padding-top: 15px; padding-bottom: 15px\">\r\n                <span class=\"ui-icon ui-icon-disk\"></span\r\n                ><a\r\n                  class=\"btnSubmitPackage\"\r\n                  href=\"javascript:void(0)\"\r\n                  title=\"Click to Submit the Response Package\"\r\n                  data-bind=\"click: ClickSubmitResponse\"\r\n                  >Submit this Response Package</a\r\n                >\r\n              </div>\r\n            </fieldset>\r\n          </div>\r\n\r\n          <div id=\"divResponseDocs\" data-bind=\"visible: currentResponse\">\r\n            <fieldset>\r\n              <legend>Response Documents</legend>\r\n\r\n              <table\r\n                id=\"tblResponseDocs\"\r\n                class=\"tablesorter report\"\r\n                data-bind=\"visible: cntResponseDocs() > 0\"\r\n              >\r\n                <thead>\r\n                  <tr valign=\"top\">\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">Type</th>\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">Name</th>\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">Title</th>\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">Receipt Date</th>\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">File Size</th>\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">Modified</th>\r\n                    <th class=\"sorter-false\" nowrap=\"nowrap\">Modified By</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody data-bind=\"with: arrResponseDocs\">\r\n                  <tr class=\"requestInfo-response-doc\">\r\n                    <td colspan=\"10\">\r\n                      <img\r\n                        style=\"background-color: transparent\"\r\n                        src=\"/_layouts/images/minus.gif\"\r\n                        title=\"Expand/Collapse\"\r\n                        data-bind=\"toggleClick: $data, toggleClass: 'collapsed', containerType: 'doc', classContainer: '.requestInfo-response-doc'\"\r\n                      /><span data-bind=\"text: responseTitle\"></span>\r\n                    </td>\r\n                  </tr>\r\n\r\n                  <!-- ko foreach: responseDocs-->\r\n\r\n                  <tr\r\n                    class=\"requestInfo-response-doc-item\"\r\n                    data-bind=\"style: styleTag\"\r\n                  >\r\n                    <td>\r\n                      <img\r\n                        data-bind=\"attr:{ src: $parent.siteUrl + '/_layouts/images/' + docIcon}\"\r\n                      />\r\n                    </td>\r\n                    <td\r\n                      class=\"requestInfo-response-doc-title\"\r\n                      title=\"Click to Download\"\r\n                    >\r\n                      <a\r\n                        data-bind=\"downloadLink: '../_layouts/download.aspx?SourceUrl=:folder/:fileName'\"\r\n                        ><span data-bind=\"text: fileName\"></span\r\n                      ></a>\r\n                      <span\r\n                        style=\"float: right\"\r\n                        data-bind=\"visible: ($parent.responseStatus == '1-Open' || $parent.responseStatus == '3-Returned to Action Office') && documentStatus == 'Open'\"\r\n                      >\r\n                        <a\r\n                          title=\"Delete Response Document\"\r\n                          href=\"javascript:void(0)\"\r\n                          data-bind=\"click:  $root.ClickMarkForDeletionResponseDoc\"\r\n                          ><span class=\"ui-icon ui-icon-trash\"\r\n                            >Delete Response Document</span\r\n                          ></a\r\n                        >\r\n                      </span>\r\n                    </td>\r\n                    <td nowrap data-bind=\"text: title\"></td>\r\n                    <td nowrap data-bind=\"text: receiptDate\"></td>\r\n                    <td nowrap data-bind=\"text: fileSize\"></td>\r\n                    <td\r\n                      class=\"requestInfo-response-doc-modified\"\r\n                      data-bind=\"text: modifiedDate\"\r\n                    ></td>\r\n                    <td\r\n                      class=\"requestInfo-response-doc-modifiedBy\"\r\n                      data-bind=\"text: modifiedBy\"\r\n                    ></td>\r\n                  </tr>\r\n\r\n                  <!-- /ko -->\r\n                </tbody>\r\n                <tfoot>\r\n                  <tr valign=\"top\">\r\n                    <th colspan=\"7\" nowrap=\"nowrap\">\r\n                      Total:\r\n                      <span\r\n                        id=\"tblResponseDocsTotal\"\r\n                        data-bind=\"text: cntResponseDocs\"\r\n                        >0</span\r\n                      >\r\n                    </th>\r\n                  </tr>\r\n                </tfoot>\r\n              </table>\r\n              <div class=\"divUpload\" data-bind=\"visible: showUpload()\">\r\n                <label class=\"file-upload-field\">\r\n                  Upload Response Documents:\r\n                  <div class=\"dropzone\" data-bind=\"\">Drop Files Here</div>\r\n                  <input\r\n                    class=\"file-upload\"\r\n                    type=\"file\"\r\n                    multiple\r\n                    data-bind=\"files: responseDocFiles\"\r\n                  />\r\n                </label>\r\n              </div>\r\n            </fieldset>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </script>\r\n\r\n  <div id=\"divTest\"></div>\r\n`;\r\n", "const state = {};\r\n\r\nwindow.history.replaceState({}, \"\", document.location.href);\r\nexport function setUrlParam(param, newVal) {\r\n  // No need to reset the param if it hasn't changed\r\n  if (getUrlParam(param) == newVal) return;\r\n\r\n  const search = window.location.search;\r\n  //var urlParams = new URLSearchParams(queryString);\r\n\r\n  const regex = new RegExp(\"([?;&])\" + param + \"[^&;]*[;&]?\");\r\n  const query = search.replace(regex, \"$1\").replace(/&$/, \"\");\r\n\r\n  const urlParams =\r\n    (query.length > 2 ? query + \"&\" : \"?\") +\r\n    (newVal ? param + \"=\" + newVal : \"\");\r\n\r\n  state[param] = newVal;\r\n  window.history.pushState(state, \"\", urlParams.toString());\r\n}\r\n\r\nexport function getUrlParam(param) {\r\n  const results = new RegExp(\"[?&]\" + param + \"=([^&#]*)\").exec(\r\n    window.location.href\r\n  );\r\n  if (results == null) {\r\n    return null;\r\n  } else {\r\n    return decodeURI(results[1]) || 0;\r\n  }\r\n}\r\n", "import { setUrlParam } from \"../../common/router.js\";\r\n\r\n// const urlParam = \"Tab\";\r\n\r\nexport class TabsModule {\r\n  constructor(tabOpts, urlParam = \"Tab\") {\r\n    this.urlParam = urlParam;\r\n    ko.utils.arrayPushAll(this.tabOpts, tabOpts);\r\n    this.selectedTab.subscribe(this.tabChangeHandler);\r\n    window.addEventListener(\"popstate\", this.popStateHandler);\r\n  }\r\n\r\n  tabOpts = ko.observableArray();\r\n  selectedTab = ko.observable();\r\n\r\n  isSelected = (tab) => {\r\n    return tab.id == this.selectedTab()?.id;\r\n  };\r\n\r\n  clickTabLink = (tab) => {\r\n    this.selectedTab(tab);\r\n    console.log(\"selected: \" + tab.id);\r\n  };\r\n\r\n  selectTab = (tab) => this.selectById(tab.id);\r\n\r\n  selectById = (tabId) => {\r\n    const tabById =\r\n      this.tabOpts().find((tab) => tab.id == tabId) ?? this.getDefaultTab();\r\n    this.selectedTab(tabById);\r\n  };\r\n\r\n  getDefaultTab = () => this.tabOpts()[0];\r\n\r\n  tabChangeHandler = (newTab) => {\r\n    if (newTab) setUrlParam(this.urlParam, newTab.id);\r\n    // window.history.pushState({ tab: { id: newTab.id } }, \"\", newTab.id);\r\n  };\r\n\r\n  popStateHandler = (event) => {\r\n    if (event.state) {\r\n      if (event.state[this.urlParam])\r\n        this.selectById(event.state[this.urlParam]);\r\n    }\r\n  };\r\n}\r\n\r\nexport class Tab {\r\n  constructor(id, linkText, template) {\r\n    this.id = id;\r\n    this.linkText = linkText;\r\n    this.template = template;\r\n  }\r\n}\r\n", "\uFEFFimport \"../../common/utilities.js\";\r\n\r\nimport { aoDbTemplate } from \"./AO_DB_Template.js\";\r\nimport { TabsModule, Tab } from \"../../components/tabs/tabs_module.js\";\r\nimport { setUrlParam } from \"../../common/index.js\";\r\nimport { appContext } from \"../../infrastructure/application_db_context.js\";\r\nimport { uploadResponseDocFile } from \"../../services/index.js\";\r\n\r\nimport {\r\n  addTask,\r\n  blockingTasks,\r\n  finishTask,\r\n  runningTasks,\r\n  taskDefs,\r\n} from \"../../services/tasks.js\";\r\n\r\nimport \"../../sal/infrastructure/knockout_extensions.js\";\r\n\r\nvar Audit = window.Audit || {};\r\nAudit.AOReport = Audit.AOReport || {};\r\n\r\nconst responseParam = \"ResNum\";\r\n\r\nAudit.AOReport.Init = function () {\r\n  var paramShowSiteActionsToAnyone = GetUrlKeyValue(\"ShowSiteActions\");\r\n  if (paramShowSiteActionsToAnyone != true) {\r\n    //hide it even for owners unless this param is passed into the URL; pass in param if you want to change the page web parts/settings\r\n    $(\"#RibbonContainer-TabRowLeft\").hide();\r\n    $(\".ms-siteactionsmenu\").hide();\r\n  }\r\n\r\n  /*setInterval(function() {\r\n\t    var divVal = $(\"#divCounter\").text();\r\n\t    var count = divVal * 1 - 1;\r\n\t    $(\"#divCounter\").text(count);\r\n\t    if (count <= 0) {\r\n\t       // location.href=\"https://example.com\";\r\n\t       Audit.Common.Utilities.Refresh();\r\n\t    }\r\n\t}, 1000);\r\n\t*/\r\n\r\n  function SetTimer() {\r\n    var intervalRefreshID = setInterval(function () {\r\n      var divVal = $(\"#divCounter\").text();\r\n      var count = divVal * 1 - 1;\r\n      $(\"#divCounter\").text(count);\r\n      if (count <= 0) {\r\n        if (!Audit.AOReport.Report.IsTransactionExecuting())\r\n          Audit.Common.Utilities.Refresh();\r\n        else {\r\n          clearInterval(intervalRefreshID);\r\n          $(\"#divCounter\").text(\"1200\");\r\n          SetTimer();\r\n        }\r\n      }\r\n    }, 1000);\r\n  }\r\n\r\n  SetTimer();\r\n};\r\n\r\nAudit.AOReport.NewReportPage = function () {\r\n  var m_bigMap = new Object();\r\n  var m_arrRequests = new Array();\r\n  var m_arrResponses = new Array();\r\n  var m_arrPermissions = new Array();\r\n  var m_IA_SPGroupName = null;\r\n  var m_IA_ActionOffice = null;\r\n\r\n  var ownerGroup,\r\n    memberGroup,\r\n    visitorGroup = null;\r\n  var m_groupColl = null;\r\n\r\n  var m_requestItems = null;\r\n  var m_responseItems = null;\r\n  var m_ResponseDocsItems = null;\r\n  var m_aoItems = null;\r\n\r\n  var m_responseDocsLibrary = null;\r\n\r\n  var m_statusToFilterOn = \"\";\r\n  var m_curResponseSelectedIsEditableByAO = false;\r\n\r\n  var m_bIsTransactionExecuting = false;\r\n\r\n  var m_responseStatus1 = \"1-Open\";\r\n  var m_responseStatus2 = \"3-Returned to Action Office\";\r\n\r\n  function ViewModel() {\r\n    var self = this;\r\n\r\n    self.debugMode = ko.observable(false);\r\n    self.siteUrl = Audit.Common.Utilities.GetSiteUrl();\r\n\r\n    self.tabOpts = {\r\n      Responses: new Tab(\"response-report\", \"Status Report\", {\r\n        id: \"responseStatusReportTemplate\",\r\n        data: self,\r\n      }),\r\n      ResponseDetail: new Tab(\"response-detail\", \"Responses\", {\r\n        id: \"responseDetailTemplate\",\r\n        data: self,\r\n      }),\r\n    };\r\n    self.tabs = new TabsModule(Object.values(self.tabOpts));\r\n\r\n    self.runningTasks = runningTasks;\r\n    self.blockingTasks = blockingTasks;\r\n\r\n    //cant add rate limit because it'll affect the refresh\r\n    //self.arrResponses = ko.observableArray( null ).extend({ rateLimit: 500 });\r\n    self.arrResponses = ko.observableArray(null);\r\n    self.arrFilteredResponsesCount = ko.observable(0);\r\n    self.cntPendingReview = ko.observable(0);\r\n\r\n    self.ddOptionsResponseTabRequestID = ko.observableArray();\r\n    self.ddOptionsResponseTabRequestStatus = ko.observableArray();\r\n    self.ddOptionsResponseTabRequestInternalDueDate = ko.observableArray();\r\n    self.ddOptionsResponseTabRequestSample = ko.observableArray();\r\n    self.ddOptionsResponseTabResponseTitle = ko.observableArray();\r\n    self.ddOptionsResponseTabResponseStatus = ko.observableArray();\r\n    self.filterResponseTabRequestIntDueDate = ko.observable();\r\n    self.filterResponseTabResponseName = ko.observable();\r\n    self.filterResponseTabResponseStatus = ko.observable();\r\n    self.doSort = ko.observable(false);\r\n\r\n    self.ddOptionsResponseInfoTabResponseNameOpen2 = ko.observableArray();\r\n    self.ddOptionsResponseInfoTabResponseNameProcessed2 = ko.observableArray();\r\n    self.filterResponseInfoTabResponseNameOpen2 = ko.observable(\"\");\r\n    self.filterResponseInfoTabResponseNameProcessed2 = ko.observable(\"\");\r\n\r\n    self.currentResponse = ko.observable();\r\n    self.arrCoverSheets = ko.observableArray(null);\r\n    self.arrResponseDocs = ko.observable(null);\r\n    self.cntResponseDocs = ko.observable(0);\r\n\r\n    // File Input Control\r\n    self.responseDocFiles = ko.observableArray();\r\n\r\n    self.showUpload = ko.observable(false);\r\n    self.showSubmit = ko.observable(false);\r\n\r\n    self.refresh = () => window.location.reload();\r\n    self.onNewResponseDocCallback = self.refresh;\r\n\r\n    self.currentResponse.subscribe((newResponse) => {\r\n      if (!newResponse) return;\r\n      setUrlParam(responseParam, newResponse.title);\r\n    });\r\n    self.selectedFiltersResponseTab = ko.computed(function () {\r\n      var requestIntDueDate = self.filterResponseTabRequestIntDueDate();\r\n      var responseName = self.filterResponseTabResponseName();\r\n      var responseStatus = self.filterResponseTabResponseStatus();\r\n\r\n      return requestIntDueDate + \" \" + responseName + \" \" + responseStatus;\r\n    });\r\n\r\n    /** Behaviors **/\r\n\r\n    self.ClearFiltersResponseTab = function () {\r\n      self.filterResponseTabRequestIntDueDate(\"\");\r\n      self.filterResponseTabResponseName(\"\");\r\n      self.filterResponseTabResponseStatus(\"\");\r\n    };\r\n\r\n    self.FilterChangedResponseTab = function () {\r\n      document.body.style.cursor = \"wait\";\r\n      setTimeout(function () {\r\n        var requestIntDueDate = self.filterResponseTabRequestIntDueDate();\r\n        var responseName = self.filterResponseTabResponseName();\r\n        var responseStatus = self.filterResponseTabResponseStatus();\r\n\r\n        if (!requestIntDueDate && !responseName && !responseStatus) {\r\n          $(\".sr-response-item\").show();\r\n          self.arrFilteredResponsesCount(self.arrResponses().length);\r\n          document.body.style.cursor = \"default\";\r\n          return;\r\n        }\r\n\r\n        requestIntDueDate = !requestIntDueDate ? \"\" : requestIntDueDate;\r\n        responseName = !responseName ? \"\" : responseName;\r\n        responseStatus = !responseStatus ? \"\" : responseStatus;\r\n\r\n        var count = 0;\r\n        var eacher = $(\".sr-response-item\");\r\n        eacher.each(function () {\r\n          var hide = false;\r\n\r\n          if (\r\n            !hide &&\r\n            requestIntDueDate != \"\" &&\r\n            $.trim($(this).find(\".sr-response-internalDueDate\").text()) !=\r\n              requestIntDueDate\r\n          )\r\n            hide = true;\r\n          if (\r\n            !hide &&\r\n            responseName != \"\" &&\r\n            $.trim($(this).find(\".sr-response-title\").text()) != responseName\r\n          )\r\n            hide = true;\r\n          if (\r\n            !hide &&\r\n            responseStatus != \"\" &&\r\n            $.trim($(this).find(\".sr-response-status\").text()) != responseStatus\r\n          )\r\n            hide = true;\r\n\r\n          if (hide) $(this).hide();\r\n          else {\r\n            $(this).show();\r\n            count++;\r\n          }\r\n        });\r\n\r\n        self.arrFilteredResponsesCount(count);\r\n        document.body.style.cursor = \"default\";\r\n      }, 100);\r\n    };\r\n\r\n    self.ClickSubmitResponse = function () {\r\n      m_fnSubmitPackage();\r\n    };\r\n\r\n    self.ClickUploadResponseDoc = function () {\r\n      var oResponse = self.currentResponse();\r\n      if (oResponse && oResponse.number && oResponse.title)\r\n        m_fnUploadResponseDoc(oResponse.number, oResponse.title);\r\n    };\r\n\r\n    self.ClickMarkForDeletionResponseDoc = function (oResponseDoc) {\r\n      if (oResponseDoc && oResponseDoc.ID)\r\n        m_fnMarkForDeletionResponseDoc(oResponseDoc.ID);\r\n    };\r\n\r\n    /** Subscriptions **/\r\n\r\n    self.selectedFiltersResponseTab.subscribe(function (value) {\r\n      self.FilterChangedResponseTab();\r\n    });\r\n\r\n    self.doSort.subscribe(function (newValue) {\r\n      Audit.Common.Utilities.OnLoadDisplayTimeStamp();\r\n\r\n      if (self.arrResponses().length > 0 && newValue) {\r\n        //should trigger only once\r\n        self.arrFilteredResponsesCount(self.arrResponses().length);\r\n\r\n        //draw these first\r\n        ko.utils.arrayPushAll(\r\n          self.ddOptionsResponseTabResponseStatus(),\r\n          self.GetDDVals(\"status\")\r\n        );\r\n        self.ddOptionsResponseTabResponseStatus.valueHasMutated();\r\n\r\n        ko.utils.arrayPushAll(\r\n          self.ddOptionsResponseInfoTabResponseNameOpen2(),\r\n          self.GetDDVals2(\"1\", true)\r\n        );\r\n        self.ddOptionsResponseInfoTabResponseNameOpen2.valueHasMutated();\r\n\r\n        ko.utils.arrayPushAll(\r\n          self.ddOptionsResponseInfoTabResponseNameProcessed2(),\r\n          self.GetDDVals2(\"0\", true)\r\n        );\r\n        self.ddOptionsResponseInfoTabResponseNameProcessed2.valueHasMutated();\r\n\r\n        //draw these next\r\n        ko.utils.arrayPushAll(\r\n          self.ddOptionsResponseTabRequestInternalDueDate(),\r\n          self.GetDDVals(\"internalDueDate\")\r\n        );\r\n        self.ddOptionsResponseTabRequestInternalDueDate.valueHasMutated();\r\n\r\n        ko.utils.arrayPushAll(\r\n          self.ddOptionsResponseTabResponseTitle(),\r\n          self.GetDDVals(\"title\", true)\r\n        );\r\n        self.ddOptionsResponseTabResponseTitle.valueHasMutated();\r\n\r\n        setTimeout(function () {\r\n          var paramTabIndex = GetUrlKeyValue(\"Tab\");\r\n          if (paramTabIndex != null && paramTabIndex != \"\") {\r\n            // $(\"#tabs\").tabs(\"option\", \"active\", paramTabIndex);\r\n            self.tabs.selectById(paramTabIndex);\r\n          } else {\r\n            self.tabs.selectById(self.tabOpts.Responses.id);\r\n          }\r\n          if (\r\n            paramTabIndex == null ||\r\n            paramTabIndex == \"\" ||\r\n            paramTabIndex == 0\r\n          ) {\r\n            if (self.cntPendingReview() > 0) {\r\n              SP.UI.Notify.addNotification(\r\n                \"<div style='text-align:left'>There are <b>\" +\r\n                  self.cntPendingReview() +\r\n                  \"</b> Responses pending your review/action. <br/> <br/> Please click on the links in the <b>Response Name</b> column of the <b>Status Report tab</b> <br/> to access each response and upload documents and submit the package.</div>\",\r\n                false\r\n              );\r\n            }\r\n          }\r\n\r\n          var paramResponseNum = GetUrlKeyValue(\"ResNum\");\r\n          if (paramResponseNum != null && paramResponseNum != \"\") {\r\n            if (paramTabIndex == 0) {\r\n              if (\r\n                $(\"#ddlResponseName option[value='\" + paramResponseNum + \"']\")\r\n                  .length > 0\r\n              )\r\n                _myViewModel.filterResponseTabResponseName(paramResponseNum);\r\n            } else {\r\n              if (\r\n                $(\"#ddlResponsesOpen option[value='\" + paramResponseNum + \"']\")\r\n                  .length > 0\r\n              )\r\n                _myViewModel.filterResponseInfoTabResponseNameOpen2(\r\n                  paramResponseNum\r\n                );\r\n              else if (\r\n                $(\r\n                  \"#ddlResponsesProcessed option[value='\" +\r\n                    paramResponseNum +\r\n                    \"']\"\r\n                ).length > 0\r\n              )\r\n                _myViewModel.filterResponseInfoTabResponseNameProcessed2(\r\n                  paramResponseNum\r\n                );\r\n            }\r\n          }\r\n\r\n          BindHandlersOnLoad();\r\n\r\n          self.filterResponseTabResponseStatus(m_statusToFilterOn);\r\n\r\n          //$( \"#tblStatusReportResponses\" ).trigger(\"update\");\r\n          $(\"#tblStatusReportResponses\").tablesorter({\r\n            sortList: [[2, 0]],\r\n            selectorHeaders: \".sorter-true\",\r\n          });\r\n        }, 200);\r\n      }\r\n    });\r\n\r\n    /**TODO: factor these below **/\r\n    /* second tab */\r\n    self.filterResponseInfoTabResponseNameOpen2.subscribe(function (newValue) {\r\n      self.filterResponseInfoTabResponseName(newValue, true);\r\n    });\r\n\r\n    /* second tab */\r\n    self.filterResponseInfoTabResponseNameProcessed2.subscribe(function (\r\n      newValue\r\n    ) {\r\n      self.filterResponseInfoTabResponseName(newValue, false);\r\n    });\r\n\r\n    self.filterResponseInfoTabResponseName = function (\r\n      newValue,\r\n      bOpenResponses\r\n    ) {\r\n      self.currentResponse(null);\r\n      self.arrCoverSheets([]);\r\n      self.arrResponseDocs(null);\r\n      self.cntResponseDocs(0);\r\n      m_curResponseSelectedIsEditableByAO = false;\r\n\r\n      var oResponse = m_bigMap[\"response-\" + newValue];\r\n      if (oResponse) {\r\n        if (bOpenResponses)\r\n          self.filterResponseInfoTabResponseNameProcessed2(\"\");\r\n        else self.filterResponseInfoTabResponseNameOpen2(\"\");\r\n\r\n        self.currentResponse(oResponse);\r\n\r\n        LoadTabResponseInfoCoverSheets(oResponse);\r\n        LoadTabResponseInfoResponseDocs(oResponse);\r\n\r\n        if (bOpenResponses) m_curResponseSelectedIsEditableByAO = true;\r\n      }\r\n    };\r\n\r\n    self.responseDocFiles.subscribe(async function (files) {\r\n      if (!files.length) return;\r\n      const resId = self.currentResponse()?.ID;\r\n      if (!resId) return;\r\n      // const request = await getRequestByTitle(this.number);\r\n      const response = await appContext.AuditResponses.FindById(resId);\r\n\r\n      const promises = [];\r\n\r\n      for (let file of files) {\r\n        promises.push(\r\n          new Promise(async (resolve) => {\r\n            const newSheet = await uploadResponseDocFile(response, file);\r\n            resolve();\r\n          })\r\n        );\r\n      }\r\n\r\n      await Promise.all(promises);\r\n      // TODO: need to requery responsedocs\r\n      self.responseDocFiles.removeAll();\r\n      self.onNewResponseDocCallback();\r\n    });\r\n\r\n    /**Other**/\r\n    self.GetDDVals = function (fieldName, sortAsResponse) {\r\n      var types = ko.utils.arrayMap(self.arrResponses(), function (item) {\r\n        return item[fieldName];\r\n      });\r\n\r\n      var ddArr = ko.utils.arrayGetDistinctValues(types).sort();\r\n      if (sortAsResponse) ddArr.sort(Audit.Common.Utilities.SortResponseTitles);\r\n\r\n      if (ddArr[0] == \"\") ddArr.shift();\r\n\r\n      return ddArr;\r\n    };\r\n\r\n    self.GetDDVals2 = function (responseStatusType, sortAsResponse) {\r\n      var types = ko.utils.arrayMap(self.arrResponses(), function (item) {\r\n        var requestStatus = item.requestStatus;\r\n        var responseStatus = item.status;\r\n\r\n        if (responseStatusType == 0) {\r\n          //get the other responses\r\n          if (\r\n            responseStatus != m_responseStatus1 &&\r\n            responseStatus != m_responseStatus2\r\n          )\r\n            return item[\"title\"];\r\n          else return \"\";\r\n        } else if (responseStatusType == 1) {\r\n          //get responses pending action\r\n          if (\r\n            (responseStatus == m_responseStatus1 ||\r\n              responseStatus == m_responseStatus2) &&\r\n            (requestStatus == \"Open\" || requestStatus == \"ReOpened\")\r\n          )\r\n            return item[\"title\"];\r\n          else return \"\";\r\n        }\r\n      });\r\n\r\n      var ddArr = ko.utils.arrayGetDistinctValues(types).sort();\r\n      if (sortAsResponse) ddArr.sort(Audit.Common.Utilities.SortResponseTitles);\r\n\r\n      if (ddArr[0] == \"\") ddArr.shift();\r\n      return ddArr;\r\n    };\r\n  }\r\n\r\n  var _myViewModel = new ViewModel();\r\n  ko.applyBindings(_myViewModel);\r\n\r\n  LoadInfo();\r\n\r\n  function LoadInfo() {\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    const m_currentUser = web.get_currentUser();\r\n    currCtx.load(m_currentUser);\r\n\r\n    var requestList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetListTitleRequests());\r\n    var requestQuery = new SP.CamlQuery();\r\n    requestQuery.set_viewXml(\r\n      '<View><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy></Query></View>'\r\n    );\r\n    m_requestItems = requestList.getItems(requestQuery);\r\n    currCtx.load(\r\n      m_requestItems,\r\n      \"Include(ID, Title, ReqSubject, ReqStatus, InternalDueDate, ActionOffice, RelatedAudit, ActionItems, Comments, EmailSent, ClosedDate)\"\r\n    );\r\n\r\n    var responseList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n    var responseQuery = new SP.CamlQuery();\r\n    responseQuery.set_viewXml(\r\n      '<View Scope=\"RecursiveAll\"><Query><OrderBy><FieldRef Name=\"ReqNum\"/></OrderBy></Query></View>'\r\n    );\r\n    m_responseItems = responseList.getItems(responseQuery);\r\n    currCtx.load(\r\n      m_responseItems,\r\n      \"Include(ID, Title, ReqNum, ActionOffice, ReturnReason, SampleNumber, ResStatus, Comments, Modified, ClosedDate, ClosedBy, POC)\"\r\n    );\r\n\r\n    //make sure to only pull documents (fsobjtype = 0)\r\n    var responseDocsLib = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n    var responseDocsQuery = new SP.CamlQuery();\r\n    responseDocsQuery.set_viewXml(\r\n      '<View Scope=\"RecursiveAll\"><Query><Where><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">0</Value></Eq></Where></Query></View>'\r\n    );\r\n    m_ResponseDocsItems = responseDocsLib.getItems(responseDocsQuery);\r\n    currCtx.load(\r\n      m_ResponseDocsItems,\r\n      \"Include(ID, Title, ReqNum, ResID, DocumentStatus, ReceiptDate, FileLeafRef, FileDirRef, File_x0020_Size, Modified, Editor)\"\r\n    );\r\n\r\n    var aoList = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetListTitleActionOffices());\r\n    var aoQuery = new SP.CamlQuery();\r\n    aoQuery.set_viewXml(\r\n      '<View><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy></Query></View>'\r\n    );\r\n    m_aoItems = aoList.getItems(aoQuery);\r\n    currCtx.load(m_aoItems, \"Include(ID, Title, UserGroup)\");\r\n\r\n    //Library GUIDS\r\n    m_responseDocsLibrary = currCtx\r\n      .get_web()\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n    currCtx.load(m_responseDocsLibrary, \"Title\", \"Id\");\r\n\r\n    ownerGroup = web.get_associatedOwnerGroup();\r\n    memberGroup = web.get_associatedMemberGroup();\r\n    visitorGroup = web.get_associatedVisitorGroup();\r\n\r\n    currCtx.load(ownerGroup);\r\n    currCtx.load(memberGroup);\r\n    currCtx.load(visitorGroup);\r\n\r\n    //Site Users\r\n    m_groupColl = web.get_siteGroups();\r\n    currCtx.load(m_groupColl);\r\n\r\n    currCtx.executeQueryAsync(OnSuccess, OnFailure);\r\n    function OnSuccess(sender, args) {\r\n      $(\"#divRefresh\").show();\r\n      m_fnLoadData();\r\n    }\r\n    function OnFailure(sender, args) {\r\n      $(\"#divRefresh\").hide();\r\n      $(\"#divLoading\").hide();\r\n\r\n      const statusId = SP.UI.Status.addStatus(\r\n        \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n      );\r\n      SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n    }\r\n  }\r\n\r\n  function m_fnLoadData() {\r\n    Audit.Common.Utilities.LoadSiteGroups(m_groupColl);\r\n    LoadLibGUIDS();\r\n    Audit.Common.Utilities.LoadActionOffices(m_aoItems);\r\n\r\n    if (memberGroup != null) m_IA_SPGroupName = memberGroup.get_title();\r\n    if (m_IA_SPGroupName == null || m_IA_SPGroupName == \"\") {\r\n      const statusId = SP.UI.Status.addStatus(\r\n        \"Unable to retrieve the IA SharePoint Group. Please contact the Administrator\"\r\n      );\r\n      SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n      return;\r\n    }\r\n\r\n    m_IA_ActionOffice = Audit.Common.Utilities.GetActionOffices()?.find(\r\n      (ao) => ao.userGroup == m_IA_SPGroupName\r\n    );\r\n\r\n    LoadRequests();\r\n    LoadResponses();\r\n    LoadResponseDocs();\r\n\r\n    LoadTabStatusReport(m_arrResponses, \"fbody\");\r\n  }\r\n\r\n  function LoadLibGUIDS() {\r\n    Audit.Common.Utilities.SetResponseDocLibGUID(\r\n      m_responseDocsLibrary.get_id()\r\n    );\r\n  }\r\n\r\n  function LoadRequests() {\r\n    m_bigMap = new Object();\r\n    m_arrRequests = new Array();\r\n\r\n    var cnt = 0;\r\n    var listItemEnumerator = m_requestItems.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var emailSent = oListItem.get_item(\"EmailSent\");\r\n      if (!emailSent) continue;\r\n\r\n      var id = oListItem.get_item(\"ID\");\r\n      var number = oListItem.get_item(\"Title\");\r\n      var status = oListItem.get_item(\"ReqStatus\");\r\n\r\n      var subject = oListItem.get_item(\"ReqSubject\");\r\n      if (subject == null) subject = \"\";\r\n\r\n      var arrActionOffice = oListItem.get_item(\"ActionOffice\");\r\n      var actionOffice = \"\";\r\n      for (var x = 0; x < arrActionOffice.length; x++) {\r\n        actionOffice +=\r\n          \"<div>\" + arrActionOffice[x].get_lookupValue() + \"</div>\";\r\n      }\r\n\r\n      var comments = oListItem.get_item(\"Comments\");\r\n      var relatedAudit = oListItem.get_item(\"RelatedAudit\");\r\n      var actionItems = oListItem.get_item(\"ActionItems\");\r\n\r\n      if (comments == null) comments = \"\";\r\n      if (relatedAudit == null) relatedAudit = \"\";\r\n      if (actionItems == null) actionItems = \"\";\r\n\r\n      var internalDueDate = oListItem.get_item(\"InternalDueDate\");\r\n      var closedDate = oListItem.get_item(\"ClosedDate\");\r\n\r\n      internalDueDate != null\r\n        ? (internalDueDate = internalDueDate.format(\"MM/dd/yyyy\"))\r\n        : (internalDueDate = \"\");\r\n      closedDate != null\r\n        ? (closedDate = closedDate.format(\"MM/dd/yyyy\"))\r\n        : (closedDate = \"\");\r\n\r\n      var requestObject = new Object();\r\n      requestObject[\"ID\"] = id;\r\n      requestObject[\"number\"] = number;\r\n      requestObject[\"subject\"] = subject;\r\n      requestObject[\"status\"] = status;\r\n      requestObject[\"internalDueDate\"] = internalDueDate;\r\n      requestObject[\"actionOffice\"] = actionOffice;\r\n      requestObject[\"comments\"] = comments;\r\n      requestObject[\"relatedAudit\"] = relatedAudit;\r\n      requestObject[\"actionItems\"] = actionItems;\r\n      requestObject[\"emailSent\"] = emailSent;\r\n      requestObject[\"closedDate\"] = closedDate;\r\n      requestObject[\"responses\"] = new Array();\r\n\r\n      requestObject[\"arrIndex\"] = cnt;\r\n\r\n      m_arrRequests.push(requestObject);\r\n\r\n      m_bigMap[\"request-\" + number] = requestObject;\r\n      cnt++;\r\n    }\r\n  }\r\n\r\n  function LoadResponses() {\r\n    m_arrResponses = new Array();\r\n    var cnt = 0;\r\n\r\n    var listItemEnumerator = m_responseItems.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      var number = oListItem.get_item(\"ReqNum\");\r\n      if (number != null) {\r\n        number = number.get_lookupValue();\r\n\r\n        var responseObject = new Object();\r\n        responseObject[\"request\"] = m_bigMap[\"request-\" + number]; //GetRequest( number );\r\n        if (!responseObject.request || !responseObject.request.emailSent)\r\n          //if request is null, then there's probably a permission issue\r\n          continue;\r\n\r\n        responseObject[\"actionOffice\"] = oListItem.get_item(\"ActionOffice\");\r\n        if (responseObject[\"actionOffice\"] == null)\r\n          responseObject[\"actionOffice\"] = \"\";\r\n        else\r\n          responseObject[\"actionOffice\"] =\r\n            responseObject[\"actionOffice\"].get_lookupValue();\r\n        if (responseObject[\"actionOffice\"] == \"\") continue;\r\n\r\n        responseObject[\"poc\"] = oListItem.get_item(\"POC\");\r\n        if (responseObject[\"poc\"] == null) responseObject[\"poc\"] = \"\";\r\n        else responseObject[\"poc\"] = responseObject[\"poc\"].get_lookupValue();\r\n\r\n        responseObject[\"ID\"] = oListItem.get_item(\"ID\");\r\n        responseObject[\"number\"] = number;\r\n\r\n        var title = oListItem.get_item(\"Title\");\r\n        responseObject[\"title\"] = title;\r\n\r\n        responseObject[\"resStatus\"] = oListItem.get_item(\"ResStatus\");\r\n        if (\r\n          responseObject.request.status == \"Closed\" ||\r\n          responseObject.request.status == \"Canceled\"\r\n        )\r\n          //make it appear that it's closed so that it doesnt confuse AO\r\n          responseObject[\"resStatus\"] = \"7-Closed\";\r\n\r\n        var modifiedDate = oListItem.get_item(\"Modified\");\r\n        var closedDate = oListItem.get_item(\"ClosedDate\");\r\n\r\n        modifiedDate != null\r\n          ? (modifiedDate = modifiedDate.format(\"MM/dd/yyyy hh:mm tt\"))\r\n          : (modifiedDate = \"\");\r\n        closedDate != null\r\n          ? (closedDate = closedDate.format(\"MM/dd/yyyy\"))\r\n          : (closedDate = \"\");\r\n\r\n        responseObject[\"modified\"] = modifiedDate;\r\n        responseObject[\"closedDate\"] = closedDate;\r\n        responseObject[\"closedBy\"] =\r\n          Audit.Common.Utilities.GetFriendlyDisplayName(oListItem, \"ClosedBy\");\r\n\r\n        responseObject[\"sample\"] = oListItem.get_item(\"SampleNumber\");\r\n        if (responseObject[\"sample\"] == null) responseObject[\"sample\"] = \"\";\r\n\r\n        var comments = oListItem.get_item(\"Comments\");\r\n        if (comments == null) comments = \"\";\r\n        responseObject[\"comments\"] = comments;\r\n\r\n        var returnReason = oListItem.get_item(\"ReturnReason\");\r\n        if (returnReason == null) returnReason = \"\";\r\n        responseObject[\"returnReason\"] = returnReason;\r\n\r\n        responseObject[\"responseDocs\"] = new Array();\r\n        responseObject[\"coversheets\"] = new Array();\r\n\r\n        responseObject[\"arrIndex\"] = cnt;\r\n        m_arrResponses.push(responseObject);\r\n\r\n        m_bigMap[\"response-\" + title] = responseObject;\r\n        cnt++;\r\n      }\r\n    }\r\n  }\r\n\r\n  function LoadResponseDocs() {\r\n    var listItemEnumerator = m_ResponseDocsItems.getEnumerator();\r\n    while (listItemEnumerator.moveNext()) {\r\n      var oListItem = listItemEnumerator.get_current();\r\n\r\n      const responseDocID = oListItem.get_item(\"ID\");\r\n\r\n      var requestNumber = oListItem.get_item(\"ReqNum\");\r\n      if (requestNumber != null)\r\n        requestNumber = requestNumber.get_lookupValue();\r\n\r\n      var responseID = oListItem.get_item(\"ResID\");\r\n      if (responseID != null) responseID = responseID.get_lookupValue();\r\n\r\n      if (requestNumber == null || responseID == null) continue;\r\n\r\n      if (oListItem.get_item(\"DocumentStatus\") == \"Marked for Deletion\") {\r\n        //ao can mark a document for deletion, but their permissions do not have delete. IA will have to delete\r\n        //do  nothing\r\n      } else {\r\n        try {\r\n          var bigMapItem = m_bigMap[\"response-\" + responseID];\r\n\r\n          var indexOfArrResponses = bigMapItem.arrIndex;\r\n          var oResponse = m_arrResponses[indexOfArrResponses];\r\n          if (oResponse) {\r\n            var responseDocObject = new Object();\r\n            responseDocObject[\"ID\"] = oListItem.get_item(\"ID\");\r\n            responseDocObject[\"title\"] = oListItem.get_item(\"Title\");\r\n            if (responseDocObject[\"title\"] == null)\r\n              responseDocObject[\"title\"] = \"\";\r\n            responseDocObject[\"fileName\"] = oListItem.get_item(\"FileLeafRef\");\r\n            responseDocObject[\"folder\"] = oListItem.get_item(\"FileDirRef\");\r\n            responseDocObject[\"documentStatus\"] =\r\n              oListItem.get_item(\"DocumentStatus\");\r\n\r\n            var fileSize = oListItem.get_item(\"File_x0020_Size\");\r\n            fileSize = Audit.Common.Utilities.GetFriendlyFileSize(fileSize);\r\n            responseDocObject[\"fileSize\"] = fileSize;\r\n\r\n            var receiptDate = \"\";\r\n            if (\r\n              oListItem.get_item(\"ReceiptDate\") != null &&\r\n              oListItem.get_item(\"ReceiptDate\") != \"\"\r\n            )\r\n              receiptDate = oListItem\r\n                .get_item(\"ReceiptDate\")\r\n                .format(\"MM/dd/yyyy\");\r\n            responseDocObject[\"receiptDate\"] = receiptDate;\r\n\r\n            var modifiedDate = \"\";\r\n            if (\r\n              oListItem.get_item(\"Modified\") != null &&\r\n              oListItem.get_item(\"Modified\") != \"\"\r\n            )\r\n              modifiedDate = oListItem\r\n                .get_item(\"Modified\")\r\n                .format(\"MM/dd/yyyy hh:mm tt\");\r\n            responseDocObject[\"modifiedDate\"] = modifiedDate;\r\n\r\n            responseDocObject[\"modifiedBy\"] =\r\n              Audit.Common.Utilities.GetFriendlyDisplayName(\r\n                oListItem,\r\n                \"Editor\"\r\n              );\r\n\r\n            oResponse[\"responseDocs\"].push(responseDocObject);\r\n          }\r\n        } catch (err) {}\r\n      }\r\n    }\r\n  }\r\n\r\n  function LoadTabStatusReport(arr, fbody) {\r\n    if (arr == null) return;\r\n\r\n    //var bLoadTest = GetUrlKeyValue(\"LoadTest\");\r\n\r\n    var responseArr = new Array();\r\n\r\n    var arrResponseTitle = new Array();\r\n    var arrResponseInternalDueDate = new Array();\r\n    var arrResponseStatus = new Array();\r\n\r\n    var count = 0;\r\n    var resStatus1 = 0;\r\n    var resStatus2 = 0;\r\n\r\n    var arrlength = arr.length;\r\n    while (arrlength--) {\r\n      var oResponse = arr[arrlength];\r\n\r\n      var responseTitle = oResponse.title;\r\n\r\n      var highlight = false;\r\n      var responseStatus = oResponse.resStatus;\r\n      if (\r\n        responseStatus == m_responseStatus1 ||\r\n        responseStatus == m_responseStatus2\r\n      ) {\r\n        count++;\r\n        if (responseStatus == m_responseStatus1) resStatus1++;\r\n        else resStatus2++;\r\n\r\n        highlight = true;\r\n      }\r\n\r\n      var aResponse = {\r\n        title: responseTitle,\r\n        requestSubject: oResponse.request.subject,\r\n        requestStatus: oResponse.request.status,\r\n        internalDueDate: oResponse.request.internalDueDate,\r\n        status: responseStatus,\r\n        docCount: oResponse.responseDocs.length,\r\n        modified: oResponse.modified,\r\n        highlight: highlight,\r\n        visibleRow: ko.observable(true),\r\n      };\r\n\r\n      responseArr.push(aResponse);\r\n\r\n      /*if( bLoadTest )\r\n\t\t\t{\r\n\t\t\t\tfor( var z = 0; z < 99; z++ )\r\n\t\t\t\t{\r\n\t\t\t\t\tresponseArr.push( aResponse );\r\n\t\t\t\t}\t\r\n\t\t\t}*/\r\n    }\r\n\r\n    //if( bLoadTest )\r\n    //\t_myViewModel.debugMode( true );\r\n\r\n    if (responseArr.length > 0) {\r\n      m_statusToFilterOn = \"\";\r\n      if (resStatus1 > 0 && resStatus2 == 0)\r\n        m_statusToFilterOn = m_responseStatus1;\r\n      else if (resStatus2 > 0 && resStatus1 == 0)\r\n        m_statusToFilterOn = m_responseStatus2;\r\n\r\n      _myViewModel.cntPendingReview(count);\r\n      // $(\"#tabs\").tabs(); //.show();\r\n\r\n      ko.utils.arrayPushAll(_myViewModel.arrResponses, responseArr);\r\n\r\n      //do this after push all because this takes some time\r\n      // var output = $(\"#responseTemplate\").render(responseArr);\r\n      // $(\"#\" + fbody).html(output);\r\n    }\r\n\r\n    //aleways calls this even if 0 responses\r\n    _myViewModel.doSort(true);\r\n  }\r\n\r\n  function LoadTabResponseInfoCoverSheets(oResponse) {\r\n    _myViewModel.arrCoverSheets([]);\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    var coverSheetLib = web\r\n      .get_lists()\r\n      .getByTitle(Audit.Common.Utilities.GetLibTitleCoverSheets());\r\n    var coverSheetQuery = new SP.CamlQuery();\r\n    coverSheetQuery.set_viewXml(\r\n      '<View Scope=\"RecursiveAll\"><Query><OrderBy><FieldRef Name=\"Title\"/></OrderBy><Where><Eq><FieldRef Name=\"ReqNum\"/><Value Type=\"Text\">' +\r\n        oResponse.request.number +\r\n        \"</Value></Eq></Where></Query></View>\"\r\n    );\r\n    const m_subsetCoverSheetItems = coverSheetLib.getItems(coverSheetQuery);\r\n    currCtx.load(\r\n      m_subsetCoverSheetItems,\r\n      \"Include(ID, Title, ReqNum, ActionOffice, FileLeafRef, FileDirRef)\"\r\n    );\r\n\r\n    var data = { oResponse: oResponse };\r\n    function OnSuccess(sender, args) {\r\n      var arrCS = new Array();\r\n\r\n      var listItemEnumerator = m_subsetCoverSheetItems.getEnumerator();\r\n      while (listItemEnumerator.moveNext()) {\r\n        var oListItem = listItemEnumerator.get_current();\r\n\r\n        if (oListItem.get_item(\"ActionOffice\") != null) {\r\n          var arrActionOffice = oListItem.get_item(\"ActionOffice\");\r\n          if (arrActionOffice.length > 0) {\r\n            for (var y = 0; y < arrActionOffice.length; y++) {\r\n              var curActionOffice = arrActionOffice[y].get_lookupValue();\r\n\r\n              if (curActionOffice == this.oResponse.actionOffice) {\r\n                var csFolder = oListItem.get_item(\"FileDirRef\");\r\n                var csTitle = oListItem.get_item(\"FileLeafRef\");\r\n\r\n                var encodedTitle = csTitle.replace(/'/g, \"&#39\");\r\n                arrCS.push({\r\n                  folder: csFolder,\r\n                  title: csTitle,\r\n                  link:\r\n                    \"STSNavigate('../_layouts/download.aspx?SourceUrl=\" +\r\n                    csFolder +\r\n                    \"/\" +\r\n                    encodedTitle +\r\n                    \"')\",\r\n                });\r\n\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      ko.utils.arrayPushAll(_myViewModel.arrCoverSheets(), arrCS);\r\n      _myViewModel.arrCoverSheets.valueHasMutated();\r\n    }\r\n    function OnFailure(sender, args) {}\r\n\r\n    currCtx.executeQueryAsync(\r\n      Function.createDelegate(data, OnSuccess),\r\n      Function.createDelegate(data, OnFailure)\r\n    );\r\n  }\r\n\r\n  function LoadTabResponseInfoResponseDocs(oResponse) {\r\n    _myViewModel.arrResponseDocs(null);\r\n    _myViewModel.cntResponseDocs(0);\r\n    _myViewModel.showUpload(false);\r\n    _myViewModel.showSubmit(false);\r\n\r\n    var currCtx = new SP.ClientContext.get_current();\r\n    var web = currCtx.get_web();\r\n\r\n    for (var z = 0; z < oResponse.responseDocs.length; z++) {\r\n      var oResponseDoc = oResponse.responseDocs[z];\r\n\r\n      //this loads on execute\r\n      oResponseDoc[\"docIcon\"] = web.mapToIcon(\r\n        oResponseDoc.fileName,\r\n        \"\",\r\n        SP.Utilities.IconSize.Size16\r\n      ); // m_siteUrl + \"/\" + _spPageContextInfo.layoutsUrl + \"/images/\" + docIcon;\r\n    }\r\n\r\n    function OnSuccess(sender, args) {\r\n      RenderResponses(oResponse);\r\n    }\r\n    function OnFailure(sender, args) {\r\n      const statusId = SP.UI.Status.addStatus(\r\n        \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n      );\r\n      SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n    }\r\n    currCtx.executeQueryAsync(OnSuccess, OnFailure);\r\n\r\n    function RenderResponses(oResponse) {\r\n      var rowCount = 0;\r\n      var cntAddedByAO = 0;\r\n\r\n      var arrResponseDocs = new Array();\r\n      for (var z = 0; z < oResponse.responseDocs.length; z++) {\r\n        var oResponseDoc = oResponse.responseDocs[z];\r\n        oResponseDoc.docIcon = oResponseDoc.docIcon.get_value();\r\n        oResponseDoc.styleTag = Audit.Common.Utilities.GetResponseDocStyleTag2(\r\n          oResponseDoc.documentStatus\r\n        );\r\n        oResponseDoc.responseTitle = oResponse.title;\r\n\r\n        if (\r\n          oResponseDoc.documentStatus == \"Open\" &&\r\n          (oResponse.resStatus == m_responseStatus1 ||\r\n            oResponse.resStatus == m_responseStatus2)\r\n        )\r\n          cntAddedByAO++;\r\n\r\n        arrResponseDocs.push(oResponseDoc);\r\n      }\r\n\r\n      if (m_curResponseSelectedIsEditableByAO) {\r\n        _myViewModel.showUpload(true);\r\n        if (cntAddedByAO > 0) _myViewModel.showSubmit(true);\r\n      }\r\n\r\n      var arrResponseSummary = {\r\n        responseTitle: oResponse.title,\r\n        responseDocs: arrResponseDocs,\r\n        responseStatus: oResponse.resStatus,\r\n      };\r\n      _myViewModel.arrResponseDocs(arrResponseSummary);\r\n      _myViewModel.arrResponseDocs.valueHasMutated();\r\n      _myViewModel.cntResponseDocs(oResponse.responseDocs.length);\r\n\r\n      //display warning message\r\n      if (\r\n        oResponse.resStatus == m_responseStatus2 &&\r\n        oResponse.returnReason != null &&\r\n        oResponse.returnReason != \"\"\r\n      ) {\r\n        if (m_curResponseSelectedIsEditableByAO && cntAddedByAO == 0) {\r\n          //notifyId = SP.UI.Notify.addNotification(\"Response Return Reason: \" + oResponse.returnReason, false);\r\n          var waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n            \"Notice - Response Needs to be Updated\",\r\n            \"<span style=''><span class='ui-icon ui-icon-alert'></span>Response Return Reason: <span style='font-weight:bold; color:red;'>\" +\r\n              oResponse.returnReason +\r\n              \"</span></span>\",\r\n            100,\r\n            500\r\n          );\r\n          setTimeout(function () {\r\n            waitDialog.close();\r\n          }, 5000);\r\n        }\r\n      }\r\n\r\n      if (\r\n        oResponse.resStatus == \"1-Open\" ||\r\n        oResponse.resStatus == \"3-Returned to Action Office\"\r\n      ) {\r\n        if (m_curResponseSelectedIsEditableByAO && cntAddedByAO > 0) {\r\n          const notifyId = SP.UI.Notify.addNotification(\r\n            \"<div style='text-align:left'>Response documents have been added. <br/><br/>Your package <span style='font-weight:bold; color:red'>has not yet been submitted</span>. <br></br>Please review your documents and click on the link <b>SUBMIT this Response Package</b> below</div>\",\r\n            false\r\n          );\r\n\r\n          $(\".btnSubmitPackage\")\r\n            .parent()\r\n            .css({ \"background-color\": \"yellow\", \"font-weight\": \"inherit\" });\r\n          $(\".btnSubmitPackage\").get(0).scrollIntoView();\r\n\r\n          function resetColor() {\r\n            $(\".btnSubmitPackage\")\r\n              .parent()\r\n              .css({ \"background-color\": \"inherit\", \"font-weight\": \"inherit\" });\r\n          }\r\n          setTimeout(function () {\r\n            resetColor();\r\n          }, 2000);\r\n        } else if (m_curResponseSelectedIsEditableByAO && cntAddedByAO == 0) {\r\n          const notifyId = SP.UI.Notify.addNotification(\r\n            \"<div style='text-align:left'>Please review the Response Information and any CoverSheets/Supplemental Documents. <br/><br/>Then, click the link to <span style='font-weight:bold; color:gree'>Upload Response Documents</span> pertaining to this Response</div>\",\r\n            false\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function m_fnFormatEmailBodyToIAFromAO(oRequest, responseTitle) {\r\n    var emailText =\r\n      \"<div>Audit Request Reference: <b>{REQUEST_NUMBER}</b></div>\" +\r\n      \"<div>Audit Request Subject: <b>{REQUEST_SUBJECT}</b></div>\" +\r\n      \"<div>Audit Request Due Date: <b>{REQUEST_DUEDATE}</b></div><br/>\" +\r\n      \"<div>Below is the Response that was submitted: </div>\" +\r\n      \"<div>{RESPONSE_TITLE}</div>\";\r\n\r\n    emailText = emailText.replace(\"{REQUEST_NUMBER}\", oRequest.number);\r\n    emailText = emailText.replace(\"{REQUEST_SUBJECT}\", oRequest.subject);\r\n    emailText = emailText.replace(\r\n      \"{REQUEST_DUEDATE}\",\r\n      oRequest.internalDueDate\r\n    );\r\n\r\n    var responseTitleBody = \"<ul><li>\" + responseTitle + \"</li></ul>\";\r\n    emailText = emailText.replace(\"{RESPONSE_TITLE}\", responseTitleBody);\r\n\r\n    return emailText;\r\n  }\r\n\r\n  function m_fnUploadResponseDoc(requestID, responseID) {\r\n    m_bIsTransactionExecuting = true;\r\n\r\n    //\t\tnotifyId = SP.UI.Notify.addNotification(\"<span style='font-size:11pt'><span class='ui-icon ui-icon-info'></span>Please <span style='font-weight:bold; color:green'>zip</span> the documents you are uploading.</span>\", false);\r\n    var waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n      \"Loading...\",\r\n      \"<span style='font-size:11pt'><span class='ui-icon ui-icon-info'></span>If you are uploading <span style='font-weight:bold; color:green;text-decoration:underline'>multiple</span> documents, please <span style='font-weight:bold; color:green;text-decoration:underline'>zip </span> them.</span>\",\r\n      100,\r\n      600\r\n    );\r\n\r\n    setTimeout(function () {\r\n      waitDialog.close();\r\n\r\n      var options = SP.UI.$create_DialogOptions();\r\n      options.title = \"Upload Response Document to: \" + responseID;\r\n      options.dialogReturnValueCallback = OnCallbackForm;\r\n\r\n      //this subfolder should have been created when the response was created\r\n      var rootFolder =\r\n        Audit.Common.Utilities.GetSiteUrl() +\r\n        \"/\" +\r\n        Audit.Common.Utilities.GetLibNameResponseDocs() +\r\n        \"/\" +\r\n        responseID;\r\n      options.url =\r\n        Audit.Common.Utilities.GetSiteUrl() +\r\n        \"/_layouts/Upload.aspx?List={\" +\r\n        Audit.Common.Utilities.GetResponseDocLibGUID() +\r\n        \"}&RootFolder=\" +\r\n        rootFolder +\r\n        \"&ReqNum=\" +\r\n        requestID +\r\n        \"&ResID=\" +\r\n        responseID;\r\n      //notifyId = SP.UI.Notify.addNotification(\"Uploading documents to: \" + options.url, false)\r\n      SP.UI.ModalDialog.showModalDialog(options);\r\n    }, 3000);\r\n  }\r\n\r\n  function OnCallbackForm(result, value) {\r\n    if (result === SP.UI.DialogResult.OK) {\r\n      Audit.Common.Utilities.Refresh();\r\n    } else m_bIsTransactionExecuting = false;\r\n  }\r\n\r\n  function m_fnSubmitPackage() {\r\n    var responseToSubmit = $(\"#ddlResponsesOpen\").val();\r\n    if (\r\n      confirm(\r\n        \"Are you sure you would like to submit these response documents? Note: You will NOT be able to make changes or upload any more documents after you submit this package.\"\r\n      )\r\n    ) {\r\n      m_bIsTransactionExecuting = true;\r\n\r\n      const m_waitDialog = SP.UI.ModalDialog.showWaitScreenWithNoClose(\r\n        \"Submitting Response\",\r\n        \"Please wait... Submitting Response\",\r\n        200,\r\n        400\r\n      );\r\n\r\n      var currCtx = new SP.ClientContext.get_current();\r\n      var web = currCtx.get_web();\r\n\r\n      var folderPath =\r\n        Audit.Common.Utilities.GetSiteUrl() +\r\n        \"/\" +\r\n        Audit.Common.Utilities.GetLibNameResponseDocs() +\r\n        \"/\" +\r\n        responseToSubmit;\r\n      var responseDocLib = web\r\n        .get_lists()\r\n        .getByTitle(Audit.Common.Utilities.GetLibTitleResponseDocs());\r\n      var responseDocQuery = new SP.CamlQuery();\r\n      responseDocQuery.set_viewXml(\r\n        \"<View Scope=\\\"RecursiveAll\\\"><Query><Where><And><Eq><FieldRef Name='FileDirRef'/><Value Type='Text'>\" +\r\n          folderPath +\r\n          \"</Value></Eq><Eq><FieldRef Name='DocumentStatus'/><Value Type='Text'>Open</Value></Eq></And></Where></Query></View>\"\r\n      );\r\n      const responseDocOpenItems = responseDocLib.getItems(responseDocQuery);\r\n      currCtx.load(\r\n        responseDocOpenItems,\r\n        \"Include(ID, DocumentStatus, FileDirRef)\"\r\n      );\r\n\r\n      var emailList = web\r\n        .get_lists()\r\n        .getByTitle(Audit.Common.Utilities.GetListTitleEmailHistory());\r\n      var emailListQuery = new SP.CamlQuery();\r\n      emailListQuery.set_viewXml(\r\n        '<View><Query><OrderBy><FieldRef Name=\"ID\"/></OrderBy><Where><Eq><FieldRef Name=\"FSObjType\"/><Value Type=\"Text\">1</Value></Eq></Where></Query></View>'\r\n      );\r\n      const emailListFolderItems = emailList.getItems(emailListQuery);\r\n      currCtx.load(emailListFolderItems, \"Include(ID, Title, DisplayName)\");\r\n\r\n      function OnSuccessLoadedResponseDocs(sender, args) {\r\n        var ctOpenResponseDocs = 0;\r\n        if (responseDocOpenItems != null) {\r\n          var listItemEnumerator = responseDocOpenItems.getEnumerator();\r\n          while (listItemEnumerator.moveNext()) {\r\n            var oListItem = listItemEnumerator.get_current();\r\n            oListItem.set_item(\"DocumentStatus\", \"Submitted\");\r\n            oListItem.update();\r\n            ctOpenResponseDocs++;\r\n          }\r\n        }\r\n\r\n        if (ctOpenResponseDocs == 0) {\r\n          const notifyId = SP.UI.Notify.addNotification(\r\n            \"Please upload a Response document.\",\r\n            false\r\n          );\r\n          m_waitDialog.close();\r\n          return;\r\n        }\r\n\r\n        var oRequest = null;\r\n        try {\r\n          var bigMapItem = m_bigMap[\"response-\" + responseToSubmit];\r\n          var indexOfArrResponses = bigMapItem.arrIndex;\r\n          const oResponse = m_arrResponses[indexOfArrResponses];\r\n          if (oResponse) {\r\n            oRequest = oResponse.request;\r\n\r\n            var responseList = currCtx\r\n              .get_web()\r\n              .get_lists()\r\n              .getByTitle(Audit.Common.Utilities.GetListTitleResponses());\r\n            const responseItem = responseList.getItemById(oResponse.ID);\r\n            responseItem.set_item(\"ResStatus\", \"2-Submitted\");\r\n            responseItem.update();\r\n          }\r\n        } catch (err) {\r\n          alert(err);\r\n          Audit.Common.Utilities.Refresh();\r\n        }\r\n\r\n        if (oRequest == null) {\r\n          m_waitDialog.close();\r\n          return;\r\n        }\r\n\r\n        var emailSubject =\r\n          \"A Response has been Submitted by an Action Office: \" +\r\n          oRequest.number;\r\n        var emailText = m_fnFormatEmailBodyToIAFromAO(\r\n          oRequest,\r\n          responseToSubmit\r\n        );\r\n\r\n        var itemCreateInfo = new SP.ListItemCreationInformation();\r\n        itemCreateInfo.set_folderUrl(\r\n          location.protocol +\r\n            \"//\" +\r\n            location.host +\r\n            Audit.Common.Utilities.GetSiteUrl() +\r\n            \"/Lists/\" +\r\n            Audit.Common.Utilities.GetListNameEmailHistory() +\r\n            \"/\" +\r\n            oRequest.number\r\n        );\r\n        oListItem = emailList.addItem(itemCreateInfo);\r\n        oListItem.set_item(\"Title\", emailSubject);\r\n        oListItem.set_item(\"Body\", emailText);\r\n        oListItem.set_item(\"To\", m_IA_ActionOffice.title);\r\n        oListItem.set_item(\"ReqNum\", oRequest.number);\r\n        oListItem.set_item(\"ResID\", responseToSubmit);\r\n        oListItem.set_item(\"NotificationType\", \"IA Notification\");\r\n        oListItem.update();\r\n\r\n        function OnSuccessUpdateResponse(sender, args) {\r\n          document.body.style.cursor = \"default\";\r\n          m_waitDialog.close();\r\n          Audit.Common.Utilities.Refresh();\r\n        }\r\n        function OnFailureUpdateResponse(sender, args) {\r\n          m_waitDialog.close();\r\n          const statusId = SP.UI.Status.addStatus(\r\n            \"Request failed: \" +\r\n              args.get_message() +\r\n              \"\\n\" +\r\n              args.get_stackTrace()\r\n          );\r\n          SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n        }\r\n\r\n        currCtx.executeQueryAsync(\r\n          OnSuccessUpdateResponse,\r\n          OnFailureUpdateResponse\r\n        );\r\n      }\r\n\r\n      function OnFailureLoadedResponseDocs(sender, args) {\r\n        m_waitDialog.close();\r\n        const statusId = SP.UI.Status.addStatus(\r\n          \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n        );\r\n        SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n      }\r\n\r\n      currCtx.executeQueryAsync(\r\n        OnSuccessLoadedResponseDocs,\r\n        OnFailureLoadedResponseDocs\r\n      );\r\n    }\r\n  }\r\n\r\n  function m_fnMarkForDeletionResponseDoc(itemID) {\r\n    if (\r\n      confirm(\"Are you sure you would like to Delete this Response Document?\")\r\n    ) {\r\n      var currCtx = new SP.ClientContext();\r\n      var responseDocsLib = currCtx\r\n        .get_web()\r\n        .get_lists()\r\n        .getByTitle(Audit.Common.Utilities.GetLibNameResponseDocs());\r\n\r\n      const oListItem = responseDocsLib.getItemById(itemID);\r\n      oListItem.set_item(\"DocumentStatus\", \"Marked for Deletion\");\r\n      oListItem.update();\r\n\r\n      function OnSuccess(sender, args) {\r\n        Audit.Common.Utilities.Refresh();\r\n      }\r\n      function OnFailure(sender, args) {\r\n        const statusId = SP.UI.Status.addStatus(\r\n          \"Request failed: \" + args.get_message() + \"\\n\" + args.get_stackTrace()\r\n        );\r\n        SP.UI.Status.setStatusPriColor(statusId, \"red\");\r\n      }\r\n      currCtx.executeQueryAsync(OnSuccess, OnFailure);\r\n    }\r\n  }\r\n\r\n  function BindHandlersOnLoad() {\r\n    BindPrintButton(\r\n      \"#btnPrint1\",\r\n      \"#divStatusReportRespones\",\r\n      \"Action Office Response Status Report\"\r\n    );\r\n    //////////Note: for the export to work, make sure this is added to the html: <iframe id=\"CsvExpFrame\" style=\"display: none\"></iframe>\r\n    BindExportButton(\r\n      \".export1\",\r\n      \"AOResponseStatusReport_\",\r\n      \"tblStatusReportResponses\"\r\n    );\r\n  }\r\n\r\n  function BindPrintButton(btnPrint, divTbl, pageTitle) {\r\n    $(btnPrint).on(\"click\", function () {\r\n      Audit.Common.Utilities.PrintStatusReport(pageTitle, divTbl);\r\n    });\r\n  }\r\n\r\n  function BindExportButton(btnExport, fileNamePrefix, tbl) {\r\n    $(btnExport).on(\"click\", function (event) {\r\n      var curDate = new Date().format(\"yyyyMMdd_hhmmtt\");\r\n      Audit.Common.Utilities.ExportToCsv(fileNamePrefix + curDate, tbl);\r\n    });\r\n  }\r\n\r\n  function GoToResponse(response) {\r\n    //$(\"#tabs\").tabs({ active: 1 });\r\n    _myViewModel.tabs.selectById(_myViewModel.tabOpts.ResponseDetail.id);\r\n\r\n    if (response) {\r\n      response = m_bigMap[\"response-\" + response];\r\n\r\n      var requestStatus = response.request.status;\r\n      var responseStatus = response.resStatus;\r\n      if (\r\n        (responseStatus == m_responseStatus1 ||\r\n          responseStatus == m_responseStatus2) &&\r\n        (requestStatus == \"Open\" || requestStatus == \"ReOpened\")\r\n      )\r\n        _myViewModel.filterResponseInfoTabResponseNameOpen2(response.title);\r\n      else\r\n        _myViewModel.filterResponseInfoTabResponseNameProcessed2(\r\n          response.title\r\n        );\r\n    }\r\n  }\r\n\r\n  var publicMembers = {\r\n    GoToResponse: GoToResponse,\r\n    IsTransactionExecuting: function () {\r\n      return m_bIsTransactionExecuting;\r\n    },\r\n  };\r\n\r\n  return publicMembers;\r\n};\r\n\r\nif (document.readyState === \"ready\" || document.readyState === \"complete\") {\r\n  InitReport();\r\n} else {\r\n  document.onreadystatechange = () => {\r\n    if (document.readyState === \"complete\" || document.readyState === \"ready\") {\r\n      ExecuteOrDelayUntilScriptLoaded(function () {\r\n        SP.SOD.executeFunc(\"sp.js\", \"SP.ClientContext\", InitReport);\r\n      }, \"sp.js\");\r\n    }\r\n  };\r\n}\r\n\r\nfunction InitReport() {\r\n  document.getElementById(\"app\").innerHTML = aoDbTemplate;\r\n  Audit.AOReport.Report = new Audit.AOReport.NewReportPage();\r\n  Audit.AOReport.Init();\r\n}\r\n", "import {\r\n  breakRequestPermissions,\r\n  getRequestById,\r\n  getRequestResponseDocs,\r\n  getRequestResponses,\r\n  breakRequestCoversheetPerms,\r\n  getNewResponseDocTitle,\r\n  ensureRequestAuditResponseDocsROFolder,\r\n  ensureRequestROEmailLogItem,\r\n} from \"./index.js\";\r\n\r\nimport {\r\n  AuditResponseDoc,\r\n  AuditResponseStates,\r\n  AuditResponseDocStates,\r\n  AuditResponseDocRO,\r\n} from \"../entities/index.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\n\r\nexport async function approveResponseDocsForQA(\r\n  requestId,\r\n  responseId = null,\r\n  responseDocsToApproveIds\r\n) {\r\n  const request = await getRequestById(requestId);\r\n\r\n  const allRequestResponseDocs = await getRequestResponseDocs(request);\r\n\r\n  const allRequestResponses = await getRequestResponses(request);\r\n\r\n  const updatedResponses = allRequestResponseDocs\r\n    .filter((responseDoc) => responseDocsToApproveIds.includes(responseDoc.ID))\r\n    .map((responseDoc) => responseDoc.ResID.Value())\r\n    .reduce((accumulator, responseDocResponse) => {\r\n      if (\r\n        !accumulator.find((response) => response?.ID == responseDocResponse.ID)\r\n      )\r\n        accumulator.push(responseDocResponse);\r\n      return accumulator;\r\n    }, []);\r\n\r\n  await Promise.all(\r\n    responseDocsToApproveIds.map(async (responseDocId) => {\r\n      const responseDoc = allRequestResponseDocs.find(\r\n        (responseDoc) => responseDoc.ID == responseDocId\r\n      );\r\n\r\n      // TODO: this should just be an ensure on our AppDbContext\r\n      const response = allRequestResponses.find(\r\n        (response) => response.ID == responseDoc.ResID.Value().ID\r\n      );\r\n\r\n      if (\r\n        responseDoc.DocumentStatus.Value() != AuditResponseDocStates.Submitted\r\n      ) {\r\n        console.error(\"Document status is not valid for approval\");\r\n        return;\r\n      }\r\n\r\n      responseDoc.DocumentStatus.Value(AuditResponseDocStates.SentToQA);\r\n\r\n      // TODO: Fix naming conflicting with drag and drop upload\r\n\r\n      const newReponseDocName = getNewResponseDocTitle(\r\n        request,\r\n        response,\r\n        responseDoc\r\n      );\r\n\r\n      responseDoc.FileName.Value(newReponseDocName);\r\n\r\n      await appContext.AuditResponseDocs.UpdateEntity(\r\n        responseDoc,\r\n        AuditResponseDoc.Views.UpdateDocStatus\r\n      );\r\n    })\r\n  );\r\n\r\n  // Now see if we can approve any responses for QA\r\n  const responsesToSubmitToQA = updatedResponses.filter((response) => {\r\n    return response.ResStatus.Value() == AuditResponseStates.Submitted;\r\n  });\r\n\r\n  if (responsesToSubmitToQA.length) {\r\n    await Promise.all(\r\n      responsesToSubmitToQA.map(async (response) => {\r\n        response.ResStatus.Value(AuditResponseStates.ApprovedForQA);\r\n        await appContext.AuditResponses.UpdateEntity(response, [\"ResStatus\"]);\r\n      })\r\n    );\r\n\r\n    // Break the request permissions\r\n    await breakRequestPermissions(request, AuditResponseStates.ApprovedForQA);\r\n    await breakRequestCoversheetPerms(request, true);\r\n  }\r\n}\r\n\r\nexport async function approveResponseDocsForRO(\r\n  requestId,\r\n  responseDocsToApproveIds\r\n) {\r\n  const request = await getRequestById(requestId);\r\n\r\n  const requestingOffice = request.RequestingOffice.Value();\r\n\r\n  if (!requestingOffice) return;\r\n\r\n  const allRequestResponseDocs = await getRequestResponseDocs(request);\r\n\r\n  const allRequestResponses = await getRequestResponses(request);\r\n\r\n  const updatedResponses = allRequestResponseDocs\r\n    .filter((responseDoc) => responseDocsToApproveIds.includes(responseDoc.ID))\r\n    .map((responseDoc) => responseDoc.ResID.Value())\r\n    .reduce((accumulator, responseDocResponse) => {\r\n      if (\r\n        !accumulator.find((response) => response?.ID == responseDocResponse.ID)\r\n      )\r\n        accumulator.push(responseDocResponse);\r\n      return accumulator;\r\n    }, []);\r\n\r\n  if (!updatedResponses.length) return;\r\n\r\n  const roResponseDocROFolderPath =\r\n    await ensureRequestAuditResponseDocsROFolder(\r\n      request.Title,\r\n      requestingOffice.ID\r\n    );\r\n\r\n  const roEmailLogItem = await ensureRequestROEmailLogItem(requestingOffice);\r\n\r\n  let cntApprovedResponseDocs = parseInt(roEmailLogItem.ResponseCount);\r\n  if (!cntApprovedResponseDocs) cntApprovedResponseDocs = 0;\r\n  let responseLogBody = \"\";\r\n\r\n  // For each response doc to approve\r\n  await Promise.all(\r\n    responseDocsToApproveIds.map(async (responseDocId) => {\r\n      const responseDoc = allRequestResponseDocs.find(\r\n        (responseDoc) => responseDoc.ID == responseDocId\r\n      );\r\n\r\n      // 1. Check that the status isn't already approved\r\n      if (responseDoc.DocumentStatus.Value() == AuditResponseDocStates.SentToQA)\r\n        return;\r\n\r\n      cntApprovedResponseDocs++;\r\n\r\n      const response = allRequestResponses.find(\r\n        (response) => response.ID == responseDoc.ResID.Value().ID\r\n      );\r\n\r\n      // 2. Get New ResponseDoc title\r\n      const newResponseDocFileName = getNewResponseDocTitle(\r\n        request,\r\n        response,\r\n        responseDoc\r\n      );\r\n\r\n      // 3. Copy File to RO\r\n      const source = responseDoc.FileRef.Value();\r\n      const dest = roResponseDocROFolderPath + \"/\" + newResponseDocFileName;\r\n\r\n      await appContext.utilities.copyFileAsync(source, dest);\r\n\r\n      const newRoFileResults =\r\n        await appContext.AuditResponseDocsRO.FindByColumnValue(\r\n          [{ column: \"FileRef\", value: dest }],\r\n          {},\r\n          { count: 1 }\r\n        );\r\n      const newRoFile = newRoFileResults.results[0] ?? null;\r\n\r\n      if (!newRoFile) return;\r\n\r\n      // 4. Update ResponseDocRo\r\n      newRoFile.markApprovedForRO(request, response);\r\n      await appContext.AuditResponseDocsRO.UpdateEntity(\r\n        newRoFile,\r\n        AuditResponseDocRO.Views.ApprovedForROUpdate\r\n      );\r\n\r\n      // 4. Update ResponseDoc Status\r\n      responseDoc.markApprovedForRO(newResponseDocFileName);\r\n      await appContext.AuditResponseDocs.UpdateEntity(responseDoc, [\r\n        \"DocumentStatus\",\r\n        \"RejectReason\",\r\n        \"FileLeafRef\",\r\n      ]);\r\n\r\n      responseLogBody += `<li><a href=\"${\r\n        window.location.origin + newRoFile.FileRef\r\n      }\" target=\"_blank\">${newResponseDocFileName}</a></li>`;\r\n    })\r\n  );\r\n\r\n  roEmailLogItem.ResponseCount = cntApprovedResponseDocs;\r\n  roEmailLogItem.Responses += responseLogBody;\r\n\r\n  await appContext.AuditROEmailsLog.UpdateEntity(roEmailLogItem, [\r\n    \"Responses\",\r\n    \"ResponseCount\",\r\n  ]);\r\n\r\n  return true;\r\n}\r\n", "import { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport { roleNames } from \"./permission_manager.js\";\r\nimport { getQAGroup, getSiteGroups } from \"./people_manager.js\";\r\nimport { ItemPermissions } from \"../sal/infrastructure/index.js\";\r\nimport { AuditROEmailLog } from \"../entities/audit_ro_email_log.js\";\r\n\r\nexport async function ensureROEmailFolder() {\r\n  const folderResults = await appContext.AuditEmails.FindByColumnValue(\r\n    [{ column: \"Title\", value: \"RONotifications\" }],\r\n    {},\r\n    { count: 1, includeFolders: true },\r\n    [\"ID\", \"Title\"]\r\n  );\r\n\r\n  const folder = folderResults.results[0] ?? null;\r\n\r\n  if (folder) return;\r\n\r\n  const newFolderId = await appContext.AuditEmails.UpsertFolderPath(\r\n    \"RONotifications\"\r\n  );\r\n\r\n  const { owners, members, visitors } = getSiteGroups();\r\n  let qaGroup = await getQAGroup();\r\n\r\n  const newPermissions = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  newPermissions.addPrincipalRole(owners, roleNames.FullControl);\r\n  newPermissions.addPrincipalRole(members, roleNames.Contribute);\r\n  newPermissions.addPrincipalRole(visitors, roleNames.RestrictedRead);\r\n  newPermissions.addPrincipalRole(qaGroup, roleNames.RestrictedContribute);\r\n\r\n  await appContext.AuditEmails.SetItemPermissions(\r\n    { ID: newFolderId },\r\n    newPermissions,\r\n    true\r\n  );\r\n}\r\n\r\nexport async function ensureRequestROEmailLogItem(requestingOffice) {\r\n  if (!requestingOffice?.ID) return;\r\n  // const roGroupName = requestingOffice?.UserGroup?.Title;\r\n  // if (!roGroupName) return;\r\n\r\n  const logItemTitle = new Date().format(\"MM/dd/yyyy\");\r\n\r\n  const emailLogResult = await appContext.AuditROEmailsLog.FindByColumnValue(\r\n    [\r\n      { column: \"Title\", value: logItemTitle },\r\n      { column: \"RequestingOfficeId\", value: requestingOffice.ID },\r\n    ],\r\n    {},\r\n    { count: 1, includeFolders: true }\r\n  );\r\n\r\n  const auditRoEmailLogItem = emailLogResult?.results[0] ?? null;\r\n  if (auditRoEmailLogItem) return auditRoEmailLogItem;\r\n\r\n  const newLogItem = new AuditROEmailLog();\r\n\r\n  newLogItem.Title = logItemTitle;\r\n  newLogItem.RequestingOffice = requestingOffice;\r\n\r\n  await appContext.AuditROEmailsLog.AddEntity(newLogItem);\r\n\r\n  return newLogItem;\r\n}\r\n", "import { ORGROLES } from \"../entities/index.js\";\r\nimport { People } from \"../sal/entities/index.js\";\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport { auditOrganizationStore } from \"../infrastructure/store.js\";\r\nimport { ItemPermissions, Role, RoleDef } from \"../sal/infrastructure/index.js\";\r\nimport { getSiteGroups } from \"./people_manager.js\";\r\nimport { addTask, finishTask, taskDefs } from \"./tasks.js\";\r\n\r\nexport const roleNames = {\r\n  FullControl: \"Full Control\",\r\n  Design: \"Design\",\r\n  Edit: \"Edit\",\r\n  Contribute: \"Contribute\",\r\n  Read: \"Read\",\r\n  LimitedAccess: \"Limited Access\",\r\n  RestrictedRead: \"Restricted Read\",\r\n  RestrictedContribute: \"Restricted Contribute\",\r\n  InitialCreate: \"Initial Create\",\r\n};\r\n\r\nexport function ensureAllAppPerms() {\r\n  ensureAllPagePerms();\r\n  ensureAllListPermissions();\r\n}\r\n\r\nfunction ensureAllPagePerms() {\r\n  ensureDBPermissions();\r\n\r\n  // Reset Other Pages\r\n  [\r\n    \"AuditBulkAddResponse.aspx\",\r\n    \"AuditBulkEditResponse.aspx\",\r\n    \"AuditPermissions.aspx\",\r\n    \"AuditReport_RequestsStatus.aspx\",\r\n    \"AuditReturnedResponses.aspx\",\r\n    \"AuditUnSubmittedResponseDocuments.aspx\",\r\n    \"AuditUpdateSiteGroups.aspx\",\r\n  ].map((page) => ensurePagePerms(page, []));\r\n}\r\n\r\nexport function ensureDBPermissions() {\r\n  const aos = auditOrganizationStore().filter(\r\n    (ao) => ao.Role != ORGROLES.REQUESTINGOFFICE\r\n  );\r\n  ensurePagePerms(\"AO_DB.aspx\", aos);\r\n\r\n  const ros = auditOrganizationStore().filter(\r\n    (ao) => ao.Role == ORGROLES.REQUESTINGOFFICE\r\n  );\r\n  ensurePagePerms(\"RO_DB.aspx\", ros);\r\n\r\n  const qas = auditOrganizationStore().filter(\r\n    (ao) => ao.Role == ORGROLES.QUALITYASSURANCE\r\n  );\r\n  ensurePagePerms(\"QA_DB.aspx\", qas);\r\n\r\n  const sps = auditOrganizationStore().filter(\r\n    (ao) => ao.Role == ORGROLES.SPECIALPERMISSIONS\r\n  );\r\n  ensurePagePerms(\"SP_DB.aspx\", sps);\r\n}\r\n\r\nasync function ensurePagePerms(pageTitle, orgs) {\r\n  const ensurePageTask = addTask(taskDefs.ensurePagePermissions(pageTitle));\r\n  const pageResults = await appContext.Pages.FindByColumnValue(\r\n    [{ column: \"FileLeafRef\", value: pageTitle }],\r\n    {},\r\n    { count: 1, includePermissions: true }\r\n  );\r\n\r\n  const page = pageResults.results[0] ?? null;\r\n\r\n  if (!page) {\r\n    console.warn(\r\n      \"Unable to ensure page permissions. Page not found: \" + pageTitle,\r\n      orgs\r\n    );\r\n    finishTask(ensurePageTask);\r\n    return;\r\n  }\r\n\r\n  let reset = false;\r\n  if (!page.HasUniqueRoleAssignments) {\r\n    reset = true;\r\n  }\r\n\r\n  if (!reset) {\r\n    const principalIds = page.RoleAssignments.results.map(\r\n      (role) => role.PrincipalId\r\n    );\r\n\r\n    reset = orgs.find((org) => {\r\n      const orgId = org.UserGroup?.ID;\r\n      return !principalIds.includes(orgId);\r\n    })\r\n      ? true\r\n      : false;\r\n  }\r\n\r\n  if (reset) {\r\n    const resetPageTask = addTask(taskDefs.resetPagePermissions(pageTitle));\r\n    const { owners, members, visitors } = getSiteGroups();\r\n\r\n    const baseRoles = [\r\n      new Role({\r\n        principal: owners,\r\n        roleDefs: [new RoleDef({ name: roleNames.FullControl })],\r\n      }),\r\n      new Role({\r\n        principal: members,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n      }),\r\n      new Role({\r\n        principal: visitors,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n      }),\r\n    ];\r\n\r\n    const newRoles = orgs.map((org) => {\r\n      return new Role({\r\n        principal: org.UserGroup,\r\n        roleDefs: [{ name: roleNames.RestrictedRead }],\r\n      });\r\n    });\r\n\r\n    const newPerms = new ItemPermissions({\r\n      hasUniqueRoleAssignments: true,\r\n      roles: [...newRoles, ...baseRoles],\r\n    });\r\n\r\n    console.warn(\"Resetting Page Perms: \", pageTitle);\r\n    await appContext.Pages.SetItemPermissions(page, newPerms, true);\r\n    finishTask(resetPageTask);\r\n  }\r\n\r\n  finishTask(ensurePageTask);\r\n}\r\n\r\nfunction getPeopleByOrgRole(orgType) {\r\n  return auditOrganizationStore()\r\n    .filter((ao) => ao.Role == orgType && ao.UserGroup)\r\n    .map((ao) => new People(ao.UserGroup));\r\n}\r\n\r\nfunction ensureAllListPermissions() {\r\n  const { owners, members, visitors } = getSiteGroups();\r\n\r\n  const baseRoles = [\r\n    new Role({\r\n      principal: owners,\r\n      roleDefs: [new RoleDef({ name: roleNames.FullControl })],\r\n    }),\r\n    new Role({\r\n      principal: members,\r\n      roleDefs: [new RoleDef({ name: roleNames.Contribute })],\r\n    }),\r\n    new Role({\r\n      principal: visitors,\r\n      roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n    }),\r\n  ];\r\n\r\n  const qaRestrictedContributeRoles = getPeopleByOrgRole(\r\n    ORGROLES.QUALITYASSURANCE\r\n  ).map(\r\n    (principal) =>\r\n      new Role({\r\n        principal,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedContribute })],\r\n      })\r\n  );\r\n\r\n  const qaRestrictedReadRoles = getPeopleByOrgRole(\r\n    ORGROLES.QUALITYASSURANCE\r\n  ).map(\r\n    (principal) =>\r\n      new Role({\r\n        principal,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n      })\r\n  );\r\n\r\n  const roRestrictedReadRoles = getPeopleByOrgRole(\r\n    ORGROLES.REQUESTINGOFFICE\r\n  ).map(\r\n    (principal) =>\r\n      new Role({\r\n        principal,\r\n        roleDefs: [new RoleDef({ name: roleNames.RestrictedRead })],\r\n      })\r\n  );\r\n\r\n  const setPerms = [\r\n    {\r\n      entitySet: appContext.AuditBulkRequests,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: baseRoles,\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditBulkResponses,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: baseRoles,\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditResponseDocsRO,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: [...baseRoles, ...qaRestrictedContributeRoles],\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditRequests,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: baseRoles,\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditRequestsInternals,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: [...baseRoles, ...qaRestrictedReadRoles],\r\n      }),\r\n    },\r\n    {\r\n      entitySet: appContext.AuditROEmailsLog,\r\n      permissions: new ItemPermissions({\r\n        hasUniqueRoleAssignments: true,\r\n        roles: [...baseRoles, ...qaRestrictedContributeRoles],\r\n      }),\r\n    },\r\n  ];\r\n\r\n  setPerms.map(async (setPerm) => {\r\n    const ensureListTask = addTask(\r\n      taskDefs.ensureListPermissions(setPerm.entitySet)\r\n    );\r\n    await ensureEntitySetPerms(setPerm);\r\n    finishTask(ensureListTask);\r\n  });\r\n}\r\n\r\nasync function ensureEntitySetPerms({ entitySet, permissions }) {\r\n  const curPerms = await entitySet.GetRootPermissions();\r\n\r\n  if (!curPerms.hasUniqueRoleAssignments) {\r\n    await resetEntitySetPerms(\r\n      entitySet,\r\n      permissions,\r\n      true,\r\n      \"List Inherits Permissions\"\r\n    );\r\n\r\n    return;\r\n  }\r\n\r\n  // Otherwise, verify that all roles match\r\n  const missingPermission = permissions.roles.find((newRole) => {\r\n    const existingRole = curPerms.roles.find(\r\n      (curRole) => curRole.principal.ID == newRole.principal.ID\r\n    );\r\n    // If the principal doesn't have a role assignment\r\n    if (!existingRole) return true;\r\n\r\n    const curRoleDefNames = existingRole.roleDefs.map(\r\n      (roleDef) => roleDef.name\r\n    );\r\n\r\n    // Else, if we find a roleDef that isn't already set\r\n    return newRole.roleDefs.find(\r\n      (roleDef) => !curRoleDefNames.includes(roleDef.name)\r\n    );\r\n  });\r\n\r\n  if (!missingPermission) return;\r\n\r\n  await resetEntitySetPerms(entitySet, permissions, false, {\r\n    \"Missing Permissions\": missingPermission,\r\n  });\r\n}\r\n\r\nasync function resetEntitySetPerms(entitySet, permissions, reset, reason) {\r\n  const resetEntitySetPermsTask = addTask(\r\n    taskDefs.resetListPermissions(entitySet)\r\n  );\r\n  console.warn(\"Resetting EntitySet Permissions: \" + entitySet.ListDef.title, {\r\n    entitySet,\r\n    permissions,\r\n    reason,\r\n  });\r\n  await entitySet.SetRootPermissions(permissions, reset);\r\n  finishTask(resetEntitySetPermsTask);\r\n}\r\n", "const taskStates = {\r\n  pending: \"Pending\",\r\n  aging: \"Aging\",\r\n  completed: \"Completed\",\r\n};\r\n\r\nexport class Task {\r\n  constructor({ msg, blocking }) {\r\n    this.msg = msg;\r\n    this.blocking = blocking;\r\n    this.Status(taskStates.pending);\r\n  }\r\n\r\n  msg;\r\n  blocking;\r\n  Status = ko.observable();\r\n\r\n  timeout = window.setTimeout(() => {\r\n    console.warn(\"this task is aging:\", this);\r\n    this.Status(taskStates.aging);\r\n  }, 5000);\r\n\r\n  markComplete = () => {\r\n    window.clearTimeout(this.timeout);\r\n    this.Status(taskStates.completed);\r\n  };\r\n\r\n  // Should this task block user input?\r\n  IsBlocking = ko.pureComputed(\r\n    () => this.blocking && this.Status() != taskStates.completed\r\n  );\r\n}\r\n\r\nexport class ProgressTask {\r\n  constructor({ msg, blocking }) {\r\n    this.msg = msg;\r\n    this.blocking = blocking;\r\n    this.Status(taskStates.pending);\r\n  }\r\n\r\n  msg;\r\n  blocking;\r\n  Status = ko.observable();\r\n\r\n  updateProgress = ({ percentDone }) => {\r\n    this.Status(`${parseInt(percentDone * 100)}%`);\r\n  };\r\n\r\n  setTimeout = () =>\r\n    window.setTimeout(() => {\r\n      console.warn(\"this task is aging:\", this);\r\n      this.Status(`${this.Status()} (${taskStates.aging})`);\r\n    }, 50000);\r\n\r\n  resetTimeout = () => {\r\n    window.clearTimeout(this.timeout);\r\n    this.timeout = this.setTimeout();\r\n  };\r\n\r\n  timeout = this.setTimeout();\r\n\r\n  markComplete = () => {\r\n    window.clearTimeout(this.timeout);\r\n    this.Status(taskStates.completed);\r\n  };\r\n\r\n  // Should this task block user input?\r\n  IsBlocking = ko.pureComputed(\r\n    () => this.blocking && this.Status() != taskStates.completed\r\n  );\r\n\r\n  static Create(params) {\r\n    return new ProgressTask(params);\r\n  }\r\n}\r\n", "import { ProgressTask, Task } from \"../value_objects/task.js\";\r\nexport const runningTasks = ko.observableArray();\r\n\r\nexport const blockingTasks = ko.pureComputed(() => {\r\n  return runningTasks().filter((task) => task.IsBlocking()) ?? [];\r\n});\r\n\r\nexport class TaskDef {\r\n  constructor(msg, blocking = false, type = null) {\r\n    this.msg = msg;\r\n    this.blocking = blocking;\r\n    this.type = type;\r\n  }\r\n  msg;\r\n  blocking;\r\n  type;\r\n}\r\n\r\nexport const taskDefs = {\r\n  init: { msg: \"Initializing the Application\", blocking: true },\r\n  save: { msg: \"Saving Request\", blocking: true },\r\n  newRequest: { msg: \"Processing New Request\", blocking: true },\r\n  cancelAction: { msg: \"Cancelling Action\", blocking: true },\r\n  view: { msg: \"Viewing Request\", blocking: false },\r\n  refresh: { msg: \"Refreshing Request\", blocking: false },\r\n  permissionsRequest: {\r\n    msg: \"Updating Request Item Permissions\",\r\n    blocking: true,\r\n  },\r\n  permissionsResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Updating Response Item Permissions: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  permissionsResponseFolder: (responseTitle) => {\r\n    return {\r\n      msg: \"Updating Response Folder Item Permissions: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  permissionsResponseAndFolder: (responseTitle) => {\r\n    return {\r\n      msg: \"Updating Response and Folder Item Permissions: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  permissionsEmailFolder: {\r\n    msg: \"Updating Email Folder Permissions\",\r\n    blocking: true,\r\n  },\r\n  permissionsCoversheet: (coversheetName) => {\r\n    return {\r\n      msg: \"Updating Coversheet Permissions: \" + coversheetName,\r\n      blocking: true,\r\n    };\r\n  },\r\n  ensurePagePermissions: (page) =>\r\n    new TaskDef(\"Ensuring Page Permissions: \" + page),\r\n  resetPagePermissions: (page) =>\r\n    new TaskDef(\"Resetting Page Permissions: \" + page, true),\r\n  ensureListPermissions: (entitySet) =>\r\n    new TaskDef(\"Ensuring List Permissions: \" + entitySet.ListDef.title),\r\n  resetListPermissions: (entitySet) =>\r\n    new TaskDef(\"Resetting List Permissions: \" + entitySet.ListDef.title, true),\r\n  deleteEmailFolder: { msg: \"Deleting Email Folder\", blocking: true },\r\n  newResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Submitting new Response: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  updateResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Updating Response: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  deleteResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Deleting Response: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  closeResponse: (responseTitle) => {\r\n    return {\r\n      msg: \"Closing Response: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  uploadResponseDoc: (responseDocTitle) => {\r\n    return {\r\n      msg: \"Uploading Response Document: \" + responseDocTitle,\r\n      blocking: true,\r\n      type: ProgressTask,\r\n    };\r\n  },\r\n  updateResponseDoc: (responseDocTitle) => {\r\n    return {\r\n      msg: \"Updating Response Document: \" + responseDocTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  approveResponseDoc: (responseDocTitle) => {\r\n    return {\r\n      msg: \"Approving Response Document: \" + responseDocTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  deleteResponseDocFolder: (responseTitle) => {\r\n    return {\r\n      msg: \"Deleting Response Document Folder: \" + responseTitle,\r\n      blocking: true,\r\n    };\r\n  },\r\n  uploadCoversheet: (coversheetName) => {\r\n    return {\r\n      msg: \"Uploading Coversheet: \" + coversheetName,\r\n      blocking: true,\r\n      type: ProgressTask,\r\n    };\r\n  },\r\n  updateCoversheet: (coversheetName) => {\r\n    return {\r\n      msg: \"Updating Coversheet: \" + coversheetName,\r\n      blocking: true,\r\n    };\r\n  },\r\n  deleteCoversheet: (coversheetName) => {\r\n    return {\r\n      msg: \"Deleting Coversheet: \" + coversheetName,\r\n      blocking: true,\r\n    };\r\n  },\r\n  deleteRequestInternalItem: {\r\n    msg: \"Deleting Request Internal Item\",\r\n    blocking: true,\r\n  },\r\n  newComment: { msg: \"Submitting Comment\", blocking: false },\r\n  refreshComments: { msg: \"Refreshing Comments\", blocking: false },\r\n  notifyComment: { msg: \"Sending Comment Email\", blocking: false },\r\n  removeComment: { msg: \"Removing Comment\", blocking: false },\r\n  newAction: { msg: \"Submitting Action\", blocking: false },\r\n  refreshActions: { msg: \"Refreshing Actions\", blocking: false },\r\n  newAttachment: { msg: \"Submitting Attachment\", blocking: false },\r\n  refreshAttachments: { msg: \"Refreshing Attachments\", blocking: false },\r\n  approve: { msg: \"Approving Request\", blocking: true },\r\n  lock: { msg: \"Locking Request\", blocking: true },\r\n  closing: { msg: \"Closing Request\", blocking: true },\r\n};\r\n\r\nexport const addTask = (taskDef) => {\r\n  let newTask;\r\n\r\n  if (taskDef.type) {\r\n    newTask = taskDef.type.Create(taskDef);\r\n  } else {\r\n    newTask = new Task(taskDef);\r\n  }\r\n\r\n  runningTasks.push(newTask);\r\n  return newTask;\r\n};\r\n\r\nexport const finishTask = function (activeTask) {\r\n  if (activeTask) {\r\n    activeTask.markComplete();\r\n    window.setTimeout(() => removeTask(activeTask), 3000);\r\n    // runningTasks.remove(activeTask);\r\n  }\r\n};\r\n\r\nconst removeTask = function (taskToRemove) {\r\n  runningTasks.remove(taskToRemove);\r\n};\r\n", "import { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport {\r\n  getPeopleByUsername,\r\n  getQAGroup,\r\n  getSiteGroups,\r\n} from \"./people_manager.js\";\r\nimport { roleNames } from \"./permission_manager.js\";\r\nimport { ItemPermissions } from \"../sal/infrastructure/index.js\";\r\nimport {\r\n  AuditResponseStates,\r\n  AuditRequest,\r\n  AuditRequestsInternal,\r\n} from \"../entities/index.js\";\r\nimport { People } from \"../sal/entities/index.js\";\r\nimport { addTask, finishTask, taskDefs } from \"./tasks.js\";\r\nimport { deleteRequestCoversheet } from \"./coversheet_manager.js\";\r\nimport { auditOrganizationStore } from \"../infrastructure/store.js\";\r\n\r\nexport async function getRequestById(id) {\r\n  return await appContext.AuditRequests.FindById(id);\r\n}\r\n\r\nexport async function getRequestByTitle(title) {\r\n  const requestResults = await appContext.AuditRequests.FindByColumnValue(\r\n    [{ column: \"Title\", value: title }],\r\n    {},\r\n    { count: 1 }\r\n  );\r\n\r\n  return requestResults.results[0] ?? null;\r\n}\r\n\r\nexport async function addNewRequest(request) {\r\n  const fields = request.FieldMap;\r\n\r\n  // See if we have a request with this title already\r\n  const existingRequests = await appContext.AuditRequests.FindByColumnValue(\r\n    [{ column: \"Title\", value: fields.Title.Value() }],\r\n    {},\r\n    { count: 1 }\r\n  );\r\n\r\n  // TODO: use addFieldRequirement?\r\n  if (existingRequests.results.length) {\r\n    throw new Error(\"Request with this name already exists!\");\r\n  }\r\n\r\n  request.FieldMap.EmailActionOffice.Value(\r\n    request.FieldMap.ActionOffice.Value()\r\n  );\r\n\r\n  await appContext.AuditRequests.AddEntity(request);\r\n\r\n  // This is handled by the IA_DB callback\r\n  // await onAddNewRequest(request);\r\n}\r\n\r\nexport async function updateRequest(request) {\r\n  await appContext.AuditRequests.UpdateEntity(\r\n    request,\r\n    AuditRequest.Views.IACanUpdate\r\n  );\r\n}\r\n\r\nexport async function deleteRequest(requestId) {\r\n  // Also delete related items:\r\n  // xCoversheets, Emails (Folder), xRequestInternal, xResponseDocs (Folder), xResponses\r\n  const request = await appContext.AuditRequests.FindById(requestId);\r\n  if (!request) {\r\n    alert(\"Could not find request: \", requestId);\r\n  }\r\n  const requestTitle = request.ReqNum.Value();\r\n  const promises = [];\r\n  // Delete Coversheets\r\n  const coversheets = await getRequestCoversheets(request);\r\n\r\n  coversheets.map((coversheet) => {\r\n    promises.push(deleteRequestCoversheet(coversheet));\r\n  });\r\n\r\n  // Delete email folder\r\n  promises.push(\r\n    new Promise(async (resolve) => {\r\n      const deleteItemTask = addTask(taskDefs.deleteEmailFolder);\r\n      await appContext.AuditEmails.RemoveFolderByPath(requestTitle);\r\n      finishTask(deleteItemTask);\r\n      resolve();\r\n    })\r\n  );\r\n\r\n  // Delete responses and responsedocs\r\n  const responses = await getRequestResponses(request);\r\n  responses.map((response) => {\r\n    promises.push(deleteResponseAndFolder(response));\r\n  });\r\n\r\n  // Delete the internal item\r\n  const requestInternalItem = await getRequestInternalItem(requestId);\r\n  if (requestInternalItem) {\r\n    promises.push(\r\n      new Promise(async (resolve) => {\r\n        const deleteItemTask = addTask(taskDefs.deleteRequestInternalItem);\r\n        await appContext.AuditRequestsInternals.RemoveEntityById(\r\n          requestInternalItem.ID\r\n        );\r\n        finishTask(deleteItemTask);\r\n        resolve();\r\n      })\r\n    );\r\n  }\r\n\r\n  await Promise.all(promises);\r\n  // Finally, delete the request\r\n  await appContext.AuditRequests.RemoveEntityById(requestId);\r\n  return true;\r\n}\r\n\r\nexport async function ensureRequestAuditResponseDocsROFolder(\r\n  reqNum,\r\n  requestingOfficeId\r\n) {\r\n  const roFolderResults =\r\n    await appContext.AuditResponseDocsRO.FindByColumnValue(\r\n      [{ column: \"FileLeafRef\", value: reqNum }],\r\n      {},\r\n      { count: 1, includeFolders: true }\r\n    );\r\n\r\n  const roFolder = roFolderResults.results[0] ?? null;\r\n\r\n  if (roFolder) return roFolder.FileRef;\r\n\r\n  const requestingOffice = auditOrganizationStore().find(\r\n    (ao) => ao.ID == requestingOfficeId\r\n  );\r\n\r\n  const newRoFolderId = await appContext.AuditResponseDocsRO.UpsertFolderPath(\r\n    reqNum\r\n  );\r\n  const { owners, members, visitors } = getSiteGroups();\r\n  const qaGroup = await getQAGroup();\r\n  const newPermissions = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  newPermissions.addPrincipalRole(owners, roleNames.FullControl);\r\n  newPermissions.addPrincipalRole(members, roleNames.Contribute);\r\n  newPermissions.addPrincipalRole(visitors, roleNames.RestrictedRead);\r\n  newPermissions.addPrincipalRole(qaGroup, roleNames.RestrictedContribute);\r\n  newPermissions.addPrincipalRole(\r\n    requestingOffice.UserGroup,\r\n    roleNames.RestrictedRead\r\n  );\r\n\r\n  await appContext.AuditResponseDocsRO.SetItemPermissions(\r\n    { ID: newRoFolderId },\r\n    newPermissions,\r\n    true\r\n  );\r\n\r\n  const newFolderEntity = await appContext.AuditResponseDocsRO.FindById(\r\n    newRoFolderId\r\n  );\r\n\r\n  return newFolderEntity.FileRef;\r\n}\r\n\r\n/* Begin Unreferenced Service Rewrites */\r\nexport async function onAddNewRequest(request) {\r\n  await Promise.all([\r\n    ensureRequestPermissions(request),\r\n    ensureAuditEmailFolder(request),\r\n    ensureRequestInternalItem(request),\r\n  ]);\r\n}\r\n\r\nasync function ensureAuditEmailFolder(request) {\r\n  const newFolderId = await appContext.AuditEmails.UpsertFolderPath(\r\n    request.ReqNum.Value()\r\n  );\r\n\r\n  const newItemPermissions = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  const { owners, members, visitors } = await getSiteGroups();\r\n  const qaGroup = await getPeopleByUsername(\r\n    Audit.Common.Utilities.GetGroupNameQA()\r\n  );\r\n\r\n  newItemPermissions.addPrincipalRole(owners, roleNames.FullControl);\r\n  newItemPermissions.addPrincipalRole(members, roleNames.RestrictedContribute);\r\n  newItemPermissions.addPrincipalRole(visitors, roleNames.RestrictedRead);\r\n\r\n  newItemPermissions.addPrincipalRole(qaGroup, roleNames.RestrictedContribute);\r\n\r\n  const actionOffices = request.FieldMap.ActionOffice.Value();\r\n\r\n  actionOffices.map((ao) => {\r\n    newItemPermissions.addPrincipalRole(\r\n      ao.UserGroup,\r\n      roleNames.RestrictedContribute\r\n    );\r\n  });\r\n\r\n  const result = await appContext.AuditEmails.SetItemPermissions(\r\n    { ID: newFolderId },\r\n    newItemPermissions,\r\n    true\r\n  );\r\n}\r\n\r\nasync function ensureRequestPermissions(request) {\r\n  const perms = await appContext.AuditRequests.GetItemPermissions(request);\r\n  if (!perms.hasUniqueRoleAssignments) {\r\n    if (window.DEBUG) console.log(\"Request does not have unique permissions\");\r\n    await breakRequestPermissions(request);\r\n  }\r\n}\r\n\r\nasync function ensureRequestInternalItem(request) {\r\n  const requestInternalResult = getRequestInternalItem(request);\r\n  if (requestInternalResult) return requestInternalResult;\r\n\r\n  const requestInternal = new AuditRequestsInternal();\r\n  requestInternal.ReqNum.Value(request);\r\n  await appContext.AuditRequestsInternals.AddEntity(requestInternal);\r\n  return requestInternal;\r\n}\r\n\r\nexport async function breakRequestPermissions(request, responseStatus) {\r\n  const curPerms = await appContext.AuditRequests.GetItemPermissions(request);\r\n\r\n  const defaultGroups = await getSiteGroups();\r\n\r\n  const qaGroup = await getPeopleByUsername(\r\n    Audit.Common.Utilities.GetGroupNameQA()\r\n  );\r\n\r\n  const qaHasRead = curPerms.principalHasPermissionKind(\r\n    qaGroup,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  const special1Group = await getPeopleByUsername(\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm1()\r\n  );\r\n  const special2Group = await getPeopleByUsername(\r\n    Audit.Common.Utilities.GetGroupNameSpecialPerm2()\r\n  );\r\n\r\n  const special1HasRead = curPerms.principalHasPermissionKind(\r\n    special1Group,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  const special2HasRead = curPerms.principalHasPermissionKind(\r\n    special2Group,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  const newRequestPermissions = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  newRequestPermissions.addPrincipalRole(\r\n    defaultGroups.owners,\r\n    roleNames.FullControl\r\n  );\r\n  newRequestPermissions.addPrincipalRole(\r\n    defaultGroups.members,\r\n    roleNames.Contribute\r\n  );\r\n  newRequestPermissions.addPrincipalRole(\r\n    defaultGroups.visitors,\r\n    roleNames.RestrictedRead\r\n  );\r\n\r\n  if (qaHasRead || responseStatus == AuditResponseStates.ApprovedForQA) {\r\n    newRequestPermissions.addPrincipalRole(qaGroup, roleNames.RestrictedRead);\r\n  }\r\n\r\n  if (special1HasRead) {\r\n    newRequestPermissions.addPrincipalRole(\r\n      special1Group,\r\n      roleNames.RestrictedRead\r\n    );\r\n  }\r\n\r\n  if (special2HasRead) {\r\n    newRequestPermissions.addPrincipalRole(\r\n      special2Group,\r\n      roleNames.RestrictedRead\r\n    );\r\n  }\r\n\r\n  const actionOffices = request.FieldMap.ActionOffice.Value();\r\n\r\n  actionOffices.map((ao) =>\r\n    newRequestPermissions.addPrincipalRole(\r\n      new People(ao.UserGroup),\r\n      roleNames.RestrictedRead\r\n    )\r\n  );\r\n\r\n  await appContext.AuditRequests.SetItemPermissions(\r\n    request,\r\n    newRequestPermissions,\r\n    true\r\n  );\r\n}\r\n\r\nexport async function getRequestInternalItem(request) {\r\n  const requestInternalResult =\r\n    await appContext.AuditRequestsInternals.FindByColumnValue(\r\n      [{ column: \"ReqNum\", op: \"eq\", value: request.ID }],\r\n      {},\r\n      {}\r\n    );\r\n\r\n  if (requestInternalResult.results.length) {\r\n    if (requestInternalResult.results.length > 1) {\r\n      //TODO: attempt to purge extra items\r\n      console.error(\r\n        requestInternalResult.results.length + \" internal items!\",\r\n        request\r\n      );\r\n    }\r\n    return requestInternalResult.results[0];\r\n  }\r\n  return;\r\n}\r\n\r\nexport async function getRequestCoversheets(request) {\r\n  const coversheetsResult = await appContext.AuditCoversheets.FindByColumnValue(\r\n    [{ column: \"ReqNum\", value: request.ID }],\r\n    {},\r\n    {}\r\n  );\r\n\r\n  return coversheetsResult.results;\r\n}\r\n\r\nexport async function getRequestResponses(request) {\r\n  const responsesResult = await appContext.AuditResponses.FindByColumnValue(\r\n    [{ column: \"ReqNum\", value: request.ID }],\r\n    {},\r\n    { includePermissions: true }\r\n  );\r\n\r\n  return responsesResult.results;\r\n}\r\n\r\nexport async function getRequestResponseDocs(request) {\r\n  const responsesResult = await appContext.AuditResponseDocs.FindByColumnValue(\r\n    [{ column: \"ReqNum\", value: request.ID }],\r\n    {},\r\n    { includePermissions: true }\r\n  );\r\n\r\n  return responsesResult.results;\r\n}\r\n\r\nexport async function getRequestResponseDocsFolders(responseTitle) {\r\n  const responsesResult = await appContext.AuditResponseDocs.FindByColumnValue(\r\n    [{ column: \"Title\", value: responseTitle }],\r\n    {},\r\n    { includeFolders: true },\r\n    [\"ID\", \"Title\"]\r\n  );\r\n\r\n  return responsesResult.results;\r\n}\r\n\r\n/* TO BE UPDATED */\r\n", "import { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport {\r\n  getSpecialPermGroups,\r\n  getSiteGroups,\r\n  getQAGroup,\r\n  getPeopleByUsername,\r\n} from \"./people_manager.js\";\r\nimport { ItemPermissions } from \"../sal/infrastructure/index.js\";\r\nimport { roleNames } from \"./permission_manager.js\";\r\nimport { People } from \"../sal/entities/index.js\";\r\nimport { AuditCoversheet } from \"../entities/index.js\";\r\nimport { getRequestCoversheets } from \"./audit_request_service.js\";\r\nimport { addTask, finishTask, taskDefs } from \"./tasks.js\";\r\n\r\nexport async function uploadRequestCoversheetFile(\r\n  file,\r\n  request,\r\n  actionOffices = []\r\n) {\r\n  let fileName = file.name;\r\n  const reqNum = request.ReqNum.Value();\r\n  if (!fileName.includes(reqNum)) fileName = reqNum + \"_\" + fileName;\r\n\r\n  const newFileName = getNewFileNameForSensitivity(\r\n    fileName,\r\n    null,\r\n    request.Sensitivity.Value()\r\n  );\r\n\r\n  const uploadCoversheetTask = addTask(taskDefs.uploadCoversheet(newFileName));\r\n  const title = newFileName.substring(0, newFileName.lastIndexOf(\".\"));\r\n\r\n  const fileMetadata = {\r\n    Title: title,\r\n    ReqNumId: request.ID,\r\n    ActionOfficeId: actionOffices.map((ao) => ao.ID),\r\n  };\r\n\r\n  const newCoversheet =\r\n    await appContext.AuditCoversheets.UploadFileToFolderAndUpdateMetadata(\r\n      file,\r\n      newFileName,\r\n      \"\",\r\n      fileMetadata,\r\n      ({ currentBlock, totalBlocks }) =>\r\n        uploadCoversheetTask.updateProgress({\r\n          percentDone: currentBlock / totalBlocks,\r\n        })\r\n    );\r\n\r\n  await breakCoversheetPermissions(newCoversheet);\r\n  finishTask(uploadCoversheetTask);\r\n  return newCoversheet;\r\n}\r\nexport async function deleteRequestCoversheetById(coversheetId) {\r\n  const coversheet = await appContext.AuditCoversheets.FindById(coversheetId);\r\n\r\n  return deleteRequestCoversheet(coversheet);\r\n}\r\nexport async function deleteRequestCoversheet(coversheet) {\r\n  const deleteItemTask = addTask(\r\n    taskDefs.deleteCoversheet(coversheet.FileName.toString())\r\n  );\r\n  await appContext.AuditCoversheets.RemoveEntityById(coversheet.ID);\r\n  finishTask(deleteItemTask);\r\n}\r\n\r\nexport async function updateRequestCoverSheet(coverSheet) {\r\n  const request = coverSheet.ReqNum.Value();\r\n\r\n  if (!request) throw new Error(\"ReqNum not set!\");\r\n  const updateCoversheetTask = addTask(\r\n    taskDefs.updateCoversheet(coverSheet.FileName.Value())\r\n  );\r\n  let fileName = coverSheet.FileName.Value();\r\n\r\n  if (!fileName.includes(request.ReqNum.Value())) {\r\n    fileName = request.ReqNum.Value() + \"_\" + fileName;\r\n    coverSheet.FileName.Value(fileName);\r\n  }\r\n\r\n  await appContext.AuditCoversheets.UpdateEntity(\r\n    coverSheet,\r\n    AuditCoversheet.Views.AOCanUpdate\r\n  );\r\n\r\n  finishTask(updateCoversheetTask);\r\n}\r\n\r\nexport async function breakRequestCoversheetPerms(request, grantQARead) {\r\n  const coversheets = await getRequestCoversheets(request);\r\n\r\n  await Promise.all(\r\n    coversheets.map((coversheet) =>\r\n      breakCoversheetPermissions(coversheet, grantQARead)\r\n    )\r\n  );\r\n}\r\n\r\nfunction getNewFileNameForSensitivity(\r\n  fileName,\r\n  oldSensitivity,\r\n  requestSensitivity\r\n) {\r\n  let newFileName = \"\";\r\n  var curDocFileNameAndExt = fileName;\r\n  var curDocFileName = curDocFileNameAndExt.substring(\r\n    0,\r\n    curDocFileNameAndExt.lastIndexOf(\".\")\r\n  );\r\n  var curDocExt = curDocFileNameAndExt.replace(curDocFileName, \"\");\r\n\r\n  newFileName = curDocFileName;\r\n  if (oldSensitivity != null && oldSensitivity != \"\") {\r\n    if (curDocFileName.endsWith(\"_\" + oldSensitivity)) {\r\n      newFileName = newFileName.replace(\"_\" + oldSensitivity, \"\");\r\n    }\r\n  }\r\n  if (\r\n    requestSensitivity != null &&\r\n    requestSensitivity != \"\" &&\r\n    requestSensitivity != \"None\"\r\n  ) {\r\n    if (!curDocFileName.endsWith(\"_\" + requestSensitivity))\r\n      newFileName = newFileName + \"_\" + requestSensitivity;\r\n  }\r\n\r\n  return newFileName + curDocExt;\r\n}\r\n\r\nasync function breakCoversheetPermissions(coversheet, grantQARead) {\r\n  const breakCoversheetPermsTask = addTask(\r\n    taskDefs.permissionsCoversheet(coversheet.FileName.Value())\r\n  );\r\n  const curPerms = await appContext.AuditCoversheets.GetItemPermissions(\r\n    coversheet\r\n  );\r\n\r\n  const defaultGroups = await getSiteGroups();\r\n\r\n  const qaGroup = await getQAGroup();\r\n\r\n  let qaHasRead = curPerms.principalHasPermissionKind(\r\n    qaGroup,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  const { specialPermGroup1, specialPermGroup2 } = await getSpecialPermGroups();\r\n\r\n  let special1HasRead = curPerms.principalHasPermissionKind(\r\n    specialPermGroup1,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n  let special2HasRead = curPerms.principalHasPermissionKind(\r\n    specialPermGroup2,\r\n    SP.PermissionKind.viewListItems\r\n  );\r\n\r\n  if (!curPerms.hasUniqueRoleAssignments) {\r\n    special1HasRead = false;\r\n    special2HasRead = false;\r\n    qaHasRead = false;\r\n  }\r\n\r\n  const newPerms = new ItemPermissions({\r\n    hasUniqueRoleAssignments: true,\r\n    roles: [],\r\n  });\r\n\r\n  newPerms.addPrincipalRole(defaultGroups.owners, roleNames.FullControl);\r\n  newPerms.addPrincipalRole(defaultGroups.members, roleNames.Contribute);\r\n  newPerms.addPrincipalRole(defaultGroups.visitors, roleNames.RestrictedRead);\r\n\r\n  if (qaHasRead || grantQARead) {\r\n    newPerms.addPrincipalRole(qaGroup, roleNames.RestrictedRead);\r\n  }\r\n\r\n  if (special1HasRead) {\r\n    newPerms.addPrincipalRole(specialPermGroup1, roleNames.RestrictedRead);\r\n  }\r\n\r\n  if (special2HasRead) {\r\n    newPerms.addPrincipalRole(specialPermGroup2, roleNames.RestrictedRead);\r\n  }\r\n\r\n  const actionOffices = coversheet.ActionOffice.Value();\r\n\r\n  actionOffices.map((ao) =>\r\n    newPerms.addPrincipalRole(\r\n      new People(ao.UserGroup),\r\n      roleNames.RestrictedRead\r\n    )\r\n  );\r\n\r\n  await appContext.AuditCoversheets.SetItemPermissions(\r\n    coversheet,\r\n    newPerms,\r\n    true\r\n  );\r\n  finishTask(breakCoversheetPermsTask);\r\n}\r\n", "import {\r\n  AuditResponse,\r\n  AuditResponseStates,\r\n  AuditResponseDoc,\r\n  AuditResponseDocStates,\r\n} from \"../entities/index.js\";\r\n\r\nimport { appContext } from \"../infrastructure/application_db_context.js\";\r\nimport { showModal } from \"../sal/components/modal/index.js\";\r\n\r\nimport {\r\n  breakRequestPermissions,\r\n  getRequestById,\r\n  getRequestResponseDocs,\r\n  getRequestResponses,\r\n} from \"./audit_request_service.js\";\r\nimport { breakRequestCoversheetPerms } from \"./coversheet_manager.js\";\r\nimport { addTask, finishTask, taskDefs } from \"./tasks.js\";\r\n\r\nexport async function showBulkAddResponseModal(request) {\r\n  const options = {\r\n    title: \"Bulk Add Responses (\" + request.ReqNum.Value() + \")\",\r\n    height: 800,\r\n    url:\r\n      Audit.Common.Utilities.GetSiteUrl() +\r\n      \"/pages/AuditBulkAddResponse.aspx?ReqNum=\" +\r\n      request.ReqNum.Value(),\r\n  };\r\n\r\n  await showModal(options);\r\n}\r\n\r\nexport async function addResponse(request, response) {\r\n  const responseTitle = getResponseTitle(request, response);\r\n  const newResponseTask = addTask(taskDefs.newResponse(responseTitle));\r\n  // Update title\r\n\r\n  response.Title.Value(responseTitle);\r\n\r\n  response.ResStatus.Value(AuditResponseStates.Open);\r\n\r\n  try {\r\n    // Validate title is unique\r\n    const responseResult = await appContext.AuditResponses.FindByColumnValue(\r\n      [\r\n        {\r\n          column: \"Title\",\r\n          value: responseTitle,\r\n        },\r\n      ],\r\n      {},\r\n      { count: 1 }\r\n    );\r\n\r\n    if (responseResult.results.length) {\r\n      throw new Error(`Response with title ${responseTitle} already exists!`);\r\n    }\r\n\r\n    await appContext.AuditResponses.AddEntity(response);\r\n  } catch (e) {\r\n    console.error(\"Error adding Response: \", e);\r\n    alert(e.message);\r\n  } finally {\r\n    finishTask(newResponseTask);\r\n  }\r\n}\r\n\r\nexport async function updateResponse(request, response) {\r\n  const updateResponseTask = addTask(\r\n    taskDefs.updateResponse(response.Title.Value())\r\n  );\r\n\r\n  try {\r\n    // FPRA Check\r\n    const actionOfficeTitle =\r\n      response.ActionOffice.Value()?.Title?.toLowerCase();\r\n    if (!actionOfficeTitle.includes(\"fpra\")) {\r\n      if (response.POC.toString() || response.POCCC.toString()) {\r\n        throw new Error(\r\n          \"Only FPRA Responses can have designated POC and POC CC fields.\"\r\n        );\r\n      }\r\n    }\r\n\r\n    // Sensitivity Check\r\n    const currentResponseSensitivity = request.Sensitivity.Value();\r\n    const selectedResponseStatus = response.ResStatus.Value();\r\n\r\n    if (\r\n      selectedResponseStatus == AuditResponseStates.ApprovedForQA &&\r\n      currentResponseSensitivity == \"None\"\r\n    ) {\r\n      throw new Error(\"Request Sensitivity not set; cannot submit to QA.\");\r\n    }\r\n\r\n    const responseTitle = getResponseTitle(request, response);\r\n\r\n    if (response.Title.Value() != responseTitle)\r\n      response.Title.Value(responseTitle);\r\n\r\n    await appContext.AuditResponses.UpdateEntity(\r\n      response,\r\n      AuditResponse.Views.IACanUpdate\r\n    );\r\n  } catch (e) {\r\n    console.error(\"Error Updating Response: \", e);\r\n    alert(e.message);\r\n  } finally {\r\n    finishTask(updateResponseTask);\r\n  }\r\n}\r\n\r\nexport async function deleteResponseAndFolder(response) {\r\n  // Find the Response Folder\r\n  const responseTitle = response.Title.Value();\r\n\r\n  const deleteFolderTask = addTask(\r\n    taskDefs.deleteResponseDocFolder(responseTitle)\r\n  );\r\n  await appContext.AuditResponseDocs.RemoveFolderByPath(responseTitle);\r\n  finishTask(deleteFolderTask);\r\n\r\n  const deleteItemTask = addTask(taskDefs.deleteResponse(responseTitle));\r\n  await appContext.AuditResponses.RemoveEntityById(response.ID);\r\n  finishTask(deleteItemTask);\r\n  return;\r\n}\r\n\r\nexport async function updateResponseDoc(request, response, responseDoc) {\r\n  const updateResponseDocTask = addTask(\r\n    taskDefs.updateResponseDoc(responseDoc.Title.Value())\r\n  );\r\n\r\n  await appContext.AuditResponseDocs.UpdateEntity(\r\n    responseDoc,\r\n    AuditResponseDoc.Views.AOCanUpdate\r\n  );\r\n\r\n  finishTask(updateResponseDocTask);\r\n}\r\n\r\nexport async function getResponsesReadyToClose(requestId) {\r\n  const allRequestResponseDocs = await getRequestResponseDocs(request);\r\n\r\n  const allRequestResponses = await getRequestResponses(request);\r\n\r\n  return allRequestResponses.filter((response) =>\r\n    isResponseReadyToClose(response, allRequestResponseDocs)\r\n  );\r\n}\r\n\r\nasync function isResponseReadyToClose(response, responseDocs) {\r\n  const openResponseDocs = responseDocs.filter(\r\n    (responseDoc) =>\r\n      responseDoc.ResID.ID == response.ID &&\r\n      [AuditResponseDocStates.Open, AuditResponseDocStates.Submitted].includes(\r\n        responseDoc.DocumentStatus.Value()\r\n      )\r\n  );\r\n\r\n  return openResponseDocs.length;\r\n}\r\n\r\nexport async function closeResponseById(responseId) {\r\n  const response = await appContext.AuditResponses.FindById(responseId);\r\n  // TODO: Use Result\r\n  if (!response) return;\r\n  return closeResponse(response);\r\n}\r\n\r\nasync function closeResponse(response) {\r\n  const closeResponseTask = addTask(\r\n    taskDefs.closeResponse(response.Title.Value())\r\n  );\r\n\r\n  response.markClosed();\r\n  await appContext.AuditResponses.UpdateEntity(\r\n    response,\r\n    AuditResponse.Views.IAUpdateClosed\r\n  );\r\n\r\n  finishTask(closeResponseTask);\r\n}\r\n\r\nexport async function uploadResponseDocFile(response, file) {\r\n  const uploadResponseDocTask = addTask(taskDefs.uploadResponseDoc(file.name));\r\n  const fileMetadata = {\r\n    Title: file.name,\r\n    ReqNumId: response.ReqNum.Value().ID,\r\n    ResIDId: response.ID,\r\n  };\r\n\r\n  await appContext.AuditResponseDocs.UploadFileToFolderAndUpdateMetadata(\r\n    file,\r\n    file.name,\r\n    response.Title.Value(),\r\n    fileMetadata,\r\n    ({ currentBlock, totalBlocks }) =>\r\n      uploadResponseDocTask.updateProgress({\r\n        percentDone: currentBlock / totalBlocks,\r\n      })\r\n  );\r\n  finishTask(uploadResponseDocTask);\r\n}\r\n\r\nfunction getResponseTitle(request, response) {\r\n  return `${request.ReqNum.Value()}-${\r\n    response.ActionOffice.Value()?.Title\r\n  }-${response.SampleNumber.Value()}`;\r\n}\r\n\r\n/* Begin Unreferenced Service Rewrites */\r\n\r\nexport function getNewResponseDocTitle(request, response, responseDoc) {\r\n  const oldResponseDocTitle = responseDoc.FileName.Value();\r\n\r\n  const createdDate = responseDoc.Created.Value().format(\"yyyyMMddTHHmmss\");\r\n  const responseName = response.Title.Value();\r\n  const sensitivity = request.Sensitivity.Value();\r\n\r\n  let newResponseDocTitle =\r\n    responseName + \"_\" + createdDate + \"_\" + Math.ceil(Math.random() * 10000);\r\n\r\n  if (sensitivity && sensitivity != \"None\")\r\n    newResponseDocTitle += \"_\" + sensitivity;\r\n\r\n  var docName = oldResponseDocTitle.substring(\r\n    0,\r\n    oldResponseDocTitle.lastIndexOf(\".\")\r\n  );\r\n  var docExt = oldResponseDocTitle.replace(docName, \"\");\r\n  newResponseDocTitle += docExt;\r\n\r\n  // Only use the new filename if it's not already encoded\r\n  if (\r\n    !oldResponseDocTitle.includes(responseName) ||\r\n    !oldResponseDocTitle.includes(createdDate) ||\r\n    (sensitivity && !oldResponseDocTitle.includes(sensitivity))\r\n  )\r\n    return newResponseDocTitle;\r\n\r\n  return oldResponseDocTitle;\r\n}\r\n", "import { directRegisterComponent } from \"../../infrastructure/index.js\";\r\nimport { modalDialogTemplate } from \"./ModalDialogTemplate.js\";\r\n\r\nconst componentName = \"modal-dialog-component\";\r\n\r\nexport const currentDialogs = ko.observableArray();\r\n\r\nexport let toggle;\r\n\r\nexport function showModalDialog(dialogOptions) {\r\n  currentDialogs.push(dialogOptions);\r\n}\r\n\r\nclass ModalDialogModule {\r\n  constructor(dialogOpts) {\r\n    this.dialogOpts = dialogOpts;\r\n    this.title = dialogOpts.title;\r\n    this.dialogReturnValueCallback = dialogOpts.dialogReturnValueCallback;\r\n\r\n    this.form = dialogOpts.form;\r\n\r\n    if (this.form?.onComplete) {\r\n      alert(\"Pass the form onComplete to the modal dialog!\");\r\n      return;\r\n    }\r\n    this.form.onComplete = this.close.bind(this);\r\n\r\n    toggle = this.toggle;\r\n  }\r\n\r\n  toggle = (show = null) => {\r\n    if (show == null) show = !this.dlgElement.hasAttribute(\"open\");\r\n\r\n    show ? this.showModal() : this.hide();\r\n  };\r\n\r\n  showModal = () => {\r\n    this.dlgElement.showModal();\r\n    this.dlgElement.classList.add(\"active\");\r\n  };\r\n\r\n  clickClose = () => {\r\n    this.close(false);\r\n  };\r\n\r\n  hide = () => {\r\n    this.dlgElement.close();\r\n    this.dlgElement.classList.remove(\"active\");\r\n  };\r\n\r\n  close(result) {\r\n    this.dlgElement.close();\r\n    this.dlgElement.classList.remove(\"active\");\r\n    if (this.dialogReturnValueCallback) this.dialogReturnValueCallback(result);\r\n    currentDialogs.remove(this.dialogOpts);\r\n  }\r\n\r\n  _id;\r\n  getUniqueId = () => {\r\n    if (!this._id) {\r\n      this._id = \"field-\" + Math.floor(Math.random() * 10000);\r\n    }\r\n    return this._id;\r\n  };\r\n\r\n  koDescendantsComplete = function (node) {\r\n    this.dlgElement = node.querySelector(\"dialog\");\r\n    dragElement(this.dlgElement);\r\n    resizeDialog(this.dlgElement);\r\n    this.showModal();\r\n  };\r\n}\r\n\r\ndirectRegisterComponent(componentName, {\r\n  template: modalDialogTemplate,\r\n  viewModel: ModalDialogModule,\r\n});\r\n\r\nfunction resizeDialog(elmnt) {\r\n  elmnt.style.width = \"550px\";\r\n  elmnt.style.height = \"\";\r\n  elmnt.style.top = \"125px\";\r\n  elmnt.style.left = (window.GetViewportWidth() - 550) / 2 + \"px\";\r\n}\r\n\r\n// TODO: this should be in a utility class or something\r\nfunction dragElement(elmnt) {\r\n  var pos1 = 0,\r\n    pos2 = 0,\r\n    pos3 = 0,\r\n    pos4 = 0;\r\n\r\n  // elmnt.style.top = elmnt.style.top\r\n\r\n  const dragger = elmnt.querySelector(\".grabber\");\r\n  if (dragger) {\r\n    // if present, the header is where you move the DIV from:\r\n    dragger.onmousedown = dragMouseDown;\r\n  } else {\r\n    // otherwise, move the DIV from anywhere inside the DIV:\r\n    elmnt.onmousedown = dragMouseDown;\r\n  }\r\n\r\n  function dragMouseDown(e) {\r\n    e = e || window.event;\r\n    e.preventDefault();\r\n    // get the mouse cursor position at startup:\r\n    pos3 = e.clientX;\r\n    pos4 = e.clientY;\r\n    document.onmouseup = closeDragElement;\r\n    // call a function whenever the cursor moves:\r\n    document.onmousemove = elementDrag;\r\n  }\r\n\r\n  function elementDrag(e) {\r\n    e = e || window.event;\r\n    e.preventDefault();\r\n    // calculate the new cursor position:\r\n    pos1 = pos3 - e.clientX;\r\n    pos2 = pos4 - e.clientY;\r\n    pos3 = e.clientX;\r\n    pos4 = e.clientY;\r\n    // set the element's new position:\r\n    elmnt.style.top = elmnt.offsetTop - pos2 + \"px\";\r\n    elmnt.style.left = elmnt.offsetLeft - pos1 + \"px\";\r\n  }\r\n\r\n  function closeDragElement() {\r\n    // stop moving when mouse button is released:\r\n    document.onmouseup = null;\r\n    document.onmousemove = null;\r\n  }\r\n}\r\n", "import { html } from \"../../infrastructure/index.js\";\r\n\r\nexport const modalDialogTemplate = html`\r\n  <dialog\r\n    id=\"\"\r\n    class=\"card bg-dark draggable modal-dialog\"\r\n    data-bind=\"attr: {id: getUniqueId() }\"\r\n  >\r\n    <!-- Can't use 'with: currentDialog' since we need to register our \r\n      javascript event listeners for grabbing and resizing -->\r\n    <div class=\"card-header bg-dark grabber\">\r\n      <h2 class=\"card-title\" data-bind=\"text: title\"></h2>\r\n      <h2 class=\"card-title\">\r\n        <i class=\"fa-solid fa-xmark pointer\" data-bind=\"click: clickClose\"></i>\r\n      </h2>\r\n    </div>\r\n    <div class=\"dimmer\" data-bind=\"css: {'active': form.saving }\">\r\n      <span class=\"loader\"></span>\r\n      <ul class=\"\" data-bind=\"foreach: $root.blockingTasks\">\r\n        <li data-bind=\"text: msg + '...'\"></li>\r\n      </ul>\r\n    </div>\r\n    <div\r\n      class=\"card-body\"\r\n      data-bind=\"component: { name: form.componentName, params: form.params }\"\r\n    ></div>\r\n    <div class=\"card-actions\">\r\n      <button\r\n        style\r\n        type=\"button\"\r\n        class=\"btn btn-danger\"\r\n        data-bind=\"click: clickClose\"\r\n      >\r\n        Cancel\r\n      </button>\r\n    </div>\r\n  </dialog>\r\n`;\r\n", "export * from \"./approvals_service.js\";\r\nexport * from \"./audit_email_service.js\";\r\nexport * from \"./audit_request_service.js\";\r\nexport * from \"./audit_response_service.js\";\r\nexport * from \"./coversheet_manager.js\";\r\nexport * from \"./people_manager.js\";\r\nexport * from \"./permission_manager.js\";\r\nexport * from \"./tasks.js\";\r\n"],
  "mappings": "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,CAC5B,YAAa,qBACf,CAAC,EAED,YAAc,IAAIT,GAAY,CAC5B,YAAa,cACb,QAAS,CAAC,OAAQ,WAAY,MAAO,SAAS,CAChD,CAAC,EAED,aAAe,IAAIE,GAAY,CAC7B,YAAa,iBACb,KAAMC,GACN,QAASC,GACT,cAAeO,GACf,UAAW,QACX,SAAU,GACV,UAAWL,EAAW,kBACxB,CAAC,EAED,kBAAoB,IAAIJ,GAAY,CAClC,YAAa,uBACb,KAAMC,GACN,QAASC,GACT,cAAeO,GACf,UAAW,QACX,SAAU,GACV,UAAWL,EAAW,kBACxB,CAAC,EAED,WAAa,IAAIC,GAAU,CACzB,YAAa,cACb,WAAY,EACd,CAAC,EAED,SAAW,IAAIK,GAAY,CACzB,YAAa,YACb,WAAY,EACd,CAAC,EAED,OAAO,MAAQ,CACb,IAAK,CACH,KACA,QACA,UACA,aACA,aACA,kBACA,aACA,YACA,WACA,cACA,eACA,cACA,WACA,YACA,YACA,cACA,eACA,oBACA,mBACA,aACA,UACF,EACA,IAAK,CACH,QACA,UACA,aACA,mBACA,aACA,kBACA,aACA,YACA,WACA,cACA,eACA,cACA,WACA,YACA,cACA,cACF,EACA,YAAa,CACX,UACA,aACA,aACA,mBACA,kBACA,aACA,YACA,WACA,cACA,eACA,cACA,WACA,YACA,cACA,eACA,oBACA,WACA,YACF,CACF,EAEA,OAAO,QAAU,CACf,KAAM,gBACN,MAAO,eACT,CACF,ICtQA,IAGaC,GAHbC,GAAAC,EAAA,KAAAC,KAGaH,GAAN,cAA+BI,EAAa,CACjD,YAAYC,EAAQ,CAClB,MAAMA,CAAM,CACd,CAEA,WAAY,CACV,IAAMC,EAAS,IAAIF,GAAa,IAAI,EAEpC,OAAAE,EAAO,SAAS,KAAK,OAAO,CAAC,EACtBA,CACT,CAEA,OAAO,MAAQ,CACb,IAAK,CACH,KACA,QACA,aACA,aACA,kBACA,aACA,YACA,WACA,cACA,eACA,cACA,WACA,YACA,YACA,cACA,eACA,oBACA,oBACA,aACA,UACF,EACA,IAAK,CACH,QACA,aACA,aACA,kBACA,aACA,YACA,WACA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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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",
  "names": ["auditOrganizationStore", "allActionOfficesFilter", "allRequestingOfficesFilter", "init_store", "__esmMin", "init_entities", "org", "ORGROLES", "ValidationError", "init_validation_error", "__esmMin", "source", "type", "description", "Entity", "init_entity", "__esmMin", "params", "val", "init_primitives", "__esmMin", "init_validation_error", "init_entity", "init_constrained_entity", "isRequiredValidationRequirement", "field", "value", "ValidationError", "BaseField", "init_BaseField", "__esmMin", "init_validation_error", "displayName", "systemName", "instructions", "isRequired", "width", "classList", "Visible", "val", "showErrors", "req", "requirement", "registerFieldComponents", "constructor", "html", "BaseFieldModule", "init_BaseFieldModule", "__esmMin", "params", "editTemplate", "viewTemplate", "BlobModule", "init_BlobModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "editTemplate", "viewTemplate", "CheckboxModule", "init_CheckboxModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "editTemplate", "DateModule", "init_DateModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "editTemplate", "LookupModule", "init_LookupModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "field", "registerFieldComponents", "editTemplate", "viewTemplate", "PeopleModule", "init_PeopleModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "opt", "registerFieldComponents", "editTemplate", "SearchSelectModule", "init_SearchSelectModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "field", "val", "option", "e", "data", "registerFieldComponents", "editTemplate", "SelectModule", "init_SelectModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "editTemplate", "viewTemplate", "TextAreaModule", "init_TextAreaModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "nodes", "toolbarOptions", "editor", "Value", "val", "delta", "oldDelta", "source", "registerFieldComponents", "editTemplate", "TextModule", "init_TextModule", "__esmMin", "init_BaseFieldModule", "html", "BaseFieldModule", "params", "registerFieldComponents", "init_fields", "__esmMin", "init_BaseFieldModule", "init_BlobModule", "init_CheckboxModule", "init_DateModule", "init_LookupModule", "init_PeopleModule", "init_SearchSelectModule", "init_SelectModule", "init_TextAreaModule", "init_TextModule", "BlobField", "init_BlobField", "__esmMin", "init_fields", "_BlobField", "BaseField", "params", "value", "input", "obj", "newEntity", "val", "item", "newType", "BlobModule", "CheckboxField", "init_CheckboxField", "__esmMin", "init_fields", "BaseField", "params", "CheckboxModule", "dateFieldTypes", "DateField", "init_DateField", "__esmMin", "init_fields", "BaseField", "params", "d", "newDate", "val", "DateModule", "getEntityPropertyAsString", "entity", "column", "field", "LookupField", "init_LookupField", "__esmMin", "init_fields", "BaseField", "displayName", "entityType", "isRequired", "Visible", "entitySet", "options", "optionsFilter", "optionsText", "multiple", "lookupCol", "instructions", "item", "SearchSelectModule", "LookupModule", "val", "optsFilter", "resolve", "reject", "isLoadingSubscription", "isLoading", "valArr", "value", "foundEntity", "optionEntity", "newEntity", "sortByTitle", "init_entity_utilities", "__esmMin", "a", "b", "People", "init_People", "__esmMin", "_People", "ID", "Title", "LoginName", "IsGroup", "IsEnsured", "props", "Page", "init_Page", "__esmMin", "init_primitives", "Entity", "params", "init_entities", "__esmMin", "init_People", "init_Page", "assetsPath", "init_env", "__esmMin", "fromPathTemplateLoader", "fromPathViewModelLoader", "init_knockout_extensions", "__esmMin", "init_entities", "init_infrastructure", "init_env", "callback", "oldValue", "_oldValue", "newValue", "arrayChanges", "addedValues", "value", "element", "valueAccessor", "allBindingsAccessor", "options", "selectedOptions", "optionsText", "onSearchInput", "populateOpts", "optionElements", "option", "optionElement", "selectedOption", "e", "opt", "allBindings", "viewModel", "bindingContext", "selectedUnwrapped", "i", "o", "schema", "elemId", "userKeys", "pickerControl", "observable", "userJSObject", "user", "ensureUserByKeyAsync", "person", "People", "userValue", "pickerUser", "path", "replaced", "_", "token", "addFiles", "fileList", "existingFiles", "newFileList", "file", "exFile", "label", "event", "files", "classToToggle", "classContainer", "containerType", "curIcon", "name", "templateConfig", "assetsPath", "response", "error", "text", "viewModelConfig", "module", "viewModelConstructor", "directRegisterComponent", "name", "template", "viewModel", "html", "init_register_components", "__esmMin", "executeQuery", "currCtx", "resolve", "reject", "sender", "args", "principalToPeople", "oPrincipal", "isGroup", "getDefaultGroups", "defaultGroups", "sal", "result", "key", "getGroupUsers", "groupName", "siteGroups", "url", "group", "fetchSharePointData", "getUserPropsAsync", "userId", "userPropsUrl", "userInfoUrl", "userInfo", "userProps", "findPropValue", "props", "prop", "copyFileAsync", "sourceFilePath", "destFilePath", "uri", "ensureUserByKeyAsync", "userName", "context", "oUser", "onEnsureUserSucceeded", "user", "onEnsureUserFailed", "data", "getSPSiteGroupByName", "userGroup", "SPList", "listDef", "self", "init", "listEndpoint", "list", "setListPermissionsAsync", "itemPermissions", "reset", "oList", "setResourcePermissionsAsync", "setListPermissions", "valuePairs", "callback", "users", "resolvedGroups", "web", "vp", "resolvedGroup", "onFindItemSucceeded", "groupPairs", "roleDefBindingColl", "userPairs", "onSetListPermissionsSuccess", "onSetListPermissionsFailure", "onFindItemFailed", "mapObjectToListItem", "val", "item", "mapItemToListItem", "createListItemAsync", "entity", "folderPath", "itemCreateInfo", "folderUrl", "oListItem", "restrictedFields", "onCreateListItemSucceeded", "onCreateListItemFailed", "mapListItemToObject", "out", "getListItems", "caml", "fields", "camlQuery", "collListItem", "onGetListItemsSucceeded", "listItemEnumerator", "foundObjects", "listObj", "field", "colVal", "onGetListItemsFailed", "getListItemsAsync", "findByIdAsync", "id", "findById", "e", "getById", "queryFields", "expandFields", "getQueryFields", "apiEndpoint", "getListFields", "listFields", "f", "fieldSchema", "lf", "idString", "titleString", "findByColumnValueAsync", "columnFilters", "orderByColumn", "sortAsc", "count", "includePermissions", "includeFolders", "orderBy", "colFilterArr", "colFilter", "filter", "include", "expand", "page", "loadNextPage", "cursor", "onGetListItemSucceeded", "onGetListItemFailed", "updateListItemAsync", "onUpdateListItemsSucceeded", "onUpdateListItemFailed", "deleteListItem", "onDeleteListItemsSucceeded", "onDeleteListItemsFailed", "deleteListItemAsync", "setItemPermissionsAsync", "getoListItemByIdAsync", "role", "ensuredPrincipalResult", "currCtx2", "roleDef", "getItemPermissionsAsync", "oListItems", "onQuerySuccess", "ItemPermissions", "roleEnumerator", "roleColl", "Role", "onQueryFailed", "getListPermissions", "getServerRelativeFolderPath", "relFolderPath", "builtPath", "upsertFolderPathAsync", "upsertLibFolderByPath", "upsertListFolderByPath", "setFolderReadonlyAsync", "targetPerms", "getFolderPermissionsAsync", "setFolderPermissionsAsync", "ensureFolderPermissionsAsync", "serverRelFolderPath", "response", "permissionResults", "missingPerms", "targetPermPair", "targetLoginName", "targetPerm", "curPerm", "curUser", "curBinding", "getFolderContentsAsync", "allItems", "getFolderItemByPath", "roles", "principals", "bindings", "principal", "logins", "principalRoles", "bindingEnumerator", "binding", "camlq", "allFolders", "folderArr", "idx", "upsertListFolderInner", "parentPath", "success", "folderName", "curPath", "ensureListFolder", "iFolder", "folderId", "path", "newItem", "onCreateFolderSucceeded", "onCreateFolderFailed", "onExists", "onNonExists", "ctx", "folder", "onQueryFolderSucceeded", "onQueryFolderItemSuccess", "folderItem", "onQueryFolderItemFailure", "onQueryFolderFailed", "createFolderInternal", "parentFolder", "folderNames", "curFolder", "subFolderUrl", "setFolderPermissions", "onFindFolderSuccess", "onSetFolderPermissionsSuccess", "onSetFolderPermissionsFailure", "onFindFolderFailure", "showModal", "formName", "title", "options", "listPath", "rootFolder", "formsPath", "showCheckinModal", "fileRef", "checkinWithComment", "comment", "showVersionHistoryModal", "itemId", "getVersionHistoryUrl", "uploadNewDocumentAsync", "siteString", "UPLOADCHUNKSIZE", "uploadchunkActionTypes", "uploadFileRestChunking", "file", "fileName", "progress", "blob", "chunkSize", "fileSize", "totalBlocks", "jobGuid", "getGUID", "currentPointer", "startUpload", "continueUpload", "finishUpload", "uploadId", "chunk", "fileOffset", "uploadFileRest", "uploadFileToFolderAndUpdateMetadata", "payload", "job", "uploadQueue", "updateUploadedFileMetadata", "itemUri", "fileResult", "copyFiles", "sourceFolderPath", "destFolderPath", "onError", "sourcePath", "destPath", "folderSrc", "files", "dest", "destLibUrl", "copyFilesAsync", "sourceFolder", "destFolder", "ensureList", "listInfo", "method", "headers", "opts", "siteEndpoint", "d", "c", "r", "serverRelativeUrl", "webRoot", "RoleDef", "JobProcessor", "init_sal", "__esmMin", "siteRoles", "inputRole", "targetRole", "roleName", "publicMembers", "createSiteGroup", "permissions", "groupCreationInfo", "collRoleDefinitionBinding", "perm", "oRoleDefinition", "collRollAssignment", "onCreateGroupSucceeded", "roleInfo", "rd", "onCreateGroupFailed", "getUserGroups", "everyone", "oGroups", "onQueryGroupsSucceeded", "groups", "groupsInfo", "groupsEnumerator", "oGroup", "onQueryGroupsFailed", "getUsersWithGroup", "oUsers", "onGetUserSuccess", "userObjs", "userEnumerator", "userObj", "onGetUserFailed", "sourceLib", "destLib", "_ItemPermissions", "hasUniqueRoleAssignments", "newRoleDef", "principalRole", "newRole", "permission", "_Role", "roleDefs", "roleDefsEnumerator", "_RoleDef", "name", "basePermissions", "maxConcurrency", "asyncFunction", "error", "getUsersByGroupName", "groupName", "users", "getGroupUsers", "userProps", "init_authorization", "__esmMin", "init_sal", "init_infrastructure", "__esmMin", "init_entity_utilities", "init_knockout_extensions", "init_register_components", "init_sal", "init_authorization", "PeopleField", "init_PeopleField", "__esmMin", "init_infrastructure", "init_PeopleModule", "init_People", "init_sal", "init_fields", "BaseField", "params", "groupName", "group", "ensureUserByKeyAsync", "users", "getUsersByGroupName", "sortByTitle", "groupId", "opts", "user", "val", "People", "vals", "u", "PeopleModule", "SelectField", "init_SelectField", "__esmMin", "init_fields", "BaseField", "displayName", "isRequired", "Visible", "options", "multiple", "optionsText", "instructions", "SearchSelectModule", "SelectModule", "val", "TextAreaField", "init_TextAreaField", "__esmMin", "init_fields", "BaseField", "params", "TextAreaModule", "TextField", "init_TextField", "__esmMin", "init_fields", "BaseField", "params", "TextModule", "init_fields", "__esmMin", "init_BaseField", "init_BlobField", "init_CheckboxField", "init_DateField", "init_LookupField", "init_PeopleField", "init_SelectField", "init_TextAreaField", "init_TextField", "ConstrainedEntity", "init_constrained_entity", "__esmMin", "init_primitives", "init_fields", "Entity", "params", "out", "key", "inputObj", "fieldMap", "val", "BaseField", "showErrors", "field", "AuditCoversheet", "init_audit_coversheet", "__esmMin", "init_entities", "init_store", "init_constrained_entity", "init_fields", "init_application_db_context", "ConstrainedEntity", "params", "TextField", "LookupField", "AuditRequest", "appContext", "AuditOrganization", "auditOrganizationStore", "request", "val", "requestActionOffices", "opt", "AuditEmail", "init_audit_email", "__esmMin", "init_constrained_entity", "ConstrainedEntity", "params", "ORGROLES", "AuditOrganization", "init_audit_organization", "__esmMin", "init_constrained_entity", "ConstrainedEntity", "params", "AUDITREQUESTSTATES", "AUDITREQUESTTYPES", "AuditRequest", "init_audit_request", "__esmMin", "init_audit_organization", "init_fields", "init_primitives", "init_validation_error", "init_store", "init_application_db_context", "ConstrainedEntity", "params", "ValidationError", "SelectField", "TextField", "LookupField", "AuditOrganization", "auditOrganizationStore", "allRequestingOfficesFilter", "appContext", "DateField", "dateFieldTypes", "CheckboxField", "TextAreaField", "allActionOfficesFilter", "PeopleField", "AuditBulkRequest", "init_audit_bulk_request", "__esmMin", "init_audit_request", "AuditRequest", "params", "newReq", "Comment", "init_comment", "__esmMin", "init_primitives", "init_fields", "_Comment", "ConstrainedEntity", "params", "TextField", "id", "text", "author", "timestamp", "newComment", "ActiveViewer", "init_active_viewer", "__esmMin", "init_primitives", "init_fields", "ConstrainedEntity", "TextField", "DateField", "dateFieldTypes", "ActiveViewersComponent", "init_active_viewers_module", "__esmMin", "init_active_viewer", "init_application_db_context", "entity", "fieldName", "loginName", "filteredViewers", "viewer", "ActiveViewer", "viewerToRemove", "set", "appContext", "commentChainTemplate", "init_CommentChainTemplate", "__esmMin", "init_infrastructure", "html", "commentChainComponentName", "CommentChainComponent", "CommentChainModule", "init_comment_chain_module", "__esmMin", "init_application_db_context", "init_infrastructure", "init_comment", "init_CommentChainTemplate", "entity", "fieldName", "blobField", "comment", "Comment", "commentToRemove", "set", "appContext", "directRegisterComponent", "commentChainTemplate", "AuditRequestsInternal", "init_audit_request_internal", "__esmMin", "init_fields", "init_constrained_entity", "init_audit_request", "init_comment", "init_active_viewer", "init_active_viewers_module", "init_comment_chain_module", "init_application_db_context", "ConstrainedEntity", "params", "BlobField", "ActiveViewer", "Comment", "LookupField", "AuditRequest", "appContext", "CommentChainComponent", "ActiveViewersComponent", "specialGroupsLoading", "qaGroupLoading", "User", "currentUser", "init_people_manager", "__esmMin", "init_entities", "init_infrastructure", "_User", "People", "ID", "Title", "LoginName", "LookupValue", "WorkPhone", "EMail", "IsGroup", "IsEnsured", "Groups", "group", "getDefaultGroups", "systemRole", "userIsOwner", "userProps", "getUserPropsAsync", "AuditResponseStates", "AuditResponse", "init_audit_response", "__esmMin", "init_primitives", "init_fields", "init_entities", "init_application_db_context", "init_active_viewer", "init_active_viewers_module", "init_store", "init_people_manager", "ConstrainedEntity", "params", "TextField", "LookupField", "AuditRequest", "appContext", "SelectField", "TextAreaField", "DateField", "dateFieldTypes", "PeopleField", "AuditOrganization", "auditOrganizationStore", "request", "val", "requestActionOffices", "opt", "BlobField", "ActiveViewer", "ActiveViewersComponent", "file", "fileMetadata", "currentUser", "AuditBulkResponse", "init_audit_bulk_response", "__esmMin", "init_entities", "AuditResponse", "params", "AuditResponseDocStates", "AuditResponseDoc", "init_audit_response_doc", "__esmMin", "init_primitives", "init_fields", "init_audit_response", "init_audit_request", "init_application_db_context", "ConstrainedEntity", "params", "TextField", "DateField", "dateFieldTypes", "SelectField", "TextAreaField", "LookupField", "AuditRequest", "appContext", "AuditResponse", "PeopleField", "newFileName", "AuditResponseDocRO", "init_audit_response_doc_ro", "__esmMin", "init_primitives", "ConstrainedEntity", "params", "request", "response", "AuditROEmailLog", "init_audit_ro_email_log", "__esmMin", "init_primitives", "_AuditROEmailLog", "ConstrainedEntity", "params", "AuditConfiguration", "init_config", "__esmMin", "init_primitives", "ConstrainedEntity", "params", "val", "init_entities", "__esmMin", "init_audit_coversheet", "init_audit_email", "init_audit_organization", "init_audit_request", "init_audit_bulk_request", "init_audit_request_internal", "init_audit_response", "init_audit_bulk_response", "init_audit_response_doc", "init_audit_response_doc_ro", "init_audit_ro_email_log", "init_config", "mapObjectToEntity", "inputObject", "targetEntity", "DEBUG", "key", "mapValueToEntityProperty", "propertyName", "inputValue", "mapObjectToViewField", "inVal", "fieldMapping", "outVal", "item", "generateObject", "fieldMap", "mapEntityToObject", "input", "selectedFields", "entity", "allWriteableFieldsSet", "field", "allWriteableFields", "storedFieldKey", "mapViewFieldToValue", "DbContext", "EntitySet", "init_orm", "__esmMin", "init_entities", "init_infrastructure", "Page", "copyFileAsync", "entityType", "set", "val", "newSet", "allFieldsSet", "e", "SPList", "id", "fields", "result", "newEntity", "columnFilters", "orderByColumn", "sortAsc", "count", "includePermissions", "includeFolders", "returnCursor", "results", "cursor", "resultObj", "refresh", "entityToLoad", "folderPath", "writeableEntity", "newId", "entityId", "valuePairs", "reset", "itemPermissions", "relFolderPath", "entities", "salValuePairs", "vp", "file", "filename", "updates", "progress", "itemId", "args", "sourceFolder", "targetFolder", "name", "title", "resolve", "reject", "fileRef", "init_sal", "__esmMin", "init_orm", "application_db_context_exports", "__export", "ApplicationDbContext", "appContext", "init_application_db_context", "__esmMin", "init_entities", "init_sal", "DbContext", "EntitySet", "AuditBulkRequest", "AuditBulkResponse", "AuditConfiguration", "AuditCoversheet", "AuditEmail", "AuditOrganization", "AuditResponse", "AuditResponseDoc", "AuditResponseDocRO", "AuditRequest", "AuditRequestsInternal", "AuditROEmailLog", "InitReport", "m_siteUrl", "m_listTitleRequests", "m_listNameRequests", "m_listTitleRequestsInternal", "m_listNameRequestsInternal", "m_listTitleResponses", "m_listNameResponses", "m_libTitleRequestDocs", "m_libNameRequestDocs", "m_libTitleCoverSheet", "m_libNameCoverSheet", "m_libTitleResponseDocs", "m_libNameResponseDocs", "m_libTitleResponseDocsEA", "m_libNameResponseDocsEA", "m_listTitleActionOffices", "m_listNameActionOffices", "m_listTitleEmailHistory", "m_listNameEmailHistory", "m_listTitleBulkResponses", "m_listNameBulkResponses", "m_listTitleBulkPermissions", "m_listNameBulkPermissions", "m_groupNameSpecialPermName1", "m_groupNameSpecialPermName2", "m_groupNameQA", "m_groupNameEA", "m_libResponseDocsLibraryGUID", "m_arrSiteGroups", "m_arrAOs", "m_fnRefresh", "hard", "curPath", "tabIndex", "responseNumOpen", "responseNumProcessed", "m_fnOnLoadDisplayTimeStamp", "curDate", "m_fnOnLoadDisplayTabAndResponse", "paramTabIndex", "bFiltered", "paramResponseNum", "m_fnOnLoadFilterResponses", "responseStatus1", "responseStatus2", "count", "cntOpen", "cntReOpened", "resStatus1", "resStatus2", "eacher", "reqStatus", "resStatus", "m_fnLoadSiteGroups", "itemColl", "listItemEnumerator", "oListItem", "id", "loginName", "title", "groupObject", "m_fnGetSPSiteGroup", "groupName", "userGroup", "x", "m_fnLoadActionOffices", "aoObject", "m_fnGetAOSPGroupName", "oGroup", "m_fnCheckSPItemHasGroupPermission", "item", "permissionLevel", "match", "roleAssignments", "rolesEnumerator", "role", "roleMember", "memberTitleName", "roleDefs", "roleDefsEnumerator", "rd", "rdName", "m_fnGoToResponse", "responseTitle", "isIA", "bFound", "m_fnGetResponseDocStyleTag2", "documentStatus", "styleTag", "m_fnGetResponseDocStyleTag", "m_fnCheckIfEmailFolderExists", "items", "requestNumber", "bFolderExists", "folderItem", "itemName", "m_cntAddToEmailFolder", "m_cntAddedToEmailFolder", "m_fnCreateEmailFolder", "list", "requestItem", "OnComplete", "currCtx", "web", "itemCreateInfo", "roleDefBindingCollAdmin", "roleDefBindingCollContribute", "roleDefBindingCollRestrictedRead", "roleDefBindingCollRestrictedContribute", "spGroupQA", "onUpdatePermsSucceeded", "arrActionOffice", "actionOfficeName", "actionOfficeGroupName", "actionOfficeGroup", "onUpdateAOPermsSucceeded", "onUpdateAOPermsFailed", "sender", "args", "currCtx2", "web2", "data", "onUpdatePermsFailed", "m_fnSortResponseTitleNoCase", "a", "b", "aTitle", "bTitle", "newA", "newB", "aIndex", "subA", "lastA", "intA", "newIntA", "bIndex", "subB", "lastB", "intB", "newIntB", "m_fnSortResponseObjectNoCase", "m_fnSortNoCase", "m_fnSortDate", "m_fnAddOptions", "arr", "ddlID", "dateSort", "responseSort", "rOptions", "j", "arrLength", "option", "thisDDL", "m_fnExistsInArr", "val", "m_fnGetTrueFalseIcon", "m_fnGetFriendlyDisplayName", "fieldName", "user", "m_fnPadDigits", "totalDigits", "pd", "i", "m_fnPreciseRound", "num", "decimals", "sign", "m_fnGetFriendlyFileSize", "fileSize", "m_fnISODateString", "d", "pad", "n", "m_fnBindHandlerResponseDoc", "event", "curIcon", "m_fnGetLookupFormField", "fieldTitle", "m_fnGetLookupDisplayText", "m_fnSetLookupFromFieldNameByText", "text", "theSelect", "m_fnGetTagFromIdentifierAndTitle", "theInput", "opt", "m_fnSetSelectedOptionByText", "select", "opts", "optLength", "tagName", "identifier", "idLength", "tags", "tagID", "m_fnViewUserManuals", "docType", "options", "m_fnPrintPage", "pageTitle", "divTbl", "siteUrl", "cssLink1", "cssLink2", "divOutput", "updatedDivOutput", "printDateString", "cssFile1", "cssFile2", "def1", "def2", "cssFileText", "html", "printWP", "m_fnExportToCsv", "fileName", "tableName", "removeHeader", "m_fnGetCellValues", "csv", "m_fnConvertToCsv", "uri", "downloadLink", "table", "deets", "tableArray", "r", "c", "m", "objArray", "array", "str", "line", "index", "value", "array1", "publicMembers", "libGUID", "html", "_a", "aoDbTemplate", "__template", "state", "setUrlParam", "param", "newVal", "getUrlParam", "search", "regex", "query", "urlParams", "results", "TabsModule", "tabOpts", "urlParam", "tab", "tabId", "tabById", "newTab", "setUrlParam", "event", "Tab", "id", "linkText", "template", "init_application_db_context", "init_entities", "init_application_db_context", "init_application_db_context", "init_entities", "init_application_db_context", "init_store", "init_infrastructure", "init_people_manager", "taskStates", "Task", "msg", "blocking", "ProgressTask", "_ProgressTask", "percentDone", "params", "runningTasks", "blockingTasks", "task", "TaskDef", "msg", "blocking", "type", "taskDefs", "responseTitle", "coversheetName", "page", "entitySet", "responseDocTitle", "ProgressTask", "addTask", "taskDef", "newTask", "Task", "finishTask", "activeTask", "removeTask", "taskToRemove", "init_people_manager", "init_infrastructure", "init_audit_ro_email_log", "init_application_db_context", "init_people_manager", "init_infrastructure", "init_entities", "init_application_db_context", "init_people_manager", "init_infrastructure", "init_entities", "init_store", "init_entities", "init_application_db_context", "init_infrastructure", "init_infrastructure", "modalDialogTemplate", "html", "componentName", "currentDialogs", "toggle", "ModalDialogModule", "dialogOpts", "toggle", "show", "result", "currentDialogs", "node", "dragElement", "resizeDialog", "directRegisterComponent", "componentName", "modalDialogTemplate", "elmnt", "pos1", "pos2", "pos3", "pos4", "dragger", "dragMouseDown", "e", "closeDragElement", "elementDrag", "uploadResponseDocFile", "response", "file", "uploadResponseDocTask", "addTask", "taskDefs", "fileMetadata", "appContext", "currentBlock", "totalBlocks", "finishTask", "init_people_manager", "init_knockout_extensions", "Audit", "responseParam", "paramShowSiteActionsToAnyone", "SetTimer", "intervalRefreshID", "divVal", "count", "m_bigMap", "m_arrRequests", "m_arrResponses", "m_arrPermissions", "m_IA_SPGroupName", "m_IA_ActionOffice", "ownerGroup", "memberGroup", "visitorGroup", "m_groupColl", "m_requestItems", "m_responseItems", "m_ResponseDocsItems", "m_aoItems", "m_responseDocsLibrary", "m_statusToFilterOn", "m_curResponseSelectedIsEditableByAO", "m_bIsTransactionExecuting", "m_responseStatus1", "m_responseStatus2", "ViewModel", "self", "Tab", "TabsModule", "runningTasks", "blockingTasks", "newResponse", "setUrlParam", "requestIntDueDate", "responseName", "responseStatus", "eacher", "hide", "m_fnSubmitPackage", "oResponse", "m_fnUploadResponseDoc", "oResponseDoc", "m_fnMarkForDeletionResponseDoc", "value", "newValue", "paramTabIndex", "paramResponseNum", "_myViewModel", "BindHandlersOnLoad", "bOpenResponses", "LoadTabResponseInfoCoverSheets", "LoadTabResponseInfoResponseDocs", "files", "resId", "response", "appContext", "promises", "file", "resolve", "newSheet", "uploadResponseDocFile", "fieldName", "sortAsResponse", "types", "item", "ddArr", "responseStatusType", "requestStatus", "LoadInfo", "currCtx", "web", "m_currentUser", "requestList", "requestQuery", "responseList", "responseQuery", "responseDocsLib", "responseDocsQuery", "aoList", "aoQuery", "OnSuccess", "OnFailure", "sender", "args", "m_fnLoadData", "statusId", "LoadLibGUIDS", "ao", "LoadRequests", "LoadResponses", "LoadResponseDocs", "LoadTabStatusReport", "cnt", "listItemEnumerator", "oListItem", "emailSent", "id", "number", "status", "subject", "arrActionOffice", "actionOffice", "x", "comments", "relatedAudit", "actionItems", "internalDueDate", "closedDate", "requestObject", "responseObject", "title", "modifiedDate", "returnReason", "responseDocID", "requestNumber", "responseID", "bigMapItem", "indexOfArrResponses", "responseDocObject", "fileSize", "receiptDate", "arr", "fbody", "responseArr", "arrResponseTitle", "arrResponseInternalDueDate", "arrResponseStatus", "resStatus1", "resStatus2", "arrlength", "responseTitle", "highlight", "aResponse", "coverSheetLib", "coverSheetQuery", "m_subsetCoverSheetItems", "data", "arrCS", "y", "curActionOffice", "csFolder", "csTitle", "encodedTitle", "z", "RenderResponses", "rowCount", "cntAddedByAO", "arrResponseDocs", "arrResponseSummary", "waitDialog", "resetColor", "notifyId", "m_fnFormatEmailBodyToIAFromAO", "oRequest", "emailText", "responseTitleBody", "requestID", "options", "OnCallbackForm", "rootFolder", "result", "responseToSubmit", "OnSuccessLoadedResponseDocs", "ctOpenResponseDocs", "responseDocOpenItems", "m_waitDialog", "responseItem", "err", "emailSubject", "itemCreateInfo", "emailList", "OnSuccessUpdateResponse", "OnFailureUpdateResponse", "OnFailureLoadedResponseDocs", "folderPath", "responseDocLib", "responseDocQuery", "emailListQuery", "emailListFolderItems", "itemID", "BindPrintButton", "BindExportButton", "btnPrint", "divTbl", "pageTitle", "btnExport", "fileNamePrefix", "tbl", "event", "curDate", "GoToResponse", "publicMembers", "InitReport", "aoDbTemplate"]
}
