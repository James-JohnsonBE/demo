<div class="request-detail-view" data-bind="visible: currentRequest">
  <div>
    <div
      id="divRequestClose"
      style="width: 300px"
      data-bind="visible: bDisplayClose"
    >
      <fieldset style="border-color: GreenYellow">
        <legend style="font-weight: bold; font-size: 12pt">Action</legend>
        <span class="fa-solid fa-lock"></span
        ><button
          type="button"
          class="btn btn-link"
          id="btnCloseRequest"
          title="Close this Request"
          data-bind="click: $root.ClickCloseRequest"
        >
          Close this Request
        </button>
      </fieldset>
    </div>

    <div data-bind="if: currentRequestResponsesReadyToClose().length">
      <fieldset class="emphasized-section">
        <legend>Responses Ready to Close</legend>
        <table class="tablesorter">
          <thead>
            <tr>
              <th>Response</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody data-bind="foreach: currentRequestResponsesReadyToClose">
            <tr>
              <td
                class="response-title"
                data-bind="attr: {'id': 'response-item-title-' + title}"
              >
                <span
                  title="View Response Docs"
                  class="btn btn-link"
                  data-bind="text: title, click: $parent.viewResponseDocs"
                ></span>
              </td>
              <td>
                <button
                  type="button"
                  class="btn btn-link"
                  title="Close Response"
                  data-bind="click: clickCloseResponse"
                >
                  <span class="fa-solid fa-circle-check"></span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <button
          type="button"
          class="btn btn-link"
          title="Close all Responses"
          data-bind="click: clickCloseReadyResponses"
        >
          <span class="fa-solid fa-check-double"></span> Close All Responses
        </button>
      </fieldset>
    </div>

    <div
      id="divRequestInfo"
      class="audit-form"
      data-bind="with: currentRequest"
    >
      <div class="form-header">
        <h3 class="uppercase form-title">
          AUDIT REQUEST DETAILS
          <span class="fw-semibold" data-bind="text: number"></span> |
          <span class="text-primary"
            >FY-<span data-bind="text: fiscalYear"></span
          ></span>
        </h3>
        <button
          type="button"
          class="btn btn-link form-title"
          data-bind="click: $parent.refreshRequest"
        >
          <i title="Refresh Request" class="fa-solid fa-arrows-rotate"></i>
        </button>
      </div>
      <!-- ko if: typeof(activeViewers) != 'undefined' -->
      <div
        id="divRequestActiveViewers"
        data-bind="visible: activeViewers.viewers().length, with: activeViewers"
      >
        <fieldset>
          <legend>
            <span class="fa-solid fa-triangle-exclamation"></span
            ><span data-bind="text: viewers().length"></span> Active Viewers
          </legend>
          <ul data-bind="foreach: viewers">
            <li>
              <div class="active-viewer">
                <div
                  data-bind="text: viewer + ' @ ' + timestamp.toLocaleString()"
                ></div>
                <div
                  style="cursor: pointer"
                  data-bind="click: $parent.onRemove"
                  class="fa-solid fa-xmark"
                ></div>
              </div>
            </li>
          </ul>
        </fieldset>
      </div>
      <!-- /ko -->
      <div class="form-row uppercase">
        <dl class="">
          <dt>Request #</dt>
          <dd data-bind="text: number"></dd>
          <dt>Subject</dt>
          <dd data-bind="text: subject"></dd>
          <dt>Requesting Office</dt>
          <dd data-bind="text: requestingOffice"></dd>
          <dt>Sensitivity</dt>
          <dd data-bind="text: sensitivity"></dd>
          <dt>Internal Due Date</dt>
          <dd data-bind="text: internalDueDate"></dd>
          <dt>Due Date</dt>
          <dd data-bind="text: dueDate"></dd>
        </dl>
        <dl>
          <dt>Type</dt>
          <dd data-bind="text: reqType"></dd>
          <dt>Status</dt>
          <dd>
            <span
              id="requestInfoStatus"
              class="uppercase"
              data-bind="text: status, class: status == 'Closed' ? 'danger' : 'success' "
            ></span>
            <span class="danger" data-bind="visible: status == 'Closed'"
              >on
              <span data-bind="text: closedDate"></span>
            </span>
          </dd>
          <dt>Sample?</dt>
          <dd>
            <span id="requestInfoSample">
              <span data-bind="if: sample"
                ><span class="fa-solid fa-check"></span> Yes</span
              >
              <span data-bind="if: !sample"
                ><span class="fa-solid fa-xmark"></span> No</span
              >
            </span>
          </dd>
          <dt>Receipt Date</dt>
          <dd data-bind="text: receiptDate"></dd>
          <dt>Related Audit</dt>
          <dd data-bind="text: relatedAudit"></dd>
        </dl>
      </div>
      <div class="form-row">
        <dl>
          <dt>Action Items</dt>
          <dd data-bind="html: actionItems"></dd>
          <dt>Comments</dt>
          <dd data-bind="html: comments"></dd>
        </dl>
      </div>

      <div class="form-row">
        <div class="emphasized-section">
          <div class="fw-semibold">Internal Status Comments</div>
          <!-- ko if: typeof(internalStatus) != 'undefined' -->
          <div class="commentChain" data-bind="with: internalStatus">
            <div data-bind="if: comments().length">
              <!-- ko if: showHistoryBool -->
              <!-- ko foreach: comments -->
              <div class="comment card">
                <div class="card-body">
                  <div class="text" data-bind="text: text"></div>
                  <div>
                    <span
                      class="info"
                      data-bind="text: author + ' @ ' + timestamp.toLocaleString()"
                    ></span>
                    <button
                      type="button"
                      title="Delete Comment"
                      class="remove btn btn-link danger"
                      data-bind="click: $parent.onRemove"
                    >
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
              <!-- /ko -->
              <!-- /ko -->
              <!-- ko ifnot: showHistoryBool -->
              <div
                class="comment card"
                data-bind="with: comments()[comments().length - 1]"
              >
                <div class="card-body">
                  <div class="text" data-bind="text: text"></div>
                  <div>
                    <span
                      class="info"
                      data-bind="text: author + ' @ ' + timestamp.toLocaleString()"
                    ></span>
                    <button
                      type="button"
                      title="Delete Comment"
                      class="remove btn btn-link danger"
                      data-bind="click: $parent.onRemove"
                    >
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
              <!-- /ko -->
            </div>
            <button
              type="button"
              class="btn btn-link"
              title="Show hidden comments"
              data-bind="click: toggleShowHistory"
            >
              <span class="fa-solid fa-comments"></span>
              Toggle Comment History (<span
                data-bind="text: comments().length"
              ></span>
              Total)
            </button>
            <div class="new-comment">
              <textarea
                class="form-control w-full"
                cols="50"
                data-bind="textInput: newCommentText"
                placeholder="Leave a new comment..."
              ></textarea>
              <button
                type="button"
                class="btn btn-primary"
                data-bind="click: onSubmit, enable: newCommentText"
              >
                Submit
              </button>
            </div>
          </div>
          <!-- /ko -->
        </div>
      </div>
      <div class="form-row">
        <dl>
          <dt>Action Office(s)</dt>
          <dd>
            <!-- ko ifnot: actionOffices.length -->
            0 Action Offices
            <!-- /ko -->
            <span
              id="requestInfoActionOffice"
              data-bind="if: actionOffices.length"
            >
              <div
                style="cursor: pointer; white-space: nowrap"
                title="Click to view"
              >
                <span
                  class="actionOfficeContainerRequestInfo"
                  data-bind="toggleClick: $data, toggleClass: 'collapsed', classContainer: '.sr1-request-actionOfficeContainerRequestInfo-item'"
                >
                  <span class="fa-solid fa-magnifying-glass"></span
                  ><button type="button" class="btn btn-link">
                    View
                    <span data-bind="text: actionOffices.length"></span> Action
                    Offices
                  </button>
                  <!-- ko foreach: actionOffices -->
                  <div
                    class="sr1-request-actionOfficeContainerRequestInfo-item collapsed"
                    data-bind="text: ao"
                  ></div>
                  <!-- /ko -->
                </span>
              </div>
            </span>
          </dd>
        </dl>
        <dl>
          <dt>Email Action Office(s)</dt>
          <dd>
            <!-- ko ifnot: emailActionOffices.length -->
            0 Email Action Offices
            <!-- /ko -->
            <span
              id="requestInfoActionOffice"
              data-bind="if: emailActionOffices.length"
            >
              <div
                style="cursor: pointer; white-space: nowrap"
                title="Click to view"
              >
                <span
                  class="actionOfficeContainerRequestInfo"
                  data-bind="toggleClick: $data, toggleClass: 'collapsed', classContainer: '.sr1-request-actionOfficeContainerRequestInfo-item'"
                >
                  <span class="fa-solid fa-magnifying-glass"></span
                  ><button type="button" class="btn btn-link">
                    View
                    <span data-bind="text: emailActionOffices.length"></span>
                    Email Action Offices
                  </button>
                  <!-- ko foreach: emailActionOffices -->
                  <div
                    class="sr1-request-actionOfficeContainerRequestInfo-item collapsed"
                    data-bind="text: ao"
                  ></div>
                  <!-- /ko -->
                </span>
              </div>
            </span>
          </dd>
        </dl>
      </div>
      <div class="form-row">
        <dl>
          <dt>Email Sent?</dt>
          <dd>
            <span data-bind="if: emailSent"
              ><span class="fa-solid fa-check"></span> Yes</span
            >
            <span data-bind="if: !emailSent"
              ><span class="fa-solid fa-xmark"></span> No</span
            >
          </dd>
        </dl>
        <fieldset
          class="emphasized-section"
          style="
            width: 225px;
            margin-top: 5px;
            margin-left: 10px;
            padding-left: 10px;
          "
        >
          <legend>Email Actions</legend>
          <div
            id="divSendEmailAction"
            style="padding-top: 5px"
            data-bind="visible: status == 'Open' || status == 'ReOpened'"
          >
            <span class="fa-solid fa-paper-plane"></span>
            <button
              type="button"
              class="btn btn-link"
              data-bind="visible: !emailSent, click: $root.ClickSendEmail, enable: emailActionOffices.length"
              title="Send Email to Action Offices"
            >
              Send Email to Action Offices
            </button>
            <button
              type="button"
              class="btn btn-link"
              data-bind="visible: emailSent, click: $root.ClickSendEmail, enable: emailActionOffices.length"
              title="ReSend Email to Action Offices"
            >
              Re-Send Email to Action Offices
            </button>
          </div>
          <div id="divEmailHistory" style="padding-top: 5px">
            <button
              type="button"
              class="btn btn-link"
              title="View Email History"
              data-bind="click: $root.ClickViewEmailHistoryFolder"
            >
              <span class="fa-solid fa-magnifying-glass"></span> View Email
              History
            </button>
          </div>
          <div id="divSyncEmailActionOffices" style="padding-top: 5px">
            <button
              type="button"
              class="btn btn-link"
              title="Synchronize Email Action Offices"
              data-bind="click: $root.ClickSyncEmailActionOffices"
            >
              <span class="fa-solid fa-right-left"></span> Synchronize Email
              Action Offices
            </button>
          </div>
        </fieldset>
      </div>
      <div class="form-row">
        <dl>
          <dt>Special Permissions?</dt>
          <dd>
            <span data-bind="if: specialPerms == true"
              ><span class="fa-solid fa-check"></span> Yes</span
            >
            <span data-bind="if: specialPerms == false"
              ><span class="fa-solid fa-xmark"></span> No</span
            >
          </dd>
        </dl>
        <fieldset
          class="emphasized-section"
          style="
            width: 200px;
            margin-top: 5px;
            margin-left: 10px;
            padding-left: 10px;
          "
        >
          <legend>Special Permission Actions</legend>
          <div
            id="divResponsesGrantSpecialPermissions"
            style="padding-top: 5px"
          >
            <button
              type="button"
              class="btn btn-link"
              title="Grant Special Permissions"
              data-bind="click: $root.ClickGrantSpecialPermissions"
            >
              <span class="fa-solid fa-unlock"></span> Grant Special Permissions
            </button>
          </div>
          <div
            id="divResponsesRemoveSpecialPermissions"
            style="padding-top: 5px"
          >
            <button
              type="button"
              class="btn btn-link"
              title="Remove Special Permissions"
              data-bind="click: $root.ClickRemoveSpecialPermissions"
            >
              <span class="fa-solid fa-lock"></span> Remove Special Permissions
            </button>
          </div>
        </fieldset>
      </div>
      <tr></tr>

      <div id="divRequestInfoActions" class="form-row">
        <fieldset class="form-actions emphasized-section">
          <legend>Request Actions</legend>
          <div>
            <button
              type="button"
              class="btn btn-primary"
              title="View Version History"
              data-bind="click: $parent.ClickViewRequestHistory"
            >
              <span class="fa-solid fa-clock-rotate-left"></span> View Version
              History
            </button>
          </div>
          <div>
            <button
              type="button"
              class="btn btn-primary"
              title="View Request"
              data-bind="click: $root.ClickViewRequest"
            >
              <span class="fa-solid fa-magnifying-glass"></span> View Request
            </button>
          </div>
          <div>
            <button
              type="button"
              class="btn btn-success"
              title="Edit Request"
              data-bind="click: $root.ClickEditRequest"
            >
              <span class="fa-solid fa-pencil"></span> Edit Request
            </button>
          </div>
          <!-- ko ifnot: emailSent  -->
          <div>
            <button
              type="button"
              class="btn btn-danger"
              title="Delete Request"
              data-bind="click: $parent.ClickDeleteRequest"
            >
              <span class="fa-solid fa-trash"></span> Delete Request
            </button>
          </div>
          <!-- /ko -->
        </fieldset>
      </div>
    </div>
  </div>

  <div class="ui-tabs-secondary request-detail-documents">
    <!-- ko using: tabs -->
    <ul class="ui-tabs-nav" data-bind="foreach: tabOpts">
      <li
        data-bind="text: linkText, 
          click: $parent.clickTabLink, 
          css: {active: $parent.isSelected($data)}"
      ></li>
    </ul>
    <!-- ko foreach: tabOpts -->
    <div
      data-bind="template: {
            name: template.id,
            data: template.data
          },
          visible: $parent.isSelected($data)"
    ></div>
    <!-- /ko -->
    <!-- /ko -->
  </div>
</div>

<script id="requestDetailCoversheetsTabTemplate" type="text/html">
  <div id="divCoverSheets" data-bind="visible: currentRequest">
    <div id="divCoverSheetActions" class="w-fit">
      <div data-bind="visible: coverSheetFiles().length">
        Uploading Coversheet!
        <progress></progress>
      </div>
      <div class="quick-links secondary">
        <label data-bind="visible: !coverSheetFiles().length">
          <div
            class="btn btn-link"
            title="Upload Cover Sheet or Supplemental Document"
            data-bind=""
          >
            <span class="fa-solid fa-upload"></span> Upload Cover Sheet or
            Supplemental Document
          </div>
          <input
            style="display: none"
            type="file"
            data-bind="files: coverSheetFiles"
          />
        </label>
      </div>
    </div>
    <div
      id="divEmptyCoversheetsMsg"
      style="border: 0px !important; font-style: italic"
      data-bind="visible: arrCurrentRequestCoverSheets().length <= 0"
    >
      There are 0 coversheets
    </div>
    <table
      id="tblCoverSheets"
      class="tablesorter report"
      data-bind="visible: arrCurrentRequestCoverSheets().length > 0"
    >
      <thead>
        <tr valign="top">
          <th class="sorter-false" nowrap="nowrap">Name</th>
          <th class="sorter-false" nowrap="nowrap">Action Office</th>
          <th class="sorter-false" nowrap="nowrap">Action</th>
        </tr>
      </thead>
      <tbody data-bind="foreach: arrCurrentRequestCoverSheets">
        <tr class="coversheet-item">
          <td class="coversheet-title" title="Click to Download">
            <a
              class="btn btn-link"
              data-bind="downloadLink: '../_layouts/download.aspx?SourceUrl=:folder/:title'"
              ><span data-bind="text: title"></span
            ></a>
          </td>
          <td class="coversheet-ao">
            <div
              style="cursor: pointer"
              title="Click to view"
              data-bind="visible: $data.actionOffices.length > 0, toggleClick: $data, toggleClass: 'collapsed', classContainer: '.sr1-request-actionOfficeContainerRequestInfo-item'"
            >
              <span class="fa-solid fa-magnifying-glass"></span
              ><span class="actionOfficeContainerRequestInfo"
                ><button type="button" class="btn btn-link">
                  View Action Offices
                </button></span
              >
              <!-- ko foreach: actionOffices -->
              <div
                class="sr1-request-actionOfficeContainerRequestInfo-item collapsed"
              >
                <span data-bind="text: actionOffice"></span>
              </div>
              <!-- /ko -->
            </div>
          </td>
          <td class="coversheet-action">
            <button
              type="button"
              class="btn btn-link"
              title="View Coversheet"
              data-bind="click: $root.ClickViewCoversheet"
            >
              <span
                title="View Coversheet"
                class="fa-solid fa-magnifying-glass"
              ></span>
            </button>
            <button
              type="button"
              class="btn btn-link"
              title="Edit Coversheet"
              data-bind="visible: requestStatus != 'Closed' && requestStatus != 'Canceled', click: $root.ClickEditCoversheet"
            >
              <span title="Edit Coversheet" class="fa-solid fa-pencil"></span>
            </button>
            <button
              type="button"
              class="btn btn-link"
              title="Delete Coversheet"
              data-bind="visible: requestStatus != 'Closed' && requestStatus != 'Canceled',
                click: $parent.ClickDeleteCoversheet"
            >
              <i class="fa-solid fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr valign="top">
          <th nowrap="nowrap" colspan="3">
            Total:
            <span
              id="tblCoverSheetsTotal"
              data-bind="text: arrCurrentRequestCoverSheets().length"
              >0</span
            >
          </th>
        </tr>
      </tfoot>
    </table>
  </div>
</script>

<script id="requestDetailResponsesTabTemplate" type="text/html">
  <div id="divResponses" data-bind="visible: currentRequest">
    <div data-bind="">
      <div id="divResponsesActions" class="quick-links secondary">
        <!-- ko if:  showResponseActions-->
        <div>
          <button
          type="button"
          class="btn btn-link"
            title="Add Response"
            data-bind="click: $root.ClickAddResponse"
            ><span class="fa-solid fa-plus"></span>Add Response</button
          >
        </div>
        <div>
          <button
            type="button"
            class="btn btn-link"
            title="Bulk Add Responses"

            data-bind="click: $root.ClickBulkAddResponse"
            ><span class="fa-solid fa-circle-plus"></span>Bulk Add Responses</a
          >
        </div>
        <div data-bind="visible: currentRequestResponseItems().length > 0">
          <button
            type="button"
            class="btn btn-link"
            title="Bulk Edit Responses"

            data-bind="click: $root.ClickBulkEditResponse"
            ><span class="fa-solid fa-pencil"></span>Bulk Edit Responses</a
          >
        </div>
        <!-- /ko -->
        <div
          id="divResponsesShowHideFolderPerms"
          data-bind="visible: currentRequestResponseItems().length > 0"
        >
          <button
            type="button"
            class="btn btn-link"
            title="Show/Hide Response Folder Permissions"
            data-bind="toggleClick: $data, toggleClass: 'response-permissions', containerType: 'any'"
            ><i class="fa-solid fa-gear"></i>Show/Hide Response Folder
            Permissions</a
          >
        </div>
      </div>
    </div>

    <table
      id="tblResponses"
      class="tablesorter report"
      data-bind="visible: currentRequestResponseItems().length > 0 "
    >
      <thead>
        <tr valign="top">
          <th class="sorter-true" nowrap="nowrap">Sample #</th>
          <th class="sorter-true" nowrap="nowrap" style="text-align: left">
            Name
          </th>
          <th class="sorter-true" nowrap="nowrap">Action Office</th>
          <th class="sorter-true" nowrap="nowrap"># Docs</th>
          <th class="sorter-true" nowrap="nowrap">Status</th>
          <th class="sorter-true" nowrap="nowrap">Return Reason</th>
          <th class="sorter-false" nowrap="nowrap">Special Permission?</th>
          <th class="sorter-false response-permissions" nowrap="nowrap">
            Response Folder Permissions
          </th>
          <th class="sorter-false" nowrap="nowrap">Active Viewers</th>
          <th class="sorter-false" nowrap="nowrap">Action</th>
          <th class="sorter-false" nowrap="nowrap">Documents</th>
        </tr>
      </thead>
      <tbody data-bind="foreach: currentRequestResponseItems">
        <tr class="response-item" data-bind="css: {'highlighted': highlight}">
          <td class="response-sample">
            <span data-bind="text: sample"></span>
          </td>
          <td
            class="response-title"
            data-bind="attr: {'id': 'response-item-title-' + title}, click: highlightResponse"
          >
            <span title="View Response Docs" class="btn btn-link" data-bind="text: title, click: $parent.viewResponseDocs"></span>
          </td>
          <td
            class="response-actionOffice"
            data-bind="attr: {'title': toolTip}, style: styleTag"
          >
            <span data-bind="text: actionOffice"></span
            ><span data-bind="visible: poc" style="color: green"
              >&nbsp;POC: </span
            ><span data-bind="text: poc" style="color: green"></span>
          </td>
          <td class="response-document-cnt" >
            <span title="View Response Docs"
              class="btn btn-link"
              data-bind="text: responseDocs.length, click: $parent.viewResponseDocs"></span>
          </td>
          <td class="response-resStatus">
            <span
              data-bind="visible: resStatus != '7-Closed'"
              style="color: green"
              ><span data-bind="text: resStatus"></span>
            </span>
            <span
              data-bind="visible: resStatus == '7-Closed'"
              style="color: red"
              ><span data-bind="text: resStatus"></span>&nbsp;on&nbsp;<span
                data-bind="text: closedDate"
              ></span
              >&nbsp;by&nbsp;<span data-bind="text: closedBy"></span
            ></span>

            <div
              style="padding-top: 5px; padding-left: 20px"
              data-bind="visible: resStatus == '7-Closed'"
            >
              <i class="fa-solid fa-gear"></i
              ><button
            type="button"
            class="btn btn-link"
                title="Click to Open Response"

                data-bind="click: $root.ClickReOpenResponse"
                >Open Response?</a
              >
            </div>
          </td>
          <td class="response-returnReason" style="white-space: pre-line">
            <span data-bind="text: returnReason"></span>
          </td>
          <td class="response-specialPermissions">
            <span
              data-bind="css: (specialPerms ? 'fa-solid fa-check' : '')"
            ></span>
          </td>
          <td class="response-permissions">
            <span data-bind="html: groupPerms"></span>
          </td>
          <td class="response-viewers">
            <div
              data-bind="visible: activeViewers.viewers().length, with: activeViewers"
            >
              <fieldset>
                <legend>
                  <i class="fa-solid fa-triangle-exclamation"></i
                  ><span data-bind="text: viewers().length"></span>
                  Active Viewers
                </legend>
                <ul data-bind="foreach: viewers">
                  <li>
                    <div class="active-viewer">
                      <div
                        data-bind="text: viewer + ' @ ' + timestamp.toLocaleString()"
                      ></div>
                      <div
                        style="cursor: pointer"
                        data-bind="click: $parent.onRemove"
                      >
                        <i class="fa-solid fa-xmark"></i>
                      </div>
                    </div>
                  </li>
                </ul>
              </fieldset>
            </div>
          </td>
          <td class="response-action">
            <button
              type="button"
              class="btn btn-link"
              title="View Response"
              data-bind="click: $root.ClickViewResponse"
            >
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
            <button
              type="button"
              class="btn btn-link"
              title="Edit Response"
              data-bind="visible: resStatus != '7-Closed' && $parent.status != 'Closed' && $parent.status != 'Canceled', click: $root.ClickEditResponse"
            >
              <i class="fa-solid fa-pen"></i>
            </button>
            <button
              type="button"
              class="btn btn-link"
              title="View Version History"
              data-bind="click: ClickViewResponseHistory"
            >
              <span class="fa-solid fa-clock-rotate-left"></span>
            </button>
            <label
              title="Upload Coversheets for Action Office"
              class="btn btn-link"
              data-bind="visible: $parent.status != 'Closed' && $parent.status != 'Canceled' && ( resStatus == '1-Open' || resStatus == '2-Submitted' || resStatus == '3-Returned to Action Office' ||resStatus == '5-Returned to GFS' )"
            >
              <i
                title="Upload Coversheets"
                class="fa-solid fa-upload"
              ></i>
              <input
                type="file"
                multiple
                style="display: none"
                data-bind="files: responseCoversheetFiles"
              />
            </label>
            <button
              type="button"
              class="btn btn-link"
              title="Flag Response as Under Review"
              data-bind="visible: resStatus != '7-Closed' && $parent.status != 'Closed' && $parent.status != 'Canceled', click: $root.ClickReviewingResponse"
            >
              <i class="fa-solid fa-flag"></i>
            </button>
            <button
              type="button"
              class="btn btn-link"
              title="Delete Response"
              data-bind="visible: $parent.status != 'Closed' && $parent.status != 'Canceled' && ( resStatus == '1-Open' || resStatus == '2-Submitted' || resStatus == '3-Returned to Action Office' || resStatus == '5-Returned to GFS' ),
                click: ClickDeleteResponse"
            >
              <i class="fa-solid fa-trash"></i>
            </button>
          </td>
          <td class="response-responseDocs">
            <button
              type="button"
              class="btn btn-link"
              title="View Response Documents"
              data-bind="visible: resStatus != '7-Closed' && $parent.status != 'Closed' && $parent.status != 'Canceled', click: $root.ClickViewResponseDocFolder"
            >
              <i class="fa-solid fa-folder-open"></i>
            </button>
            <label
              class="btn btn-link"
              title="Upload Response Documents"
              data-bind="visible: $parent.status != 'Closed' && $parent.status != 'Canceled' && ( resStatus == '1-Open' || resStatus == '2-Submitted' || resStatus == '3-Returned to Action Office' ||resStatus == '5-Returned to GFS' )"
              ><i class="fa-solid fa-file-arrow-up"></i>
              <input
                type="file"
                multiple
                style="display: none"
                data-bind="files: responseDocFiles"
              />
            </label>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr valign="top">
          <th colspan="10" nowrap="nowrap">
            Total:
            <span
              id="tblResponsesTotal"
              data-bind="text: currentRequestResponseItems().length"
              >0</span
            >
          </th>
        </tr>
      </tfoot>
    </table>
  </div>
</script>

<script id="requestDetailResponseDocsTabTemplate" type="text/html">
  <div id="divResponseDocs" data-bind="visible: currentRequest">
    <div
      id="divEmptyResponseDocsMsg"
      style="border: 0px !important; font-style: italic"
      data-bind="visible: cntResponseDocs() == 0"
    >
      There are 0 response documents
    </div>

    <div
      class="quick-links secondary"
      data-bind="visible: cntResponseDocs() > 0"
    >
      <div>
        <button
            type="button"
            class="btn btn-link"
          class="btnApprovedCheckedResponseDocs"

          title="Approve Checked Response Documents"
          data-bind="click: ApproveCheckedResponseDocs, visible: currentRequest() && (currentRequest().status == 'Open' || currentRequest().status == 'ReOpened')"
        >
          <span class="fa-solid fa-circle-check"></span>
          Approve Checked Response Documents
        </button>
      </div>
      <div>
        <button
            type="button"
            class="btn btn-link"
          class="btnCheckResponseDocs"

          title="Check/Un-Check Response Documents"
          data-bind="click: CheckResponseDocs, visible: currentRequest() && (currentRequest().status == 'Open' || currentRequest().status == 'ReOpened')"
        >
          <span class="fa-solid fa-check-double"></span>
          Check Response Documents
        </button>
      </div>
      <div>
        <button
            type="button"
            class="btn btn-link"
          class="btnToggleExpand"

          title="Click to Expand/Collapse"
          data-bind="toggles: showCollapsed"
        >
          <span
            class="fa-solid"
            data-bind="class: showCollapsed() ? 'fa-expand' : 'fa-compress'"
          ></span>
          <span
            data-bind="text: showCollapsed() ? 'Expand Documents' : 'Collapse Documents'"
          ></span>
        </button>
      </div>
    </div>

    <table
      id="tblResponseDocs"
      class="tablesorter report"
      data-bind="visible: cntResponseDocs() > 0"
    >
      <thead>
        <tr valign="top">
          <th class="sorter-false" nowrap="nowrap">Type</th>
          <th class="sorter-false" nowrap="nowrap">Name</th>
          <th class="sorter-false" nowrap="nowrap">Title</th>
          <th class="sorter-false" nowrap="nowrap">Receipt Date</th>
          <th class="sorter-false" nowrap="nowrap">File Size</th>
          <th class="sorter-false" nowrap="nowrap">Checked Out</th>
          <th class="sorter-false" nowrap="nowrap">
            Status
            <span class="linkHelpResponseDocs"
              ><button
            type="button"
            class="btn btn-link"
                title="View Help"
                data-bind="click: clickHelpResponseDocs"
                style="color: #0072bc"
                ><i class="fa-solid fa-question"></i></a
            ></span>
          </th>
          <th class="sorter-false" nowrap="nowrap">Reason</th>
          <th class="sorter-false" nowrap="nowrap">Modified</th>
          <th class="sorter-false" nowrap="nowrap">Modified By</th>
          <th class="sorter-false" nowrap="nowrap">Actions</th>
        </tr>
      </thead>
      <tbody
        data-bind="foreach: { data: currentRequestResponseDocs, as: 'responseDocSummary'} "
      >
        <tr
          class="requestInfo-response-doc"
          data-bind="visible: responseDocSummary.responseDocs.length > 0,
            attr: {id: responseDocSummary.titleRowElementId() }"
        >
          <td colspan="11">
            <img
              style="background-color: transparent"
              title="Expand/Collapse"
              data-bind="
              attr: { src: (responseDocSummary.collapsed() ? '/_layouts/images/plus.gif' : '/_layouts/images/minus.gif') },
              toggles: responseDocSummary.collapsed"
            /><span>
              <button type="button"
                class="btn btn-link"
                title="View Response"
                data-bind="text: responseDocSummary.responseTitle,
                  click: $parent.ClickViewResponse">
              </button>
              </span>
              (<span data-bind="text: responseStatus"></span>)
          </td>
        </tr>

        <tr
          class="requestInfo-response-doc-item"
          data-bind="visible: responseDocSummary.showBulkApprove,
            css: (responseDocSummary.collapsed() ? 'collapsed' : '')"
        >
          <td colspan="11">
            <span class="divBulkApprove">
              <button
                type="button"
                class="btn btn-link"
                class="btnApproveAll"

                title="Click to Approve Remaining Documents"
                data-bind="click: $parent.ClickBulkApprove"
              >
                <span class="fa-solid fa-circle-check"></span>
                Approve 'Submitted' Documents for this Response below
              </button>
            </span>
          </td>
        </tr>

        <!-- ko foreach: responseDocSummary.responseDocs-->

        <tr
          class="requestInfo-response-doc-item"
          data-bind="style: styleTag,
          css: {'collapsed': responseDocSummary.collapsed(), 'highlighted': responseDocSummary.highlight}"
        >
          <td>
            <img
              data-bind="attr:{ src: $parent.siteUrl + '/_layouts/images/' + docIcon}"
            />
          </td>
          <td class="requestInfo-response-doc-title">
            <input
              type="checkbox"
              data-bind="attr: { id: ID }, visible: $parents[1].responseDocCanBeApproved(responseDocSummary, $data), checked: chkApproveResDoc"
            />

            <a
              title="Click to Download"
              data-bind="visible: $parent.responseStatus == '7-Closed' || $parent.requestStatus == 'Closed' || $parent.requestStatus == 'Canceled', downloadLink: '../_layouts/download.aspx?SourceUrl=:folder/:fileName'"
              ><span data-bind="text: fileName"></span
            ></a>
            <span
              title="Click to Open"
              data-bind="visible: $parent.responseStatus != '7-Closed' && $parent.requestStatus != 'Closed' && $parent.requestStatus != 'Canceled', html: responseDocOpenInIELink "
            ></span>
            <span
              style="float: right"
              data-bind="visible: ( documentStatus == 'Open' || documentStatus == 'Marked for Deletion') && ($parent.requestStatus == 'Open' || $parent.requestStatus == 'ReOpened') "
              ><button
            type="button"
            class="btn btn-link"
                title="Delete Response Document"

                data-bind="click: $root.ClickDeleteResponseDoc"
                ><i class="fa-solid fa-trash"></i></a
            ></span>
          </td>
          <td nowrap data-bind="text: title"></td>
          <td nowrap data-bind="text: receiptDate"></td>
          <td nowrap data-bind="text: fileSize"></td>
          <td nowrap>
            <span data-bind="visible: checkedOutBy != ''"
              ><span data-bind="text: checkedOutBy"></span>&nbsp;<img
                style="background-color: transparent"
                src="/_layouts/images/checkin.gif"
                title="Check In Document"
              /><button
            type="button"
            class="btn btn-link"

                title="Check In Document"
                data-bind="click: $root.ClickCheckInResponseDocument"
                >Check In Document</a
              ></span
            >
          </td>
          <td nowrap>
            <span data-bind="text: documentStatus"></span>
            <span
              data-bind="visible: documentStatus == 'Rejected' && ( $parent.requestStatus == 'Open' || $parent.requestStatus == 'ReOpened' ) "
              ><button
            type="button"
            class="btn btn-link"
                title="Clear Rejected Status"

                data-bind="click: $root.ClickResendRejectedResponseDocToQA"
                ><i class="fa-solid fa-circle-check"></i></a
            ></span>
          </td>
          <td data-bind="html: rejectReason"></td>
          <td
            class="requestInfo-response-doc-modified"
            data-bind="text: modifiedDate"
          ></td>
          <td
            class="requestInfo-response-doc-modifiedBy"
            data-bind="text: modifiedBy"
          ></td>
          <td nowrap>
            <span
              data-bind="visible: $parent.responseStatus == '2-Submitted' && documentStatus == 'Submitted'"
            >
              <button
                type="button"
                class="btn btn-link"
                title="Approve this Document"

                data-bind="click: $parents[1].ClickApproveResponseDoc"
              >
                <span class="fa-solid fa-circle-check"
                  ></span
                >
              </button>
              <button
                type="button"
                class="btn btn-link"
                title="Reject this Document"

                data-bind="click: $parents[1].ClickRejectResponseDoc"
              >
                <span class="fa-solid fa-circle-xmark"
                  ></span
                >
              </button>
            </span>

            <a
              title="Click to Download"
              data-bind="downloadLink: '../_layouts/download.aspx?SourceUrl=:folder/:fileName'"
              ><i class="fa-solid fa-download"></i
            ></a>
            <button
              type="button"
              class="btn btn-link"
              title="View Response Document Properties"

              data-bind="click: $root.ClickViewResponseDoc"
              ><span class="fa-solid fa-magnifying-glass"
                ></span
              ></a
            >
            <button
              type="button"
              class="btn btn-link"
              title="Edit Response Document Properties"

              data-bind="visible: $parent.responseStatus != '7-Closed' && $parent.requestStatus != 'Closed' && $parent.requestStatus != 'Canceled' && ( documentStatus == 'Sent to QA' || documentStatus == 'Open' || documentStatus == 'Submitted' ), click: $root.ClickEditResponseDoc"
              ><span class="fa-solid fa-pencil"></span></a
            >
            <button
              type="button"
              class="btn btn-link"
              title="View Version History"
              data-bind="click: $parent.ClickViewResponseDocHistory"
            >
              <span class="fa-solid fa-clock-rotate-left"></span>
            </button>
          </td>
        </tr>

        <!-- /ko -->
      </tbody>
      <tfoot>
        <tr valign="top">
          <th colspan="11" nowrap="nowrap">
            Total:
            <span id="tblResponseDocsTotal" data-bind="text: cntResponseDocs()"
              >0</span
            >
          </th>
        </tr>
      </tfoot>
    </table>
  </div>
</script>
